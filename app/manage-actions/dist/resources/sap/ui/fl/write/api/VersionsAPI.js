/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexObjectState","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/fl/initial/api/Version","sap/ui/fl/write/_internal/flexState/FlexObjectManager","sap/ui/fl/write/_internal/Versions","sap/ui/fl/write/api/ContextBasedAdaptationsAPI","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/Utils"],function(e,r,t,n,i,o,a,s,l,c){"use strict";function d(e){const r=t.getFlexReferenceForControl(e);if(!r){throw Error("The application ID could not be determined")}return r}function f(r){const t=e.getDirtyFlexObjects(r);return t.length>0}function p(e){if(!e.control){throw Error("No control was provided")}if(!e.layer){throw Error("No layer was provided")}var r=d(e.control);const t=a.getVersionsModel({reference:r,layer:e.layer});if(f(r)){t.updateDraftVersion()}return t}function u(e){var r=d(e.control);var t=s.hasAdaptationsModel({layer:e.layer,reference:r});if(!e.adaptationId&&t){return s.refreshAdaptationModel(e)}else if(e.adaptationId&&t){var n=s.getAdaptationsModel(e);n.switchDisplayedAdaptation(e.adaptationId);return Promise.resolve(e.adaptationId)}return Promise.resolve()}var v={};v.initialize=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}var r=c.getAppComponentForControl(e.control);return a.initialize({reference:d(r),layer:e.layer})};v.clearInstances=function(){a.clearInstances()};v.isDraftAvailable=function(e){var r=p(e);var t=r.getProperty("/versions");var n=t.find(function(e){return e.version===i.Number.Draft});return!!n};v.getDraftFilenames=function(e){const r=p(e);return r.getProperty("/draftFilenames")};v.isOldVersionDisplayed=function(e){var r=p(e);var t=r.getProperty("/displayedVersion");var n=r.getProperty("/activeVersion");return t!==i.Number.Draft&&t!==n};v.loadDraftForApplication=function(e){e.version=i.Number.Draft;return v.loadVersionForApplication(e)};v.loadVersionForApplication=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}const t=p(e);if(t){if(e.version===undefined){e.version=t.getProperty("/activeVersion")}t.setProperty("/displayedVersion",e.version);t.setProperty("/persistedVersion",e.version);if(e.version!==i.Number.Draft&&l.isPublishAvailable()){const r=t.getProperty("/versions");if(r.length){const n=r.find(function(r){return r.version===e.version});if(n){t.setProperty("/publishVersionEnabled",!n.isPublished)}}}}return u(e).then(function(t){const i=c.getAppComponentForControl(e.control);const o=d(i);const a=n.getByReference(o);a.version=e.version;a.displayedAdaptationId=t;n.setByReference(a,o);r.clearState(o)})};v.activate=function(e){if(!e.control){return Promise.reject("No control was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.title){return Promise.reject("No version title was provided")}const r=d(e.control);if(f(r)){return Promise.reject("Unsaved changes exist")}const t=n.getByReference(r);delete t.version;n.setByReference(t,r);return a.activate({reference:r,layer:e.layer,title:e.title,appComponent:c.getAppComponentForControl(e.control),displayedVersion:e.displayedVersion})};v.discardDraft=function(t){const i=c.getAppComponentForControl(t.control);const l=d(i);function f(){const r=e.getDirtyFlexObjects(l);o.deleteFlexObjects({reference:l,flexObjects:r});return r.length>0}if(!t.control){return Promise.reject("No control was provided")}if(!t.layer){return Promise.reject("No layer was provided")}return a.discardDraft({reference:l,layer:t.layer,discardDraftAndKeepActiveVersion:t.discardDraftAndKeepActiveVersion}).then(function(e){var i=false;if(!t.discardDraftAndKeepActiveVersion){i=f()}e.dirtyChangesDiscarded=i;if(e.backendChangesDiscarded){const i=s.hasAdaptationsModel({layer:t.layer,reference:l});if(i){return s.refreshAdaptationModel(t).then(function(i){const o=n.getByReference(l);o.displayedAdaptationId=i;n.setByReference(o,l);if(!t.discardDraftAndKeepActiveVersion){r.clearState(l)}return e})}}if(!t.discardDraftAndKeepActiveVersion){r.clearState(l)}return e})};v.publish=function(e){if(!e.selector){return Promise.reject("No selector was provided")}if(!e.layer){return Promise.reject("No layer was provided")}if(!e.version){return Promise.reject("No version was provided")}e.styleClass||="";e.reference=d(e.selector);return a.publish(e)};return v});
//# sourceMappingURL=VersionsAPI.js.map