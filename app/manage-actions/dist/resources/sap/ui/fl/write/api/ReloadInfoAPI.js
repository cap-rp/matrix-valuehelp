/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/fl/initial/api/Version","sap/ui/fl/write/_internal/flexState/compVariants/CompVariantState","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/write/api/VersionsAPI","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/registry/Settings","sap/ui/fl/Utils"],function(e,r,t,a,n,i,l,o,s,f,c,u){"use strict";function v(e,r){if(t.getByReference(r).version){return Promise.resolve(false)}return i.isVersioningEnabled(e.layer).then(function(r){return r&&o.isDraftAvailable({control:e.selector,layer:e.layer})})}function d(e,r){var a=t.getByReference(r);var n=e.layer===s.USER;if(n||a.maxLayer&&a.maxLayer===e.layer){return Promise.resolve(false)}return l.hasHigherLayerChanges({selector:e.selector,ignoreMaxLayerParameter:e.ignoreMaxLayerParameter,upToLayer:e.layer,includeCtrlVariants:e.includeCtrlVariants,includeDirtyChanges:true}).then(function(r){return r||g(e)})}function g(e){if(f.isOverLayer(s.USER,e.layer)){return n.checkSVMControlsForDirty(r.getFlexReferenceForControl(e.selector))}return false}async function y(r,a){let n=t.getByReference(a);if(n.initialAllContexts){return false}if(n.allContextsProvided===undefined){const e={selector:r.selector,layer:r.layer};await l.updateResetAndPublishInfo(e);n=t.getByReference(a)}else{e.setAllContextsProvided(a,n.allContextsProvided)}n.initialAllContexts=!n.allContextsProvided;t.setByReference(n,a);return!n.allContextsProvided}function h(e,r){if(!c.getInstanceOrUndef()?.isContextSharingEnabled(r)){return false}return t.getByReference(e).allContextsProvided===false}function R(e){return t.getByReference(e).isEndUserAdaptation===false}var A={getReloadReasonsForStart(e){const t=r.getFlexReferenceForControl(e.selector);return Promise.all([d.call(this,e,t),v(e,t),y(e,t)]).then(function(r){[e.hasHigherLayerChanges,e.isDraftAvailable,e.allContexts]=r;return e})},hasVersionStorage(e,a){const n=r.getFlexReferenceForControl(a);var i=t.getByReference(n);return!!(i.version&&i.version===e.value)},removeInfoSessionStorage(e){const a=r.getFlexReferenceForControl(e);t.removeByReference(a)},hasMaxLayerStorage(e,a){const n=r.getFlexReferenceForControl(a);var i=t.getByReference(n);return!!(i.maxLayer&&i.maxLayer===e.value)},handleReloadInfo(e){const n=r.getFlexReferenceForControl(e.selector);var i=false;var l=t.getByReference(n);if(!e.ignoreMaxLayerParameter&&e.hasHigherLayerChanges){delete l.maxLayer;delete l.adaptationLayer;i=true}if(e.versionSwitch&&l.version!==e.version){l.version=e.version;i=true}if(l.version&&e.removeVersionParameter||l.version===a.Number.Draft&&e.removeDraft){delete l.version;i=true}t.setByReference(l,n);return i},handleReloadInfoOnStart(e){const n=r.getFlexReferenceForControl(e.selector);var i=false;var l=t.getByReference(n);if(e.hasHigherLayerChanges){l.maxLayer=e.layer;i=true}if(e.isDraftAvailable){l.version=a.Number.Draft;i=true}t.setByReference(l,n);return i},initialDraftGotActivated(e){if(e.versioningEnabled){var r=this.hasVersionStorage({value:a.Number.Draft},e.selector);return!o.isDraftAvailable({control:e.selector,layer:e.layer})&&r}return false},getReloadMethod(e){const n=r.getFlexReferenceForControl(e.selector);var i={NOT_NEEDED:"NO_RELOAD",RELOAD_PAGE:"HARD_RELOAD",VIA_HASH:"CROSS_APP_NAVIGATION"};e.reloadMethod=i.NOT_NEEDED;e.isDraftAvailable||=A.hasVersionStorage({value:a.Number.Draft},e.selector);e.isDraftAvailable||=A.hasVersionStorage({value:a.Number.Draft},e.selector);e.hasVersionStorage=!!t.getByReference(n).version;if(e.activeVersion&&e.activeVersion!==a.Number.Original&&e.hasVersionStorage){e.activeVersionNotSelected=!A.hasVersionStorage({value:e.activeVersion},e.selector)}e.hasHigherLayerChanges=A.hasMaxLayerStorage({value:e.layer},e.selector);e.initialDraftGotActivated=A.initialDraftGotActivated(e);if(e.initialDraftGotActivated){e.isDraftAvailable=false}e.allContexts=h(n,e.layer);e.switchEndUserAdaptation=R(n);if(e.changesNeedReload||e.isDraftAvailable||e.hasHigherLayerChanges||e.initialDraftGotActivated||e.activeVersionNotSelected||e.allContexts||e.switchEndUserAdaptation){e.reloadMethod=i.RELOAD_PAGE;if(!e.changesNeedReload&&u.getUshellContainer()){e.reloadMethod=i.VIA_HASH}}return e}};return A});
//# sourceMappingURL=ReloadInfoAPI.js.map