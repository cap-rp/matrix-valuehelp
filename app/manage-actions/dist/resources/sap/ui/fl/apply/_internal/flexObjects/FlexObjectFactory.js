/* !
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_pick","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/ui/fl/apply/_internal/flexObjects/AnnotationChange","sap/ui/fl/apply/_internal/flexObjects/AppDescriptorChange","sap/ui/fl/apply/_internal/flexObjects/CompVariant","sap/ui/fl/apply/_internal/flexObjects/ControllerExtensionChange","sap/ui/fl/apply/_internal/flexObjects/FlexObject","sap/ui/fl/apply/_internal/flexObjects/FlVariant","sap/ui/fl/apply/_internal/flexObjects/getVariantAuthor","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/apply/_internal/flexObjects/UIChange","sap/ui/fl/apply/_internal/flexObjects/UpdatableChange","sap/ui/fl/apply/_internal/flexObjects/VariantChange","sap/ui/fl/apply/_internal/flexObjects/VariantManagementChange","sap/ui/fl/registry/Settings","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/Utils"],function(e,t,n,a,r,i,c,o,s,l,p,u,f,g,m,y,C,O,N){"use strict";const _={COMP_VARIANT_OBJECT:i,FL_VARIANT_OBJECT:s,CONTROLLER_EXTENSION:c,APP_DESCRIPTOR_CHANGE:r,ANNOTATION_CHANGE:a,UI_CHANGE:u,UPDATABLE_CHANGE:f,VARIANT_CHANGE:g,VARIANT_MANAGEMENT_CHANGE:m,FLEX_OBJECT:o};function T(e){return t(e)?{...e}:e}function d(e){if(e.fileType==="variant"){return _.COMP_VARIANT_OBJECT}else if(e.fileType==="ctrl_variant"){return _.FL_VARIANT_OBJECT}else if(e.changeType==="codeExt"){return _.CONTROLLER_EXTENSION}else if(e.appDescriptorChange){return _.APP_DESCRIPTOR_CHANGE}else if(e.fileType==="annotation_change"){return _.ANNOTATION_CHANGE}else if(e.fileType==="change"&&e.changeType==="defaultVariant"){return _.UPDATABLE_CHANGE}else if(e.fileType==="ctrl_variant_change"){return _.VARIANT_CHANGE}else if(e.fileType==="ctrl_variant_management_change"){return _.VARIANT_MANAGEMENT_CHANGE}else if(e.changeType==="deactivateChanges"){return _.FLEX_OBJECT}return _.UI_CHANGE}function A(e){const t=T(e);const n=t.type||t.changeType;let a=t.fileName||t.id;if(!a){a=N.createDefaultFileName(n);if(a.length>64){throw Error(`File name '${a}' must not exceed 64 characters`)}}const r=t.user||(!O.isDeveloperLayer(t.layer)?y.getInstanceOrUndef()&&y.getInstanceOrUndef().getUserId():undefined);return{id:a,adaptationId:t.adaptationId,layer:t.layer,content:T(t.content),texts:T(t.texts),supportInformation:{service:t.ODataService,oDataInformation:T(t.oDataInformation),command:t.command,compositeCommand:t.compositeCommand,generator:t.generator,sourceChangeFileName:t.support&&t.support.sourceChangeFileName,sourceSystem:t.sourceSystem,sourceClient:t.sourceClient,originalLanguage:t.originalLanguage,user:r},flexObjectMetadata:{changeType:n,reference:t.reference,packageName:t.packageName,projectId:t.projectId}}}const E={};E.createFromFileContent=function(e,t,a){const r={...e};var i=t||d(r);if(!i){throw new Error("Unknown file type")}r.support={generator:"FlexObjectFactory.createFromFileContent",...r.support||{}};const c=i.getMappingInfo();const s=o.mapFileContent(r,c);const l=Object.entries(s).reduce(function(e,t){n.set(t[0].split("."),t[1],e);return e},{});const u=new i(l);if(a){u.setProperty("state",p.LifecycleState.PERSISTED)}return u};E.createFlexObject=function(e){const t=A({...e,...{packageName:e.packageName||"$TMP"}});return new o(t)};E.createUIChange=function(e){e.packageName||="$TMP";const t=A(e);t.layer||=e.isUserDependent?C.USER:O.getCurrentLayer();t.selector=e.selector;t.jsOnly=e.jsOnly;t.variantReference=e.variantReference;t.isChangeOnStandardVariant=e.isChangeOnStandardVariant;t.fileType=e.fileType||"change";return new u(t)};E.createVariantChange=function(e){e.packageName||="$TMP";const t=A(e);t.variantId=e.variantId||e.selector?.id;t.fileType=e.fileType||"ctrl_variant_change";return new g(t)};E.createVariantManagementChange=function(e){e.packageName||="$TMP";const t=A(e);t.selector=e.selector;t.fileType=e.fileType||"ctrl_variant_management_change";return new m(t)};E.createAppDescriptorChange=function(e){e.compositeCommand||=e.support&&e.support.compositeCommand;if(!(e.fileName||e.id)){const t=e.type||e.changeType;e.fileName=N.createDefaultFileName(t).substring(0,64)}const t=A(e);return new r(t)};E.createAnnotationChange=function(e){e.compositeCommand||=e.support&&e.support.compositeCommand;const t=A(e);t.serviceUrl=e.serviceUrl;return new a(t)};E.createControllerExtensionChange=function(e){e.generator||="FlexObjectFactory.createControllerExtensionChange";e.changeType="codeExt";e.content={codeRef:e.codeRef};const t=A(e);t.flexObjectMetadata.moduleName=e.moduleName;t.controllerName=e.controllerName;return new c(t)};E.createFlVariant=function(e){const t=T(e);t.generator||="FlexObjectFactory.createFlVariant";const n=A(t);n.variantManagementReference=t.variantManagementReference;n.variantReference=t.variantReference;n.contexts=t.contexts;n.executeOnSelection=t.executeOnSelection;n.texts={variantName:{value:t.variantName,type:"XFLD"}};n.author=l(n.supportInformation.user,n.layer,t.authors);return new s(n)};E.createCompVariant=function(e,t){const a=T(e);a.generator||="FlexObjectFactory.createCompVariant";a.user=n.get("support.user",a);const r=A(a);r.variantId=a.variantId||r.id;r.contexts=a.contexts;r.favorite=a.favorite;r.persisted=a.persisted;r.persistencyKey=a.persistencyKey||n.get("selector.persistencyKey",a);if(a.layer===C.VENDOR||a.layer===C.CUSTOMER_BASE){r.favorite=true}if(a.executeOnSelection!==undefined){r.executeOnSelection=a.executeOnSelection}else{r.executeOnSelection=r.content&&(r.content.executeOnSelect||r.content.executeOnSelection)}r.author=l(r.supportInformation.user,r.layer,t);return new i(r)};return E});
//# sourceMappingURL=FlexObjectFactory.js.map