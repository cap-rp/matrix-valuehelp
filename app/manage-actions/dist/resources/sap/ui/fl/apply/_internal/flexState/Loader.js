/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/base/ManagedObject","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/initial/_internal/Storage","sap/ui/fl/initial/_internal/StorageUtils","sap/ui/fl/registry/Settings"],function(e,t,n,a,r,i){"use strict";function s(e){if(typeof e==="string"){e={id:e}}e.idIsLocal=true;return e}function c(e,t){if(e){[t.changes,t.variantChanges,t.variantDependentControlChanges,t.variantManagementChanges].flat().filter(e=>e.selector&&!e.selector.idIsLocal).forEach(function(e){e.selector=s(e.selector);if(e.dependentSelector){Object.keys(e.dependentSelector).forEach(t=>{const n=e.dependentSelector[t];if(Array.isArray(n)){e.dependentSelector[t]=n.map(s)}else{e.dependentSelector[t]=s(n)}})}})}return t}function o(n){r.getAllFlexObjectNamespaces().forEach(function(a){const r=e.get(a,n);if(r){e.set(a,r.filter(e=>{let n;try{n=new t(e.fileName)}catch(e){return false}n.destroy();return true}),n)}});return n}function l(e){return e&&!!n.getOvpEntry(e)}function f(e){return{changes:e,cacheKey:e.cacheKey}}function p(e){if(e?.startupParameters&&Array.isArray(e.startupParameters.hcpApplicationId)){return e.startupParameters.hcpApplicationId[0]}}function u(t){const n="deactivateChanges";const a=t.changes.map(e=>{if(e.changeType===n){return[e.fileName,...e.content.changeIds]}}).flat().filter(Boolean);if(a.length){r.getAllFlexObjectNamespaces().forEach(function(n){const r=e.get(n,t);if(r.length){e.set(n,r.filter(e=>!a.includes(e.fileName)),t)}})}return t}return{loadFlexData(e){var t=n.getBaseComponentNameFromManifest(e.manifest);if(e.partialFlexData){return a.completeFlexData({reference:e.reference,componentName:t,partialFlexData:e.partialFlexData}).then(f)}var r=e.reInitialize?undefined:n.getCacheKeyFromAsyncHints(e.reference,e.asyncHints);return a.loadFlexData({preview:n.getPreviewSectionFromAsyncHints(e.asyncHints),reference:e.reference,componentName:t,cacheKey:r,siteId:p(e.componentData),appDescriptor:e.manifest.getRawJson?e.manifest.getRawJson():e.manifest,version:e.version,allContexts:e.allContexts,adaptationId:e.adaptationId}).then(u.bind()).then(o.bind()).then(c.bind(undefined,l(e.manifest))).then(f)},loadVariantsAuthors(e){const t=i.getInstanceOrUndef();return t?.isVariantAuthorNameAvailable()?a.loadVariantsAuthors(e):Promise.resolve({})}}});
//# sourceMappingURL=Loader.js.map