/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_omit","sap/base/util/merge","sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/apply/_internal/changes/Utils","sap/ui/fl/apply/_internal/flexObjects/FlexObjectFactory","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/apply/_internal/flexState/changes/DependencyHandler","sap/ui/fl/apply/_internal/flexState/FlexObjectState","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/initial/_internal/changeHandlers/ChangeHandlerStorage","sap/ui/fl/Utils"],(e,t,n,a,i,o,r,s,l,c,g,p,f)=>{"use strict";const d={};function u(e,t){if(t.fragmentId){const n=e.getExtensionPointInfo&&e.getExtensionPointInfo();if(n){return t.fragmentId!==n.fragmentId}return true}return false}function C(e,n,a){let i=e.getSelector();if(n.closestAggregationBindingCarrier&&n.closestAggregationBinding){i=t(i,{id:n.closestAggregationBindingCarrier,idIsLocal:false});const o={id:n.targetControl.getId(),idIsLocal:false};if(a){e.originalSelectorToBeAdjusted=o}else{e.setDependentSelectors({originalSelector:o})}e.setContent({boundAggregation:n.closestAggregationBinding})}else{i=t(i,{id:n.targetControl.getId(),idIsLocal:false})}e.setSelector(i)}function m(e){const t=o.createUIChange(e.changeSpecificData);return p.getChangeHandler(t.getChangeType(),e.controlType,e.selector,a,t.getLayer()).then(n=>n.completeChangeContent(t,e.changeSpecificData,{modifier:a,appComponent:e.appComponent,view:f.getViewForControl(e.selector)})).then(()=>{t.setState(r.LifecycleState.NEW);return t})}function h(e){if(e.selector.name&&e.selector.view){const t=f.getAppComponentForSelector(e.selector.view);const n=e.selector.appId||g.getFlexReferenceForControl(t);e.appComponent=t;e.changeSpecificData.reference=n;e.changeSpecificData.selector={name:e.selector.name,viewSelector:a.getSelector(e.selector.view.getId(),t)};return m(e)}return undefined}d.getChangesForExtensionPoint=function(e,t){if(!t.extensionPointName){n.error("Missing name from extension point info!");return[]}const a=l.getAllApplicableUIChanges(e);return a.filter(e=>{if(e.getSelector().name!==t.extensionPointName){return false}return i.isChangeInView(t,e)})};d.enhanceExtensionPointChanges=function(t,n){t.extensionPointName=n.name;const a=g.getFlexReferenceForControl(n.targetControl);const i=d.getChangesForExtensionPoint(a,t);const o=[];i.forEach(function(i){if(i.isInInitialState()&&!(i.getExtensionPointInfo&&i.getExtensionPointInfo())){i.setExtensionPointInfo(n);C(i,n,false);if(c.isInitialized(t)){s.addChangeAndUpdateDependencies(i,t.appComponent,l.getLiveDependencyMap(a))}}else if(u(i,n)){const r=i.convertToFileContent();const c=e(r,["dependentSelector","fileName","selector","adaptationId"]);c.support.sourceChangeFileName=i.getId()||"";o.push(h({changeSpecificData:c,selector:{view:n.view,name:n.name}}).then(function(e){C(e,n,true);e.setExtensionPointInfo(n);const r=e.getFlexObjectMetadata();r.moduleName=i.getFlexObjectMetadata().moduleName;e.setFlexObjectMetadata(r);e.setCreation(i.getCreation());s.insertChange(e,l.getLiveDependencyMap(a),i);s.addChangeAndUpdateDependencies(e,t.appComponent,l.getLiveDependencyMap(a));o.push(e)}))}});return Promise.all(o).then(function(){return i})};return d});
//# sourceMappingURL=ExtensionPointState.js.map