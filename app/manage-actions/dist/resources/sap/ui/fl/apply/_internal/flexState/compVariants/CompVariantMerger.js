/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexObjects/CompVariant","sap/ui/fl/apply/_internal/flexObjects/FlexObjectFactory","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/apply/_internal/flexState/compVariants/Utils","sap/base/Log"],function(e,t,a,n,i){"use strict";var r={addFavorite(e){e.setFavorite(true)},removeFavorite(e){e.setFavorite(false)},updateVariant(e,t){var a=t.getContent();if(a.executeOnSelection!==undefined){e.setExecuteOnSelection(a.executeOnSelection)}if(a.favorite!==undefined){e.setFavorite(a.favorite)}if(a.contexts){e.setContexts(a.contexts)}if(a.visible!==undefined){e.setVisible(a.visible)}if(a.variantContent){e.setContent(a.variantContent,true)}var n=t.getText("variantName");if(n){e.setName(n,true)}},standardVariant(e,t){e.setExecuteOnSelection(t.getContent().executeOnSelect)}};function o(e){var t={};e.changes.forEach(function(e){var a=e.getSelector().variantId||e.getContent().key;t[a]||=[];t[a].push(e)});return t}function d(e,t){i.error(`No change handler for change with the ID '${t.getId()}' and type '${t.getChangeType()}' defined.\n\t\t\tThe variant '${e.getId()}'was not modified'`)}function s(a,n,i){var r={fileName:n.fileName,variantId:n.id||e.STANDARD_VARIANT_ID,persisted:n.persisted,content:n.content||{},texts:{variantName:{value:n.name||""}},selector:{persistencyKey:a}};if(n.favorite!==undefined){r.favorite=n.favorite}if(n.executeOnSelection!==undefined){r.executeOnSelection=n.executeOnSelection}if(n.adaptationId!==undefined){r.adaptationId=n.adaptationId}return t.createCompVariant(r,i)}function f(e,t){var a=r[t.getChangeType()]||d;a(e,t);e.addChange(t)}function c(e,t){var a=t.getVariantId();if(e[a]){e[a].forEach(function(e){f(t,e)})}}return{merge(e,t,i){var r=t.nonPersistedVariants.concat(t.variants);var d=o(t);var f;r.forEach(function(e){if(e.getContent()&&e.getContent().standardvariant){f=e}});if(!f){f=s(e,i)}else{r=r.filter(function(e){return!e.getContent()||!e.getContent().standardvariant})}t.nonPersistedVariants.concat([f]).forEach(e=>{e.setState(a.LifecycleState.PERSISTED)});r.forEach(c.bind(undefined,d));r=r.filter(function(e){var a=e.getVisible();if(!a){var n=e.getId();delete d[n];delete t.byId[n]}return a});f.setFavorite(true);f.setStandardVariant(true);t.byId[f.getVariantId()]=f;var u=t.standardVariantChange;if(u){d[f.getVariantId()]=d[f.getVariantId()]||[];d[f.getVariantId()].push(u);d[f.getVariantId()].sort(function(e,t){if(e.getCreation()<t.getCreation()){return-1}if(e.getCreation()>t.getCreation()){return 1}return 0})}c(d,f);t.standardVariant=f;const l=n.getDefaultVariantId(t);r.some(e=>{if(!e.getFavorite()&&e.getId()===l){e.setFavorite(true)}});return{standardVariant:f,variants:r}},createVariant(e,t,a){return s(e,t,a)},applyChangeOnVariant:f}});
//# sourceMappingURL=CompVariantMerger.js.map