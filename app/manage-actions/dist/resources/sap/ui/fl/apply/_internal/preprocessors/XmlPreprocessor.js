/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/core/util/reflection/XmlTreeModifier","sap/ui/core/Component","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/changes/Utils","sap/ui/fl/apply/_internal/flexState/controlVariants/VariantManagementState","sap/ui/fl/apply/_internal/flexState/FlexObjectState","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/Utils","sap/base/Log"],function(e,t,n,a,i,r,o,l,p,s,c){"use strict";var f=function(){};f.NOTAG="<NoTag>";function u(e){const t=o.getAllApplicableUIChanges(e.reference);return t.filter(i.isChangeInView.bind(undefined,e))}f.process=async function(i,r){try{r.viewId=r.id;var o=n.getComponentById(r.componentId);if(!o){c.warning("View is generated without a component. Flexibility features are not possible.");return i}var f=s.getAppComponentForControl(o);if(!s.isApplication(f.getManifestObject())){return i}const g=p.getFlexReferenceForControl(f);await l.waitForInitialization(g);const d=e({appComponent:f,modifier:t,view:i,reference:g},r);const y=u(d);await a.applyAllChangesForXMLView(d,y);c.debug(`flex processing view ${r.id} finished`);return i}catch(e){var g=`view ${r.id}: ${e}`;c.info(g);return i}};function g(e,t){if(!t){return e}return e.concat("-",t)}function d(e){return e.replace(/(^W\/|")/g,"")}f.getCacheKey=async function(e){const t=n.getComponentById(e.componentId);const a=s.getAppComponentForControl(t);if(s.isVariantByStartupParameter(a)){return undefined}const i=p.getFlexReferenceForControl(a);let o=f.NOTAG;if(i){const e=await l.getStorageResponse(i);if(e?.cacheKey){o=d(e.cacheKey);const t=r.getAllCurrentVariants(i).filter(e=>!e.getStandardVariant()).map(e=>e.getId());o=g(o,t.join("-"))}}return o};return f},true);
//# sourceMappingURL=XmlPreprocessor.js.map