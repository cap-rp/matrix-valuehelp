/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/apply/_internal/changes/Reverter","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/apply/_internal/flexState/FlexObjectState","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/write/_internal/flexState/FlexObjectManager","sap/ui/fl/write/_internal/Versions","sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/Layer"],function(e,t,n,r,s,a,i,o,l){"use strict";async function f(n,r,s){if(s.length!==0){await t.revertMultipleChanges([...s].reverse(),{appComponent:n,modifier:e,reference:r})}}var c=function(e){this._oChangePersistence=undefined;this._sComponentName=e||"";if(this._sComponentName){this._oChangePersistence=o.getChangePersistenceForComponent(this._sComponentName)}};c.prototype._removeOtherLayerChanges=async function(e,t,n){if(n&&t){var r=Object.values(l).filter(function(e){return e!==t});const n=this._sComponentName;const s=a.removeDirtyFlexObjects({reference:n,layers:r,component:e});await f(e,n,s);return s}return undefined};c.prototype.saveAll=function(e,t,n,r,s,a){var o;var f;if(n){var c=i.getVersionsModel({reference:this._sComponentName,layer:l.CUSTOMER});o=c.getProperty("/persistedVersion");f=c.getProperty("/draftFilenames")}return this._removeOtherLayerChanges(e,r,s).then(this._oChangePersistence.saveDirtyChanges.bind(this._oChangePersistence,e,t,undefined,o,f,a,r)).then(function(e){if(n){var t={reference:this._sComponentName,layer:l.CUSTOMER};if(e?.response&&e.response.length>0){var r=[];if(Array.isArray(e.response)){e.response.forEach(function(e){r.push(e.fileName)})}t.draftFilenames=r;i.onAllChangesSaved(t)}else{return i.updateModelFromBackend(t)}}return e}.bind(this))};c.prototype.saveSequenceOfDirtyChanges=async function(e,t){const a=e||r.getDirtyFlexObjects(this._sComponentName);const i=await this._oChangePersistence.saveDirtyChanges(t,false,a);if(i?.response?.length){var o=i.response.map(e=>e.fileName);a.forEach(function(e){if(o.includes(e.getId())){e.setState(n.LifecycleState.PERSISTED)}});s.getFlexObjectsDataSelector().checkUpdate({reference:this._sComponentName})}return i};return c});
//# sourceMappingURL=FlexController.js.map