/*!
 * OpenUI5
 * (c) Copyright 2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/fl/initial/_internal/FlexConfiguration","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/base/util/isEmptyObject"],function(n,e,t,r,a){"use strict";const o={};var i={load:{LrepConnector:"sap/ui/fl/initial/_internal/connectors/LrepConnector",NeoLrepConnector:"sap/ui/fl/initial/_internal/connectors/NeoLrepConnector",PersonalizationConnector:"sap/ui/fl/initial/_internal/connectors/PersonalizationConnector",KeyUserConnector:"sap/ui/fl/initial/_internal/connectors/KeyUserConnector",BtpServiceConnector:"sap/ui/fl/initial/_internal/connectors/BtpServiceConnector",StaticFileConnector:"sap/ui/fl/initial/_internal/connectors/StaticFileConnector",JsObjectConnector:"sap/ui/fl/write/_internal/connectors/JsObjectConnector",ObjectPathConnector:"sap/ui/fl/write/_internal/connectors/ObjectPathConnector",LocalStorageConnector:"sap/ui/fl/write/_internal/connectors/LocalStorageConnector",SessionStorageConnector:"sap/ui/fl/write/_internal/connectors/SessionStorageConnector"},write:{LrepConnector:"sap/ui/fl/write/_internal/connectors/LrepConnector",NeoLrepConnector:"sap/ui/fl/write/_internal/connectors/NeoLrepConnector",PersonalizationConnector:"sap/ui/fl/write/_internal/connectors/PersonalizationConnector",KeyUserConnector:"sap/ui/fl/write/_internal/connectors/KeyUserConnector",BtpServiceConnector:"sap/ui/fl/write/_internal/connectors/BtpServiceConnector",StaticFileConnector:"sap/ui/fl/write/_internal/connectors/StaticFileConnector",JsObjectConnector:"sap/ui/fl/write/_internal/connectors/JsObjectConnector",ObjectPathConnector:"sap/ui/fl/write/_internal/connectors/ObjectPathConnector",LocalStorageConnector:"sap/ui/fl/write/_internal/connectors/LocalStorageConnector",SessionStorageConnector:"sap/ui/fl/write/_internal/connectors/SessionStorageConnector"}};var c="sap/ui/fl/initial/_internal/connectors/";var s={connector:"StaticFileConnector"};function l(n,e){var t=[];if(!n){t=e}else{t=n.filter(function(n){return e.indexOf(n)!==-1||e[0]==="ALL"})}return t}function p(n,e,t){return t.map(function(n){var t=n.connector;var r;if(!n.loadConnector&&!n.applyConnector&&!n.loadConnector){r=e?i.load[t]:i.write[t]}else if(e){r=n.loadConnector||n.applyConnector}else{r=n.writeConnector||"sap/ui/fl/write/connectors/BaseConnector"}return r})}o.requireConnectors=function(n){return new Promise(function(e){sap.ui.require(n,function(...n){e(n)})})};async function u(n,e,t){var r=p(n,e,t);const a=await o.requireConnectors(r,e,t);a.forEach(function(n,r){if(!t[r].layers){t[r].layers=n.layers}else{t[r].layers=l(t[r].layers,n.layers)}if(e){t[r].loadConnectorModule=n}else{t[r].writeConnectorModule=n}});return t}o.getConnectors=function(n,t){var r=e.getFlexibilityServices();var a=[];if(t){a=[s]}a=a.concat(r);return u(n,t,a)};o.getLoadConnectors=function(){return this.getConnectors(c,true)};o.getStaticFileConnector=function(){return u(c,true,[s])};o.logAndResolveDefault=function(e,t,r,a){n.error(`Connector (${t.connector}) failed call '${r}': ${a}\n\t\t\tApplication startup continues without data from this storage.`);return e};o.filterAndSortResponses=function(n){var e=[];Object.keys(n).forEach(function(t){e.push(n[t])});e=e.filter(function(n){return n.changes.length>0||n.appDescriptorChanges.length>0||n.variants.length>0||n.variantChanges.length>0||n.variantManagementChanges.length>0||n.variantDependentControlChanges.length>0||n.comp.variants.length>0||n.comp.changes.length>0||n.comp.defaultVariants.length>0||n.comp.standardVariants.length>0||n.annotationChanges.length>0});e.sort(function(n,e){return n.index-e.index});return e};o.sortFlexObjects=function(n){const e=n.filter(n=>n.creation);const t=n.filter(n=>!n.creation);e.sort(function(n,e){return Date.parse(n.creation)-Date.parse(e.creation)});return t.concat(e)};o.getGroupedFlexObjects=function(n){const e=this.sortFlexObjects(n);var a={};Object.keys(t).forEach(function(n){a[n]=this.getEmptyFlexDataResponse();a[n].index=r.getLayerIndex(n)}.bind(this));e.forEach(function(n){var e=n.layer;if(n.fileType==="annotation_change"){a[e].annotationChanges.push(n)}else if(n.fileType==="ctrl_variant"&&n.variantManagementReference){a[e].variants.push(n)}else if(n.fileType==="ctrl_variant_change"){a[e].variantChanges.push(n)}else if(n.fileType==="ctrl_variant_management_change"){a[e].variantManagementChanges.push(n)}else if(n.fileType==="variant"){a[e].comp.variants.push(n)}else if(n.fileType==="change"){if(n.variantReference){a[e].variantDependentControlChanges.push(n)}else if(n.appDescriptorChange){a[e].appDescriptorChanges.push(n)}else{switch(n.changeType){case"addFavorite":case"removeFavorite":case"updateVariant":a[e].comp.changes.push(n);break;case"defaultVariant":a[e].comp.defaultVariants.push(n);break;case"standardVariant":a[e].comp.standardVariants.push(n);break;default:a[e].changes.push(n)}}}});return a};o.getEmptyFlexDataResponse=function(){return{appDescriptorChanges:[],annotationChanges:[],changes:[],comp:{variants:[],changes:[],defaultVariants:[],standardVariants:[]},variants:[],variantChanges:[],variantDependentControlChanges:[],variantManagementChanges:[],ui2personalization:{}}};o.getAllFlexObjectNamespaces=function(){return["appDescriptorChanges","annotationChanges","changes","comp.changes","comp.changes","comp.defaultVariants","comp.standardVariants","variants","variantChanges","variantDependentControlChanges","variantManagementChanges"]};o.isStorageResponseFilled=function(n){return Object.keys(n||{}).some(function(e){if(Array.isArray(n[e])){return n[e].length!==0}return!a(n[e])})};return o});
//# sourceMappingURL=StorageUtils.js.map