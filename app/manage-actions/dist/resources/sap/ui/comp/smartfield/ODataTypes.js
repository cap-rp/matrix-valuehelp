/*
 * SAPUI5
 * (c) Copyright 2025 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/model/SimpleType","sap/ui/core/format/NumberFormat","sap/ui/model/odata/type/Boolean","sap/ui/comp/smartfield/type/Double","sap/ui/comp/smartfield/type/DateTime","sap/ui/comp/odata/type/StringDate","sap/ui/comp/odata/type/FiscalDate","sap/ui/comp/odata/type/NumericText","sap/ui/comp/smartfield/type/DateTimeOffset","sap/ui/model/odata/type/DateTimeWithTimezone","sap/ui/comp/smartfield/type/Decimal","sap/ui/comp/smartfield/type/Int16","sap/ui/comp/smartfield/type/Int32","sap/ui/comp/smartfield/type/Int64","sap/ui/comp/smartfield/type/Byte","sap/ui/comp/smartfield/type/SByte","sap/ui/comp/smartfield/type/String","sap/ui/comp/smartfield/type/StringNullable","sap/ui/comp/smartfield/type/TextArrangementString","sap/ui/comp/smartfield/type/TextArrangementGuid","sap/ui/comp/smartfield/type/AbapBool","sap/ui/comp/smartfield/type/Currency","sap/ui/comp/smartfield/type/Time","sap/ui/comp/smartfield/type/Guid","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/smartfield/type/Unit","sap/ui/comp/smartfield/type/IanaTextArrangement","sap/ui/comp/odata/type/CalendarDate","sap/ui/comp/odata/CalendarMetadata","sap/ui/comp/library"],function(e,t,r,n,i,a,o,s,p,u,l,m,c,f,y,g,d,h,C,v,T,x,D,_,F,w,S,b,O,A,L){"use strict";var E=L.numericEdmTypes;var I=function(e){this._oParent=e};I.prototype.getType=function(t,T,x,S){S=S||{};var L=this._oParent.getBindingInfo("value"),I=L&&L.binding&&L.binding.getType(),N=S.composite&&I instanceof e;if(I&&!N){return P(I)}if(t&&t.property&&t.property.type){if(!I){x=this.getConstraints(t.property,x);T=this.getFormatOptions(t.property,T)}if(E.indexOf(t.property.type)!==-1&&x.nullable===false){T.parseEmptyValueToZero=true}switch(t.property.type){case"Edm.Boolean":return new r(T,x);case"Edm.Double":return new n(T,x);case"Edm.Decimal":case"Edm.Single":return new l(T,this._getDecimalConstraints(t,x));case"Edm.Int16":return new m(T,x);case"Edm.Int32":return new c(T,x);case"Edm.Int64":return new f(T,x);case"Edm.Byte":return new y(T,x);case"Edm.SByte":return new g(T,x);case"Edm.DateTimeOffset":if(this.isWithTimeZone(t)){return new u(T)}return new p(T,x);case"Edm.DateTime":return new i(T,this._getDateTimeConstraints(t,x));case"Edm.String":if(!I){x=this._getStringConstraints(t,x)}if(I&&!x){x=I.oConstraints}var B=A.getCalendarAnnotationType(t.property);if(B&&!S.composite){return new O(T,x,{calendarType:B})}if(this.isCalendarDate(t)&&!S.composite){return new a(T)}var M=w.getFiscalAnnotationType(t.property);if(M&&!S.composite){return new o(T,x,{fiscalType:M})}if(x&&x.isDigitSequence&&!S.composite){return new s(T,x)}if(S.composite&&this.isTimeZone(t)){T=Object.assign({},T,this._getTextArrangementFormatOptions());return new b(T,x,this._getTextArrangementOptions(S))}if(S.composite){T=Object.assign({},T,this._getTextArrangementFormatOptions());x=this._getTextArrangementConstraints(t,x,T);if(x.isDigitSequence){return[new C(T,x,this._getTextArrangementOptions(S),this._oParent),new s(T,x)]}else{return new C(T,x,this._getTextArrangementOptions(S),this._oParent)}}if(this.isTimeZone(t)){return new u(T)}if(t.isStringNullable){return new h(T,x)}return new d(T,x,this._oParent);case"Edm.Time":return new D(T,x);case"Edm.Guid":var V={},k=this._getTextArrangementFormatOptions();if(F.hasTextArrangementAnnotation(t.property)&&k&&k.textArrangement==="descriptionOnly"){V={validateException:{resourceBundle:"sap.ui.comp",text:"ENTER_AN_EXISTING_DESCRIPTION"}}}if(S.composite){T=Object.assign({},T,this._getTextArrangementFormatOptions());return new v(T,x,this._getTextArrangementOptions(S))}return new _(T,x,V);default:return null}}return null};function P(e){var t=e.parseValue,r=e.destroy;e.parseValue=function(e,r){var n=t.apply(this,arguments);if(typeof this.oFieldControl==="function"){this.oFieldControl(e,r)}return n};e.destroy=function(){r.apply(this,arguments);this.oFieldControl=null};return e}I.prototype.getConstraints=function(e,t){return Object.assign({},t,{nullable:F.isNullable(e),skipDecimalsValidation:F.isSkippingMeasuredQuantityCheck(e)})};I.prototype.getFormatOptions=function(e,t){var r={};if(F.isUpperCase(e)){r.displayFormat="UpperCase"}return Object.assign({},t,r)};I.prototype._getDateTimeConstraints=function(e,t){var r={},n;if(e.property["sap:display-format"]==="Date"||this.isCalendarDate(e)){r={displayFormat:"Date"}}for(n in t){r[n]=t[n]}return r};I.prototype.getMaxLength=function(e,t){var r=[],n,i=0;if(t&&t.constraints){if(t.constraints.maxLength&&t.constraints.maxLength>-1){r.push(t.constraints.maxLength)}}if(t&&t.type&&t.type.oConstraints){if(t.type.oConstraints.maxLength&&t.type.oConstraints.maxLength>-1){r.push(t.type.oConstraints.maxLength)}}if(e&&e.property&&e.property.maxLength){var a=parseInt(e.property.maxLength);if(a>-1){r.push(a)}}var o=this._oParent.getMaxLength();if(o>0){r.push(o)}var s=r.length;while(s--){n=r[s];if(n>0){if(i>0){if(n<i){i=n}}else{i=n}}}return i};I.prototype._getDecimalConstraints=function(e,t){var r=e.property;t=t||{};if(r.precision){t.precision=parseInt(r.precision)}if(r.scale){t.scale=parseInt(r.scale)}if(r["sap:variable-scale"]){t.variableScale=r["sap:variable-scale"]==="true"}return t};I.prototype._getTextArrangementFormatOptions=function(){return{textArrangement:this._oParent.getControlFactory()._getDisplayBehaviourConfiguration()}};I.prototype._getTextArrangementConstraints=function(e,t,r){var n=Object.assign({},t),i,a=e.valueListAnnotation;if(a&&r&&r.textArrangement==="descriptionOnly"){i=a.fields.find(function(e){return e.name===a.descriptionField});if(i!==undefined&&parseInt(i.maxLength)>parseInt(t.maxLength)){n.keyMaxLength=n.maxLength;n.maxLength=t.maxLength;n.descriptionMaxLength=i.maxLength}}return n};I.prototype._getStringConstraints=function(e,t){t=t||{};var r=this._oParent.getBindingInfo("value"),n=this.getMaxLength(e,r),i;if(r&&r.type&&r.type.oConstraints){if(r.type.oConstraints.equals){i=r.type.oConstraints.equals}}if(n>0||i){if(n>0){t.maxLength=n}if(i){t.equals=i}}if(F.isDigitSequence(e.property)){t.isDigitSequence=true}return t};I.prototype._getTextArrangementOptions=function(e){var t=this._oParent.getControlFactory().oTextArrangementDelegate;return{keyField:e.keyField,descriptionField:e.descriptionField,valueListNoValidation:e.valueListNoValidation,valueList:e.valueList,onBeforeValidateValue:t.onBeforeValidateValue.bind(t),delegate:e.delegate,clientSideMandatoryCheck:this._oParent.getClientSideMandatoryCheck()}};I.prototype.isCalendarDate=function(e){var t=e.property["com.sap.vocabularies.Common.v1.IsCalendarDate"];if(t&&t.Bool){return t.Bool?t.Bool!=="false":true}return false};I.prototype.isTimeZone=function(e){return e.property["com.sap.vocabularies.Common.v1.IsTimezone"]&&e.property["com.sap.vocabularies.Common.v1.IsTimezone"].Bool!=="false"};I.prototype.isWithTimeZone=function(e){return e.property["com.sap.vocabularies.Common.v1.Timezone"]?true:false};I.prototype.getDisplayFormatter=function(e,t){t=t||{};if(t.currency){return this.getCurrencyDisplayFormatter(t)}else if(t.type&&t.type.oConstraints&&t.type.oConstraints.scale&&e.scale){e.scale=t.type.oConstraints.scale}return this.getUOMDisplayFormatter(e,t)};I.prototype.getCurrencyDisplayFormatter=function(e){var t={showMeasure:false,emptyString:NaN},r;this._enhanceFormatOptions(t);r=new x(t);return function(t,n,i){var a,o,s,p,u,l=this&&this.oParent&&this.oParent.oParent,m=l&&l.isA("sap.ui.comp.smartfield.SmartField")&&l.isFormContextType();if(!t||!n||n==="*"){return""}if(!e.currency){a=t+=" ";return a}if(isNaN(parseFloat(t))){return t.toString()+" "}a=r.formatValue([t,n,i],"string");p=i&&i[n]&&i[n].digits;s=r&&r.oOutputFormat&&r.oOutputFormat.oLocaleData.getCurrencyDigits(n);o=p||s;if(o===0&&!m){a+=" "}u=3-o;if(u&&!m&&a){a=a.padEnd(a.length+u," ")}else{a+=" "}if(e.mask){return I.maskValue(a)}return a}};I.prototype.getUOMDisplayFormatter=function(e,t){var r={showMeasure:false,emptyString:NaN},n;this._enhanceFormatOptions(r);n=new S(r,{scale:e&&e.scale?e.scale:0});return function(e,r,i){var a,o,s=this&&this.oParent&&this.oParent.oParent,p=s&&s.isA("sap.ui.comp.smartfield.SmartField")&&s.isFormContextType();if(!e&&e!==0||!r&&r!==""||r==="*"){return""}if(isNaN(parseFloat(e))){return e.toString()+" "}a=n.formatValue([e,r,i],"string");o=i&&i[r]&&i[r].UnitSpecificScale;if((o===0||o===null)&&!p){a+=" "}if(!p&&s&&s.getControlContext&&s.getControlContext()===""&&a&&o){a=a.padEnd(a.length+1," ")}if(p){a+=" "}if(t&&t.mask){return I.maskValue(a)}return a}};I.maskValue=function(e){if(e){return e.replace(new RegExp(".","igm"),"*")}return e};I.prototype.getCurrencyType=function(e){if(e){var t=this._getDecimalConstraints(e),r=this.getConstraints(e.property,t),n=N(r),i=B(t);this._enhanceFormatOptions(n);return new x(n,this.getConstraints(e.property,i))}return null};I.prototype.getUoMType=function(e){var t=["edm.int16","edm.int32","edm.byte","edm.double"];if(e){var r=this._getDecimalConstraints(e),n=this.getConstraints(e.property,r),i=N(n);if(t.includes(e.property.type.toLowerCase())){i.parseAsString=false;n.type=e.property.type}this._enhanceFormatOptions(i);return new S(i,n)}return null};function N(e){var t=e.nullable?null:0;return{showMeasure:false,parseAsString:true,emptyString:t,precision:e.precision}}function B(e){return{precision:e.precision,scale:e.scale,variableScale:e.variableScale}}I.prototype.getAbapBoolean=function(){return new T};I.prototype.destroy=function(){this._oParent=null};I.prototype._enhanceFormatOptions=function(e){var t=this._getCustomDataConfiguration();if(typeof t.preserveDecimals==="boolean"){e.preserveDecimals=t.preserveDecimals}};I.prototype._getCustomDataConfiguration=function(){var e={},t;if(this._oParent){t=this._oParent.data("preserveDecimals");if(t){e.preserveDecimals=t==="true"}}return e};return I},true);
//# sourceMappingURL=ODataTypes.js.map