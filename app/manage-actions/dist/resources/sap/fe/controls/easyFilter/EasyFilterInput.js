/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/base/EventDelegateHook","sap/fe/base/jsx-runtime/jsx","sap/fe/controls/easyFilter/ShellHistoryProvider","sap/m/Button","sap/m/CustomListItem","sap/m/FlexBox","sap/m/HBox","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/Input","sap/m/List","sap/m/Popover","sap/m/Text","sap/m/Title","sap/m/library","sap/ui/core/Control","sap/ui/core/CustomData","sap/ui/core/Lib","sap/ui/core/library","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,r,s,i,a,n,o,l,u,c,h,p,d,f,v,g,E,P,b,I,m,y,T,_){"use strict";var S,F,O,x,$,C,L,Q,R,V,w,B,j,A,H,M,D;var z={};var Y=y.ValueState;var q=y.TitleLevel;var U=P.PlacementType;var k=P.ListMode;var N=P.FlexWrap;var W=P.FlexJustifyContent;var G=P.FlexDirection;var J=P.FlexAlignItems;var K=P.ButtonType;var X=r.property;var Z=r.event;var ee=r.defineUI5Class;var te=r.defineState;var re=r.aggregation;var se=t.lessThan;var ie=t.length;var ae=t.equal;var ne=t.bindState;function oe(e,t,r,s){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(s):void 0})}function le(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ue(e,t)}function ue(e,t){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ue(e,t)}function ce(e,t,r,s,i){var a={};return Object.keys(s).forEach(function(e){a[e]=s[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(r,s){return s(e,t,r)||r},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}function he(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let pe=(S=ee("sap.fe.controls.easyFilter.EasyFilterInput"),F=re({type:"sap.m.Input",multiple:false,isDefault:true}),O=X({type:"string"}),x=X({type:"array"}),$=Z(),C=Z(),L=Z(),Q=te(),S(R=(V=function(t){function r(e,r){var s;s=t.call(this,e,r)||this;oe(s,"$searchInput",w,s);oe(s,"appId",B,s);oe(s,"recommendedValues",j,s);oe(s,"queryChanged",A,s);oe(s,"enterPressed",H,s);oe(s,"liveChange",M,s);oe(s,"state",D,s);s.initialize();return s}z=r;le(r,t);var P=r.prototype;P.getValue=function e(){return this.$searchInput.getValue()};P.isHistoryEnabled=function e(){return this.state.isHistoryEnabled.valueOf()};P.setValue=function e(t){this.$searchInput.setValue(t);return this};P.setPlaceholder=function e(t){this.$searchInput.setPlaceholder(t);return this};P.getPlaceholder=function e(){return this.$searchInput.getPlaceholder()};P.initialize=function e(){this.state.recommendedQueries=this.recommendedValues??[];this.resourceBundle=m.getResourceBundleFor("sap.fe.controls");this.createInput()};P.setAsInvalid=function e(t){this.$searchInput.setValueState(Y.Warning);this.$searchInput.setValueStateText(t);this.$searchInput.openValueStateMessage()};P.createInput=function e(){this.$searchInput=T(d,{width:"100%",showClearIcon:true,change:e=>{this.fireEvent("queryChanged",{query:e.getParameter("value")})},liveChange:e=>{this.state.queryChanged=true;this.fireEvent("liveChange");if(!e.getSource().getValue()&&!(this.$favoritePopover?.isOpen()??false)){this.openSuggestionPopover()}if(e.getParameter("value")===""){this.setPlaceholder(this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER"))}},placeholder:this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")});const t=this.createFavoritePopover();this.$favoritePopover=t;this.$searchInput.addDependent(t);this.$searchInput.addEventDelegate({onkeyup:e=>{if(e.key==="Enter"){this.onEnterPressed()}if(this.$favoritePopover&&this.$searchInput.getValue()){this.$favoritePopover.close()}},onkeydown:e=>{if(e.key==="Tab"&&this.$searchInput?.getValue().length===0&&this.$searchInput?.getValue()!==this.$searchInput?.getPlaceholder()&&this.$searchInput?.getPlaceholder()!==this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")){e.preventDefault();this.$searchInput?.setValue(this.$searchInput?.getPlaceholder());this.fireEvent("liveChange")}},ontap:()=>{this.openSuggestionPopover()},onfocusin:()=>{this.openSuggestionPopover()}})};P.openSuggestionPopover=function e(){if(!this.$searchInput?.getValue()&&(!this.$favoritePopover||!this.$favoritePopover?.isOpen())){this.state.isHistoryEnabled=this.shellHistoryProvider?.isHistoryEnabled()??false;this.state.favoriteQueries=this.shellHistoryProvider?.getFavoriteQueries()??[];this.state.recentQueries=(this.shellHistoryProvider?.getRecentQueries()??[]).map(e=>e);this.$favoritePopover?.openBy(this.$searchInput)}};P.requestFavorite=function e(t){this.$favoritePopover?.close();this.$searchInput?.setValue(t.getSource().getText());this.onEnterPressed()};P.onEnterPressed=function e(){this.$favoritePopover?.close();this.state.queryChanged=false;let t=this.$searchInput?.getValue();if(t===""&&this.$searchInput.getPlaceholder()!==this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")){t=this.$searchInput.getPlaceholder();this.$searchInput?.setValue(t)}this.$searchInput?.setValueStateText("");this.$searchInput?.setValueState("None");this.fireEvent("enterPressed",{query:t})};P.addRecentQuery=function e(t){t=t?.replace(/\\/g,"\\\\");const r=this.state.recentQueries.findIndex(e=>e.toLowerCase()===t?.toLowerCase());if(t&&r===-1){this.state.recentQueries=[t].concat(this.state.recentQueries);if(this.state.recentQueries.length>5){this.state.recentQueries=this.state.recentQueries.slice(0,5)}}else if(t){const e=this.state.recentQueries.filter(e=>e.toLowerCase()!==t?.toLowerCase());e.unshift(t);this.state.recentQueries=e}};P.onStateChange=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(t.includes("favoriteQueries")||t.includes("recentQueries")){this.shellHistoryProvider?.setFavoriteQueries(this.state.favoriteQueries);this.shellHistoryProvider?.setRecentQueries(this.state.recentQueries.map(e=>e));this.state.recentQueriesWitFavorites=this.state.recentQueries.map(e=>({text:e,isFavorite:!!this.state.favoriteQueries.find(t=>t===e)}))}};P.initShellHistoryProvider=async function t(){try{this.shellHistoryProvider=await a.getInstance(this.appId??"<unknownApp>")}catch(t){e.error("Error while creating ShellHistoryProvider for easy filter",t)}};P.createFavoritePopover=function e(){return T(v,{id:this.getId()+"-favoritePopover",showHeader:false,horizontalScrolling:false,placement:U.Bottom,showArrow:false,initialFocus:this.$searchInput,class:"sapFEControlsPopover",visible:this.state.recommendedQueries.length>0||ae(ne(this.state,"isHistoryEnabled"),true),children:{content:T(l,{direction:G.Column,class:"sapUiContentPadding",renderType:"Bare",children:{items:[T(E,{titleStyle:q.H6,text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_SUGGESTIONS_TITLE"),class:"sapFeControlsTitleBorder",visible:this.state.recommendedQueries.length>0}),T(u,{class:"sapUiContentPadding",items:ne(this.state,"recommendedQueries"),wrap:N.Wrap,visible:this.state.recommendedQueries.length>0,children:{items:(e,t)=>T(n,{class:"sapUiTinyMarginEnd",text:t.getObject(),press:this.requestFavorite.bind(this)})}}),T(E,{titleStyle:q.H6,text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_FAVORITE_TITLE"),class:"sapFeControlsTitleBorder",visible:ae(ne(this.state,"isHistoryEnabled"),true)}),T(f,{items:ne(this.state,"favoriteQueries"),visible:ae(ne(this.state,"isHistoryEnabled"),true),children:{noData:T(c,{title:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_EMPTY_FAVORITE_TITLE"),illustrationSize:h.ExtraSmall,illustrationType:p.NoEntries,description:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_EMPTY_FAVORITE_DESCRIPTION")}),items:(e,t)=>T(o,{class:"sapUiSmallMarginBegin",customData:[T(I,{value:t.getObject()},"text")],press:()=>{this.$searchInput.setValue(t.getObject());this.onEnterPressed()},children:_(l,{width:"100%",direction:G.Row,alignItems:J.Center,justifyContent:W.SpaceBetween,renderType:"Bare",id:e,children:[T(g,{text:t.getObject(),tooltip:t.getObject(),wrapping:false,class:"sapFEControlsPointer",children:{dependents:T(s,{tap:()=>{this.$searchInput?.setValue(t.getObject().replace(/\\\\/g,"\\"));this.onEnterPressed()}})}}),T(n,{icon:"sap-icon://favorite",tooltip:this.resourceBundle.getText("M_EASY_FILTER_FILLED_STAR"),type:K.Transparent,press:()=>{this.$favoritePopover?.focus();const e=t.getObject();const r=this.state.favoriteQueries.indexOf(e);if(r!==-1){this.state.favoriteQueries=this.state.favoriteQueries.filter(t=>t!==e)}}})]})})}}),T(E,{titleStyle:q.H6,text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_LAST_USED"),class:"sapFeControlsTitleBorder",visible:ae(ne(this.state,"isHistoryEnabled"),true)}),T(f,{items:ne(this.state,"recentQueriesWitFavorites"),visible:ae(ne(this.state,"isHistoryEnabled"),true),mode:k.Delete,delete:e=>{this.$favoritePopover?.focus();let t=e.getParameter("listItem")?.data("text");if(!t)return;t=t?.replace(/\\/g,"\\\\");this.state.recentQueries=this.state.recentQueries.filter(e=>e!==t)},children:{noData:T(c,{title:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_EMPTY_LAST_USED_TITLE"),illustrationSize:h.ExtraSmall,illustrationType:p.NoEntries,description:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_EMPTY_RECENT_DESCRIPTION")}),items:(e,t)=>T(o,{press:()=>{this.$searchInput?.setValue(t.getObject().text);this.onEnterPressed()},class:"sapUiSmallMarginBegin",customData:[T(I,{value:t.getObject().text},"text")],children:_(l,{width:"100%",direction:G.Row,alignItems:J.Center,justifyContent:W.SpaceBetween,renderType:"Bare",id:e,children:[T(g,{text:t.getObject().text,tooltip:t.getObject().text,wrapping:false,class:"sapFEControlsPointer",children:{dependents:T(s,{tap:()=>{this.$searchInput?.setValue(t.getObject().text.replace(/\\\\/g,"\\"));this.onEnterPressed()}})}}),T(n,{icon:t.getObject().isFavorite?"sap-icon://favorite":"sap-icon://add-favorite",tooltip:t.getObject().isFavorite?this.resourceBundle.getText("M_EASY_FILTER_FILLED_STAR"):this.resourceBundle.getText("M_EASY_FILTER_EMPTY_START"),enabled:se(ie(ne(this.state,"favoriteQueries")),5),type:K.Transparent,press:()=>{this.$favoritePopover?.focus();const e=t.getObject().text;const r=t.getObject().isFavorite;if(r){this.removeFromFavorites(e)}else{this.addToFavorites(e)}}})]})})}})]}})}})};P.removeFromFavorites=function e(t){this.state.favoriteQueries=this.state.favoriteQueries.filter(e=>e.toLowerCase()!==t.toLowerCase())};P.addToFavorites=function e(t){const r=[t].concat(this.state.favoriteQueries.concat());if(r.length>5){r.pop()}this.state.favoriteQueries=r};r.render=function e(t,r){return i.renderUsingRenderManager(t,r,()=>T("span",{ref:r,class:"sapFEEasyFilterInput",children:r.$searchInput}))};return r}(b),w=ce(V.prototype,"$searchInput",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),B=ce(V.prototype,"appId",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),j=ce(V.prototype,"recommendedValues",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),A=ce(V.prototype,"queryChanged",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),H=ce(V.prototype,"enterPressed",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),M=ce(V.prototype,"liveChange",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),D=ce(V.prototype,"state",[Q],{configurable:true,enumerable:true,writable:true,initializer:function(){return{queryChanged:false,isHistoryEnabled:false,recentQueries:[],recentQueriesWitFavorites:[],favoriteQueries:[],recommendedQueries:[]}}}),V))||R);z=pe;return z},false);
//# sourceMappingURL=EasyFilterInput.js.map