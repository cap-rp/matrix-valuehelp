/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/fe/controls/easyFilter/innerControls/BaseFactory","sap/fe/controls/easyFilter/utils","sap/m/List","sap/m/StandardListItem","sap/m/library","sap/ui/core/CustomData"],function(e,t,s,r,o,n,a,i){"use strict";var l=a.ListSeparators;var c=a.ListMode;var u=s.BaseFactory;function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,f(e,t)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}let m=function(s){function a(e,t){var r;r=s.call(this,e,t)||this;r.setControl(new o({delete:r.onDelete.bind(r),mode:c.Delete,showSeparators:l.None}));return r}p(a,s);var u=a.prototype;u.setItems=function e(t,s,o){if(r.areItemsSame(t,this.items)){return}this.items=t;const n=this.getControl();n?.destroyAggregation("items");let a=0;t.forEach((e,t)=>{const{operator:i,selectedValues:l}=e;let c="";if(s==="ValueHelp"&&a<5){if(r.isBetweenSelectedValues(i)){c=r.mapOperatorForBetweenOperator(i,l,s,o);this.insertItem(n,c,[t]);++a}else{l.forEach((e,l)=>{if(a<5){c=r.mapOperatorForValueHelp(i,e,s,o);this.insertItem(n,c,[t,l]);++a}})}}else if(s!=="ValueHelp"){if(r.isBetweenSelectedValues(i)){c=r.mapOperatorForBetweenOperator(i,l,s,o);this.insertItem(n,c,[t])}else{l.forEach((e,a)=>{c=r.mapOperator(i,e,s,o);this.insertItem(n,c,[t,a])})}}})};u.insertItem=function e(t,s,r){t?.addItem(new n({title:s,customData:new i({key:"arrayIndex",value:r})}))};u.onDelete=function e(t){const s=this.getToken()?.getCustomDataValue("popover");t.getParameter("listItem")?.setVisible(false);s.focus()};u.normalizeString=function e(t){const s=/^(>=|<=|!=|>|<)+/;return t.replace(s,"")};u.invokeOkButtonHandler=function e(){const s=this.getToken()?.getCustomDataValue("popover");const r=this.getToken();const o=this.getEasyFilter();const n=r?.getItems()?.map(e=>({operator:JSON.parse(JSON.stringify(e.operator)),selectedValues:t(e.selectedValues)}));const a=[];this.getControl()?.getItems().forEach(e=>{if(!e.getVisible()){const[t=Infinity,s=Infinity]=e?.getCustomData()?.find(e=>e?.getKey()==="arrayIndex")?.getValue()??[];if(t===Infinity||!n){return}a.push([t,s])}});a.sort((e,t)=>t[0]-e[0]||t[1]-e[1]);a.forEach(e=>{let[t,s]=e;if(n){if(s===Infinity){n.splice(t,1);return}n[t].selectedValues.splice(s,1);if(n[t].selectedValues.length===0){n.splice(t,1)}}});o.updateTokenArray("setSelectedValues",n,r?.getKey());s.close()};u.invokeShowAllButtonHandler=async function t(){const s=this.getToken();const{type:r}=s?.getCustomDataValue("TokenInfo");const o=s?.getKey();const n=new Promise((e,t)=>{this.getEasyFilter()?.fireEvent("showValueHelp",{key:o,values:s?.getItems()?.map(e=>{if(r==="ValueHelp"){return{operator:e.operator,selectedValues:e.selectedValues.map(e=>e.value)}}else{return e}}),resolve:e,reject:t})});try{const e=await n;this.getEasyFilter()?.updateTokenArray("setSelectedValues",e,o)}catch(t){if(t instanceof Error){e.error("Error while fetching new tokens",t.message)}else{e.error("Error while fetching new tokens",String(t))}}};u.invokePopupCloseHandler=function e(){this.getControl()?.getItems().forEach(e=>e.setVisible(true))};return a}(u);return m},false);
//# sourceMappingURL=ValueHelpPreviewFactory.js.map