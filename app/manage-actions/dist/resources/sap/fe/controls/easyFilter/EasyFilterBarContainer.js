/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/base/jsx-runtime/jsx","sap/fe/controls/easyFilter/Token","sap/m/Button","sap/m/FlexBox","sap/m/Popover","sap/m/Tokenizer","sap/m/VBox","sap/m/library","sap/ui/core/Control","sap/ui/core/CustomData","sap/ui/core/Lib","sap/ui/core/library","sap/base/util/deepClone","sap/fe/base/BindingToolkit","sap/fe/controls/easyFilter/EasyFilterInput","sap/m/MessageStrip","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/model/FilterOperator","sap/ui/performance/trace/FESRHelper","./AINotice","./utils","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs"],function(e,t,r,i,s,n,a,o,l,u,c,h,p,d,f,y,g,k,b,S,m,v,F,T,E,V,M){"use strict";var I,P,C,w,B,R,z,_,x,A,L,O,j,q,K,D,H,U,N,Y,G,Q,W,J,$,X,Z,ee,te,re,ie,se,ne,ae,oe;function le(e){return new Promise((t,r)=>{sap.ui.require([e],r=>{if(!(r&&r.__esModule)){r=r===null||!(typeof r==="object"&&e.endsWith("/library"))?{default:r}:r;Object.defineProperty(r,"__esModule",{value:true})}t(r)},e=>{r(e)})})}var ue={};var ce=y.bindState;var he=y.and;var pe=d.ValueState;var de=u.TokenizerRenderMode;var fe=u.PlacementType;var ye=u.FlexWrap;var ge=u.FlexJustifyContent;var ke=u.FlexAlignItems;var be=u.ButtonType;var Se=t.property;var me=t.event;var ve=t.defineUI5Class;var Fe=t.defineState;var Te=t.defineReference;var Ee=t.createReference;var Ve=t.aggregation;function Me(e,t,r,i){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Ie(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Pe(e,t)}function Pe(e,t){return Pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pe(e,t)}function Ce(e,t,r,i,s){var n={};return Object.keys(i).forEach(function(e){n[e]=i[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},n),s&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function we(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let Be=(I=ve("sap.fe.controls.easyFilter.EasyFilterBarContainer"),P=Se({type:"string"}),C=Se({type:"string"}),w=Se({type:"string"}),B=Se({type:"array"}),R=Se({type:"array"}),z=Se({type:"function"}),_=Te(),x=Te(),A=Ve({type:"sap.ui.core.Control"}),L=me(),O=me(),j=me(),q=me(),K=me(),D=me(),H=Fe(),I(U=(N=function(t){function u(e,r){var i;i=t.call(this,e,r)||this;Me(i,"contextPath",Y,i);Me(i,"appId",G,i);Me(i,"easyFilterLib",Q,i);Me(i,"filterBarMetadata",W,i);Me(i,"recommendedValues",J,i);Me(i,"dataFetcher",$,i);Me(i,"easyFilterInput",X,i);Me(i,"tokenizer",Z,i);Me(i,"content",ee,i);Me(i,"tokensChanged",te,i);Me(i,"queryChanged",re,i);Me(i,"showValueHelp",ie,i);Me(i,"clearFilters",se,i);Me(i,"beforeQueryProcessing",ne,i);Me(i,"afterQueryProcessing",ae,i);Me(i,"state",oe,i);i.shouldTokenChangeEventFired=true;i.inputFieldReady=new Promise(e=>{i.resolveContentReady=e});i.initialize();return i}ue=u;Ie(u,t);var c=u.prototype;c.setEasyFilterLib=function e(t){this.setProperty("easyFilterLib",t);if(this.easyFilterLib){this.easyfilter=le(this.easyFilterLib)}};c.setAppId=async function e(t){if(!this.appId){this.setProperty("appId",t,true);await this.inputFieldReady;this.easyFilterInput.current?.setProperty("appId",t,true);await(this.easyFilterInput.current?.initShellHistoryProvider())}};c.setFilterBarMetadata=function e(t){if(!this.filterBarMetadata){this.setProperty("filterBarMetadata",t,true);const e=this.getDefaultTokens();if(!this.innerControlPopover){this.innerControlPopover=this.createPopoverForInnerControls();this.addDependent(this.innerControlPopover)}this.state.tokens=e;this.state.showResult=e.length>0;this.isMandatoryCheckRequired=true;this.shouldTokenChangeEventFired=false}};c.init=function e(){this.resourceBundle=p.getResourceBundleFor("sap.fe.controls")};c.initialize=function e(){this.content=this.createContent();this.resolveContentReady();if(!this.innerControlPopover){this.innerControlPopover=this.createPopoverForInnerControls();this.addDependent(this.innerControlPopover)}this.isMandatoryCheckRequired=true;this.shouldTokenChangeEventFired=false};c.getDefaultTokens=function e(){const t=[];if(!this.mandatoryKeyMap){this.mandatoryKeyMap={}}this.filterBarMetadata?.forEach(e=>{const r=e.required;if(r){this.mandatoryKeyMap[e.name]=true;if(e.type==="ValueHelp"){t.push({key:e.name,label:e.label,keySpecificSelectedValues:e.defaultValue??[],type:e.type,busy:false,isRequired:r})}else{t.push({key:e.name,label:e.label,keySpecificSelectedValues:e.defaultValue??[],type:e.type,busy:false,isRequired:r})}}});return t};c.onEnterPressed=function e(t){this.onGoPress(t.getParameter("query"))};c.checkIfAllMandatoryTokensFilled=function e(){const t=this.getUnSetMandatoryTokensInCurrentState();if(t.length!==0){const e=this.getActualTokensFromState(t);e?.forEach(e=>{e.setProperty("valueState",pe.Error);e.setProperty("valueStateText",this.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_ERROR"));e.openValueStateMessage()});return false}return true};c.closeAllMandatoryValueStateMessages=function e(){const t=this.tokenizer.current?.getTokens();t.forEach(e=>e.closeValueStateMessage())};c.onGoPress=async function t(r){if(!r){this.resetState();return}this.state.tokenizerEditable=true;const i=await this.easyfilter;if(!i){return}this.fireEvent("beforeQueryProcessing");const s={version:1,entitySet:this.contextPath,fields:this.filterBarMetadata};const n=await i.easyFilter(r,s);if(n.success){if(this.easyFilterInput.current?.isHistoryEnabled()??false){this.easyFilterInput.current?.addRecentQuery(r)}if(n.data.version===1){this.handleV1Success(n)}else if(n.data.version===2){}}else{this.easyFilterInput.current?.setAsInvalid(n.message);this.removeNonMandatoryTokens();e.error("Error while generating filter criteria: ",n.message)}this.fireEvent("afterQueryProcessing")};c.handleV1Success=function t(r){if(r.data.unclear){this.easyFilterInput.current?.setAsInvalid(this.resourceBundle.getText("M_EASY_FILTER_UNCLEAR_INPUT",[r.data.unclear]))}if(r.data.filter){e.debug("Filter criteria generated: ",JSON.stringify(r.data.filter,null,2));const t=[...this.state.tokens].filter(e=>e.isRequired);T.formatData(t,r.data.filter,this.filterBarMetadata);const i=t.filter(e=>e.type==="ValueHelp");if(this.dataFetcher){i.forEach(async e=>{const t=await(this.dataFetcher?.(e.key,e.keySpecificSelectedValues,r));e.busy=false;if(t){e.keySpecificSelectedValues=t;this.state.showResult=true;this.state.tokens=s}})}else{i.forEach(e=>{e.busy=false;e.keySpecificSelectedValues.forEach((t,r)=>{if(t.operator===m.BT||t.operator===m.NB){e.keySpecificSelectedValues[r].selectedValues=[{value:t.selectedValues[0],description:t.selectedValues[0]},{value:t.selectedValues[1],description:t.selectedValues[1]}]}else{e.keySpecificSelectedValues[r].selectedValues.forEach((t,i)=>{e.keySpecificSelectedValues[r].selectedValues[i]={value:t,description:t}})}})})}const s=this.verifySingleSelectTokenValues(t);this.state.showResult=true;this.state.tokens=s}};c.verifySingleSelectTokenValues=function e(t){const r=[];t.forEach(e=>{if(e.type==="MenuWithSingleSelect"){if(e.keySpecificSelectedValues[0].selectedValues.length>1){r.push(e.label);e.keySpecificSelectedValues[0].selectedValues.splice(1)}}});if(r.length){this.state.singleValueMessageStripText=this.resourceBundle.getText("M_EASY_FILTER_SINGLE_VALUE_MESSAGE",[`<strong>${r.join(", ")}</strong>`]);this.state.showSingleValueMessageStrip=true}return t};c.createPopoverForInnerControls=function e(){if(!this.innerControlPopover){this.innerControlPopover=E(a,{id:this.getId()+"-innerPopover",showArrow:false,showHeader:true,placement:fe.Bottom,children:{footer:this.getToolbar()}})}return this.innerControlPopover};c.getToolbar=function e(){if(!this.toolbar){const e=this.getOkButton();const t=this.getShowAllButton();this.toolbar=E(b,{children:{content:M(V,{children:[E(S,{}),e,t]})}})}return this.toolbar};c.getOkButton=function e(){if(!this.okButton){this.okButton=E(s,{text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_OK"),type:be.Emphasized})}return this.okButton};c.getShowAllButton=function e(){if(!this.showAllButton){this.showAllButton=E(s,{text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_SHOW_ALL_ITEMS")})}return this.showAllButton};c.formatTokens=function e(t){return t.map(e=>{if(e.type==="ValueHelp"){return{...e,keySpecificSelectedValues:e.keySpecificSelectedValues.map(e=>({operator:e.operator,selectedValues:e.selectedValues.map(e=>e.value)}))}}else{return f(e)}})};c.onStateChange=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(t.includes("tokens")){if(this.shouldTokenChangeEventFired){this.fireEvent("tokensChanged",{tokens:this.formatTokens(this.state.tokens)})}this.state.showResult=this.state.tokens.length>0;if(!(this.isMandatoryCheckRequired??false)){this.checkIfAllMandatoryTokensFilled()}}this.isMandatoryCheckRequired=false;this.shouldTokenChangeEventFired=true;(this.tokenizer?.current).onsapfocusleave=()=>{}};c.createContent=function e(){const t=Ee();const r=M(l,{children:[M(n,{renderType:"Bare",children:[E(g,{recommendedValues:this.recommendedValues,ref:this.easyFilterInput,enterPressed:this.onEnterPressed.bind(this),queryChanged:e=>{this.fireEvent("queryChanged",{query:e.getParameter("query")})},liveChange:()=>{this.state.tokenizerEditable=false}}),E(s,{icon:"sap-icon://ai",class:"sapUiSmallMarginBegin",ref:t,text:this.resourceBundle.getText("M_EASY_FILTER_GO"),type:be.Emphasized,press:this.onGoButtonPress.bind(this)})]}),E(n,{renderType:"Bare",visible:ce(this.state,"showResult"),alignItems:ke.Center,wrap:ye.Wrap,justifyContent:ge.SpaceBetween,class:"sapUiTinyMarginTop",children:M(n,{class:"sapFeControlsGap8px",renderType:"Bare",alignItems:ke.Center,wrap:ye.Wrap,children:[E(F,{resourceBundle:this.resourceBundle}),E(o,{editable:he(ce(this.state,"tokenizerEditable"),true),class:"sapFeControlsTokenizer",tokens:ce(this.state,"tokens"),renderMode:de.Loose,ref:this.tokenizer,children:{tokens:(e,t)=>{const r=t.getObject();return E(i,{label:this.state.tokens.label,items:this.state.tokens.keySpecificSelectedValues,mandatory:this.isKeyMandatory(r.key),busy:this.state.tokens.busy,delete:()=>{const e=this.state.tokens.findIndex(e=>e.key===r.key);const t=this.state.tokens.concat();t.splice(e,1);this.state.tokens=t;this.updateFilterInput("tokenUpdated")},children:{customData:[E(h,{value:r},"TokenInfo"),E(h,{value:this.innerControlPopover},"popover"),E(h,{value:this},"easyFilterBarContainer"),E(h,{value:this.filterBarMetadata?.find(e=>e.name===r.key)?.codeList},"codeList")]}},this.state.tokens.key)}}}),E(s,{text:this.resourceBundle.getText("M_EASY_FILTER_RESET"),type:be.Transparent,press:()=>{this.resetState();this.easyFilterInput.current?.$searchInput.focus()}})]})}),E(n,{renderType:"Bare",children:E(k,{text:ce(this.state,"singleValueMessageStripText"),showIcon:true,enableFormattedText:true,visible:ce(this.state,"showSingleValueMessageStrip"),showCloseButton:true,close:()=>{this.state.showSingleValueMessageStrip=false}})})]});v.setSemanticStepname(t.current,"press","fe:ai:search");return r};c.onGoButtonPress=async function e(){this.state.tokenizerEditable=true;let t=this.easyFilterInput.current?.getValue();const r=this.easyFilterInput.current?.getPlaceholder();if(t===""&&r!==this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")){this.easyFilterInput.current?.setValue(r||"");t=r}await this.onGoPress(t)};c.resetState=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(t){this.fireEvent("clearFilters")}else{this.shouldTokenChangeEventFired=false}this.state.tokens=this.getDefaultTokens();this.updateFilterInput("tokenReset");this.state.tokenizerEditable=true;this.isMandatoryCheckRequired=true;this.tokenizer.current?.getTokens().forEach(e=>e.setProperty("valueState",pe.None));this.tokenizer.current?.getTokens().forEach(e=>e.setProperty("valueStateText",null))};c.updateTokenArray=function t(r,i,s){const n=this.state.tokens.map(e=>({...e,keySpecificSelectedValues:[...e.keySpecificSelectedValues]}));const a=n.findIndex(e=>e.key===s);const o=n[a];if(a!=-1){switch(r){case"setSelectedValues":this.setSelectedValues(o,i,a,n);o.keySpecificSelectedValues=i;if(!this.isKeyMandatory(o.key)&&o.keySpecificSelectedValues.length===0){n.splice(a,1)}break;default:e.error("Specifying a setter that is out of the boundary");break}this.state.tokens=n;this.state.showResult=n.length>0;this.updateFilterInput("tokenUpdated")}};c.closeInnerControlPopover=function e(){this.innerControlPopover?.close()};c.setSelectedValues=function e(t,r,i,s){t.keySpecificSelectedValues=r;if(!this.isKeyMandatory(t.key)&&t.keySpecificSelectedValues.length===0){s.splice(i,1)}};c.isKeyMandatory=function e(t){if(!this.mandatoryKeyMap){this.mandatoryKeyMap={}}return this.mandatoryKeyMap[t]?true:false};c.removeNonMandatoryTokens=function e(){const t=this.state.tokens.filter(e=>this.isKeyMandatory(e.key));this.state.tokens=t;return this};c.updateFilterInput=function e(t){const r=this.easyFilterInput.current?.getValue()||"";if(t==="tokenUpdated"&&r!==""){this.easyFilterInput.current?.setValue("");this.easyFilterInput.current?.setPlaceholder(r)}else if(t==="tokenReset"){this.easyFilterInput.current?.setValue("");this.easyFilterInput.current?.setPlaceholder(this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER"))}};c.getTokensInInitialState=function e(){const t=this.state.tokens.map(e=>({...e,keySpecificSelectedValues:[...e.keySpecificSelectedValues]}));const r=t.filter(e=>{if(this.isKeyMandatory(e.key)){return true}});return r.map(e=>({...e,keySpecificSelectedValues:[]}))};c.getUnSetMandatoryTokensInCurrentState=function e(){return this.state.tokens.filter(e=>{const t=this.isKeyMandatory(e.key);if(t){return e.keySpecificSelectedValues.length===0}})};c.getActualTokensFromState=function e(t){const r=t.map(e=>e.key);return this.tokenizer.current?.getTokens().filter(e=>r.includes(e.getKey()))};u.render=function e(t,i){return r.renderUsingRenderManager(t,i,()=>E("span",{ref:i,children:i.getAggregation("content")}))};return u}(c),Y=Ce(N.prototype,"contextPath",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),G=Ce(N.prototype,"appId",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=Ce(N.prototype,"easyFilterLib",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),W=Ce(N.prototype,"filterBarMetadata",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),J=Ce(N.prototype,"recommendedValues",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),$=Ce(N.prototype,"dataFetcher",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),X=Ce(N.prototype,"easyFilterInput",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=Ce(N.prototype,"tokenizer",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),ee=Ce(N.prototype,"content",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),te=Ce(N.prototype,"tokensChanged",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),re=Ce(N.prototype,"queryChanged",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),ie=Ce(N.prototype,"showValueHelp",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),se=Ce(N.prototype,"clearFilters",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=Ce(N.prototype,"beforeQueryProcessing",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=Ce(N.prototype,"afterQueryProcessing",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=Ce(N.prototype,"state",[H],{configurable:true,enumerable:true,writable:true,initializer:function(){return{showResult:false,tokens:[],tokenizerEditable:true,showSingleValueMessageStrip:false,singleValueMessageStripText:""}}}),N))||U);ue=Be;return ue},false);
//# sourceMappingURL=EasyFilterBarContainer.js.map