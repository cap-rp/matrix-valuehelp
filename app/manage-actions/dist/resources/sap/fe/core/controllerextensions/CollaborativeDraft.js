/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/ClassSupport","sap/ui/core/Element","../templating/UIFormatters","./BaseControllerExtension","./collaboration/CollaborationCommon"],function(t,e,i,n,o){"use strict";var s,a;var r={};var c=o.CollaborationFieldGroupPrefix;var l=o.Activity;var u=i.FieldEditMode;var f=t.defineUI5Class;function d(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,g(t,e)}function g(t,e){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},g(t,e)}let h=(s=f("sap.fe.core.controllerextensions.CollaborationDraft"),s(a=function(t){function i(){return t.apply(this,arguments)||this}r=i;d(i,t);var n=i.prototype;n.getCollaborativeDraftService=function t(){this.collaborativeDraftService=this.collaborativeDraftService??this.base.getAppComponent().getCollaborativeDraftService();return this.collaborativeDraftService};n.handleContentFocusIn=function t(i,n){if(i.isA("sap.m.Tokenizer")){i=i.getParent()?.getParent()}let o=false;if(n){o=!i.getDomRef()?.contains(n.relatedTarget)}if(i.isA("sap.ui.mdc.MultiValueField")||o){const t=this.getLastFocusId();if(t&&t!==i.getId()&&this.getLastFocusFieldGroups()===i.getFieldGroupIds().join(",")){const i=e.getElementById(t);this?.sendFocusOutMessage(i)}this.setLastFocusInformation(i);this.sendFocusInMessage(i)}};n.handleContentFocusOut=function t(i){let n=i.getSource();if(n.isA("sap.m.Tokenizer")){n=n.getParent()?.getParent()}if(!n.isA("sap.ui.mdc.MultiValueField")){while(n&&!n?.isA("sap.fe.macros.Field")){n=n?.getParent()}if(!n)return}const o=i.getParameter("fieldGroupIds");if(o.some(t=>t.startsWith(c))){const t=i.getSource();let o=e.getActiveElement();while(o&&o!==t){o=o.getParent()}if(o!==t){this.sendFocusOutMessage(n);if(this.getLastFocusId()===n.getId()){this.setLastFocusInformation(undefined)}}}};n.getLastFocusId=function t(){return this.lastFocusId};n.getLastFocusFieldGroups=function t(){return this.lastFocusFieldGroups};n.setLastFocusInformation=function t(e){this.lastFocusId=e?.getId();this.lastFocusFieldGroups=e?.getFieldGroupIds().join(",")};n.sendFocusInMessage=function t(e){const i=this.getCollaborationPath(e);if(i){this.send({action:l.Lock,content:i})}};n.sendFocusOutMessage=function t(e){if(!e){return}const i=this.getCollaborationPath(e);if(i){this.send({action:l.Unlock,content:i})}};n.getCollaborationPath=function t(e){const i=e?.getBindingContext();if(!i){return}if(e.isA("sap.fe.macros.Field")){if(!e.getMainPropertyRelativePath()){return undefined}const t=e.content;if(![u.Editable,u.EditableDisplay,u.EditableReadOnly].includes(t?.getProperty("editMode"))){return undefined}return`${i.getPath()}/${e.getMainPropertyRelativePath()}`}else if(e.isA("sap.ui.mdc.MultiValueField")){const t=e.getBindingInfo("items").template.getBindingPath("key");return`${i.getPath()}/${e.getBindingInfo("items").path}/${t}`}};n.send=function t(e){this.getCollaborativeDraftService().send(this.getView(),e)};n.isConnected=function t(){return this.getCollaborativeDraftService().isConnected(this.getView())};n.connect=async function t(){return this.getCollaborativeDraftService().connect(this.getView())};n.disconnect=function t(){return this.getCollaborativeDraftService().disconnect(this.getView())};n.isCollaborationEnabled=function t(){return this.getCollaborativeDraftService().isCollaborationEnabled(this.getView())};n.retainAsyncMessages=function t(e){return this.getCollaborativeDraftService().retainAsyncMessages(this.getView(),e)};n.releaseAsyncMessages=function t(e){return this.getCollaborativeDraftService().releaseAsyncMessages(this.getView(),e)};n.updateLocksForContextPath=function t(e,i){return this.getCollaborativeDraftService().updateLocksForContextPath(this.getView(),e,i)};return i}(n))||a);r=h;return r},false);
//# sourceMappingURL=CollaborativeDraft.js.map