/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/base/util/extend","sap/fe/base/ClassSupport","sap/m/library","sap/ui/core/Component","sap/ui/core/Element","sap/ui/core/Fragment","sap/ui/core/Lib","sap/ui/core/XMLTemplateProcessor","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/routing/HashChanger","sap/ui/core/util/XMLPreprocessor","sap/ui/model/json/JSONModel"],function(e,t,o,a,r,i,n,s,l,c,p,u,h,d,g){"use strict";var f,m,y,S,b,w,_,T,O,P,E,M,D,A,C,v,I,j,x;var U=a.publicExtension;var H=a.methodOverride;var F=a.finalExtension;var R=a.extensible;var L=a.defineUI5Class;function B(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,J(e,t)}function J(e,t){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},J(e,t)}function V(e,t,o,a,r){var i={};return Object.keys(a).forEach(function(e){i[e]=a[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,a){return a(e,t,o)||o},i),r&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(r):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}let z;let k=(f=L("sap.fe.core.controllerextensions.Share"),m=H(),y=H(),S=U(),b=F(),w=U(),_=R("AfterAsync"),T=U(),O=R(u.After),P=U(),E=F(),M=U(),D=F(),A=U(),C=F(),v=U(),I=F(),f(j=(x=function(a){function p(){return a.call(this)||this}B(p,a);var u=p.prototype;u.onInit=function e(){const t=new g({saveAsTileClicked:false,collaborationInfo:{url:"",appTitle:"",subTitle:"",minifyUrlForChat:true,appId:""}});this.base.getView().setModel(t,"shareInfo")};u.onExit=function e(){const t=this.base?.getView()?.getModel("shareInfo");if(t){t.destroy()}};u.openShareSheet=function e(t){this._openShareSheetImpl(t)};u.getCardDefinition=async function e(){return Promise.resolve(undefined)};u.adaptShareMetadata=function e(t){const o=this.base?.getView()?.getModel("shareInfo");const a=this.base.getAppComponent().getManifest();const r=a?.["sap.app"]?.id;const i=a?.["sap.app"]?.title||document.title;if(o){o.setProperty("/collaborationInfo/appId",r);o.setProperty("/collaborationInfo/url",t.url);o.setProperty("/collaborationInfo/appTitle",i)}return t};u._openShareSheetImpl=async function t(a){let i;const p=h.getInstance();const u=p.getHash();const f=p.hrefForAppSpecificHash?p.hrefForAppSpecificHash(""):"";const m={url:window.location.origin+window.location.pathname+window.location.search+(u?f+u:window.location.hash),title:await(this.base.getAppComponent()?.getShellServices()?.getTitle()),email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};z=a;const y=function(e,t){const a=e.getModel("shareData");const r=o(a.getData(),t);a.setData(r)};try{const t=await(this.base.getView().getController()?.share?.adaptShareMetadata(m));const p={shareEmailPressed:function(){const e=i.getModel("shareData");const t=e.getData();const o=l.getResourceBundleFor("sap.fe.core");const a=t.email.title?t.email.title:o.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[t.title]);r.URLHelper.triggerEmail(undefined,a,t.email.url?t.email.url:t.url)},shareMSTeamsPressed:function(){const e=i.getModel("shareData");const t=e.getData();const o=t.email.title?t.email.title:t.title;const a=t.email.url?t.email.url:t.url;const r=window.open("","ms-teams-share-popup","width=700,height=600");r.opener=null;r.location=`https://teams.microsoft.com/share?msgText=${encodeURIComponent(o)}&href=${encodeURIComponent(a)}`},onSaveTilePress:function(){setTimeout(function(){n.getElementById("bookmarkDialog")?.attachAfterClose(function(){z.focus()})},0)},shareJamPressed:async()=>{await this._doOpenJamShareDialog(t?.jam?.title?t.jam.title:t.title,t?.jam?.url?t.jam.url:t.url)}};p.onCancelPressed=function(){i.close()};p.setShareSheet=function(e){a.shareSheet=e};const u=new g({});const h={bindingContexts:{this:u.createBindingContext("/")},models:{this:u}};const f={title:t?.tile?.title?t.tile.title:t.title,subtitle:t?.tile?.subtitle,icon:t?.tile?.icon,url:t?.tile?.url?t.tile.url:t.url.substring(t.url.indexOf("#")),queryUrl:t?.tile?.queryUrl};if(a.shareSheet){i=a.shareSheet;const e=i.getModel("share");this._setStaticShareData(e);const r=o(e.getData(),f);e.setData(r);y(i,t);i.openBy(a)}else{const r="sap.fe.macros.share.ShareSheet";const n=c.loadTemplate(r,"fragment");try{const e=await d.process(n,{name:r},h);i=await s.load({definition:e,controller:p});i.setModel(new g(f||{}),"share");const l=i.getModel("share");this._setStaticShareData(l);const c=o(l.getData(),f);l.setData(c);i.setModel(new g(t||{}),"shareData");y(i,t);a.addDependent(i);i.openBy(a);p.setShareSheet(i)}catch(t){e.error("Error while opening the share fragment",t)}}}catch(t){e.error("Error while fetching the share model data",t)}};u.getTeamsUrl=async function e(t){const o=await(this.base.getAppComponent()?.getShellServices().getInframeUrl());return o?o:t};u._setStaticShareData=function e(o){const a=l.getResourceBundleFor("sap.fe.core");o.setProperty("/jamButtonText",a.getText("T_COMMON_SAPFE_SHARE_JAM"));o.setProperty("/emailButtonText",a.getText("T_SEMANTIC_CONTROL_SEND_EMAIL"));o.setProperty("/msTeamsShareButtonText",a.getText("T_COMMON_SAPFE_SHARE_MSTEAMS"));if(t.get("sap-ushell-config.renderers.fiori2.componentData.config.sapHorizonEnabled")===true){o.setProperty("/msTeamsVisible",true)}else{o.setProperty("/msTeamsVisible",false)}const r=t.get("sap.ushell.Container.getUser");o.setProperty("/jamVisible",!!r&&r().isJamActive());o.setProperty("/saveAsTileVisible",!!sap.ui.require("sap/ushell/Container"))};u._doOpenJamShareDialog=async function e(t,o){const a=await i.create({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:o,share:t}}});a.open()};u._triggerEmail=async function e(){const t=await this._adaptShareMetadata();const o=l.getResourceBundleFor("sap.fe.core");const a=t.email.title?t.email.title:o.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[t.title]);r.URLHelper.triggerEmail(undefined,a,t.email.url?t.email.url:t.url)};u._triggerShareToJam=async function e(){const t=await this._adaptShareMetadata();await this._doOpenJamShareDialog(t.jam.title?t.jam.title:t.title,t.jam.url?t.jam.url:window.location.origin+window.location.pathname+t.url)};u._saveAsTile=async function e(t){const o=this.base?.getView()?.getModel("shareInfo");if(o){o.setProperty("/saveAsTileClicked",true)}const a=await this._adaptShareMetadata(),r=t.getDependents()[0],i=h.getInstance(),n=i.getHash(),s=i.hrefForAppSpecificHash?i.hrefForAppSpecificHash(""):"";a.url=n?s+n:window.location.hash;r.setTitle(a.tile.title?a.tile.title:a.title);r.setSubtitle(a.tile.subtitle);r.setTileIcon(a.tile.icon);r.setCustomUrl(a.tile.url?a.tile.url:a.url);r.setServiceUrl(a.tile.queryUrl);r.setDataSource({type:"OData",settings:{odataVersion:"4.0"}});if(o){o.setProperty("/saveAsTileClicked",false)}r.firePress()};u._adaptShareMetadata=async function e(){const t=h.getInstance();const o=encodeURIComponent(t.getHash());const a=t.hrefForAppSpecificHash?t.hrefForAppSpecificHash(""):"";const r={url:window.location.origin+window.location.pathname+window.location.search+(o?a+o:window.location.hash),title:await(this.base.getAppComponent()?.getShellServices()?.getTitle()),email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};return this.base.getView().getController().share.adaptShareMetadata(r)};return p}(p),V(x.prototype,"onInit",[m],Object.getOwnPropertyDescriptor(x.prototype,"onInit"),x.prototype),V(x.prototype,"onExit",[y],Object.getOwnPropertyDescriptor(x.prototype,"onExit"),x.prototype),V(x.prototype,"openShareSheet",[S,b],Object.getOwnPropertyDescriptor(x.prototype,"openShareSheet"),x.prototype),V(x.prototype,"getCardDefinition",[w,_],Object.getOwnPropertyDescriptor(x.prototype,"getCardDefinition"),x.prototype),V(x.prototype,"adaptShareMetadata",[T,O],Object.getOwnPropertyDescriptor(x.prototype,"adaptShareMetadata"),x.prototype),V(x.prototype,"_triggerEmail",[P,E],Object.getOwnPropertyDescriptor(x.prototype,"_triggerEmail"),x.prototype),V(x.prototype,"_triggerShareToJam",[M,D],Object.getOwnPropertyDescriptor(x.prototype,"_triggerShareToJam"),x.prototype),V(x.prototype,"_saveAsTile",[A,C],Object.getOwnPropertyDescriptor(x.prototype,"_saveAsTile"),x.prototype),V(x.prototype,"_adaptShareMetadata",[v,I],Object.getOwnPropertyDescriptor(x.prototype,"_adaptShareMetadata"),x.prototype),x))||j);return k},false);
//# sourceMappingURL=Share.js.map