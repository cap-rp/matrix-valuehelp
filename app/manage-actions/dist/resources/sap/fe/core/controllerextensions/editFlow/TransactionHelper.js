/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/UIProvider","sap/fe/core/controllerextensions/BusyLocker","sap/fe/core/controllerextensions/editFlow/draft","sap/fe/core/controllerextensions/editFlow/editFlowConstants","sap/fe/core/controllerextensions/editFlow/operations","sap/fe/core/controllerextensions/editFlow/sticky","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/PromiseKeeper","sap/fe/core/helpers/ToES6Promise","sap/fe/core/helpers/TypeGuards","sap/fe/core/library","sap/m/Button","sap/m/Dialog","sap/m/MessageBox","sap/m/MessageToast","sap/m/Popover","sap/m/Text","sap/m/VBox","sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/core/message/MessageType","../../ActionRuntime","./operations/Operation","./operations/actionHelper"],function(e,t,n,a,o,i,r,s,c,l,d,g,u,f,p,h,C,m,y,D,E,w,M,b,A,v,x,P,T,O,I,_){"use strict";var S=m.isNavigationProperty;var N=f.getCreatePopupFields;var B=d.isDataFieldForAction;var L=l.convertTypes;var R=n.getCoreUIFactory;const F=y.CreationMode;const k=y.ProgrammingModel;const H=g.DeleteOptionTypes;const $=g.DeleteDialogContentControl;function U(e){if(e&&e.getMetadata&&e.getMetadata().getName()==="sap.ui.base.Event"){e={}}return e||{}}let j=function(){function n(){}var d=n.prototype;d.busyLock=function e(t,n){a.lock(t.getModel("ui"),n)};d.busyUnlock=function e(t,n){a.unlock(t.getModel("ui"),n)};d.getProgrammingModel=function e(t){let n;if(t.isA("sap.ui.model.odata.v4.Context")){n=t.getPath()}else{n=(t.isRelative()?t.getResolvedPath():t.getPath())??""}const a=t.getModel()?.getMetaModel();if(a&&p.isDraftSupported(a,n)){return k.Draft}else if(a&&p.isStickySessionSupported(a)){return k.Sticky}else{return k.NonDraft}};d.validateDocument=async function e(t,n,a){const o=n&&n.customValidationFunction;if(o){const e=o.substring(0,o.lastIndexOf(".")||-1).replace(/\./gi,"/"),i=o.substring(o.lastIndexOf(".")+1,o.length),r=n.data;delete r["@$ui5.context.isTransient"];return u.validationWrapper(e,i,r,a,t)}return Promise.resolve([])};d.getDataFromDefaultValueFunction=async function e(t){const n=t.getModel();const a=n.getMetaModel();const o=a.getMetaContext(t.getResolvedPath());const i=l.getInvolvedDataModelObjects(o);const s=i.targetObject.annotations.Common?.DefaultValuesFunction;const c=i.targetEntitySet?.annotations.Common?.DefaultValuesFunction;const d=s??c;if(!d){return undefined}const g=S(i.targetObject)&&s!==undefined;const u=g?t.getContext():t.getHeaderContext();if(!u){return undefined}const f=`${a.getMetaPath(u.getPath())}/${d}`;const p=l.getInvolvedDataModelObjects(a.getMetaContext(f));const h=p.targetObject?.isBound?await r.callBoundFunction(d.toString(),u,n):await r.callFunctionImport(d.toString(),n);return h.getObject()};d.isListBindingHierarchical=function e(t){return t.getAggregation()?.hierarchyQualifier?true:false};d.isListBindingAnalytical=function e(t){const n=t.getAggregation();return n!==undefined&&!n.hierarchyQualifier};d.createContext=async function e(t,n,a){const o=n??{};if(this.isListBindingHierarchical(t)){let e;if(a.parentContext?.isExpanded()===false){await t.expand(a.parentContext)}if(t.isRelative()){Object.assign(o,{"@$ui5.node.parent":a.parentContext});e=t}else{const n=t.getModel();const i=n.getMetaModel();e=n.bindList(t.getPath(),undefined,undefined,undefined,{$$groupId:t.getGroupId(),$$updateGroupId:t.getUpdateGroupId()});if(a.parentContext){const e=l.getInvolvedDataModelObjects(i.getMetaContext(t.getPath()));const n=t.getAggregation().hierarchyQualifier;const r=e.targetEntityType.annotations.Aggregation?.[`RecursiveHierarchy#${n}`]?.ParentNavigationProperty.value;if(!r){throw new Error(`Cannot find parent navigation property for ${t.getPath()}`)}const s={};s[`${r}@odata.bind`]=a.parentContext.getPath().replace(/^\//,"");Object.assign(o,s)}}return e.create(o,true)}else if(this.isListBindingAnalytical(t)){if(t.isRelative()){throw new Error("Creating a new document in a analytical table is supported only in a ListReport")}else{const e=t.getModel();const n=e.bindList(t.getPath(),undefined,undefined,undefined,{$$groupId:t.getGroupId(),$$updateGroupId:t.getUpdateGroupId()});return n.create(o,true)}}else{return t.create(o,true,a.createAtEnd,a.createInactive)}};d.getCreationParameters=function e(t,n,a){const o=t.getModel().getMetaModel();const i=o.getMetaPath(t.getHeaderContext().getPath());const r=N(o,i,a);return r.filter(e=>!(e in(n??{})))};d.createDocument=async function e(t,n,a,o,i,r){let s;const c=U(n);if(!t){throw new Error("Binding required for new document creation")}const l=this.getProgrammingModel(t);if(l!==k.Draft&&l!==k.Sticky){throw new Error("Create document only allowed for draft or sticky session supported services")}const d=this.getBusyPath(c);c.beforeCreateCallBack=r?undefined:c.beforeCreateCallBack;if(!n?.inactive){this.busyLock(a,d)}const g=i.registerToHoldMessages();try{s=await this.performCreation(t,c,a,i,o,r);await i.showMessageDialog({control:c.parentControl,unHoldKey:g});return s}catch(e){await i.showMessageDialog({control:c.parentControl,unHoldKey:g});if((e===y.Constants.ActionExecutionFailed||e===y.Constants.CancelActionDialog)&&s?.isTransient()){s.delete("$direct")}throw e}finally{if(!n?.inactive){this.busyUnlock(a,d)}}};d.getBusyPath=function e(t){return t.busyMode==="Local"?`/busyLocal/${t.busyId}`:"/busy"};d.createDocumentContext=async function n(a,o){if(o.beforeCreateCallBack){const t=o.data?Object.entries(o.data).map(e=>{let[t,n]=e;return{[t]:n}}):[];try{await C(o.beforeCreateCallBack({contextPath:a&&a.getPath(),createParameters:t}))}catch(t){e.error(t);throw y.Constants.OnBeforeCreateFailed}o.data=t.reduce((e,t)=>({...e,...t}),{})}const i=this.createContext(a,o.data,{createAtEnd:!!o.createAtEnd,createInactive:!!o.inactive,parentContext:o.parentContext});if(a.getUpdateGroupId()===t.INLINEEDIT_UPDATEGROUPID){a.getModel().submitBatch(t.INLINEEDIT_UPDATEGROUPID)}return i};d.performCreation=async function e(t,n,a,o,i,r){const s=t.getModel().getMetaModel();const c=s.getMetaPath(t.getHeaderContext().getPath());const l=a.getRouterProxy().getHash();const d=a.getComponentData();const g=d?.startupParameters??{};const u=!t.isRelative()?this._getNewAction(g,l,s,c):undefined;if(u){const e=await this.performCreationWithAction(u,t,n,a,i,o);if(e.status==="rejected"){throw e.reason}return e.value.returnedContext}else{return this.performCreationWithPOST(t,n,a,i,o,r)}};d.performCreationWithAction=async function e(t,n,a,o,i,r){const s=n.getHeaderContext().getPath();const c=n.getModel().getMetaModel();const l=c.getMetaPath(s);const d=p.getMessagesPath(c,l);const g={$$patchWithoutSideEffects:true,$$updateGroupId:"$auto"};const u=[];if(d){u.push(d)}if(this.getProgrammingModel(n)===k.Draft){u.push("IsActiveEntity","HasDraftEntity","HasActiveEntity")}if(u.length>0){g["$select"]=u.join(",")}const f=await this.callAction(t,{contexts:n.getHeaderContext(),showActionParameterDialog:true,label:this._getSpecificCreateActionDialogLabel(c,l,t,i),bindingParameters:g,view:a.parentControl,isCreateAction:true,skipParameterDialog:a.skipParameterDialog},o,r);return f[0]};d.performCreationWithPOST=async function t(n,a,o,i,r,s){try{let e;const t=a.data;if(!s){const e=await this.getDataFromDefaultValueFunction(n);a.data=Object.assign({},e,a.data)}if(a.data){delete a.data["@odata.context"]}const c=a.creationMode!==F.CreationRow&&a.creationMode!==F.Inline;const l=c?this.getCreationParameters(n,t,o):[];if(a.creationMode===F.CreationDialog){a.creationDialogFields?.forEach(e=>{if(!l.includes(e)){l.push(e)}});if(l.length===0){throw new Error("No fields available for the creation dialog")}}if(l.length>0){e=await this.createWithDialog(n,l,a,o,i,r)}else{e=await this.createDocumentContext(n,a);if(!a.inactive){await this.waitForCreateCompletion(e,a.keepTransientContextOnFailed===true)}}return e}catch(t){const n=t.message??t;e.error("Error while creating the new document",n);throw n}};d._isDraftEnabled=function e(t){const n=t[0];const a=this.getProgrammingModel(n);return a===k.Draft};d.deleteDocument=async function e(t,n,a,o,i){this.busyLock(a);const r=Array.isArray(t)?[...t]:[t];const s=(n.selectedContexts??r)[0];return new Promise((e,t)=>{try{const l=this._isDraftEnabled(n.selectedContexts||r);const d=[];let u=[];let f;if(n){n=U(n);n.entitySetName=this.getCollectionNameFromContext(s);if(!n.numberOfSelectedContexts){if(l){const e=r.find(e=>{const t=e.getObject();return t.IsActiveEntity===true&&t.HasDraftEntity===true&&t.DraftAdministrativeData&&t.DraftAdministrativeData.InProcessByUser&&!t.DraftAdministrativeData.DraftIsCreatedByMe});if(e){const n=e.getObject().DraftAdministrativeData.InProcessByUser;w.show(o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_SINGLE_OBJECT_LOCKED",[n]),{title:o.getText("C_COMMON_DELETE"),onClose:t});return}else{f=r.find(e=>{const{IsActiveEntity:t,HasDraftEntity:n,DraftAdministrativeData:a}=e.getObject()||{};return t===true&&n===true&&!!a?.InProcessByUser})}}let e="";if(f){const t=f.getObject().DraftAdministrativeData.InProcessByUser;e=o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_UNSAVED_CHANGES",[t],n.entitySetName)}else if(n.title){if(n.description){e=o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTINFO",[n.title,n.description],n.entitySetName)}else{e=o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_ONLY",[n.title],n.entitySetName)}}else{e=o.getText("C_TRANSACTION_HELPER_CONFIRM_DELETE_WITH_OBJECTTITLE_SINGULAR",undefined,n.entitySetName)}u.push({type:H.deletableContexts,contexts:r,text:e,selected:true,control:$.TEXT})}else{let e=r.length;if(l){e+=(n.draftsWithNonDeletableActive?.length??0)+(n.draftsWithDeletableActive?.length??0)+(n.unSavedContexts?.length??0);g.updateDraftOptionsForDeletableTexts(n,r,e,o,d,u)}else{const t=g.getNonDeletableText(n,e,o);if(t){d.push(t)}}const t=g.getOptionsForDeletableTexts(n,r,o);u=[...u,...t]}}const p=s.getBinding();let h;if(p.isA("sap.ui.model.odata.v4.ODataListBinding")){if(this.isListBindingHierarchical(p)){h="Tree"}else if(this.isListBindingAnalytical(p)){h="Analytical"}}g.updateContentForDeleteDialog(u,d);const C=async()=>{c.removeBoundTransitionMessages();this.busyLock(a);try{await g.deleteConfirmHandler(u,n,i,o,a,l,h);e()}catch(e){t()}finally{this.busyUnlock(a)}};const m=this.createDeleteDialog(d,n,o,C,t);if(n.noDialog===true||n.silentMode===true){C()}else{m.addStyleClass("sapUiContentPadding");m.open()}}finally{this.busyUnlock(a)}})};d.createDeleteDialog=function e(t,n,a,o,i){let r=false;const s=new v({items:t});const c=x.getResourceBundleFor("sap.fe.core");let l;if(n.parentControl?.isA("sap.ui.mdc.Table")){l=a.getText("M_COMMON_TABLE_DELETE",undefined,n.entitySetName)}else{l=c.getText("C_COMMON_DELETE")}const d=new E({title:l,state:"Warning",content:[s],ariaLabelledBy:t,beginButton:new D({text:l,type:"Emphasized",press:function(){r=true;d.close();o()}}),endButton:new D({text:a.getText("C_COMMON_DIALOG_CANCEL"),press:function(){d.close()}}),afterClose:function(){d.destroy();if(!r){i()}}});return d};d.editDocument=async function e(t,n,a,i,r){const c=this.getProgrammingModel(t);if(!t){throw new Error("Binding context to active document is required")}if(c!==k.Draft&&c!==k.Sticky){throw new Error("Edit is only allowed for draft or sticky session supported services")}this.busyLock(a);i.removeTransitionMessages();const l=i.registerToHoldMessages();try{const e=c===k.Draft?await o.createDraftFromActiveDocument(t,a,{bPreserveChanges:true,oView:n},r,i):await s.editDocumentInStickySession(t,a,i);await i.showMessageDialog({unHoldKey:l});return e}catch(e){await i.showMessages({concurrentEditFlag:true,unHoldKey:l});throw e}finally{this.busyUnlock(a)}};d.cancelDocument=async function e(t,n,a,i,r,c,l){if(!t){throw new Error("No context exists. Pass a meaningful context")}const d=U(n);const g=t.getModel();const u=this.getProgrammingModel(t);if(u!==k.Draft&&u!==k.Sticky){throw new Error("Cancel document only allowed for draft or sticky session supported services")}this.busyLock(a);try{let e;if(u===k.Draft&&!l){const e=g.bindContext(`${t.getPath()}/DraftAdministrativeData`).getBoundContext();const n=await e.requestObject();if(n){l=n.CreationDateTime!==n.LastChangeDateTime}}if(!d.skipDiscardPopover){await this._confirmDiscard(d.cancelButton,l,i)}if(t.isKeepAlive()){t.setKeepAlive(true,undefined)}if(d.beforeCancelCallBack){await d.beforeCancelCallBack({context:t})}if(u===k.Draft){if(c){if(t.hasPendingChanges()){t.getBinding().resetChanges()}await o.deleteDraft(t,r,a)}else{const n=g.bindContext(`${t.getPath()}/SiblingEntity`).getBoundContext();try{const a=await n.requestCanonicalPath();if(t.hasPendingChanges()){t.getBinding().resetChanges()}e=g.bindContext(a).getBoundContext()}finally{await o.deleteDraft(t,r,a)}}}else{const n=await s.discardDocument(t);if(n){if(n.hasPendingChanges()){n.getBinding().resetChanges()}if(!c){n.refresh();e=n}}}r.removeTransitionMessages();await r.showMessages();return e}catch(e){await r.showMessages();throw e}finally{this.busyUnlock(a)}};d.saveDocument=async function e(n,a,i,r,l,d,g){let u=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;const f=this.getProgrammingModel(n);if(f!==k.Sticky&&f!==k.Draft){throw new Error("Save is only allowed for draft or sticky session supported services")}try{this.busyLock(a);const e=this.getCollectionNameFromContext(n);const t=f===k.Draft?await o.activateDocument(n,a,{},d):await s.activateDocument(n,a,d);const r=c.getMessages().concat(c.getMessages(true,true));if(!u&&!(r.length===1&&r[0].getType()===T.Success)){M.show(g?i.getText("C_TRANSACTION_HELPER_OBJECT_CREATED",undefined,e):i.getText("C_TRANSACTION_HELPER_OBJECT_SAVED",undefined,e))}return t}catch(e){if(r&&l?.length>0){l.forEach(e=>{if(!t.hasTransientContext(e)){a.getSideEffectsService().requestSideEffectsForNavigationProperty(e.getPath(),n)}})}await d.showMessages();throw e}finally{this.busyUnlock(a)}};d.callAction=async function e(t,n,a,o){n=U(n);let i;let s;if(!t){throw new Error("Provide name of action to be executed")}const c=t.split("/")[1];i=c?undefined:n.contexts;if(i&&(Array.isArray(i)&&i.length||!Array.isArray(i))){i=Array.isArray(i)?i[0]:i;s=i.getModel()}if(n.model){s=n.model}if(!s){throw new Error("Pass a context for a bound action or pass the model for an unbound action")}try{const e=n.controlId?n.view.byId(n.controlId):n.view;let c;if(i&&n.contexts){const i=Array.isArray(n.contexts)?n.contexts:[n.contexts];const r=s.getMetaModel(),l=`${r.getMetaPath(i[0].getPath())}/${t}`,d=r.createBindingContext(`${l}/@$ui5.overload/0`);const g=L(s.getMetaModel());const u=g.resolvePath(d.getPath()).target;if(!u){throw new Error("Unknown bound action")}c=await new I(a,s,u,{parameterValues:n.parameterValues,contexts:i,invocationGrouping:n.invocationGrouping,label:n.label,skipParameterDialog:n.skipParameterDialog,bindingParameters:n.bindingParameters,entitySetName:n.entitySetName,oDataProperties:{ghostContextBindingProtection:true,enhance$select:n.feFrameworkCall===true,groupId:n.groupId,ignoreETag:n.ignoreETag},oDataEvents:{onODataSubmit:()=>{o?.removeTransitionMessages();this.busyLock(a)},onODataResponse:()=>{this.busyUnlock(a)},onRequestSideEffects:()=>{this.handleActionEnablementOnOperation({internalModelContext:n.internalModelContext,operationAvailableMap:n.operationAvailableMap,control:e,contexts:i,convertedAction:u})}},view:n.view,isCreateAction:n.isCreateAction,messageHandler:o,defaultValuesExtensionFunction:n.defaultValuesExtensionFunction}).execute()}else{c=await r.callActionImport(t,s,a,{parameterValues:n.parameterValues,label:n.label,skipParameterDialog:n.skipParameterDialog,bindingParameters:n.bindingParameters,entitySetName:n.entitySetName,oDataEvents:{onODataSubmit:()=>{this.busyLock(a)},onODataResponse:()=>{this.busyUnlock(a)}},oDataProperties:{ignoreETag:n.ignoreETag},messageHandler:o,view:n.view})}if(o){this._handleActionResponse(n,t)}return c}catch(e){if(o){this._handleActionResponse(n,t)}throw e}};d.getCollectionNameFromContext=function e(t){const n=t.getModel().getMetaModel().getMetaContext(t.getPath());return l.getInvolvedDataModelObjects(n).targetObject?.name};d.handleActionEnablementOnOperation=function e(t){if(t.internalModelContext&&t.operationAvailableMap){let e=[];if(!_.isStaticAction(t.convertedAction)){e=t.internalModelContext.getProperty("selectedContexts")||[];O.setActionEnablement(t.internalModelContext,JSON.parse(t.operationAvailableMap),e,"table")}else if(t.control){if(t.control.isA("sap.ui.mdc.Table")){e=t.control.getSelectedContexts();O.setActionEnablement(t.internalModelContext,JSON.parse(t.operationAvailableMap),e,"table")}}g.updateDeleteInfoForSelectedContexts(t.internalModelContext,e)}};d._handleActionResponse=function e(t,n){const a=c.getMessages(true,true);if(a.length>0&&t&&t.internalModelContext){t.internalModelContext.setProperty("sActionName",t.label?t.label:n)}};d.handleValidationError=function e(){const t=P.getMessageModel().getData().filter(e=>e.validation);P.removeMessages(t)};d._createPopover=function e(t){return new b(t)};d._confirmDiscard=async function e(t,n,a){if(!n){this.handleValidationError();return Promise.resolve()}t.setEnabled(false);return new Promise((e,n)=>{const o=this._createPopover({showHeader:false,placement:"Top"});o.addStyleClass("sapUiContentPadding");const i=new A({text:a.getText("C_TRANSACTION_HELPER_DRAFT_DISCARD_MESSAGE")});const r=new D({text:a.getText("C_TRANSACTION_HELPER_DRAFT_DISCARD_BUTTON"),width:"100%",press:()=>{this.handleValidationError();o.data("continueDiscard",true);o.close()}});o.addContent(new v({items:[i,r]}));o.attachBeforeOpen(()=>{o.setInitialFocus(r)});o.attachAfterClose(()=>{t.setEnabled(true);if(o.data("continueDiscard")){e()}else{n()}});o.openBy(t,false)})};d.refreshListBinding=async function t(n,a){try{if(n.isRoot()){if(this.isListBindingHierarchical(n)){await a.getSideEffectsService().requestSideEffects([{$NavigationPropertyPath:""}],n.getHeaderContext())}else{await n.requestRefresh()}}else{await a.getSideEffectsService().requestSideEffects([{$NavigationPropertyPath:n.getPath()}],n.getContext())}}catch(t){e.error(`Error while refreshing list binding ${n.getPath()}`,t)}};d.createWithDialog=async function n(a,o,r,s,c,l){const d=a.getModel();const g=d.getMetaModel();const u=g.getMetaPath(a.getResolvedPath());const f=d.bindList(a.getPath(),a.getContext(),undefined,undefined,{$$updateGroupId:"submitLater"});f.refreshInternal=function(){};const p=f.create(r.data,true);const m=o.map(e=>g.createBindingContext(`${u}/${e}`));const D=R().newCreateDialog(p,o,s,r.creationMode===F.CreationDialog?"Standalone":"WithNavigation",r.parentControl);try{await t.setUserDefaults(s,m,p,false,r.createAction,r.data);D.openDialog()}catch(e){await l.showMessages();throw e}const E=new h;const w=async t=>{if(!t.getParameter("accept")){f.destroy();D.closeDialog();E.reject(y.Constants.CancelActionDialog);return}D.setBusy(true);r.bIsCreateDialog=true;try{const t=p.getObject();let n={};Object.keys(t).forEach(e=>{const a=g.getObject(`${u}/${e}`);if(a&&a.$kind!=="NavigationProperty"&&!e?.startsWith("@$ui5")){n[e]=t[e]}});if(r.beforeCreateCallBack){const t=Object.entries(n).map(e=>{let[t,n]=e;return{[t]:n}});try{await C(r.beforeCreateCallBack({contextPath:a.getPath(),createParameters:t}))}catch(t){e.error("Error while creating the new document",t);throw y.Constants.OnBeforeCreateFailed}n=t.reduce((e,t)=>({...e,...t}),{})}if(Object.keys(n).length>0){s.getModel("ui").setProperty(i.DocumentModified,true)}const o=await this.createContext(a,n,{createAtEnd:r.createAtEnd,createInactive:r.inactive,parentContext:r.parentContext});const d=await this.waitForCreateCompletion(o,r.keepTransientContextOnFailed===true);if(d){try{await(r.afterCreateCallBack?.(o))}catch(t){D.displayErrorMessages(P.getMessageModel().getData());await l.showMessageDialog({showBoundStateMessages:true});await this.deleteDocument(o,{silentMode:true},s,c,l);await this.refreshListBinding(a,s);e.error("Error while creating/saving the new document",t);throw y.Constants.CreationFailed}f.destroy();D.closeDialog();E.resolve(o)}}catch(e){if(![y.Constants.OnBeforeCreateFailed,y.Constants.CreationFailed].includes(e)){f.destroy();D.closeDialog();E.reject(e)}}finally{D.setBusy(false);l.showMessages({isOperationDialogOpen:D.isOpen()})}};D.attachExitDialog({},w);return E.promise};d.waitForCreateCompletion=async function t(n,a){const o=new h;const i=n.getBinding();const r=e=>{const t=e.getParameter("context");const a=e.getParameter("success");if(t===n){i.detachCreateCompleted(r);o.resolve(a===true)}};i.attachCreateCompleted(r);const s=await o.promise;if(!s){if(!a){(n.created()??Promise.resolve()).catch(function(t){e.trace("transient creation context deletion error",t)});i.resetChanges();i.getModel().resetChanges(i.getUpdateGroupId());throw y.Constants.CreationFailed}return false}else{await n.created();return true}};d._getNewAction=function e(t,n,a,o){let i;if(t&&t.preferredMode&&n.toUpperCase().includes("I-ACTION=CREATEWITH")){const e=t.preferredMode[0];i=e.toUpperCase().includes("CREATEWITH:")?e.substring(e.lastIndexOf(":")+1):undefined}else if(t&&t.preferredMode&&n.toUpperCase().includes("I-ACTION=AUTOCREATEWITH")){const e=t.preferredMode[0];i=e.toUpperCase().includes("AUTOCREATEWITH:")?e.substring(e.lastIndexOf(":")+1):undefined}else{i=a&&a.getObject!==undefined?a.getObject(`${o}@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction`)||a.getObject(`${o}@com.sap.vocabularies.Common.v1.DraftRoot/NewAction`):undefined}return i};d._getSpecificCreateActionDialogLabel=function e(t,n,a,o){const i=t?.getObject(`${n}/@com.sap.vocabularies.UI.v1.LineItem`);const r=i?.find(e=>B(e)&&e.Action.split("(",1)[0]===a)?.Label;return r||t?.getObject(`${n}/${a}@com.sap.vocabularies.Common.v1.Label`)||o?.getText("C_TRANSACTION_HELPER_SAPFE_ACTION_CREATE")};return n}();const W=new j;return W},false);
//# sourceMappingURL=TransactionHelper.js.map