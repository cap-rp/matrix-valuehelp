/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepEqual","sap/base/util/uid","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/core/message/MessageType","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution"],function(e,s,t,o,i,n,r,a,g,c,l){"use strict";var u,h,d,f,p,M,y,m,T,w,v,S;var E=o.publicExtension;var b=o.privateExtension;var D=o.finalExtension;var O=o.extensible;var I=o.defineUI5Class;function C(e,s){e.prototype=Object.create(s.prototype),e.prototype.constructor=e,P(e,s)}function P(e,s){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e},P(e,s)}function A(e,s,t,o,i){var n={};return Object.keys(o).forEach(function(e){n[e]=o[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=t.slice().reverse().reduce(function(t,o){return o(e,s,t)||t},n),i&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(i):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,s,n),null):n}let _=(u=I("sap.fe.core.controllerextensions.MessageHandler"),h=b(),d=O(l.Instead),f=E(),p=O("AfterAsync"),M=E(),y=D(),m=E(),T=E(),w=D(),u(v=(S=function(o){function c(){var e;e=o.call(this)||this;e.strictWarningMessages=[];e.holdKeys=[];e.holdMsgsToShow=false;e.uiElementIsAvailable=Promise.resolve();return e}C(c,o);var l=c.prototype;l.addWarningMessagesToMessageHandler=function e(s){this.strictWarningMessages=this.strictWarningMessages.concat(s)};l.isStrictWarningMessage=function e(t){return this.strictWarningMessages.find(e=>e.getCode()===t.getCode()&&e.getMessage()===t.getMessage()&&e.getType()===t.getType()&&e.getDescriptionUrl()===t.getDescriptionUrl()&&s(e.getTargets(),t.getTargets())&&e.getPersistent()===t.getPersistent())!==undefined};l.clearStrictWarningMessages=function e(){this.strictWarningMessages=[]};l.filterErrorMessages=function e(s){return s.filter(e=>e.getType()===g.Error)};l.getShowBoundMessagesInMessageDialog=function e(){return true};l.beforeShowMessageButton=async function e(s){return Promise.resolve()};l.registerToHoldMessages=function e(s){const o=s??t();if(!this.holdKeys.includes(o)){this.holdKeys.push(o)}return o};l.resetHoldKeys=function e(){this.holdKeys=[]};l.showMessageDialog=async function e(s){await this.uiElementIsAvailable;const t=a.getMessageModel().getData();const o=t.filter(e=>this.isStrictWarningMessage(e));a.removeMessages(o);const i=s&&s.customMessages?s.customMessages:undefined,n=this.base.getView().getBindingContext("internal");const r=this.base.getView().getViewData().converterType;if(s&&s.isOperationDialogOpen&&n){n.setProperty("isOperationDialogOpen",true)}const g=this.getShowBoundMessagesInMessageDialog();const c=s&&s.context?s.context:this.getView().getBindingContext();if(n){n.setProperty("isOperationDialogOpen",false)}return new Promise(function(e,t){setTimeout(function(){this.processAndShowMessages(s??{},c,g,i??[],e,t,r)}.bind(this),0)}.bind(this))};l.processAndShowMessages=function e(s,t,o,i,r,a,g){const{concurrentEditFlag:c,control:l,sActionName:u,onBeforeShowMessage:h,unHoldKey:d,isOperationDialogOpen:f=false,overrideUIDecision:p,showBoundStateMessages:M}=s;this.holdMsgsToShow=true;const y=n.getUIDecisions(i,t,o,c,l,u,h,g,M,s);this.updateUIDecisions(y,p);this.removeHoldKey(d??l?.getId());this.showMessagesWithCondtions(f,r,a)};l.showMessagesWithCondtions=async function s(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;let o=arguments.length>1?arguments[1]:undefined;let i=arguments.length>2?arguments[2]:undefined;const r=t||this.checkToShowUIElement();if(r&&this.uiDecisions){try{this.uiElementIsAvailable=n.showMessagesInUI(this.uiDecisions);const e=await this.uiElementIsAvailable;o?.(e)}catch(s){e.error(`FE : V4 : MessageHandler : Error on trying to show UI element: ${s}`);this.uiElementIsAvailable=Promise.resolve();i?.(s)}this.uiDecisions=undefined;this.clearStrictWarningMessages();this.holdMsgsToShow=false}else{e.info("FE : V4 : MessageHandler : Holding messages until a registered process ");o?.()}};l.removeTransitionMessages=function e(s,t,o){if(!s){n.removeBoundTransitionMessages(o)}if(!t){n.removeUnboundTransitionMessages()}};l._checkNavigationToErrorPage=function e(s){const t=n.getMessages();const o=this.getShowBoundMessagesInMessageDialog();const r=o?n.getMessages(true,true):[];const a=s&&s.customMessages?s.customMessages:[];const g=i.isStickyEditMode(this.base.getView());let c;if(s?.isDataReceivedError===true){c={title:s.title,description:s.description,navigateBackToOrigin:true,errorType:"PageNotFound"}}else if(!g&&!r.length&&!a.length&&(t.length===1||s?.isInitialLoad503Error===true)){const e=t[0];const s=e.getTechnicalDetails();if(s?.httpStatus===503){c=this._getHTTP503MessageParameters(e,s)}}return c};l._getHTTP503MessageParameters=function e(s,t){let o;const i=t.retryAfter!==undefined?this._getSecondsBeforeRetryAfter(t.retryAfter):undefined;if(i===undefined||i>120){const e=n.getRetryAfterMessage(s);o={description:e?`${e} ${s.getMessage()}`:s.getMessage(),navigateBackToOrigin:true,errorType:"UnableToLoad"}}return o};l._getSecondsBeforeRetryAfter=function e(s){const t=new Date,o=t.getTime(),i=s.getTime(),n=(i-o)/1e3;return n};l.updateUIDecisions=function e(s){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const o=this.uiDecisions;let i=[];let n;if(o&&t===false){if(o.messagesToShow.length===1&&s.messagesToShow.length===1&&o.messagesToShow[0].getCode()==="C_COMMON_SUCCESS_MESSAGE"&&s.messagesToShow[0].getCode()==="C_COMMON_SUCCESS_MESSAGE"){i=o.messagesToShow}else{i=Array.from(new Set([...o.messagesToShow,...s.messagesToShow]))}const e=[o.uiElementToUse,s.uiElementToUse];let t=i.length>0?"Dialog":"None";if(i.length===1){if(e.includes("Toast")){t="Toast"}else if(e.includes("Box")){t="Box"}}n={messagesToShow:i,uiElementToUse:t,contextNeedsEtagRefresh:o.contextNeedsEtagRefresh||s.contextNeedsEtagRefresh,containsBoundTransition:o.containsBoundTransition||s.containsBoundTransition}}else{n=s}this.uiDecisions=n};l.removeHoldKey=function e(s){if(s&&this.holdKeys.includes(s)){this.holdKeys.splice(this.holdKeys.indexOf(s),1)}};l.checkToShowUIElement=function e(){return this.holdMsgsToShow&&(this.holdKeys.length>0?false:true)};l.holdMessagesForControl=function e(s){const t=s.getId();this.registerToHoldMessages(t)};l.releaseHoldByControl=async function e(s){const t=s?.getId();this.removeHoldKey(t);this.uiElementIsAvailable=this.uiElementIsAvailable.then(async function(){return this.showMessagesWithCondtions()}.bind(this));await this.uiElementIsAvailable};l.showMessages=async function e(s){const t=this._checkNavigationToErrorPage(s);if(t){if(s?.messagePageNavigationCallback){s.messagePageNavigationCallback()}t.handleShellBack=!s?.shellBack;this.removeTransitionMessages();const e=r.getResourceBundleFor("sap.fe.core");return new Promise((o,i)=>{setTimeout(()=>{this.resetHoldKeys();this.base._routing.navigateToMessagePage(s?.isDataReceivedError===true?e.getText("C_COMMON_SAPFE_DATA_RECEIVED_ERROR"):e.getText("C_MESSAGE_HANDLING_SAPFE_503_TITLE"),t).then(o).catch(i)},0)})}else{return this.showMessageDialog(s)}};return c}(c),A(S.prototype,"getShowBoundMessagesInMessageDialog",[h,d],Object.getOwnPropertyDescriptor(S.prototype,"getShowBoundMessagesInMessageDialog"),S.prototype),A(S.prototype,"beforeShowMessageButton",[f,p],Object.getOwnPropertyDescriptor(S.prototype,"beforeShowMessageButton"),S.prototype),A(S.prototype,"showMessageDialog",[M,y],Object.getOwnPropertyDescriptor(S.prototype,"showMessageDialog"),S.prototype),A(S.prototype,"removeTransitionMessages",[m],Object.getOwnPropertyDescriptor(S.prototype,"removeTransitionMessages"),S.prototype),A(S.prototype,"showMessages",[T,w],Object.getOwnPropertyDescriptor(S.prototype,"showMessages"),S.prototype),S))||v);return _},false);
//# sourceMappingURL=MessageHandler.js.map