{"version":3,"file":"MessageHandler.js","names":["MessageHandler","_dec","defineUI5Class","_dec2","privateExtension","_dec3","extensible","OverrideExecution","Instead","_dec4","publicExtension","_dec5","_dec6","_dec7","finalExtension","_dec8","_dec9","_dec10","_class","_class2","_ControllerExtension","_this","call","this","strictWarningMessages","holdKeys","holdMsgsToShow","uiElementIsAvailable","Promise","resolve","_inheritsLoose","_proto","prototype","addWarningMessagesToMessageHandler","aMessages","concat","isStrictWarningMessage","oMessage","find","message","getCode","getMessage","getType","getDescriptionUrl","deepEqual","getTargets","getPersistent","undefined","clearStrictWarningMessages","filterErrorMessages","messages","filter","MessageType","Error","getShowBoundMessagesInMessageDialog","beforeShowMessageButton","async","_messageDetails","registerToHoldMessages","key","uniqueKey","uid","includes","push","resetHoldKeys","showMessageDialog","mParameters","messagesInModel","Messaging","getMessageModel","getData","duplicateWarningMessage","removeMessages","customMessages","oOPInternalBindingContext","base","getView","getBindingContext","viewType","getViewData","converterType","isOperationDialogOpen","setProperty","bShowBoundMessages","oBindingContext","context","reject","setTimeout","processAndShowMessages","bind","parameters","bindingContext","showBoundTransitionMessages","success","failure","concurrentEditFlag","control","sActionName","onBeforeShowMessage","unHoldKey","forceShowUIElement","overrideUIDecision","showBoundStateMessages","newUIDecisions","messageHandling","getUIDecisions","updateUIDecisions","removeHoldKey","getId","showMessagesWithCondtions","arguments","length","showUIElement","checkToShowUIElement","uiDecisions","showMessagesInUI","ret","err","Log","error","info","removeTransitionMessages","keepBoundMessage","keepUnboundMessage","sPathToBeRemoved","removeBoundTransitionMessages","removeUnboundTransitionMessages","_checkNavigationToErrorPage","aUnboundMessages","getMessages","bShowBoundTransitionMessages","aBoundTransitionMessages","aCustomMessages","bIsStickyEditMode","CommonUtils","isStickyEditMode","mMessagePageParameters","isDataReceivedError","title","description","navigateBackToOrigin","errorType","isInitialLoad503Error","oTechnicalDetails","getTechnicalDetails","httpStatus","_getHTTP503MessageParameters","technicalDetails","messagePageParameters","secondsBeforeRetry","retryAfter","_getSecondsBeforeRetryAfter","retryAfterMessage","getRetryAfterMessage","dRetryAfter","dCurrentDateTime","Date","iCurrentDateTimeInMilliSeconds","getTime","iRetryAfterDateTimeInMilliSeconds","iSecondsBeforeRetry","oldUIDecisions","allMessagesToShow","mergedUIDecision","messagesToShow","Array","from","Set","elements","uiElementToUse","contextNeedsEtagRefresh","containsBoundTransition","inKey","splice","indexOf","holdMessagesForControl","identifier","releaseHoldByControl","then","showMessages","messagePageNavigationCallback","handleShellBack","shellBack","oResourceBundle","Library","getResourceBundleFor","_routing","navigateToMessagePage","getText","catch","ControllerExtension","_applyDecoratedDescriptor","Object","getOwnPropertyDescriptor"],"sources":["./MessageHandler.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport deepEqual from \"sap/base/util/deepEqual\";\nimport uid from \"sap/base/util/uid\";\nimport { defineUI5Class, extensible, finalExtension, privateExtension, publicExtension } from \"sap/fe/base/ClassSupport\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type {\n\tMessageTechnicalDetails,\n\tMessageUIDecisions,\n\tShowMessageParameters,\n\tSupportedUIElement\n} from \"sap/fe/core/controllerextensions/messageHandler/messageHandling\";\nimport messageHandling from \"sap/fe/core/controllerextensions/messageHandler/messageHandling\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport type Dialog from \"sap/m/Dialog\";\nimport type Control from \"sap/ui/core/Control\";\nimport Library from \"sap/ui/core/Lib\";\nimport Messaging from \"sap/ui/core/Messaging\";\nimport type Message from \"sap/ui/core/message/Message\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport ControllerExtension from \"sap/ui/core/mvc/ControllerExtension\";\nimport OverrideExecution from \"sap/ui/core/mvc/OverrideExecution\";\nimport type Context from \"sap/ui/model/Context\";\nimport type ODataV4Context from \"sap/ui/model/odata/v4/Context\";\n\ntype ObjectWithConverterType = object & {\n\tconverterType: string;\n};\ntype NavigationToErrorPageParameter = {\n\tcustomMessages?: CustomMessage[];\n\tconcurrentEditFlag?: boolean;\n\tisDataReceivedError?: boolean;\n\ttitle?: string;\n\tdescription?: string;\n\tisInitialLoad503Error?: boolean;\n};\nexport type NavigationToErrorPageResult = {\n\ttitle?: string;\n\tdescription?: string;\n\terrorType?: string;\n\tnavigateBackToOrigin?: boolean;\n\thandleShellBack?: boolean;\n};\nexport type CustomMessage = {\n\tcode: string;\n\ttext: string;\n\tpersistent: boolean;\n\ttype: MessageType;\n};\nexport type ShowMessageDialogParameter = {\n\tcustomMessages?: CustomMessage[];\n\tisOperationDialogOpen?: boolean;\n\tcontext?: Context;\n\tconcurrentEditFlag?: boolean;\n\tcontrol?: Control;\n\tsActionName?: string;\n\taSelectedContexts?: Context | Context[] | null;\n\tonBeforeShowMessage?: (messages: Message[], showMessageParameters: ShowMessageParameters) => ShowMessageParameters;\n\tunHoldKey?: string;\n\toverrideUIDecision?: boolean;\n\tshowBoundStateMessages?: boolean;\n\tboundActionName?: string;\n\tentitySet?: string;\n};\n\nexport type ShowMessagesParameters = ShowMessageDialogParameter & {\n\tmessagePageNavigationCallback?: Function;\n\tshellBack?: Function | boolean;\n\tisDataReceivedError?: boolean;\n\tisInitialLoad503Error?: boolean;\n\ttitle?: string;\n\tdescription?: string;\n};\n/**\n *\n * Defines the message detail relevant for the MessageButton building block to display a popover.\n * @public\n */\nexport type MessageDetail = {\n\tmessage: Message;\n\tgroupName?: string;\n\tactiveTitleHandler?: Function;\n};\n\n/**\n * A controller extension offering message handling.\n * @hideconstructor\n * @public\n * @experimental As of version 1.90.0\n * @since 1.90.0\n */\n@defineUI5Class(\"sap.fe.core.controllerextensions.MessageHandler\")\nclass MessageHandler extends ControllerExtension {\n\tprivate strictWarningMessages: Message[] = [];\n\n\tprotected base!: PageController;\n\n\tprotected holdKeys: string[] = [];\n\n\tprotected uiDecisions: MessageUIDecisions | undefined;\n\n\tprivate holdMsgsToShow = false;\n\n\t// We await showMessageDialog until the UI element is available.\n\tprivate uiElementIsAvailable = Promise.resolve();\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t/**\n\t * Adds warning messages to the message handler.\n\t * @param aMessages The strict warning messages to be added\n\t */\n\taddWarningMessagesToMessageHandler(aMessages: Message[]): void {\n\t\tthis.strictWarningMessages = this.strictWarningMessages.concat(aMessages);\n\t}\n\n\t/**\n\t * Determines whether or not a message is a strict warning message that was received previously.\n\t * @param oMessage The message to be checked\n\t * @returns Whether or not the message is a strict warning message\n\t */\n\tisStrictWarningMessage(oMessage: Message): boolean {\n\t\treturn (\n\t\t\tthis.strictWarningMessages.find((message) => {\n\t\t\t\treturn (\n\t\t\t\t\tmessage.getCode() === oMessage.getCode() &&\n\t\t\t\t\tmessage.getMessage() === oMessage.getMessage() &&\n\t\t\t\t\tmessage.getType() === oMessage.getType() &&\n\t\t\t\t\tmessage.getDescriptionUrl() === oMessage.getDescriptionUrl() &&\n\t\t\t\t\tdeepEqual(message.getTargets(), oMessage.getTargets()) &&\n\t\t\t\t\tmessage.getPersistent() === oMessage.getPersistent()\n\t\t\t\t);\n\t\t\t}) !== undefined\n\t\t);\n\t}\n\n\t/**\n\t * Clears all strict warning messages from the message handler.\n\t */\n\tclearStrictWarningMessages(): void {\n\t\tthis.strictWarningMessages = [];\n\t}\n\n\tfilterErrorMessages(messages: Message[]): Message[] {\n\t\treturn messages.filter((message) => message.getType() === MessageType.Error);\n\t}\n\n\t/**\n\t * Determines whether or not bound messages are shown in the message dialog.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.Instead}.\n\t *\n\t * If the bound messages are shown to the user with a different control like the (TODO:Link) MessageButton\n\t * this method has to be overridden.\n\t * @returns Determines whether or not bound messages are shown in the message dialog.\n\t */\n\t@privateExtension()\n\t@extensible(OverrideExecution.Instead)\n\tgetShowBoundMessagesInMessageDialog(): boolean {\n\t\treturn true;\n\t}\n\n\t/**\n\t * Allows consumer of a message button BB to decide which bound messages should be shown and how.\n\t *\n\t * This hook is called when the message button BB detects a change in the message model.\n\t * The hooks allows to define behaviour for messages in the message button BB.\n\t *\n\t * Consumers will be able to do the following with this hook.\n\t *\n\t * 1. Filter out messages so that they are not shown on the message button.\n\t * 2. group the messages based on their UI.\n\t * 3. provide a presser handler incase the message should show as a link.\n\t * @param _messageDetails Object containing the details related to the message.\n\t * @param _messageDetails.message The message from the message model.Ideally, it must not be modified directly.\n\t * @param _messageDetails.groupName The group name associated with the current message.\n\t * @param _messageDetails.activeTitleHandler Function to handle the click event on a message in the MessageButton building block.\n\t * @returns A promise that must be returned by the overridden method.\n\t * @public\n\t * @experimental\n\t */\n\t@publicExtension()\n\t@extensible(\"AfterAsync\")\n\tasync beforeShowMessageButton(_messageDetails: MessageDetail[]): Promise<void> {\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * Register to hold messages unitl a process is complete.\n\t *\n\t * The caller can register to hold the message handler from showing messages until the caller's processes are completed.\n\t * On registering the caller is returned a unique key.\n\t * The messages will not be shown in the UI with subsequent 'showMessageDialog()' calls.\n\t * The caller needs to use 'showMessageDialog(<key>)' at the end of all his processes to show the messages in the UI.\n\t *\n\t * If multiple owners register simultaneously, then messages are shown in the UI only after 'showMessageDialog(<respective_key>)' is called by all the processes' owners.\n\t * @param key Unique identifier to use, If not provided, a UID would be created and used to register.\n\t * @returns Unique Key to be used by the caller to show messages at a later point of time.\n\t */\n\tregisterToHoldMessages(key?: string): string {\n\t\tconst uniqueKey = key ?? uid();\n\t\tif (!this.holdKeys.includes(uniqueKey)) {\n\t\t\tthis.holdKeys.push(uniqueKey);\n\t\t}\n\t\treturn uniqueKey;\n\t}\n\n\t/**\n\t * Clear all existing held keys.\n\t */\n\tresetHoldKeys(): void {\n\t\tthis.holdKeys = [];\n\t}\n\n\t/**\n\t * Shows a message dialog with transition messages if there are any.\n\t * The message dialog is shown as a modal dialog. Once the user confirms the dialog, all transition messages\n\t * are removed from the message model. If there is more than one message, a list of messages is shown. The user\n\t * can filter on message types and can display details as well as the long text. If there is one message,\n\t * the dialog immediately shows the details of the message. If there is just one success message, a message\n\t * toast is shown instead.\n\t * @param mParameters PRIVATE\n\t * @returns A promise that is resolved once the user closes the dialog. If there are no messages\n\t * to be shown, the promise is resolved immediately\n\t * @public\n\t * @experimental As of version 1.90.0\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync showMessageDialog(mParameters?: ShowMessageDialogParameter): Promise<void> {\n\t\t// remove strict warning messages from the message model before showing the message dialog\n\t\tawait this.uiElementIsAvailable;\n\n\t\tconst messagesInModel = Messaging.getMessageModel().getData();\n\t\tconst duplicateWarningMessage = messagesInModel.filter((message: Message) => {\n\t\t\treturn this.isStrictWarningMessage(message);\n\t\t});\n\t\tMessaging.removeMessages(duplicateWarningMessage);\n\n\t\tconst customMessages = mParameters && mParameters.customMessages ? mParameters.customMessages : undefined,\n\t\t\toOPInternalBindingContext = this.base.getView().getBindingContext(\"internal\") as InternalModelContext;\n\t\tconst viewType = (this.base.getView().getViewData() as ObjectWithConverterType).converterType;\n\t\t// set isActionParameterDialog open so that it can be used in the controller extension to decide whether message dialog should open or not\n\t\tif (mParameters && mParameters.isOperationDialogOpen && oOPInternalBindingContext) {\n\t\t\toOPInternalBindingContext.setProperty(\"isOperationDialogOpen\", true);\n\t\t}\n\t\tconst bShowBoundMessages = this.getShowBoundMessagesInMessageDialog();\n\t\tconst oBindingContext = (\n\t\t\tmParameters && mParameters.context ? mParameters.context : this.getView().getBindingContext()\n\t\t) as ODataV4Context;\n\t\t//const bEtagMessage = mParameters && mParameters.bHasEtagMessage;\n\t\t// reset  isOperationDialogOpen\n\t\t// cannot do this operations.js since it is not aware of the view\n\t\tif (oOPInternalBindingContext) {\n\t\t\toOPInternalBindingContext.setProperty(\"isOperationDialogOpen\", false);\n\t\t}\n\t\treturn new Promise<void>(\n\t\t\tfunction (this: MessageHandler, resolve: () => void, reject: () => void): void {\n\t\t\t\t// we have to set a timeout to be able to access the most recent messages\n\t\t\t\tsetTimeout(\n\t\t\t\t\tfunction (this: MessageHandler): void {\n\t\t\t\t\t\t// TODO: great API - will be changed later\n\t\t\t\t\t\tthis.processAndShowMessages(\n\t\t\t\t\t\t\tmParameters ?? {},\n\t\t\t\t\t\t\toBindingContext,\n\t\t\t\t\t\t\tbShowBoundMessages,\n\t\t\t\t\t\t\tcustomMessages ?? [],\n\t\t\t\t\t\t\tresolve,\n\t\t\t\t\t\t\treject,\n\t\t\t\t\t\t\tviewType\n\t\t\t\t\t\t);\n\t\t\t\t\t}.bind(this),\n\t\t\t\t\t0\n\t\t\t\t);\n\t\t\t}.bind(this)\n\t\t);\n\t}\n\n\t/**\n\t * Process the messages and show them when expected.\n\t *\n\t * We filter the messages to show and hold them until all registered processes call showMessageDialog with their respective held keys.\n\t * @param parameters Parameters to show message dialog.\n\t * @param bindingContext Bind context of the page.\n\t * @param showBoundTransitionMessages Should bound messages be shown.\n\t * @param customMessages Custom messages to add.\n\t * @param success Success callback.\n\t * @param failure Failure callback.\n\t * @param viewType View type, list report or object page.\n\t */\n\tprocessAndShowMessages(\n\t\tparameters: ShowMessageDialogParameter,\n\t\tbindingContext: ODataV4Context,\n\t\tshowBoundTransitionMessages: boolean,\n\t\tcustomMessages: CustomMessage[],\n\t\tsuccess: () => void,\n\t\tfailure: () => void,\n\t\tviewType?: string\n\t): void {\n\t\tconst {\n\t\t\tconcurrentEditFlag,\n\t\t\tcontrol,\n\t\t\tsActionName,\n\t\t\tonBeforeShowMessage,\n\t\t\tunHoldKey,\n\t\t\tisOperationDialogOpen: forceShowUIElement = false,\n\t\t\toverrideUIDecision,\n\t\t\tshowBoundStateMessages\n\t\t} = parameters;\n\t\tthis.holdMsgsToShow = true;\n\n\t\t// Create a UI decision.\n\t\tconst newUIDecisions = messageHandling.getUIDecisions(\n\t\t\tcustomMessages,\n\t\t\tbindingContext,\n\t\t\tshowBoundTransitionMessages,\n\t\t\tconcurrentEditFlag,\n\t\t\tcontrol,\n\t\t\tsActionName,\n\t\t\tonBeforeShowMessage,\n\t\t\tviewType,\n\t\t\tshowBoundStateMessages,\n\t\t\tparameters\n\t\t);\n\t\tthis.updateUIDecisions(newUIDecisions, overrideUIDecision);\n\t\tthis.removeHoldKey(unHoldKey ?? control?.getId());\n\t\tthis.showMessagesWithCondtions(forceShowUIElement, success, failure);\n\t}\n\n\t/**\n\t * Show Messages in the UI based on conditions.\n\t * @param forceShowUIElement\n\t * @param success\n\t * @param failure\n\t */\n\tasync showMessagesWithCondtions(\n\t\tforceShowUIElement = false,\n\t\tsuccess?: (ret?: unknown) => void,\n\t\tfailure?: (err?: unknown) => void\n\t): Promise<void> {\n\t\tconst showUIElement = forceShowUIElement || this.checkToShowUIElement();\n\t\tif (showUIElement && this.uiDecisions) {\n\t\t\t// Show UI element for the present decision and clear the decision.\n\t\t\ttry {\n\t\t\t\tthis.uiElementIsAvailable = messageHandling.showMessagesInUI(this.uiDecisions);\n\t\t\t\tconst ret = await this.uiElementIsAvailable;\n\t\t\t\tsuccess?.(ret);\n\t\t\t} catch (err: unknown) {\n\t\t\t\tLog.error(`FE : V4 : MessageHandler : Error on trying to show UI element: ${err}`);\n\t\t\t\tthis.uiElementIsAvailable = Promise.resolve();\n\t\t\t\tfailure?.(err);\n\t\t\t}\n\t\t\tthis.uiDecisions = undefined;\n\t\t\tthis.clearStrictWarningMessages();\n\t\t\tthis.holdMsgsToShow = false;\n\t\t} else {\n\t\t\tLog.info(\"FE : V4 : MessageHandler : Holding messages until a registered process \");\n\t\t\tsuccess?.();\n\t\t}\n\t}\n\n\t/**\n\t * You can remove the existing transition message from the message model with this method.\n\t * With every user interaction that causes server communication (like clicking on an action, changing data),\n\t * this method removes the existing transition messages from the message model.\n\t * @param [keepBoundMessage] Checks if the bound transition messages are not to be removed\n\t * @param keepUnboundMessage\n\t * @param sPathToBeRemoved\n\t */\n\t@publicExtension()\n\tremoveTransitionMessages(keepBoundMessage?: boolean, keepUnboundMessage?: boolean, sPathToBeRemoved?: string): void {\n\t\tif (!keepBoundMessage) {\n\t\t\tmessageHandling.removeBoundTransitionMessages(sPathToBeRemoved);\n\t\t}\n\t\tif (!keepUnboundMessage) {\n\t\t\tmessageHandling.removeUnboundTransitionMessages();\n\t\t}\n\t}\n\n\t/**\n\t * Method that returns all the parameters needed to handle the navigation to the error page.\n\t * @param mParameters\n\t * @returns The parameters necessary for the navigation to the error page\n\t */\n\t_checkNavigationToErrorPage(mParameters?: NavigationToErrorPageParameter): NavigationToErrorPageResult | undefined {\n\t\tconst aUnboundMessages = messageHandling.getMessages();\n\t\tconst bShowBoundTransitionMessages = this.getShowBoundMessagesInMessageDialog();\n\t\tconst aBoundTransitionMessages = bShowBoundTransitionMessages ? messageHandling.getMessages(true, true) : [];\n\t\tconst aCustomMessages = mParameters && mParameters.customMessages ? mParameters.customMessages : [];\n\t\tconst bIsStickyEditMode = CommonUtils.isStickyEditMode(this.base.getView());\n\t\tlet mMessagePageParameters: NavigationToErrorPageResult | undefined;\n\n\t\t// TODO: Stick mode check is okay as long as the controller extension is used with sap.fe.core and sap.fe.core.AppComponent.\n\t\t// It might be better to provide an extension to the consumer of the controller extension to provide this value.\n\n\t\t// The message page can only show 1 message today, so we navigate to it when :\n\t\t// 1. There are no bound transition messages to show,\n\t\t// 2. There are no custom messages to show, &\n\t\t// 3. There is exactly 1 unbound message in the message model with statusCode=503 and retry-After available\n\t\t// 4. retryAfter is greater than 120 seconds\n\t\t//\n\t\t// In Addition, navigating away from a sticky session will destroy the session so we do not navigate to message page for now.\n\t\t// TODO: check if navigation should be done in sticky edit mode.\n\t\tif (mParameters?.isDataReceivedError === true) {\n\t\t\tmMessagePageParameters = {\n\t\t\t\ttitle: mParameters.title,\n\t\t\t\tdescription: mParameters.description,\n\t\t\t\tnavigateBackToOrigin: true,\n\t\t\t\terrorType: \"PageNotFound\"\n\t\t\t};\n\t\t} else if (\n\t\t\t!bIsStickyEditMode &&\n\t\t\t!aBoundTransitionMessages.length &&\n\t\t\t!aCustomMessages.length &&\n\t\t\t(aUnboundMessages.length === 1 || mParameters?.isInitialLoad503Error === true)\n\t\t) {\n\t\t\tconst oMessage = aUnboundMessages[0];\n\t\t\tconst oTechnicalDetails = oMessage.getTechnicalDetails() as MessageTechnicalDetails | undefined;\n\t\t\tif (oTechnicalDetails?.httpStatus === 503) {\n\t\t\t\tmMessagePageParameters = this._getHTTP503MessageParameters(oMessage, oTechnicalDetails);\n\t\t\t}\n\t\t}\n\t\treturn mMessagePageParameters;\n\t}\n\n\t_getHTTP503MessageParameters(message: Message, technicalDetails: MessageTechnicalDetails): NavigationToErrorPageResult | undefined {\n\t\tlet messagePageParameters: NavigationToErrorPageResult | undefined;\n\n\t\tconst secondsBeforeRetry =\n\t\t\ttechnicalDetails.retryAfter !== undefined ? this._getSecondsBeforeRetryAfter(technicalDetails.retryAfter) : undefined;\n\n\t\tif (secondsBeforeRetry === undefined || secondsBeforeRetry > 120) {\n\t\t\tconst retryAfterMessage = messageHandling.getRetryAfterMessage(message);\n\t\t\tmessagePageParameters = {\n\t\t\t\tdescription: retryAfterMessage ? `${retryAfterMessage} ${message.getMessage()}` : message.getMessage(),\n\t\t\t\tnavigateBackToOrigin: true,\n\t\t\t\terrorType: \"UnableToLoad\"\n\t\t\t};\n\t\t}\n\n\t\treturn messagePageParameters;\n\t}\n\n\t_getSecondsBeforeRetryAfter(dRetryAfter: Date): number {\n\t\tconst dCurrentDateTime = new Date(),\n\t\t\tiCurrentDateTimeInMilliSeconds = dCurrentDateTime.getTime(),\n\t\t\tiRetryAfterDateTimeInMilliSeconds = dRetryAfter.getTime(),\n\t\t\tiSecondsBeforeRetry = (iRetryAfterDateTimeInMilliSeconds - iCurrentDateTimeInMilliSeconds) / 1000;\n\t\treturn iSecondsBeforeRetry;\n\t}\n\n\t/**\n\t * Update the existing UI decisions with the new ones.\n\t * @param newUIDecisions In comming UI decisions.\n\t * @param overrideUIDecision Override the existing UI decision to show messages with the new one.\n\t *\n\t * 'overrideUIDecision', This would be needed when there is a change in page context and the paramters to create the new UI decision are different.\n\t */\n\tupdateUIDecisions(newUIDecisions: MessageUIDecisions, overrideUIDecision = false): void {\n\t\tconst oldUIDecisions = this.uiDecisions;\n\t\tlet allMessagesToShow: Message[] = [];\n\t\tlet mergedUIDecision;\n\t\tif (oldUIDecisions && overrideUIDecision === false) {\n\t\t\tif (\n\t\t\t\toldUIDecisions.messagesToShow.length === 1 &&\n\t\t\t\tnewUIDecisions.messagesToShow.length === 1 &&\n\t\t\t\toldUIDecisions.messagesToShow[0].getCode() === \"C_COMMON_SUCCESS_MESSAGE\" &&\n\t\t\t\tnewUIDecisions.messagesToShow[0].getCode() === \"C_COMMON_SUCCESS_MESSAGE\"\n\t\t\t) {\n\t\t\t\t// Check if both are generic success messages, then we show only one message.\n\t\t\t\tallMessagesToShow = oldUIDecisions.messagesToShow;\n\t\t\t} else {\n\t\t\t\tallMessagesToShow = Array.from(new Set([...oldUIDecisions.messagesToShow, ...newUIDecisions.messagesToShow]));\n\t\t\t}\n\t\t\tconst elements = [oldUIDecisions.uiElementToUse, newUIDecisions.uiElementToUse];\n\t\t\t// Default we show dialog\n\t\t\tlet uiElementToUse: SupportedUIElement = allMessagesToShow.length > 0 ? \"Dialog\" : \"None\";\n\n\t\t\tif (allMessagesToShow.length === 1) {\n\t\t\t\t// Single message, we check for specific UI Element to use.\n\t\t\t\tif (elements.includes(\"Toast\")) {\n\t\t\t\t\tuiElementToUse = \"Toast\";\n\t\t\t\t} else if (elements.includes(\"Box\")) {\n\t\t\t\t\tuiElementToUse = \"Box\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmergedUIDecision = {\n\t\t\t\tmessagesToShow: allMessagesToShow,\n\t\t\t\tuiElementToUse,\n\t\t\t\tcontextNeedsEtagRefresh: oldUIDecisions.contextNeedsEtagRefresh || newUIDecisions.contextNeedsEtagRefresh,\n\t\t\t\tcontainsBoundTransition: oldUIDecisions.containsBoundTransition || newUIDecisions.containsBoundTransition\n\t\t\t};\n\t\t} else {\n\t\t\tmergedUIDecision = newUIDecisions;\n\t\t}\n\n\t\tthis.uiDecisions = mergedUIDecision;\n\t}\n\n\t/**\n\t * Remove held key.\n\t * @param inKey Key to remove.\n\t */\n\tremoveHoldKey(inKey?: string): void {\n\t\tif (inKey && this.holdKeys.includes(inKey)) {\n\t\t\tthis.holdKeys.splice(this.holdKeys.indexOf(inKey), 1);\n\t\t}\n\t}\n\n\t/**\n\t * Check if UI Element with messages should be shown.\n\t * @returns Boolean\n\t */\n\tcheckToShowUIElement(): boolean {\n\t\treturn this.holdMsgsToShow && (this.holdKeys.length > 0 ? false : true);\n\t}\n\n\t/**\n\t * Hold messages for the control.\n\t * @param control\n\t */\n\tholdMessagesForControl(control: Control): void {\n\t\tconst identifier = control.getId();\n\t\tthis.registerToHoldMessages(identifier);\n\t}\n\n\t/**\n\t * Release message hold by a control.\n\t * @param control\n\t */\n\tasync releaseHoldByControl(control?: Control): Promise<void> {\n\t\tconst identifier = control?.getId();\n\t\tthis.removeHoldKey(identifier);\n\t\tthis.uiElementIsAvailable = this.uiElementIsAvailable.then(\n\t\t\tasync function (this: MessageHandler): Promise<void> {\n\t\t\t\treturn this.showMessagesWithCondtions();\n\t\t\t}.bind(this)\n\t\t);\n\t\tawait this.uiElementIsAvailable;\n\t}\n\n\t/**\n\t * Shows a message page or a message dialog based on the messages in the message dialog.\n\t * @param [parameters]\n\t * @returns A promise that is resolved once the user closes the message dialog or when navigation to the message page is complete. If there are no messages\n\t * to be shown, the promise is resolved immediately\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync showMessages(parameters?: ShowMessagesParameters): Promise<void | boolean | Dialog> {\n\t\tconst messagePageParameters = this._checkNavigationToErrorPage(parameters);\n\n\t\tif (messagePageParameters) {\n\t\t\t// navigate to message page.\n\t\t\t// handler before page navigation is triggered, for example to close the action parameter dialog\n\t\t\tif (parameters?.messagePageNavigationCallback) {\n\t\t\t\tparameters.messagePageNavigationCallback();\n\t\t\t}\n\n\t\t\tmessagePageParameters.handleShellBack = !parameters?.shellBack;\n\t\t\tthis.removeTransitionMessages();\n\t\t\tconst oResourceBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n\n\t\t\treturn new Promise<boolean>((resolve, reject) => {\n\t\t\t\t// we have to set a timeout to be able to access the most recent messages\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t// clear all hold keys as we navigate to message page.\n\t\t\t\t\tthis.resetHoldKeys();\n\n\t\t\t\t\t// TODO: great API - will be changed later\n\t\t\t\t\tthis.base._routing\n\t\t\t\t\t\t.navigateToMessagePage(\n\t\t\t\t\t\t\tparameters?.isDataReceivedError === true\n\t\t\t\t\t\t\t\t? oResourceBundle.getText(\"C_COMMON_SAPFE_DATA_RECEIVED_ERROR\")\n\t\t\t\t\t\t\t\t: oResourceBundle.getText(\"C_MESSAGE_HANDLING_SAPFE_503_TITLE\"),\n\t\t\t\t\t\t\tmessagePageParameters\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.then(resolve)\n\t\t\t\t\t\t.catch(reject);\n\t\t\t\t}, 0);\n\t\t\t});\n\t\t} else {\n\t\t\t// navigate to message dialog\n\t\t\treturn this.showMessageDialog(parameters);\n\t\t}\n\t}\n}\nexport default MessageHandler;\n"],"mappings":"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","ignoreList":[]}