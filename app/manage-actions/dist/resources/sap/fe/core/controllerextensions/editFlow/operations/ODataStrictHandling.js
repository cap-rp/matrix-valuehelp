/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/library","sap/m/MessageBox","sap/ui/core/ElementRegistry","sap/ui/core/Messaging","sap/ui/core/message/Message","sap/ui/core/message/MessageType","sap/ui/model/json/JSONModel","../../dialog/ODataStrictDialog","../../messageHandler/messageHandling"],function(e,t,n,s,i,a,o,r,g,l,c){"use strict";var h={};const p=n.InvocationGrouping;let d=function(){function n(e){this.strictHandlingResolves=[];this.strictHandlingWarningMessages=[];this.canceled=false;this.isCanceled=()=>this.canceled;this.parameters=e;if(this.parameters.contexts.length){const e=this.parameters.contexts[0].getBinding();if(e?.isA("sap.ui.model.odata.v4.ODataListBinding")){this.tableAPI=i.filter(t=>t.isA("sap.fe.macros.table.TableAPI")&&t.getContent()?.getRowBinding()===e)[0]}}}h=n;var d=n.prototype;d.handleOdataStrictHandling=async function t(n,s,i){let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];let o;const g=new Promise(function(e){o=e});this.strictHandlingResolves.push(o);if(a.filter(e=>e.getType()===r.Error).length){e.warning("Warning: 412 ('Pre-condition Check Failed due to strict-handling') returns messages of type error but only warning messages are appropriate!")}let l="";if(this.parameters.contexts.length>1){const e=this.tableAPI?.getIdentifierColumn();if(typeof e==="string"){l=n.getContext()?.getObject(e)}}for(const e of a){e.setAdditionalText(l);this.strictHandlingWarningMessages.push(e)}this.parameters.events?.onResponse?.(a);s?.();this.onContextValidation(g,i);return g};d.onContextValidation=async function e(t,n){const s=await t;if(s){n()}};d.manageStrictHandlingFails=async function t(){if(this.strictHandlingResolves.length){try{if((!c.hasTransitionErrorsOrWarnings()||this.parameters.invocationGrouping!==p.ChangeSet)&&this.strictHandlingWarningMessages.length){await this.displayMessages()}else{for(const e of this.strictHandlingResolves){e(false)}const e=a.getMessageModel();const t=e.getData();e.setData(t.concat(this.strictHandlingWarningMessages))}}catch{e.error("Re-triggering of strict handling operations failed")}}};d.displayMessages=async function e(){const n=this.strictHandlingWarningMessages;if(!n.length){return}const s=t.getLocalizedText(this.parameters.label,this.parameters.appComponent);return n.length===1&&!(n[0].getDescription()?.length||n[0].getDescriptionUrl()?.length)?this.displayMessageOnMessageBox(n[0],s):this.displayMessagesOnDialog(n,s)};d.displayMessageOnMessageBox=async function e(n,i){let a;const o=new Promise(e=>{a=e});const r=t.getResourceModel(this.parameters.appComponent);const g=n.getMessage();const l=n.getAdditionalText();const c=this.parameters.contexts.length>1;const h=r.getText("C_COMMON_DIALOG_CANCEL_SINGLE_MESSAGE_TEXT");const d=this.parameters.invocationGrouping===p.ChangeSet?r.getText("C_COMMON_DIALOG_CANCEL_MESSAGE_TEXT",[i]):r.getText("C_COMMON_DIALOG_SKIP_SINGLE_MESSAGE_TEXT");let M=r.getText("C_COMMON_DIALOG_CANCEL");let C="";if(!c){C=`${g}\n${r.getText("PROCEED")}`}else if(l!==undefined&&l!==""){M=this.parameters.invocationGrouping===p.ChangeSet?M:r.getText("C_COMMON_DIALOG_SKIP");const e=this.tableAPI?.getTableDefinition().headerInfoTypeName;if(e){C=`${e.toString()} ${l}: ${g}\n\n${d}`}else{C=`${l}: ${g}\n\n${d}`}}else{M=this.parameters.invocationGrouping===p.ChangeSet?M:r.getText("C_COMMON_DIALOG_SKIP");C=`${g}\n\n${d}`}if(c&&this.parameters.invocationGrouping===p.ChangeSet){C=`${h}\n\n${C}`}s.warning(C,{title:r.getText("WARNING"),actions:[i,M],emphasizedAction:i,onClose:e=>{this[e===i?"handleMessageOnValidation":"handleMessageOnCancel"]();a()}});return o};d.displayMessagesOnDialog=async function e(n,s){let i;const a=new Promise(e=>{i=e});const h=new g;const d=t.getResourceModel(this.parameters.appComponent);const M=this.parameters.contexts.length>1;let C="";let _="";let u=d.getText("C_COMMON_DIALOG_CANCEL");if(M){u=this.parameters.invocationGrouping===p.ChangeSet?u:d.getText("C_COMMON_DIALOG_SKIP");C=d.getText(this.parameters.invocationGrouping===p.ChangeSet?"C_COMMON_DIALOG_CANCEL_MESSAGES_WARNING":"C_COMMON_DIALOG_SKIP_MESSAGES_WARNING");_=d.getText(this.parameters.invocationGrouping===p.ChangeSet?"C_COMMON_DIALOG_CANCEL_MESSAGES_TEXT":"C_COMMON_DIALOG_SKIP_MESSAGES_TEXT",[s])}else{C=d.getText("C_COMMON_DIALOG_CANCEL_MESSAGES_GENERIC_ACTION_WARNING",[s])}const f=new o({message:C,type:r.Information,target:undefined,persistent:true,description:_.length?_:undefined});n=[f].concat(n);h.setData(n);new l({messageObject:c.prepareMessageViewForDialog(h,true,M),actionName:s,messageDialogModel:h,cancelButtonTxt:u,onBeginButtonPress:this.handleMessageOnValidation.bind(this),onEndButtonPress:this.handleMessageOnCancel.bind(this),onClose:i}).open();return a};d.handleMessageOnValidation=function e(){for(const e of this.strictHandlingResolves){e(true)}c.removeBoundTransitionMessages();c.removeUnboundTransitionMessages();this.strictHandlingWarningMessages=[];this.parameters.events?.onValidation?.()};d.handleMessageOnCancel=function e(){const n=t.getResourceModel(this.parameters.appComponent);this.strictHandlingWarningMessages=[];this.canceled=true;for(const e of this.strictHandlingResolves){e(false)}this.strictHandlingResolves=[];if(this.parameters.invocationGrouping===p.ChangeSet){s.information(n.getText("M_CHANGESET_CANCEL_MESSAGES"),{contentWidth:"150px"})}this.parameters.events?.onCancel?.()};return n}();h=d;return h},false);
//# sourceMappingURL=ODataStrictHandling.js.map