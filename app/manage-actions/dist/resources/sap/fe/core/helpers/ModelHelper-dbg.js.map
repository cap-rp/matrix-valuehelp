{"version":3,"names":["ModelHelper","disableCollaborationDraft","isStickySessionSupported","metaModel","entityContainer","getObject","entitySetName","$kind","isDraftSupported","path","metaContext","getMetaContext","objectPath","getInvolvedDataModelObjects","isObjectPathDraftSupported","dataModelObjectPath","currentEntitySet","targetEntitySet","bIsDraftRoot","isDraftRoot","bIsDraftNode","isDraftNode","bIsDraftParentEntityForContainment","isNavigationProperty","targetObject","containsTarget","startingEntitySet","annotations","Common","DraftRoot","DraftNode","isMetaPathDraftSupported","getClosestEntitySet","isCollaborationDraftSupportedFromConverterContext","converterContext","getConvertedTypes","entitySets","some","entitySet","ShareAction","undefined","isCollaborationDraftSupported","metaObject","templateInterface","oMetaModel","context","getModel","__$feIsCollaborationDraftEnabled","oEntityContainer","sEntitySet","getDraftRootPath","oContext","getMetaModel","getRootPath","sPath","model","firstIteration","arguments","length","sIterationPath","RegExp","exec","sEntityPath","getMetaPath","mDataModel","MetaModelConverter","getContext","getPath","getStickyRootPath","Session","StickySessionSupported","getTargetEntitySet","sEntitySetPath","getEntitySetPath","odataMetaModel","entitySetPath","split","filter","filterOutNavPropBinding","join","pathParts","initialPathObject","growingPath","pendingNavPropBinding","pathObject","reduce","pathUnderConstruction","pathPart","idx","delimiter","tempPath","navPropBindings","navPropBindingToCheck","Object","keys","hasOwnProperty","replace","getActionParameterItemsModelPath","oParameter","$Name","sPathPart","enhanceInternalJSONModel","oInternalModel","fnBindContext","bindContext","mParameters","oEvents","contextBinding","apply","fnGetBoundContext","getBoundContext","oBoundContext","setProperty","propertyPath","value","propertyPathSplit","i","getProperty","enhanceUiJSONModel","uiModel","library","fnSetProperty","asyncUpdate","EditMode","Editable","Display","enhanceViewJSONModel","viewModel","fnGetObject","_getObject","isFilteringCaseSensitive","filterFunctions","_filterFunctions","indexOf","getMetaPathForContext","oModel","getRootEntitySetPath","contextPath","rootEntitySetPath","aPaths","getAbsoluteMetaPathForListBinding","oView","vListBinding","sMetaPath","startsWith","oBindingContext","getBindingContext","sRootContextPath","oBinding","oRootBinding","getRootBinding","sRootBindingPath","sRelativePath","getDraftRoot","getDraftNode","isSticky","getStickySession","isUpdateHidden","entityType","isEntitySet","UI","UpdateHidden","getDeleteHidden","DeleteHidden","getAbsolutePathFromListBinding","listBinding","metamodel","metaPath","rootBinding","rootBindingPath","relativePath","enhanceODataModel","odataModel","appComponent","virtualPropertyBindingRegistry","Array","fnMessage","setMessages","localAnnotationModel","JSONModel","setDefaultBindingMode","BindingMode","OneWay","baseSetProperty","baseGetProperty","propertyName","annotationType","isTransient","contextObject","MetaPath","convertTypes","externalIdProperty","getMetaPathForPath","getTarget","ExternalID","isPathAnnotationExpression","fullPath","_refreshLocalModel","refresh","externalIdPropPath","propertiesToRequest","substring","lastIndexOf","textProperty","Text","textPropPath","includes","push","requestSideEffects","then","catch","err","Log","error","pathFromRoot","clearAnnotationType","annotationTypes","dataSet","isContext","isA","endsWith","_localAnnotationModel","getLocalAnnotationModel","messages","cleanedData","getData","setData","messageTarget","getType","getMessage","fnBindProperty","bindProperty","bind","parameters","recommendationFeatureDisabled","getEnvironmentCapabilities","getCapabilities","DisableInputAssistance","recommendationPropertyBinding","setUpRecommendationLocalModelBinding","internalIdBinding","externalIdBinding","attachChange","requestValue","propBinding","updateRequired","expression","getVirtualBindingExpression","ghostControl","Any","any","compileExpression","bindBackProperty","fnDestroyPropertyBinding","destroy","fnSetContext","setContext","newContext","setBindingContext","setModel","ghostBinding","getBindingInfo","binding","fnCheckUpdate","checkUpdate","fnDestroy","vpBinding","fetchTextFromMetaModel","text","metaModelPath","getEntityTypeAnnotation","annotation","toString","e","info","getMessagesPath","targetEntityType","Messages","recommendationbinding","setContextOnRecommendationBinding","odataPropertyBinding","recommendationComplexProperty","isRecommendedProperty","validateRecommendationBindingPath","alreadyBound","existingBinding","setType","Raw","setBindingMode","event","propertyBinding","getSource","currentContext","contextRecommendations","getValue","setRecommendationsOnLocalAnnotationModel","bindingPath","contextMetaPath","Recommendations","entityProperties","entityProperty","name","targetType","properties","property","recommendedProperty","propertyRecommendations","localModelPath","typeAheadValues","propertyRecommendation","RecommendedFieldIsSuggestion","placeholderValueAnnotationPath","placeholderDescriptionAnnotationPath","RecommendedFieldValue","RecommendedFieldDescription","getAlternateAndSecondaryKeys","alternateKeys","_fetchAlternateKeys","entityTypeOrSet","Core","AlternateKeys","forEach","alternateKey","Key","key","Name","_fetchSecondaryKeys","eT","SecondaryKey","secondaryKey"],"sourceRoot":".","sources":["ModelHelper.ts"],"sourcesContent":["/* This class contains helpers to be used at runtime to retrieve further information on the model */\nimport type { ComplexType, EntitySet, EntityType, Property, PropertyPath, Singleton } from \"@sap-ux/vocabularies-types\";\nimport type { FilterFunctions } from \"@sap-ux/vocabularies-types/vocabularies/Capabilities\";\nimport type { DraftNode, DraftRoot } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport type { AlternateKey, PropertyRef } from \"@sap-ux/vocabularies-types/vocabularies/Core\";\nimport type { StickySessionSupported } from \"@sap-ux/vocabularies-types/vocabularies/Session\";\nimport type { DeleteHidden, UpdateHidden } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport type { EntityTypeAnnotations_UI } from \"@sap-ux/vocabularies-types/vocabularies/UI_Edm\";\nimport Log from \"sap/base/Log\";\nimport { compileExpression } from \"sap/fe/base/BindingToolkit\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport Any from \"sap/fe/core/controls/Any\";\nimport type ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport type { MetaModelActionParameter } from \"sap/fe/core/converters/MetaModelConverter\";\nimport * as MetaModelConverter from \"sap/fe/core/converters/MetaModelConverter\";\nimport { convertTypes, getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport MetaPath from \"sap/fe/core/helpers/MetaPath\";\nimport { isEntitySet, isNavigationProperty, isPathAnnotationExpression } from \"sap/fe/core/helpers/TypeGuards\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport type Message from \"sap/ui/core/message/Message\";\nimport BindingMode from \"sap/ui/model/BindingMode\";\nimport type BaseContext from \"sap/ui/model/Context\";\nimport type ContextBinding from \"sap/ui/model/ContextBinding\";\nimport type MetaModel from \"sap/ui/model/MetaModel\";\nimport type PropertyBinding from \"sap/ui/model/PropertyBinding\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport Raw from \"sap/ui/model/odata/type/Raw\";\nimport type { default as Context, default as ODataV4Context } from \"sap/ui/model/odata/v4/Context\";\nimport type { default as ODataListBinding } from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type ODataPropertyBinding from \"sap/ui/model/odata/v4/ODataPropertyBinding\";\nimport type { ODataPropertyBinding$ChangeEvent } from \"sap/ui/model/odata/v4/ODataPropertyBinding\";\nimport type AppComponent from \"../AppComponent\";\n\n// TODO: Right now recommendations is not part of the UI vocabulary.\n// hence we are adding it to the type.\n// once this becomes part of the UI vocabulary then we can remove this.\nexport type EntityTypeAnnotations_UI_With_Recommendations = EntityTypeAnnotations_UI & {\n\tRecommendations?: {\n\t\tpath: string;\n\t};\n};\n\nconst ModelHelper = {\n\t// global switch to disable the collaboration draft by a private manifest flag\n\t// this allows customers to disable the collaboration draft in case we run into issues with the first delivery\n\t// this will be removed with the next S/4 release\n\tdisableCollaborationDraft: false,\n\t/**\n\t * Method to determine if the programming model is sticky.\n\t * @param metaModel ODataModelMetaModel to check for sticky enabled entity\n\t * @returns Returns true if sticky, else false\n\t */\n\tisStickySessionSupported: function (metaModel: ODataMetaModel): boolean {\n\t\tconst entityContainer = metaModel.getObject(\"/\");\n\t\tfor (const entitySetName in entityContainer) {\n\t\t\tif (\n\t\t\t\tentityContainer[entitySetName].$kind === \"EntitySet\" &&\n\t\t\t\tmetaModel.getObject(`/${entitySetName}@com.sap.vocabularies.Session.v1.StickySessionSupported`)\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Method to determine if the programming model is draft.\n\t * @param metaModel ODataModelMetaModel of the context for which draft support shall be checked\n\t * @param path Path for which draft support shall be checked\n\t * @returns Returns true if draft, else false\n\t */\n\tisDraftSupported: function (metaModel: ODataMetaModel, path: string): boolean {\n\t\tconst metaContext = metaModel.getMetaContext(path);\n\t\tconst objectPath = getInvolvedDataModelObjects<PageContextPathTarget>(metaContext);\n\t\treturn this.isObjectPathDraftSupported(objectPath);\n\t},\n\n\t/**\n\t * Checks if draft is supported for the data model object path.\n\t * @param dataModelObjectPath\n\t * @returns `true` if it is supported\n\t */\n\tisObjectPathDraftSupported: function (dataModelObjectPath: DataModelObjectPath<unknown>): boolean {\n\t\tconst currentEntitySet = dataModelObjectPath.targetEntitySet as EntitySet;\n\t\tconst bIsDraftRoot = ModelHelper.isDraftRoot(currentEntitySet);\n\t\tconst bIsDraftNode = ModelHelper.isDraftNode(currentEntitySet);\n\t\tconst bIsDraftParentEntityForContainment =\n\t\t\tisNavigationProperty(dataModelObjectPath.targetObject) &&\n\t\t\tdataModelObjectPath.targetObject?.containsTarget &&\n\t\t\t((dataModelObjectPath.startingEntitySet as EntitySet)?.annotations?.Common?.DraftRoot ||\n\t\t\t\t(dataModelObjectPath.startingEntitySet as EntitySet)?.annotations?.Common?.DraftNode)\n\t\t\t\t? true\n\t\t\t\t: false;\n\n\t\treturn bIsDraftRoot || bIsDraftNode || (!currentEntitySet && bIsDraftParentEntityForContainment);\n\t},\n\n\tisMetaPathDraftSupported: function (dataModelObjectPath: MetaPath<unknown>): boolean {\n\t\tconst currentEntitySet = dataModelObjectPath.getClosestEntitySet() as EntitySet;\n\t\tconst bIsDraftRoot = ModelHelper.isDraftRoot(currentEntitySet);\n\t\tconst bIsDraftNode = ModelHelper.isDraftNode(currentEntitySet);\n\t\treturn bIsDraftRoot || bIsDraftNode;\n\t},\n\n\t/**\n\t * Returns whether or not we have a ShareAction in any EntitySet of the application.\n\t * @param converterContext The instance of the converter context\n\t * @returns True if the annotation exists. False otherwise.\n\t */\n\tisCollaborationDraftSupportedFromConverterContext(converterContext: ConverterContext): boolean {\n\t\treturn converterContext.getConvertedTypes().entitySets.some((entitySet) => {\n\t\t\treturn entitySet.annotations?.Common?.DraftRoot?.ShareAction !== undefined;\n\t\t});\n\t},\n\n\t/**\n\t * Method to determine if the service, supports collaboration draft.\n\t * @param metaObject MetaObject to be used for determination\n\t * @param templateInterface API provided by UI5 templating if used\n\t * @param templateInterface.context Context of the template\n\t * @returns Returns true if the service supports collaboration draft, else false\n\t */\n\tisCollaborationDraftSupported: function (metaObject: unknown, templateInterface?: { context: Context }): boolean {\n\t\tif (!ModelHelper.disableCollaborationDraft) {\n\t\t\tconst oMetaModel = (templateInterface?.context?.getModel() || metaObject) as ODataMetaModel & {\n\t\t\t\t__$feIsCollaborationDraftEnabled?: boolean;\n\t\t\t};\n\t\t\tif (oMetaModel.__$feIsCollaborationDraftEnabled !== undefined) {\n\t\t\t\treturn oMetaModel.__$feIsCollaborationDraftEnabled;\n\t\t\t}\n\t\t\tconst oEntityContainer = oMetaModel.getObject(\"/\");\n\t\t\tfor (const sEntitySet in oEntityContainer) {\n\t\t\t\tif (\n\t\t\t\t\toEntityContainer[sEntitySet].$kind === \"EntitySet\" &&\n\t\t\t\t\toMetaModel.getObject(`/${sEntitySet}@com.sap.vocabularies.Common.v1.DraftRoot/ShareAction`)\n\t\t\t\t) {\n\t\t\t\t\toMetaModel.__$feIsCollaborationDraftEnabled = true;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\toMetaModel.__$feIsCollaborationDraftEnabled = false;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t * Method to get the path of the DraftRoot path according to the provided context.\n\t * @param oContext OdataModel context\n\t * @returns Returns the path of the draftRoot entity, or undefined if no draftRoot is found\n\t */\n\tgetDraftRootPath: function (oContext: Context): string | undefined {\n\t\tconst oMetaModel = oContext.getModel().getMetaModel();\n\t\tconst getRootPath = function (sPath: string, model: ODataModel, firstIteration = true): string | undefined {\n\t\t\tconst sIterationPath = firstIteration ? sPath : new RegExp(/.*(?=\\/)/).exec(sPath)?.[0]; // *Regex to get the ancestor\n\t\t\tif (sIterationPath && sIterationPath !== \"/\") {\n\t\t\t\tconst sEntityPath = oMetaModel.getMetaPath(sIterationPath);\n\t\t\t\tconst mDataModel = MetaModelConverter.getInvolvedDataModelObjects(oMetaModel.getContext(sEntityPath));\n\t\t\t\tif ((mDataModel.targetEntitySet as EntitySet)?.annotations.Common?.DraftRoot) {\n\t\t\t\t\treturn sIterationPath;\n\t\t\t\t}\n\t\t\t\treturn getRootPath(sIterationPath, model, false);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\t\treturn getRootPath(oContext.getPath(), oContext.getModel());\n\t},\n\n\t/**\n\t * Method to get the path of the StickyRoot path according to the provided context.\n\t * @param oContext OdataModel context\n\t * @returns Returns the path of the StickyRoot entity, or undefined if no StickyRoot is found\n\t */\n\tgetStickyRootPath: function (oContext: Context): string | undefined {\n\t\tconst oMetaModel = oContext.getModel().getMetaModel();\n\t\tconst getRootPath = function (sPath: string, model: ODataModel, firstIteration = true): string | undefined {\n\t\t\tconst sIterationPath = firstIteration ? sPath : new RegExp(/.*(?=\\/)/).exec(sPath)?.[0]; // *Regex to get the ancestor\n\t\t\tif (sIterationPath && sIterationPath !== \"/\") {\n\t\t\t\tconst sEntityPath = oMetaModel.getMetaPath(sIterationPath);\n\t\t\t\tconst mDataModel = MetaModelConverter.getInvolvedDataModelObjects(oMetaModel.getContext(sEntityPath));\n\t\t\t\tif (\n\t\t\t\t\tmDataModel.startingEntitySet === mDataModel.targetEntitySet &&\n\t\t\t\t\t(mDataModel.targetEntitySet as EntitySet)?.annotations?.Session?.StickySessionSupported\n\t\t\t\t) {\n\t\t\t\t\treturn sIterationPath;\n\t\t\t\t}\n\t\t\t\treturn getRootPath(sIterationPath, model, false);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t};\n\t\treturn getRootPath(oContext.getPath(), oContext.getModel());\n\t},\n\t/**\n\t * Returns the path to the target entity set with navigation property binding.\n\t * @param oContext Context for which the target entity set will be determined\n\t * @returns Returns the path to the target entity set\n\t */\n\tgetTargetEntitySet: function (oContext: BaseContext): string {\n\t\tconst sPath = oContext.getPath();\n\t\tif (\n\t\t\toContext.getObject(\"$kind\") === \"EntitySet\" ||\n\t\t\toContext.getObject(\"$kind\") === \"Action\" ||\n\t\t\toContext.getObject(\"0/$kind\") === \"Action\"\n\t\t) {\n\t\t\treturn sPath;\n\t\t}\n\t\tconst sEntitySetPath = ModelHelper.getEntitySetPath(sPath);\n\t\treturn `/${oContext.getObject(sEntitySetPath)}`;\n\t},\n\n\t/**\n\t * Returns complete path to the entity set via using navigation property binding. Note: To be used only after the metamodel has loaded.\n\t * @param path Path for which complete entitySet path needs to be determined from entityType path\n\t * @param odataMetaModel Metamodel to be used.(Optional in normal scenarios, but needed for parameterized service scenarios)\n\t * @returns Returns complete path to the entity set\n\t */\n\tgetEntitySetPath: function (path: string, odataMetaModel?: ODataMetaModel): string {\n\t\tlet entitySetPath = \"\";\n\t\tif (!odataMetaModel) {\n\t\t\t// Previous implementation for getting entitySetPath from entityTypePath\n\t\t\tentitySetPath = `/${path.split(\"/\").filter(ModelHelper.filterOutNavPropBinding).join(\"/$NavigationPropertyBinding/\")}`;\n\t\t} else {\n\t\t\t// Calculating the entitySetPath from MetaModel.\n\t\t\tconst pathParts = path.split(\"/\").filter(ModelHelper.filterOutNavPropBinding);\n\t\t\tif (pathParts.length > 1) {\n\t\t\t\tconst initialPathObject = {\n\t\t\t\t\tgrowingPath: \"/\",\n\t\t\t\t\tpendingNavPropBinding: \"\"\n\t\t\t\t};\n\n\t\t\t\tconst pathObject = pathParts.reduce(\n\t\t\t\t\t(pathUnderConstruction: { growingPath: string; pendingNavPropBinding: string }, pathPart: string, idx: number) => {\n\t\t\t\t\t\tconst delimiter = (!!idx && \"/$NavigationPropertyBinding/\") || \"\";\n\t\t\t\t\t\tlet { growingPath, pendingNavPropBinding } = pathUnderConstruction;\n\t\t\t\t\t\tconst tempPath = growingPath + delimiter;\n\t\t\t\t\t\tconst navPropBindings = odataMetaModel.getObject(tempPath);\n\t\t\t\t\t\tconst navPropBindingToCheck = pendingNavPropBinding ? `${pendingNavPropBinding}/${pathPart}` : pathPart;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tnavPropBindings &&\n\t\t\t\t\t\t\tObject.keys(navPropBindings).length > 0 &&\n\t\t\t\t\t\t\tnavPropBindings.hasOwnProperty(navPropBindingToCheck)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tgrowingPath = tempPath + navPropBindingToCheck.replace(\"/\", \"%2F\");\n\t\t\t\t\t\t\tpendingNavPropBinding = \"\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpendingNavPropBinding += pendingNavPropBinding ? `/${pathPart}` : pathPart;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn { growingPath, pendingNavPropBinding };\n\t\t\t\t\t},\n\t\t\t\t\tinitialPathObject\n\t\t\t\t);\n\n\t\t\t\tentitySetPath = pathObject.growingPath;\n\t\t\t} else {\n\t\t\t\tentitySetPath = `/${pathParts[0]}`;\n\t\t\t}\n\t\t}\n\n\t\treturn entitySetPath;\n\t},\n\n\t/**\n\t * Gets the path for the items property of MultiValueField parameters.\n\t * @param oParameter Action Parameter\n\t * @returns Returns the complete model path for the items property of MultiValueField parameters\n\t */\n\tgetActionParameterItemsModelPath: function (oParameter: MetaModelActionParameter): string | undefined {\n\t\treturn oParameter && oParameter.$Name ? `{path: 'mvfview>/${oParameter.$Name}'}` : undefined;\n\t},\n\n\tfilterOutNavPropBinding: function (sPathPart: string): boolean {\n\t\treturn sPathPart !== \"\" && sPathPart !== \"$NavigationPropertyBinding\";\n\t},\n\n\t/**\n\t * Adds a setProperty to the created binding contexts of the internal JSON model.\n\t * @param Internal JSON Model which is enhanced\n\t */\n\n\tenhanceInternalJSONModel: function (oInternalModel: JSONModel): void {\n\t\tconst fnBindContext = oInternalModel.bindContext;\n\t\toInternalModel.bindContext = function (\n\t\t\tsPath: string,\n\t\t\tcontext: BaseContext,\n\t\t\tmParameters: object | undefined,\n\t\t\toEvents: object | undefined\n\t\t): ContextBinding {\n\t\t\tconst contextBinding = fnBindContext.apply(this, [sPath, context, mParameters, oEvents]);\n\t\t\tconst fnGetBoundContext = contextBinding.getBoundContext;\n\n\t\t\tcontextBinding.getBoundContext = function (): BaseContext | null {\n\t\t\t\tconst oBoundContext = fnGetBoundContext.apply(this);\n\t\t\t\tif (oBoundContext) {\n\t\t\t\t\toBoundContext.setProperty = function (propertyPath: string, value: unknown): void {\n\t\t\t\t\t\tif (this.getObject() === undefined) {\n\t\t\t\t\t\t\t// initialize\n\t\t\t\t\t\t\tthis.getModel().setProperty(this.getPath(), {});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst propertyPathSplit = propertyPath.split(\"/\");\n\t\t\t\t\t\tlet path = this.getPath().replace(/\\/$/, \"\"); // Remove slash if it is at the end\n\t\t\t\t\t\t// let's ensure that sub objects are initialized\n\t\t\t\t\t\tfor (let i = 0; i < propertyPathSplit.length - 1; i++) {\n\t\t\t\t\t\t\tpath = `${path}/${propertyPathSplit[i]}`;\n\t\t\t\t\t\t\tif (this.getModel().getProperty(path) === undefined) {\n\t\t\t\t\t\t\t\t// initialize\n\t\t\t\t\t\t\t\tthis.getModel().setProperty(path, {});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.getModel().setProperty(propertyPath, value, this);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn oBoundContext;\n\t\t\t};\n\t\t\treturn contextBinding;\n\t\t};\n\t},\n\n\t/**\n\t * Adds an handler on propertyChange.\n\t * The property \"/editMode\" is changed according to property '/isEditable' when this last one is set\n\t * in order to be compliant with former versions where building blocks use the property \"/editMode\"\n\t * @param uiModel JSON Model which is enhanced\n\t * @param library Core library of SAP Fiori elements\n\t */\n\n\tenhanceUiJSONModel: function (uiModel: JSONModel, library: { EditMode: { Editable: string; Display: string } }): void {\n\t\tconst fnSetProperty = uiModel.setProperty;\n\t\tuiModel.setProperty = function (\n\t\t\tpath: string,\n\t\t\tvalue: unknown,\n\t\t\tcontext: BaseContext | undefined,\n\t\t\tasyncUpdate: boolean | undefined\n\t\t): boolean {\n\t\t\tif (path === \"/isEditable\") {\n\t\t\t\tuiModel.setProperty(\"/editMode\", value ? library.EditMode.Editable : library.EditMode.Display, context, asyncUpdate);\n\t\t\t}\n\t\t\treturn fnSetProperty.apply(this, [path, value, context, asyncUpdate]);\n\t\t};\n\t},\n\n\tenhanceViewJSONModel: function (viewModel: JSONModel & { _getObject: Function }): void {\n\t\tconst fnGetObject = viewModel._getObject;\n\t\tviewModel._getObject = function (sPath: string, oContext?: Context): unknown {\n\t\t\tif (sPath === undefined || sPath === \"\") {\n\t\t\t\tsPath = \"/\";\n\t\t\t}\n\t\t\treturn fnGetObject.apply(this, [sPath, oContext]);\n\t\t};\n\t},\n\t/**\n\t * Returns whether filtering on the table is case sensitive.\n\t * @param oMetaModel The instance of the meta model\n\t * @param filterFunctions Filter functions supported by the service\n\t * @returns Returns 'false' if the service supports 'tolower', else 'true'\n\t */\n\tisFilteringCaseSensitive: function (oMetaModel?: ODataMetaModel, filterFunctions?: FilterFunctions | string[]): boolean {\n\t\tconst _filterFunctions = filterFunctions ?? oMetaModel?.getObject(\"/@Org.OData.Capabilities.V1.FilterFunctions\");\n\n\t\tif (!_filterFunctions) {\n\t\t\t// if no filters function defined in service, we assume that the service is case sensitive\n\t\t\treturn true;\n\t\t}\n\n\t\treturn _filterFunctions.indexOf(\"tolower\") === -1;\n\t},\n\n\t/**\n\t * Get MetaPath for the context.\n\t * @param oContext Context to be used\n\t * @returns Returns the metapath for the context.\n\t */\n\tgetMetaPathForContext: function (oContext: Context): string {\n\t\tconst oModel = oContext.getModel(),\n\t\t\toMetaModel = oModel.getMetaModel(),\n\t\t\tsPath = oContext.getPath();\n\t\treturn oMetaModel && sPath && oMetaModel.getMetaPath(sPath);\n\t},\n\n\t/**\n\t * Get MetaPath for the context.\n\t * @param contextPath MetaPath to be used\n\t * @returns Returns the root entity set path.\n\t */\n\tgetRootEntitySetPath: function (contextPath: string): string {\n\t\tlet rootEntitySetPath = \"\";\n\t\tconst aPaths = contextPath ? contextPath.split(\"/\") : [];\n\t\tif (aPaths.length > 1) {\n\t\t\trootEntitySetPath = aPaths[1];\n\t\t}\n\t\treturn rootEntitySetPath;\n\t},\n\t/**\n\t * Get MetaPath for the listBinding.\n\t * @param oView View of the control using listBinding\n\t * @param vListBinding ODataListBinding object or the binding path for a temporary list binding\n\t * @returns Returns the metapath for the listbinding.\n\t */\n\tgetAbsoluteMetaPathForListBinding: function (oView: FEView, vListBinding: ODataListBinding | string): string {\n\t\tconst oMetaModel = oView.getModel().getMetaModel();\n\t\tlet sMetaPath;\n\n\t\tif (typeof vListBinding === \"string\") {\n\t\t\tif (vListBinding.startsWith(\"/\")) {\n\t\t\t\t// absolute path\n\t\t\t\tsMetaPath = oMetaModel.getMetaPath(vListBinding);\n\t\t\t} else {\n\t\t\t\t// relative path\n\t\t\t\tconst oBindingContext = oView.getBindingContext();\n\t\t\t\tconst sRootContextPath = oBindingContext.getPath();\n\t\t\t\tsMetaPath = oMetaModel.getMetaPath(`${sRootContextPath}/${vListBinding}`);\n\t\t\t}\n\t\t} else {\n\t\t\t// we already get a list binding use this one\n\t\t\tconst oBinding = vListBinding;\n\t\t\tconst oRootBinding = oBinding.getRootBinding();\n\t\t\tif (oBinding === oRootBinding) {\n\t\t\t\t// absolute path\n\t\t\t\tsMetaPath = oMetaModel.getMetaPath(oBinding.getPath());\n\t\t\t} else {\n\t\t\t\t// relative path\n\t\t\t\tconst sRootBindingPath = oRootBinding!.getPath();\n\t\t\t\tconst sRelativePath = oBinding.getPath();\n\t\t\t\tsMetaPath = oMetaModel.getMetaPath(`${sRootBindingPath}/${sRelativePath}`);\n\t\t\t}\n\t\t}\n\t\treturn sMetaPath;\n\t},\n\n\t/**\n\t * Method to determine whether the argument is a draft root.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns Whether the argument is a draft root\n\t */\n\tisDraftRoot: function (entitySet: EntitySet | Singleton | unknown | undefined): boolean {\n\t\treturn this.getDraftRoot(entitySet) !== undefined;\n\t},\n\n\t/**\n\t * Method to determine whether the argument is a draft node.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns Whether the argument is a draft node\n\t */\n\tisDraftNode: function (entitySet: EntitySet | Singleton | unknown | undefined): boolean {\n\t\treturn this.getDraftNode(entitySet) !== undefined;\n\t},\n\n\t/**\n\t * Method to determine whether the argument is a sticky session root.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns Whether the argument is a sticky session root\n\t */\n\tisSticky: function (entitySet: EntitySet | Singleton | undefined): boolean {\n\t\treturn this.getStickySession(entitySet) !== undefined;\n\t},\n\n\t/**\n\t * Method to determine if entity is updatable or not.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @param entityType EntityType\n\t * @returns True if updatable else false\n\t */\n\tisUpdateHidden: function (entitySet: EntitySet | Singleton | undefined, entityType: EntityType): UpdateHidden | undefined {\n\t\tif (isEntitySet(entitySet)) {\n\t\t\treturn entitySet.annotations.UI?.UpdateHidden ?? entityType?.annotations.UI?.UpdateHidden;\n\t\t}\n\t},\n\t/**\n\t * Gets the @Common.DraftRoot annotation if the argument is an EntitySet.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns DraftRoot\n\t */\n\tgetDraftRoot: function (entitySet: EntitySet | Singleton | unknown | undefined): DraftRoot | undefined {\n\t\treturn isEntitySet(entitySet) ? entitySet.annotations.Common?.DraftRoot : undefined;\n\t},\n\n\t/**\n\t * Gets the @Common.DraftNode annotation if the argument is an EntitySet.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns DraftRoot\n\t */\n\tgetDraftNode: function (entitySet: EntitySet | Singleton | unknown | undefined): DraftNode | undefined {\n\t\treturn isEntitySet(entitySet) ? entitySet.annotations.Common?.DraftNode : undefined;\n\t},\n\n\t/**\n\t * Helper method to get sticky session.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @returns Session StickySessionSupported\n\t */\n\tgetStickySession: function (entitySet: EntitySet | Singleton | unknown | undefined): StickySessionSupported | undefined {\n\t\treturn isEntitySet(entitySet) ? entitySet.annotations.Session?.StickySessionSupported : undefined;\n\t},\n\n\t/**\n\t * Method to get the visibility state of delete button.\n\t * @param entitySet EntitySet | Singleton | undefined\n\t * @param entityType EntityType\n\t * @returns True if delete button is hidden\n\t */\n\tgetDeleteHidden: function (entitySet: EntitySet | Singleton | undefined, entityType: EntityType): DeleteHidden | undefined {\n\t\tif (isEntitySet(entitySet)) {\n\t\t\treturn entitySet.annotations.UI?.DeleteHidden ?? entityType.annotations.UI?.DeleteHidden;\n\t\t}\n\t},\n\t/**\n\t * This function will return metapath for the given list binding.\n\t * @param listBinding ListBinding.\n\t * @returns MetaPath\n\t */\n\tgetAbsolutePathFromListBinding(listBinding: ODataListBinding): string {\n\t\tconst metamodel = listBinding.getModel().getMetaModel();\n\t\tlet metaPath;\n\t\tconst rootBinding = listBinding.getRootBinding();\n\t\tif (listBinding === rootBinding) {\n\t\t\tmetaPath = metamodel.getMetaPath(listBinding.getPath());\n\t\t} else {\n\t\t\tconst rootBindingPath = rootBinding?.getPath();\n\t\t\tconst relativePath = listBinding.getPath();\n\t\t\tmetaPath = metamodel.getMetaPath(`${rootBindingPath}/${relativePath}`);\n\t\t}\n\t\treturn metaPath;\n\t},\n\n\tenhanceODataModel(odataModel: ODataModel, appComponent: AppComponent): void {\n\t\todataModel.virtualPropertyBindingRegistry = new Array<ODataPropertyBinding>();\n\t\tconst fnMessage = odataModel.setMessages;\n\t\tconst localAnnotationModel = new JSONModel({});\n\t\tlocalAnnotationModel.setDefaultBindingMode(BindingMode.OneWay);\n\t\tconst baseSetProperty = localAnnotationModel.setProperty;\n\t\tconst baseGetProperty = localAnnotationModel.getProperty;\n\t\tlocalAnnotationModel.getProperty = function (path, context: ODataV4Context): unknown {\n\t\t\tconst [propertyName, annotationType] = path.split(\"@$ui5.fe.\");\n\n\t\t\tif (context && context.isTransient() !== true && annotationType === \"@Common/ExternalID\") {\n\t\t\t\tconst contextObject = context.getObject();\n\t\t\t\tif (contextObject) {\n\t\t\t\t\tconst metaPath = new MetaPath<EntitySet>(\n\t\t\t\t\t\tconvertTypes(odataModel.getMetaModel()),\n\t\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath()),\n\t\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath())\n\t\t\t\t\t);\n\t\t\t\t\tconst externalIdProperty = metaPath.getMetaPathForPath<Property>(propertyName)?.getTarget().annotations.Common\n\t\t\t\t\t\t?.ExternalID;\n\t\t\t\t\tif (isPathAnnotationExpression(externalIdProperty)) {\n\t\t\t\t\t\treturn context.getObject(externalIdProperty.path);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn context.getObject(propertyName);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t} else if (context && annotationType === \"contextPath\") {\n\t\t\t\treturn context.getPath();\n\t\t\t}\n\n\t\t\treturn baseGetProperty.apply(this, [path, context]);\n\t\t};\n\n\t\tlocalAnnotationModel.setProperty = function (path, value, context, asyncUpdate): boolean {\n\t\t\tlet fullPath = path;\n\t\t\tif (context) {\n\t\t\t\tfullPath = context.getPath(path);\n\t\t\t}\n\t\t\tconst _refreshLocalModel = (): void => {\n\t\t\t\tthis.refresh();\n\t\t\t};\n\t\t\tconst [propertyName, annotationType] = path.split(\"@$ui5.fe.\");\n\t\t\tif (context && annotationType === \"@Common/ExternalID\") {\n\t\t\t\tcontext.setProperty(propertyName, value);\n\t\t\t\t// refreshing ExternalID and text properties (paths need to be determined generically)\n\t\t\t\tconst metaPath = new MetaPath<EntitySet>(\n\t\t\t\t\tconvertTypes(odataModel.getMetaModel()),\n\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath()),\n\t\t\t\t\todataModel.getMetaModel().getMetaPath(context.getPath())\n\t\t\t\t);\n\t\t\t\tconst externalIdProperty = metaPath.getMetaPathForPath<Property>(propertyName)?.getTarget().annotations.Common?.ExternalID;\n\t\t\t\tif (isPathAnnotationExpression(externalIdProperty)) {\n\t\t\t\t\tconst externalIdPropPath = externalIdProperty.path;\n\t\t\t\t\tconst propertiesToRequest = [externalIdPropPath.substring(0, externalIdPropPath.lastIndexOf(\"/\"))];\n\t\t\t\t\tconst textProperty = metaPath.getMetaPathForPath<Property>(externalIdPropPath)?.getTarget().annotations.Common?.Text;\n\t\t\t\t\tif (isPathAnnotationExpression(textProperty)) {\n\t\t\t\t\t\tconst textPropPath = textProperty.path;\n\t\t\t\t\t\tif (textPropPath.includes(\"/\")) {\n\t\t\t\t\t\t\tpropertiesToRequest.push(textPropPath);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t(context as ODataV4Context)\n\t\t\t\t\t\t.requestSideEffects(propertiesToRequest)\n\t\t\t\t\t\t.then(_refreshLocalModel)\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tLog.error(err as string);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst propertyPathSplit = fullPath.split(\"/\");\n\t\t\t// let's ensure that sub objects are initialized\n\t\t\tlet pathFromRoot = \"\";\n\t\t\tfor (let i = 0; i < propertyPathSplit.length - 1; i++) {\n\t\t\t\tif (i > 0) {\n\t\t\t\t\tpathFromRoot += \"/\";\n\t\t\t\t}\n\t\t\t\tpathFromRoot += propertyPathSplit[i];\n\t\t\t\tif (this.getObject(pathFromRoot) === undefined) {\n\t\t\t\t\t// initialize\n\t\t\t\t\tthis.setProperty(pathFromRoot, {});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn baseSetProperty.apply(this, [path, value, context, asyncUpdate]);\n\t\t};\n\t\tfunction clearAnnotationType(annotationTypes: string[], dataSet: Record<string, unknown>): object {\n\t\t\tfor (const contextPath in dataSet) {\n\t\t\t\t// we added a context for accepting recommendations eventually.\n\t\t\t\t// the context is a deeply nested object iterating over it cause the code the break\n\t\t\t\t// hence we are skipping it here.\n\t\t\t\tconst context = dataSet?.[contextPath] as ODataV4Context;\n\t\t\t\tconst isContext = context?.isA?.(\"sap.ui.model.odata.v4.Context\");\n\t\t\t\tif (typeof context === \"object\" && !isContext) {\n\t\t\t\t\tdataSet[contextPath] = clearAnnotationType(annotationTypes, dataSet[contextPath] as Record<string, unknown>);\n\t\t\t\t\tif (dataSet[contextPath] && Object.keys(dataSet[contextPath] as object).length === 0) {\n\t\t\t\t\t\tdelete dataSet[contextPath];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const annotationType of annotationTypes) {\n\t\t\t\t\tif (contextPath.endsWith(annotationType)) {\n\t\t\t\t\t\tdelete dataSet[contextPath];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn dataSet;\n\t\t}\n\t\todataModel._localAnnotationModel = localAnnotationModel;\n\t\todataModel.getLocalAnnotationModel = function (): JSONModel {\n\t\t\treturn this._localAnnotationModel;\n\t\t};\n\t\todataModel.setMessages = function (messages: Record<string, Message[]>): void {\n\t\t\tconst cleanedData = clearAnnotationType([\"@$ui5.fe.messageType\", \"@$ui5.fe.messageText\"], this._localAnnotationModel.getData());\n\t\t\tthis._localAnnotationModel.setData(cleanedData);\n\t\t\tfor (const messageTarget in messages) {\n\t\t\t\tthis._localAnnotationModel.setProperty(`${messageTarget}@$ui5.fe.messageType`, messages[messageTarget][0].getType());\n\t\t\t\tthis._localAnnotationModel.setProperty(`${messageTarget}@$ui5.fe.messageText`, messages[messageTarget][0].getMessage());\n\t\t\t}\n\t\t\tfnMessage.apply(this, [messages]);\n\t\t};\n\t\tconst fnBindProperty = odataModel.bindProperty.bind(odataModel);\n\t\todataModel.bindProperty = function (path: string, context: ODataV4Context, parameters): ODataPropertyBinding {\n\t\t\tconst recommendationFeatureDisabled = appComponent.getEnvironmentCapabilities()?.getCapabilities().DisableInputAssistance;\n\t\t\tconst recommendationPropertyBinding = ModelHelper.setUpRecommendationLocalModelBinding(\n\t\t\t\tthis,\n\t\t\t\tfnBindProperty,\n\t\t\t\tpath,\n\t\t\t\tcontext,\n\t\t\t\trecommendationFeatureDisabled\n\t\t\t);\n\t\t\tif (recommendationPropertyBinding) {\n\t\t\t\treturn recommendationPropertyBinding as ODataPropertyBinding;\n\t\t\t}\n\t\t\tif (path.endsWith(\"@$ui5.fe.@Common/ExternalID\") && context) {\n\t\t\t\tconst internalIdBinding = fnBindProperty(path, context);\n\t\t\t\todataModel.virtualPropertyBindingRegistry.push(internalIdBinding);\n\t\t\t\tconst externalIdBinding = this._localAnnotationModel.bindProperty(path, context) as unknown as ODataPropertyBinding;\n\n\t\t\t\tinternalIdBinding.attachChange(() => {\n\t\t\t\t\texternalIdBinding.refresh();\n\t\t\t\t});\n\t\t\t\tinternalIdBinding\n\t\t\t\t\t.requestValue()\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\texternalIdBinding.refresh();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tLog.error(err as string);\n\t\t\t\t\t});\n\t\t\t\treturn externalIdBinding;\n\t\t\t}\n\t\t\tif (path.includes(\"@$ui5.fe.\")) {\n\t\t\t\tconst propBinding = this._localAnnotationModel.bindProperty(path, context) as ODataPropertyBinding & {\n\t\t\t\t\tsetContext?: Function;\n\t\t\t\t};\n\t\t\t\tif (path.endsWith(\"@$ui5.fe.@Common/ExternalID\")) {\n\t\t\t\t\treturn propBinding;\n\t\t\t\t}\n\t\t\t\tpropBinding.updateRequired = function (model: object): boolean {\n\t\t\t\t\treturn model && model === odataModel;\n\t\t\t\t};\n\t\t\t\tif (path.includes(\"@$ui5.fe.virtual.\")) {\n\t\t\t\t\tconst expression = MetaModelConverter.getVirtualBindingExpression(\n\t\t\t\t\t\tpath,\n\t\t\t\t\t\tMetaModelConverter.convertTypes(this.getMetaModel())\n\t\t\t\t\t);\n\t\t\t\t\tconst ghostControl = new Any({ any: compileExpression(expression), bindBackProperty: path });\n\t\t\t\t\tconst fnDestroyPropertyBinding = propBinding.destroy.bind(propBinding);\n\t\t\t\t\tpropBinding.destroy = (): void => {\n\t\t\t\t\t\tghostControl?.destroy();\n\t\t\t\t\t\treturn fnDestroyPropertyBinding();\n\t\t\t\t\t};\n\t\t\t\t\tconst fnSetContext = propBinding.setContext;\n\t\t\t\t\tif (fnSetContext) {\n\t\t\t\t\t\tpropBinding.setContext = (newContext: Context): void => {\n\t\t\t\t\t\t\tghostControl?.setBindingContext(newContext);\n\t\t\t\t\t\t\treturn fnSetContext.bind(propBinding)(newContext);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tghostControl.setModel(this);\n\t\t\t\t\tconst ghostBinding = ghostControl.getBindingInfo(\"any\")?.binding;\n\t\t\t\t\tconst fnCheckUpdate = ghostBinding?.checkUpdate;\n\t\t\t\t\tif (fnCheckUpdate) {\n\t\t\t\t\t\tghostControl.getBindingInfo(\"any\").binding.checkUpdate = (): void => {\n\t\t\t\t\t\t\treturn fnCheckUpdate.bind(ghostBinding)(true);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tghostControl.setBindingContext(context);\n\t\t\t\t}\n\t\t\t\treturn propBinding;\n\t\t\t}\n\t\t\treturn fnBindProperty(path, context, parameters);\n\t\t};\n\t\tconst fnDestroy = odataModel.destroy.bind(odataModel);\n\t\todataModel.destroy = function (): void {\n\t\t\tfor (const vpBinding of odataModel.virtualPropertyBindingRegistry) {\n\t\t\t\tvpBinding.destroy();\n\t\t\t}\n\t\t\tthis._localAnnotationModel.destroy();\n\t\t\treturn fnDestroy.apply(this);\n\t\t};\n\t},\n\t/**\n\t * Resolves a metadata binding to its text, either using the converterContext or the metaModel directly.\n\t * @param path\n\t * @param converterContext\n\t * @param metaModel\n\t * @returns The resolved text if possible, else the input value or an empty string if the path was undefined\n\t */\n\tfetchTextFromMetaModel(path: string | undefined, converterContext?: ConverterContext<unknown>, metaModel?: MetaModel): string {\n\t\tlet text = path !== undefined ? path : \"\";\n\t\tif (path?.startsWith(\"{metaModel>\")) {\n\t\t\tconst metaModelPath = path.substring(11, path.length - 1);\n\t\t\ttry {\n\t\t\t\tif (converterContext) {\n\t\t\t\t\ttext = converterContext.getEntityTypeAnnotation(metaModelPath).annotation?.toString() ?? \"\";\n\t\t\t\t} else {\n\t\t\t\t\ttext = metaModel?.getObject(metaModelPath);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tLog.info(`Unable to retrieve text from meta model using path ${metaModelPath}`);\n\t\t\t}\n\t\t}\n\t\treturn text;\n\t},\n\n\t/**\n\t * Method to retrieve the property path corresponding to state messages.\n\t * @param metaModel The metamodel\n\t * @param contextPath Path for the context on which we what to retreive the message path\n\t * @returns Returns the property path, or undefined if no Messages annotation is defined\n\t */\n\tgetMessagesPath: function (metaModel: ODataMetaModel, contextPath: string): string | undefined {\n\t\tconst metaContext = metaModel.getMetaContext(contextPath);\n\t\tconst objectPath = getInvolvedDataModelObjects(metaContext);\n\t\tconst messages = objectPath.targetEntityType.annotations.Common?.Messages;\n\t\treturn isPathAnnotationExpression(messages) ? messages.path : undefined;\n\t},\n\t/**\n\t * Setup recommendation local binding to make recommendations accessible via client side instance annotations.\n\t *\n\t * Recommendations is a complex property.\n\t * Model does not provide an easy way to bind to complex properties. It has 2 major limitations.\n\t *\n\t * It only supports one time binding to complex properties. This is needed to show updated recommendations on the UI.\n\t * It does not support bindings to properties inside a complex property which is needed for recommendations.\n\t *\n\t * This function provides a workaround to overcome the above two short comings and\n\t * to support client side instance annotations for recommendations.\n\t * @param odataModel The odata model instance.\n\t * @param fnBindProperty Original bind property of the oDataModel\n\t * @param path Binding path for which recommendation is being requested\n\t * @param context Context where recommendation is being requested\n\t * @param recommendationFeatureDisabled Flag which toggles the recommendation feature\n\t * @returns Recommendation property path for the entity related to the context and whether the bindingPath is relevant or not based on metadata.\n\t */\n\tsetUpRecommendationLocalModelBinding: function (\n\t\todataModel: ODataModel,\n\t\tfnBindProperty: Function,\n\t\tpath: string,\n\t\tcontext: ODataV4Context,\n\t\trecommendationFeatureDisabled: boolean\n\t): PropertyBinding | undefined {\n\t\tif (path.includes(\"ui5.fe.recommendations\")) {\n\t\t\tconst recommendationbinding = odataModel.getLocalAnnotationModel().bindProperty(path, context) as ODataPropertyBinding & {\n\t\t\t\tsetContext: Function;\n\t\t\t};\n\t\t\tconst setContextOnRecommendationBinding = (odataPropertyBinding: ODataPropertyBinding & { setContext: Function }): void => {\n\t\t\t\t//we make sure the parent context is set to the propertybinding\n\t\t\t\tconst fnSetContext = recommendationbinding.setContext;\n\t\t\t\tif (fnSetContext) {\n\t\t\t\t\trecommendationbinding.setContext = (newContext: Context): void => {\n\t\t\t\t\t\todataPropertyBinding?.setContext(newContext);\n\t\t\t\t\t\treturn fnSetContext.bind(odataPropertyBinding)(newContext);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (context) {\n\t\t\t\tconst { recommendationComplexProperty, isRecommendedProperty } = ModelHelper.validateRecommendationBindingPath(\n\t\t\t\t\tcontext,\n\t\t\t\t\tpath\n\t\t\t\t);\n\t\t\t\tif (recommendationComplexProperty && isRecommendedProperty && !recommendationFeatureDisabled) {\n\t\t\t\t\tconst alreadyBound = odataModel.virtualPropertyBindingRegistry.some((existingBinding) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t// binding exists but the context can be destroyed sometimes because of discard and delete.\n\t\t\t\t\t\t\t// hence we need to check if context exists or not before deciding if we already have a binding or not.\n\t\t\t\t\t\t\t// TODO: We might want to clear the property binding when the contex is destroyed.\n\t\t\t\t\t\t\tcontext.getPath() === existingBinding.getContext()?.getPath() &&\n\t\t\t\t\t\t\trecommendationComplexProperty === existingBinding.getPath()\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t\tif (!alreadyBound) {\n\t\t\t\t\t\tconst odataPropertyBinding = fnBindProperty(recommendationComplexProperty, context) as ODataPropertyBinding & {\n\t\t\t\t\t\t\tsetContext: Function;\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// Becuase recommendations is a complex property and not a primitive type hence use a raw type.\n\t\t\t\t\t\todataPropertyBinding.setType(new Raw(), \"any\");\n\t\t\t\t\t\todataPropertyBinding.setBindingMode(BindingMode.OneWay);\n\t\t\t\t\t\todataModel.virtualPropertyBindingRegistry.push(odataPropertyBinding);\n\t\t\t\t\t\todataPropertyBinding.attachChange((event: ODataPropertyBinding$ChangeEvent) => {\n\t\t\t\t\t\t\t// refresh the local annotation binding once recommendation binding is updated.\n\t\t\t\t\t\t\tconst propertyBinding = event.getSource();\n\t\t\t\t\t\t\tconst currentContext = event.getSource().getContext() as ODataV4Context;\n\t\t\t\t\t\t\tif (currentContext) {\n\t\t\t\t\t\t\t\tconst contextRecommendations = propertyBinding.getValue();\n\t\t\t\t\t\t\t\tModelHelper.setRecommendationsOnLocalAnnotationModel(contextRecommendations, currentContext);\n\t\t\t\t\t\t\t\trecommendationbinding.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// reuestValue will add the recommendation property to the $select\n\t\t\t\t\t\t// hence we do not need to add it to the $select when constructing the binding at various places (forms, table etc.)\n\t\t\t\t\t\todataPropertyBinding.requestValue().catch((error) => {\n\t\t\t\t\t\t\tLog.error(\"Recommendations could not be resolved\", error);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsetContextOnRecommendationBinding(odataPropertyBinding);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// We need to ensure that the binding becomes invalid and a new binding is created so the recommendation property binding can be created.\n\t\t\t//\n\t\t\t// For this we need to override updateRequired so that the binding is updated until it has not received a context\n\t\t\t// post that we do not need the binding to be updated.\n\t\t\t// If we remove the updateRequired override then recommendations work fine by during save of a newly created document\n\t\t\t// we get binding related issues.\n\t\t\t//\n\t\t\t// Updating the binding to recommendations will be done by setProperty on the localAnnotationModel\n\t\t\t// when the recommendation property is actually updated.\n\t\t\trecommendationbinding.updateRequired = function (model: object): boolean {\n\t\t\t\treturn this.getContext() ? model && model === odataModel : model && this.getModel() === model;\n\t\t\t};\n\t\t\treturn recommendationbinding;\n\t\t}\n\t},\n\t/**\n\t * Validates based on metadata whether a given binding should deal with recommendations or not.\n\t * @param context Context where recommendation is being requested.\n\t * @param bindingPath Binding path for which recommendation is being requested.\n\t * @returns Recommendation property path for the entity related to the context and whether the bindingPath is relevant or not based on metadata.\n\t */\n\tvalidateRecommendationBindingPath: function (\n\t\tcontext: ODataV4Context,\n\t\tbindingPath: string\n\t): { recommendationComplexProperty: string | undefined; isRecommendedProperty: boolean } {\n\t\tconst metaModel = context.getModel().getMetaModel();\n\t\tconst contextMetaPath = metaModel.getMetaPath(context.getPath());\n\t\tconst metaContext = metaModel.getMetaContext(contextMetaPath);\n\t\tconst targetEntityType = getInvolvedDataModelObjects(metaContext).targetEntityType;\n\t\tconst recommendationComplexProperty = (targetEntityType?.annotations?.UI as EntityTypeAnnotations_UI_With_Recommendations)\n\t\t\t?.Recommendations?.path;\n\t\t// sample binding - ShippingCondition@$ui5.fe.recommendations.placeholderValue\n\t\tconst propertyPath = bindingPath.split(\"@$ui5.fe.recommendations\")[0];\n\t\tconst isRecommendedProperty = targetEntityType.entityProperties.some((entityProperty) => {\n\t\t\tif (entityProperty.name === recommendationComplexProperty) {\n\t\t\t\treturn (entityProperty?.targetType as ComplexType)?.properties.some((property) => {\n\t\t\t\t\treturn propertyPath === property.name;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\trecommendationComplexProperty,\n\t\t\tisRecommendedProperty\n\t\t};\n\t},\n\t/**\n\t * Update recommendation client side instance annotations.\n\t * @param contextRecommendations Updated recommendations.\n\t * @param currentContext Context where recommendation was updated.\n\t */\n\tsetRecommendationsOnLocalAnnotationModel: function (contextRecommendations: Recommendations, currentContext: ODataV4Context): void {\n\t\tif (contextRecommendations) {\n\t\t\tfor (const recommendedProperty in contextRecommendations) {\n\t\t\t\tconst propertyRecommendations = contextRecommendations[recommendedProperty];\n\t\t\t\tconst localModelPath = recommendedProperty;\n\t\t\t\tconst localAnnotationModel = currentContext.getModel().getLocalAnnotationModel();\n\t\t\t\tconst typeAheadValues = [];\n\t\t\t\tfor (const propertyRecommendation of propertyRecommendations) {\n\t\t\t\t\tif (propertyRecommendation.RecommendedFieldIsSuggestion) {\n\t\t\t\t\t\tconst placeholderValueAnnotationPath = currentContext.getPath(\n\t\t\t\t\t\t\tlocalModelPath + \"@$ui5.fe.recommendations.placeholderValue\"\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst placeholderDescriptionAnnotationPath = currentContext.getPath(\n\t\t\t\t\t\t\tlocalModelPath + \"@$ui5.fe.recommendations.placeholderDescription\"\n\t\t\t\t\t\t);\n\t\t\t\t\t\tlocalAnnotationModel.setProperty(\n\t\t\t\t\t\t\tplaceholderValueAnnotationPath,\n\t\t\t\t\t\t\tpropertyRecommendation.RecommendedFieldValue,\n\t\t\t\t\t\t\tcurrentContext,\n\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t);\n\t\t\t\t\t\tlocalAnnotationModel.setProperty(\n\t\t\t\t\t\t\tplaceholderDescriptionAnnotationPath,\n\t\t\t\t\t\t\tpropertyRecommendation.RecommendedFieldDescription,\n\t\t\t\t\t\t\tcurrentContext,\n\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t);\n\t\t\t\t\t\t// set placeholder description and values\n\t\t\t\t\t}\n\t\t\t\t\t//localAnnotationModel.\n\t\t\t\t\t// push top 3 recommendation values\n\t\t\t\t\tif (propertyRecommendation.RecommendedFieldValue) {\n\t\t\t\t\t\ttypeAheadValues.push(propertyRecommendation.RecommendedFieldValue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!propertyRecommendations || !propertyRecommendations.length) {\n\t\t\t\t\tconst placeholderValueAnnotationPath = currentContext.getPath(\n\t\t\t\t\t\tlocalModelPath + \"@$ui5.fe.recommendations.placeholderValue\"\n\t\t\t\t\t);\n\t\t\t\t\tconst placeholderDescriptionAnnotationPath = currentContext.getPath(\n\t\t\t\t\t\tlocalModelPath + \"@$ui5.fe.recommendations.placeholderDescription\"\n\t\t\t\t\t);\n\t\t\t\t\tlocalAnnotationModel.setProperty(placeholderValueAnnotationPath, null, currentContext, false);\n\t\t\t\t\tlocalAnnotationModel.setProperty(placeholderDescriptionAnnotationPath, \"\", currentContext, false);\n\t\t\t\t}\n\t\t\t\tlocalAnnotationModel.setProperty(\n\t\t\t\t\tcurrentContext.getPath(localModelPath + \"@$ui5.fe.recommendations.typeAheadValues\"),\n\t\t\t\t\ttypeAheadValues,\n\t\t\t\t\tcurrentContext,\n\t\t\t\t\tfalse\n\t\t\t\t);\n\t\t\t\tlocalAnnotationModel.setProperty(currentContext.getPath(\"recommendationContext\"), currentContext);\n\t\t\t}\n\t\t}\n\t},\n\t/**\n\t * Fetches the SecondaryKeys from entitytype.\n\t * @param entityType Datamodel object of entityType\n\t * @param entitySet Datamodel object of entitySet\n\t * @returns An array of alternate keys\n\t */\n\tgetAlternateAndSecondaryKeys: (entityType: EntityType, entitySet: EntitySet): string[] => {\n\t\tconst alternateKeys: string[] = [];\n\t\tconst _fetchAlternateKeys = (entityTypeOrSet: EntitySet | EntityType): void => {\n\t\t\tentityTypeOrSet?.annotations?.Core?.AlternateKeys?.forEach((alternateKey: AlternateKey) => {\n\t\t\t\talternateKey.Key.forEach((key: PropertyRef) => {\n\t\t\t\t\talternateKeys.push(key.Name.value);\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\tconst _fetchSecondaryKeys = (eT: EntityType): void => {\n\t\t\teT?.annotations?.Common?.SecondaryKey?.forEach((secondaryKey: PropertyPath) => {\n\t\t\t\tif (!alternateKeys.includes(secondaryKey.value)) {\n\t\t\t\t\talternateKeys.push(secondaryKey.value);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t_fetchAlternateKeys(entitySet);\n\t\tif (!alternateKeys.length) {\n\t\t\t_fetchAlternateKeys(entityType);\n\t\t}\n\t\t_fetchSecondaryKeys(entityType);\n\t\treturn alternateKeys;\n\t}\n};\n\ntype Recommendations = Record<string, RecommendationDetails[]>;\ntype RecommendationDetails = {\n\tRecommendedFieldValue: string;\n\tRecommendedFieldIsSuggestion: boolean;\n\tRecommendedFieldDescription: string;\n};\n\nexport type InternalModelContext = { getModel(): JSONModel } & BaseContext & {\n\t\tsetProperty(sPath: string, vValue: unknown): void;\n\t};\n\nexport default ModelHelper;\n"],"mappings":"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","ignoreList":[],"file":"ModelHelper-dbg.js"}