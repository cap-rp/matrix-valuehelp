{"version":3,"file":"SemanticKeyHelper.js","names":["SemanticKeyHelper","getSemanticKeys","oMetaModel","sEntitySetName","getObject","getSemanticObjectInformation","oSemanticObject","aSemanticKeys","this","semanticObject","semanticKeys","getPathContent","valuePairs","typeMetadata","singleKey","length","map","valuePair","keyValue","value","encodedKeyValue","name","$Type","encodeURIComponent","join","getSemanticPath","oContext","bStrict","arguments","undefined","getModel","getMetaModel","getMetaContext","getPath","oSemanticObjectInformation","sTechnicalPath","sSemanticPath","isA","isRelative","getHeaderContext","_isPathForSemantic","oEntityType","keyValues","semanticKey","keyName","$PropertyPath","getProperty","Error","semanticKeysPart","e","Log","info","sPath","test"],"sources":["./SemanticKeyHelper.ts"],"sourcesContent":["import type { PropertyPath } from \"@sap-ux/vocabularies-types\";\nimport type { SemanticObject } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport Log from \"sap/base/Log\";\nimport type ODataV4Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type { ExpandPathType, MetaModelType } from \"types/metamodel_types\";\n\ntype SemanticObjectInformation = {\n\tsemanticObject?: MetaModelType<SemanticObject>;\n\tsemanticKeys?: ExpandPathType<PropertyPath>[];\n};\nconst SemanticKeyHelper = {\n\tgetSemanticKeys: function (oMetaModel: ODataMetaModel, sEntitySetName: string): ExpandPathType<PropertyPath>[] | undefined {\n\t\treturn oMetaModel.getObject(`/${sEntitySetName}/@com.sap.vocabularies.Common.v1.SemanticKey`);\n\t},\n\tgetSemanticObjectInformation: function (oMetaModel: ODataMetaModel, sEntitySetName: string): SemanticObjectInformation {\n\t\tconst oSemanticObject = oMetaModel.getObject(`/${sEntitySetName}/@com.sap.vocabularies.Common.v1.SemanticObject`) as\n\t\t\t| MetaModelType<SemanticObject>\n\t\t\t| undefined;\n\t\tconst aSemanticKeys = this.getSemanticKeys(oMetaModel, sEntitySetName);\n\t\treturn {\n\t\t\tsemanticObject: oSemanticObject,\n\t\t\tsemanticKeys: aSemanticKeys\n\t\t};\n\t},\n\t/**\n\t * Returns a stringified version of a list of key values, e.g. [{name:\"aa\", value:1}, {name:\"bb\", value:\"foo\"}] --> \"aa=1,bb='foo'\".\n\t * @param valuePairs\n\t * @param typeMetadata\n\t * @returns String\n\t */\n\tgetPathContent(valuePairs: { name: string; value: unknown }[], typeMetadata: Record<string, { $Type: string }>): string {\n\t\tconst singleKey = valuePairs.length === 1;\n\t\treturn valuePairs\n\t\t\t.map((valuePair) => {\n\t\t\t\tconst keyValue = valuePair.value;\n\t\t\t\tconst encodedKeyValue =\n\t\t\t\t\ttypeMetadata[valuePair.name].$Type === \"Edm.String\" ? `'${encodeURIComponent(keyValue as string)}'` : keyValue;\n\t\t\t\treturn singleKey ? encodedKeyValue : `${valuePair.name}=${encodedKeyValue}`;\n\t\t\t})\n\t\t\t.join(\",\");\n\t},\n\tgetSemanticPath: function (oContext: ODataV4Context, bStrict = false): string | undefined {\n\t\tconst oMetaModel = oContext.getModel().getMetaModel(),\n\t\t\tsEntitySetName = oMetaModel.getMetaContext(oContext.getPath()).getObject(\"@sapui.name\"),\n\t\t\toSemanticObjectInformation = this.getSemanticObjectInformation(oMetaModel, sEntitySetName);\n\t\tlet sTechnicalPath, sSemanticPath;\n\n\t\tif (oContext.isA<ODataListBinding>(\"sap.ui.model.odata.v4.ODataListBinding\") && oContext.isRelative()) {\n\t\t\tsTechnicalPath = oContext.getHeaderContext()!.getPath();\n\t\t} else {\n\t\t\tsTechnicalPath = oContext.getPath();\n\t\t}\n\n\t\tif (\n\t\t\tthis._isPathForSemantic(sTechnicalPath) &&\n\t\t\toSemanticObjectInformation.semanticKeys &&\n\t\t\toSemanticObjectInformation.semanticKeys.length !== 0\n\t\t) {\n\t\t\tconst aSemanticKeys = oSemanticObjectInformation.semanticKeys;\n\t\t\tconst oEntityType = oMetaModel.getObject(\"/\" + oMetaModel.getObject(`/${sEntitySetName}`).$Type);\n\n\t\t\ttry {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\t\tconst keyValues = aSemanticKeys.map((semanticKey) => {\n\t\t\t\t\tconst keyName = semanticKey.$PropertyPath;\n\t\t\t\t\tconst keyValue = oContext.getProperty(keyName);\n\t\t\t\t\tif (keyValue === undefined || keyValue === null) {\n\t\t\t\t\t\tthrow new Error(`Couldn't resolve semantic key value for ${keyName}`);\n\t\t\t\t\t}\n\t\t\t\t\treturn { name: keyName, value: keyValue };\n\t\t\t\t});\n\t\t\t\tconst semanticKeysPart = this.getPathContent(keyValues, oEntityType);\n\n\t\t\t\tsSemanticPath = `/${sEntitySetName}(${semanticKeysPart})`;\n\t\t\t} catch (e) {\n\t\t\t\tLog.info(e as string);\n\t\t\t}\n\t\t}\n\n\t\treturn bStrict ? sSemanticPath : sSemanticPath || sTechnicalPath;\n\t},\n\n\t// ==============================\n\t// INTERNAL METHODS\n\t// ==============================\n\n\t_isPathForSemantic: function (sPath: string): boolean {\n\t\t// Only path on root objects allow semantic keys, i.e. sPath = xxx(yyy)\n\t\treturn /^[^()]+\\([^()]+\\)$/.test(sPath);\n\t}\n};\n\nexport default SemanticKeyHelper;\n"],"mappings":";;;;wDAYA,MAAMA,EAAoB,CACzBC,gBAAiB,SAAUC,EAA4BC,GACtD,OAAOD,EAAWE,UAAU,IAAID,gDACjC,EACAE,6BAA8B,SAAUH,EAA4BC,GACnE,MAAMG,EAAkBJ,EAAWE,UAAU,IAAID,oDAGjD,MAAMI,EAAgBC,KAAKP,gBAAgBC,EAAYC,GACvD,MAAO,CACNM,eAAgBH,EAChBI,aAAcH,EAEhB,EAOAI,eAAeC,EAAgDC,GAC9D,MAAMC,EAAYF,EAAWG,SAAW,EACxC,OAAOH,EACLI,IAAKC,IACL,MAAMC,EAAWD,EAAUE,MAC3B,MAAMC,EACLP,EAAaI,EAAUI,MAAMC,QAAU,aAAe,IAAIC,mBAAmBL,MAAyBA,EACvG,OAAOJ,EAAYM,EAAkB,GAAGH,EAAUI,QAAQD,MAE1DI,KAAK,IACR,EACAC,gBAAiB,SAAUC,GAA+D,IAArCC,EAAOC,UAAAb,OAAA,GAAAa,UAAA,KAAAC,UAAAD,UAAA,GAAG,MAC9D,MAAM1B,EAAawB,EAASI,WAAWC,eACtC5B,EAAiBD,EAAW8B,eAAeN,EAASO,WAAW7B,UAAU,eACzE8B,EAA6B1B,KAAKH,6BAA6BH,EAAYC,GAC5E,IAAIgC,EAAgBC,EAEpB,GAAIV,EAASW,IAAsB,2CAA6CX,EAASY,aAAc,CACtGH,EAAiBT,EAASa,mBAAoBN,SAC/C,KAAO,CACNE,EAAiBT,EAASO,SAC3B,CAEA,GACCzB,KAAKgC,mBAAmBL,IACxBD,EAA2BxB,cAC3BwB,EAA2BxB,aAAaK,SAAW,EAClD,CACD,MAAMR,EAAgB2B,EAA2BxB,aACjD,MAAM+B,EAAcvC,EAAWE,UAAU,IAAMF,EAAWE,UAAU,IAAID,KAAkBmB,OAE1F,IAEC,MAAMoB,EAAYnC,EAAcS,IAAK2B,IACpC,MAAMC,EAAUD,EAAYE,cAC5B,MAAM3B,EAAWQ,EAASoB,YAAYF,GACtC,GAAI1B,IAAaW,WAAaX,IAAa,KAAM,CAChD,MAAM,IAAI6B,MAAM,2CAA2CH,IAC5D,CACA,MAAO,CAAEvB,KAAMuB,EAASzB,MAAOD,KAEhC,MAAM8B,EAAmBxC,KAAKG,eAAe+B,EAAWD,GAExDL,EAAgB,IAAIjC,KAAkB6C,IACvC,CAAE,MAAOC,GACRC,EAAIC,KAAKF,EACV,CACD,CAEA,OAAOtB,EAAUS,EAAgBA,GAAiBD,CACnD,EAMAK,mBAAoB,SAAUY,GAE7B,MAAO,qBAAqBC,KAAKD,EAClC,GACC,OAEapD,CAAiB","ignoreList":[]}