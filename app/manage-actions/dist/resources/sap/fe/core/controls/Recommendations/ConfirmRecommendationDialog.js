/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/ResourceModelHelper","sap/m/Button","sap/m/CustomListItem","sap/m/Dialog","sap/m/FlexItemData","sap/m/HBox","sap/m/List","sap/m/Text","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/ui/base/ManagedObject","sap/ui/core/library","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","../../formatters/ValueFormatter","../../helpers/StandardRecommendationHelper","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs"],function(e,t,n,o,i,r,a,s,c,l,d,m,u,g,f,p,h,C,x,D,R,A){"use strict";var v,M,O,_,b;var E={};var T=x.standardRecommendationHelper;var I=f.ValueState;var y=o.getResourceModel;var N=t.defineUI5Class;var P=t.defineReference;function w(e,t,n,o){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(o):void 0})}function j(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,S(e,t)}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function F(e,t,n,o,i){var r={};return Object.keys(o).forEach(function(e){r[e]=o[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce(function(n,o){return o(e,t,n)||n},r),i&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(i):void 0,r.initializer=void 0),void 0===r.initializer?(Object.defineProperty(e,t,r),null):r}function L(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let G=function(e){e["Accept"]="Accept_Recommendations";e["Ignore"]="Ignore_Recommendations";e["Continue"]="Continue_Editing";e["Skipped"]="Skipped";return e}({});E.RecommendationDialogDecision=G;let B=(v=N("sap.fe.core.controls.Recommendations.ConfirmRecommendationDialog"),M=P(),v(O=(_=function(t){function o(e){var n;n=t.call(this,e)||this;w(n,"confirmRecommendationDialog",b,n);n.view=e.view;n.confirmRecommendationDialogResourceModel=y(n.view);return n}E.ConfirmRecommendationDialog=o;j(o,t);var g=o.prototype;g.getOpenRecommendations=function e(){const t=this.getVisiblePageContextPaths();const n=this.getOpenRecommendationsForVisibleContextPaths(t);const o=[];if(n.length>0){n.forEach(e=>{const t=this.view.getBindingContext();const n=e.propertyPath?e.propertyPath:"";if(t?.getProperty(n)===null||t?.getProperty(n)===undefined||t?.getProperty(n)==""){o.push(e)}})}return o};g.getVisiblePageContextPaths=function e(){const t=[this.view.getBindingContext()?.getPath()];const n=this.view.getController();const o=n.getAppComponent().getRootViewController();const i=n.getAppComponent()._isFclEnabled();const r=i?o.getHelper().getCurrentUIState().isFullScreen:true;if(i&&!r){const e=o.getRightmostContext();t.push(e?.getPath())}return t};g.getOpenRecommendationsForVisibleContextPaths=function e(t){const n=[];if(t.length>0){const e=this.view.getModel().getLocalAnnotationModel();t.forEach(t=>{if(t!==undefined){const o=e.getObject(t);if(o){const e=o;this.fetchLocalAnnotationObject(e,n)}}})}return n};g.fetchLocalAnnotationObject=function e(t,o){if(t["recommendationContext"]){const e={};e["recommendationContext"]=t["recommendationContext"];for(const n in t){const i=t[n];if(i){if(i["recommendationContext"]){this.fetchLocalAnnotationObject(t[n],o)}else if(n.includes("@$ui5.fe.recommendations.placeholderValue")||n.includes("@$ui5.fe.recommendations.placeholderDescription")||n.includes("@$ui5.fe.recommendations.typeAheadValues")){e[n]=i}}}const i=n.getInvolvedDataModelObjectEntityKeys(e["recommendationContext"]);e["recommendationContext"].contextIdentifier=i["semanticKeys"]?i["semanticKeys"]:i["technicalKeys"];this.getOpenRecommendationsForContext(e,e["recommendationContext"],o)}};g.getOpenRecommendationsForContext=function e(t,n,o){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";for(const e in t){const r=t[e];if(r){const a=r.isA&&r.isA("sap.ui.model.odata.v4.Context");if(e.includes("@$ui5.fe.recommendations.placeholderValue")){const a=e.split("@$ui5.fe.recommendations.placeholderValue")[0];const s={context:n,propertyPath:i?`${i}/${a}`:a,value:r,contextIdentifier:n.contextIdentifier,contextIdentifierText:[]};const c=t[`${a}@$ui5.fe.recommendations.placeholderDescription`];if(c){s.text=c}o.push(s)}else if(typeof r==="object"&&!Array.isArray(r)&&!a){this.getOpenRecommendationsForContext(r,n,o,e)}}}};g.open=async function e(t){const n=this.getOpenRecommendations();if(n.length>0){T.addContextIdentifierText({recommendationData:n},this.view.getBindingContext()?.getPath());this.acceptAllParams={recommendationData:n}}else{const e=(this.view?.getController()).recommendations.checkIfRecommendationsExist();if(e){this.acceptAllParams=await(this.view?.getController()).recommendations.fetchAcceptAllParams()}else{return undefined}}const o=this.getAcceptAllModel();this.view.setModel(o,"_acceptDialogModel");if(!o.getData().items?.length){return G.Skipped}this.isSave=t;const i=this.getContent();i?.setEscapeHandler(this.onContinueEditing.bind(this));this.view.addDependent(i);i?.open();return new Promise((e,t)=>{this.promiseResolve=e;this.promiseReject=t})};g.close=function e(){this.confirmRecommendationDialog.current?.close();this.confirmRecommendationDialog.current?.destroy()};g.onAcceptAndSave=async function t(){try{const e=await(this.view?.getController()).recommendations.acceptRecommendations(this.acceptAllParams);if(!e){this.promiseReject("Accept Failed")}this.promiseResolve(G.Accept)}catch{e.error("Accept Recommendations Failed");this.promiseReject("Accept Failed")}finally{this.close()}};g.onIgnoreAndSave=function e(){(this.view?.getController()).recommendations.ignoreRecommendationForContexts();this.promiseResolve(G.Ignore);this.close()};g.onContinueEditing=function e(){this.promiseResolve(G.Continue);this.close()};g.getFieldName=function e(t){const o=n.getInvolvedDataModelObjectsForTargetPath(t,this.view?.getBindingContext()?.getModel()?.getMetaModel());return o?.targetObject?.annotations?.Common?.Label?.toString()||t.split("/")[t.split("/").length-1]};g.getText=function e(t,n){if(t.text||t.value){switch(n){case"Description":return t.text;case"DescriptionValue":return C.formatWithBrackets(t.text,t.value);case"ValueDescription":return C.formatWithBrackets(t.value,t.text);case"Value":return t.value}}return t.value||""};g.getButton=function e(t,n,o){return D(i,{text:t,type:n,width:"auto",press:o,children:{layoutData:D(R,{children:D(s,{minWidth:"100%"})})}})};g.getFooter=function e(){return D(m,{children:{content:A(R,{children:[D(u,{}),this.getButton(this._getDialogButtonText(this.isSave,G.Accept),"Emphasized",this.onAcceptAndSave.bind(this)),this.getButton(this._getDialogButtonText(this.isSave,G.Ignore),"Ghost",this.onIgnoreAndSave.bind(this)),this.getButton(this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_CONTINUE_EDITING"),"Ghost",this.onContinueEditing.bind(this))]})}})};g._getDialogButtonText=function e(t,n){const o=n===G.Accept;if(t){if(!this.view.getBindingContext()?.getObject().HasActiveEntity){return o?this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_ACCEPT_AND_CREATE"):this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_IGNORE_AND_CREATE")}return o?this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_ACCEPT_AND_SAVE"):this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_IGNORE_AND_SAVE")}else{return o?this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_ACCEPT"):this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_IGNORE")}};g.getAcceptAllModel=function e(){const t=new h;const n=[];for(const e of this.acceptAllParams?.recommendationData||[]){const t=T.getEntityName(e.context)||"";const o=e.contextIdentifierText&&e.contextIdentifierText.length>0?`${t} (${e.contextIdentifierText})`:t;if(e.value||e.text){const t=e.context?.getPath()+"/"+e.propertyPath;const i=T.getDisplayModeForTargetPath(t,this.view?.getBindingContext()?.getModel()?.getMetaModel());const r={fieldName:this.getFieldName(t).valueOf(),fieldValue:this.getText(e,i),identifierTexts:o};n.push(r)}}t.setData({items:n});return t};g.getGroup=function e(t){return t.getProperty("identifierTexts")};g.getMessage=function e(){const t=this.view.getModel("_acceptDialogModel")?.getData()?.items;const n=t.length>1?this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_TEXT",[t.length]):this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_TEXT_SINGULAR");return D(d,{text:n})};g.getDialogContent=function e(){return D(l,{items:{model:"_acceptDialogModel",path:"/items",sorter:new p("identifierTexts",false,this.getGroup)},children:D(r,{children:D(c,{class:"sapUiSmallMarginBegin sapUiTinyMargin",children:D(d,{text:"{_acceptDialogModel>fieldName}: {_acceptDialogModel>fieldValue}"})})})})};g.getContent=function e(){return D(a,{title:this.confirmRecommendationDialogResourceModel.getText("C_RECOMMENDATION_DIALOG_TITLE"),state:I.Information,type:"Message",ref:this.confirmRecommendationDialog,resizable:"true",contentWidth:"35rem",children:{content:A(R,{children:[this.getMessage(),this.getDialogContent()]}),footer:D(R,{children:this.getFooter()})}})};return o}(g),b=F(_.prototype,"confirmRecommendationDialog",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),_))||O);E.ConfirmRecommendationDialog=B;return E},false);
//# sourceMappingURL=ConfirmRecommendationDialog.js.map