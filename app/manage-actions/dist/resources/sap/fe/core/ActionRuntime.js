/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/merge","sap/fe/base/BindingToolkit","sap/fe/core/CommonUtils","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/ui/core/Messaging","sap/ui/core/message/Message","sap/ui/core/message/MessageType","./controls/AnyElement","./converters/ConverterContext","./converters/objectPage/HeaderAndFooterAction"],function(e,t,n,o,a,i,s,r,l,c,d){"use strict";var g=d.getHiddenExpression;var p=d.getEditButtonEnabled;var f=a.isEntitySet;var u=t.transformRecursively;var b=t.equal;var y=t.constant;var A=t.compileExpression;const m={_addMessageForActionParameter:function(e){i.addMessages(e.map(e=>{const t=e.actionParameterInfo.field.getBinding(e.actionParameterInfo.isMultiValue?"items":"value");return new s({message:e.message,type:r.Error,processor:t?.getModel()??undefined,persistent:true,target:t?.getResolvedPath()})}))},validateProperties:async function(e,t){await Promise.allSettled(e.map(e=>e.validationPromise));const n=e.filter(e=>e.field.getRequired&&e.field.getRequired());const o=i.getMessageModel().getData();const a=n.filter(e=>{const t=e.field.getId();const n=o.filter(e=>e.getControlIds().some(e=>e.includes(t)));if(n.length>0){return false}else if(e.isMultiValue){return e.value===undefined||!e.value.length}else{const t=e.field.getValue();const n=Array.isArray(e.field.getValue());if(n){return t[0]===null||t[0]===""}return t===undefined||t===null||t===""}});if(a.length){this._addMessageForActionParameter(a.map(e=>({actionParameterInfo:e,message:t.getText("C_OPERATIONS_ACTION_PARAMETER_DIALOG_MISSING_MANDATORY_MSG",[(e.field.getParent()?.getAggregation("label")).getText()])})))}const s=e.find(e=>e.field.getVisible()&&(e.hasError||e.field.getValueState()==="Error"||a.includes(e)));if(s){s.field.setVisible(true);s.field.focus();return false}else{return true}},setActionEnablement:async function(e,t,o,a){let i=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;const s=[];for(const r in t){let l=[];e.setProperty(r,false);if(a==="table"){e.setProperty(`dynamicActions/${r}/aApplicable`,[]);e.setProperty(`dynamicActions/${r}/aNotApplicable`,[]);if(i){e.setProperty(`dynamicActions/${r}/bEnabledForContextMenu`,false)}else{e.setProperty(`dynamicActions/${r}/bEnabled`,false)}}const c=t[r];for(const t of o){const n=t;if(n){const t=n.getObject();if(a==="chart"){if(c===null&&!!t[`#${r}`]||n.getObject(c)){e.setProperty(r,true);break}}else if(a==="table"){l=this._setActionEnablementForTable(n,e,r,c,l,i)}}}if(a==="table"){if(!o.length){e.setProperty(`dynamicActions/${r}`,{bEnabled:false,aApplicable:[],aNotApplicable:[]});s.push(n.setContextsBasedOnOperationAvailable(e,[],i))}else if(o.length&&typeof c==="string"){s.push(n.setContextsBasedOnOperationAvailable(e,l,i))}}}return Promise.all(s)},setActionEnablementAfterPatch:function(e,t,n){const o=n?.getObject();const a=o?.controls||{};for(const n in a){if(a[n]&&a[n].controlId){const o=e.byId(n);if(o&&o.isA("sap.ui.mdc.Table")){const e=o.getRowBinding();if(e==t){const e=o.getParent();m.setActionEnablement(o.getBindingContext("internal"),JSON.parse(e.tableDefinition.operationAvailableMap),o.getSelectedContexts(),"table")}}}}},updateEditButtonVisibilityAndEnablement(t){const a=t.getViewData()?.viewLevel,i=n.getIsEditable(t);if(a>1&&i!==true){const a=t.getBindingContext();const i=n.getAppComponent(t);const s=o.getMetaPathForContext(a);const r=o.getRootEntitySetPath(s);const l=a?.getModel().getMetaModel()?.getContext(a?.getPath());const d=c?.createConverterContextForMacro(r,l,i.getDiagnostics(),e);const u=d.getEntitySet();const y=d.getEntityType();let m;const P=f(u)&&u.annotations.UI?.UpdateHidden?.valueOf();if(P!==true){m=o.isUpdateHidden(u,y)}const E=p(d);const M=o.getDraftRootPath(a);const x=o.getStickyRootPath(a);const C=M||x;const h=t.getBindingContext("internal");if(C){const e=t.getModel().bindContext(C).getBoundContext();if(m!==undefined){const n=A(b(g(d,m),false));this.updateEditModelContext(n,t,e,"rootEditVisible",h)}if(E){this.updateEditModelContext(E,t,e,"rootEditEnabled",h)}}}},updateEditModelContext:function(e,t,n,o,a){if(e){const i=new l({anyText:e});i.setBindingContext(null);t.addDependent(i);i.getBinding("anyText");const s=i.getModel()?.bindContext(n.getPath(),n,{$$groupId:"$auto.Heroes"})?.getBoundContext();i.setBindingContext(s);i?.getBinding("anyText")?.attachChange(e=>{const t=e.getSource().getExternalValue();a.setProperty(o,t)})}},_setActionEnablementForTable:function(e,t,o,a,i){let s=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;const r=s?"bEnabledForContextMenu":"bEnabled",l=t.getProperty(`dynamicActions/${o}/aApplicable`)||[],c=t.getProperty(`dynamicActions/${o}/aNotApplicable`)||[];let d=t.getProperty(`dynamicActions/${o}/${r}`)||false;if(!s){t.setProperty(`dynamicActions/${o}`,{bEnabled:false,aApplicable:[],aNotApplicable:[]})}else{t.setProperty(`dynamicActions/${o}`,{bEnabled:t.getProperty(`dynamicActions/${o}/bEnabled`),aApplicable:t.getProperty(`dynamicActions/${o}/aApplicable`),aNotApplicable:t.getProperty(`dynamicActions/${o}/aNotApplicable`),bEnabledForContextMenu:false,aApplicableForContextMenu:[],aNotApplicableForContextMenu:[]})}const g=`${t.getPath()}/dynamicActions/${o}/${r}`;if(typeof a==="object"&&a!==null&&a!==undefined){if(e){const n=e.getObject();const o=u(a,"PathInModel",function(e){return n?y(n[e.path]):y(false)},true);const i=A(o);d=d||i==="true";t.getModel().setProperty(g,d);(i==="true"?l:c).push(e)}n.setDynamicActionContexts(t,o,l,c,s)}else{const s=e?.getObject();if(a===null&&!!s[`#${o}`]){t.getModel().setProperty(g,true)}else if(e!==undefined){i.push(n.requestProperty(e,o,a,g))}}return i}};return m},false);
//# sourceMappingURL=ActionRuntime.js.map