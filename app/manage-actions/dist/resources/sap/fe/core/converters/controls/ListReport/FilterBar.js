/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/controls/Common/Table","sap/fe/core/converters/controls/Common/table/Columns","sap/fe/core/converters/controls/ListReport/FilterField","sap/fe/core/converters/controls/ListReport/VisualFilters","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/m/library"],function(t,e,n,a,i,o,r,s,l,c,u,p,f){"use strict";var d={};var g=f.StandardDynamicDateRangeKeys;var y=p.getAssociatedUnitPropertyPath;var h=p.getAssociatedTimezonePropertyPath;var m=p.getAssociatedTextPropertyPath;var v=p.getAssociatedCurrencyPropertyPath;var b=u.getTargetNavigationPath;var P=u.getRelativePaths;var F=u.enhanceDataModelPath;var S=c.isNavigationProperty;var T=c.isMultipleNavigationProperty;var D=c.isEntitySet;var C=c.isComplexType;var E=s.KeyHelper;var O=r.IssueType;var I=r.IssueSeverity;var x=r.IssueCategory;var M=o.insertCustomElements;var N=o.Placement;var R=o.OverrideType;var U=i.getVisualFilters;var A=a.getMaxConditions;var L=n.isFilteringCaseSensitive;var $=n.getTypeConfig;var j=e.getSelectionVariantConfiguration;var k=t.getSelectionVariant;var V=function(t){t["Default"]="Default";t["Slot"]="Slot";return t}(V||{});const w="Edm.String";const q="sap.ui.model.odata.type.String";function H(t){const e={};t.Data.forEach(n=>{if(n.$Type==="com.sap.vocabularies.UI.v1.DataField"){e[n.Value.path]={group:t.fullyQualifiedName,groupLabel:t.Label?.toString()??t.annotations?.Common?.Label?.toString()??t.qualifier}}});return e}function W(t,e){const n=new Set;const a=e.getManifestWrapper().getFilterConfiguration().filterFields??{};const i=new Set([...(e.getDataModelObjectPath().targetEntityType?.annotations?.UI?.SelectionFields??[]).map(t=>t.value),...Object.keys(a).filter(t=>!!a[t].template)]);return new Set(t.map(t=>{const a=t.control.filters;if(!a){return[]}return[...a.hiddenFilters?.paths??[],...a.quickFilters?.paths??[]].map(t=>{const a=t.annotationPath;if(!n.has(a)){n.add(a);const t=j(a,e);if(t){t.propertyNames=t.propertyNames.filter(t=>!i.has(t));return t.propertyNames}}return[]})}).flat(2))}const B=function(t,e){const n=e.split("/");let a;let i="";while(n.length){let e=n.shift();a=a?`${a}/${e}`:e;const o=t.resolvePath(a);if(T(o)){e+="*"}i=i?`${i}/${e}`:e}return i};const K=function(t,e,n,a,i){if(e&&e.targetType===undefined&&(a||e.annotations?.UI?.Hidden?.valueOf()!==true)){const a=i.getAnnotationEntityType(e),o={key:E.getSelectionFieldKeyFromPath(n),annotationPath:i.getAbsoluteAnnotationPath(n),conditionPath:B(t,n),availability:e.annotations?.UI?.HiddenFilter?.valueOf()===true?"Hidden":"Adaptation",label:e.annotations.Common?.Label?.toString()??e.name,group:a.name,groupLabel:a?.annotations?.Common?.Label?.toString()??a.name};G(o);return o}return undefined};const G=function(t){if(t.key==="DraftAdministrativeData::CreationDateTime"||t.key==="DraftAdministrativeData::LastChangeDateTime"){const e=[g.TO,g.TOMORROW,g.NEXTWEEK,g.NEXTMONTH,g.NEXTQUARTER,g.NEXTYEAR];t.settings={operatorConfiguration:[{path:"key",equals:e.join(","),exclude:true}]}}};const X=function(t,e,n,a,i){const o={};if(n){n.forEach(n=>{const r=n.name;const s=(e?`${e}/`:"")+r;const l=K(t,n,s,a,i);if(l){o[s]=l}})}return o};const J=function(t,e,n,a){let i={};if(e){e.forEach(e=>{let o={};const r=F(a.getDataModelObjectPath(),e);const s=r.targetObject;if(s===undefined||!n&&r.navigationProperties.find(t=>t.annotations?.UI?.Hidden?.valueOf()===true)){return}if(S(s)){o=X(t,e,s.targetType.entityProperties,n,a)}else if(C(s.targetType)){o=X(t,e,s.targetType.properties,n,a)}else{o=X(t,b(r,true),[s],n,a)}i={...i,...o}})}return i};const z=function(t,e,n,a){let i=t[e];if(i){delete t[e]}else{i=K(a,a.resolvePath(e),e,true,n)}if(!i){n.getDiagnostics()?.addIssue(x.Annotation,I.High,O.MISSING_SELECTIONFIELD)}if(i){i.availability=i.availability==="Hidden"?"Hidden":"Default";i.isParameter=!!a.annotations?.Common?.ResultContext}return i};const Q=function(t,e,n,a,i){const o=[];const r={};const s=e.entityProperties;i?.forEach(t=>{r[t.value]=true});if(t&&t.length>0){t?.forEach(t=>{const r=t.PropertyName;const s=r?.value;const l={};i?.forEach(t=>{l[t.value]=true});if(s&&!a.has(s)){if(!(s in l)){const t=et(s,n,e);if(t){o.push(t)}}}})}else if(s){s.forEach(t=>{const i=t.annotations?.Common?.FilterDefaultValue;const s=t.name;if(!(s in a)){if(i&&!(s in r)){const t=et(s,n,e);if(t){o.push(t)}}}})}return o};function Y(t){const e=t.getDataModelObjectPath();const n=e.startingEntitySet.entityType;const a=!!n.annotations?.Common?.ResultContext&&!e.targetEntitySet;const i=a&&t.getConverterContextFor(`/${e.startingEntitySet.name}`);return i?n.entityProperties.map(function(t){return z({},t.name,i,n)}):[]}const _=function(t,e,n){const a=e.length===0||e.every(t=>!t.applySupported.enableSearch);const i=t.length===0||t.every(t=>(t.enableAnalytics||t.control.type==="TreeTable")&&!t.enableBasicSearch);const o=n.getContextPath();if(o&&a&&i){return true}else{return false}};d.getFilterBarHideBasicSearch=_;const Z=function(t,e,n){const a=e.getManifestWrapper();const i=a.getContextPath()||(a.getEntitySet()?`/${a.getEntitySet()}`:undefined);const o=tt(e,i,n);let r={};r=a.getFilterConfiguration(o);const s=r?.filterFields||{};const l=J(t,Object.keys(s).map(t=>s[t].property??E.getPathFromSelectionFieldKey(t)),true,e);const c={};for(const n in s){const a=s[n];const i=a.property??E.getPathFromSelectionFieldKey(n);const o=l[i];const r=a.type==="Slot"?V.Slot:V.Default;const u=a&&a?.visualFilter?U(t,e,n,s):undefined;if(a.template||a.type===V.Slot){if(a.settings){a.settings.isCustomFilter=true}else{a.settings={isCustomFilter:true}}}c[n]={key:n,type:r,slotName:a?.slotName||n,annotationPath:o?.annotationPath,conditionPath:a.property?E.getPathFromSelectionFieldKey(n):o?.conditionPath||i,documentRefText:a.property&&e.fetchTextFromMetaModel("{metaModel>"+a.property+"@com.sap.vocabularies.Common.v1.DocumentationRef}"),template:a.template,label:e.fetchTextFromMetaModel(a.label),position:a.position||{placement:N.After},availability:a.availability||"Default",settings:a.settings,visualFilter:u,required:a.required}}return c};d.getManifestFilterFields=Z;const tt=function(t,e,n){let a;const i=t.getContextPath();const o=`${i}/${n}`;if(e&&o?.startsWith(e)&&n){a=o.replace(`${e}/`,"")}else{a=n}return a?a:undefined};const et=function(t,e,n){return z({},t,e,n)};d.getFilterField=et;const nt=function(t,e){let n=[];if(t&&t[e]){n=t[e].map(function(t){return t.value})}return n};d.getFilterRestrictions=nt;const at=function(){return{name:"$search",path:"$search",dataType:q,maxConditions:1}};const it=function(){return{name:"$editState",path:"$editState",groupLabel:"",group:"",dataType:q,hiddenFilter:false}};const ot=function(t){const e=t.getEntitySet();return D(e)?e.annotations.Capabilities?.SearchRestrictions:undefined};const rt=function(t,e){const n=t.getEntitySet()?.annotations?.Capabilities?.NavigationRestrictions;const a=n&&n.RestrictedProperties;return a&&a.find(function(t){return t&&t.NavigationProperty&&t.NavigationProperty.value===e})};d.getNavigationRestrictions=rt;const st=function(t){return{key:t.key,annotationPath:t.annotationPath,conditionPath:t.conditionPath,name:t.conditionPath,label:t.label,hiddenFilter:t.availability==="Hidden",display:"Value",isParameter:t.isParameter,caseSensitive:t.caseSensitive,availability:t.availability,position:t.position,type:t.type,template:t.template,menu:t.menu,required:t.required,isCustomFilter:t.settings?.isCustomFilter}};const lt=function(t,e){t.forEach(t=>{if(e.hasOwnProperty(t.key)&&!e[t.key].label){e[t.key].label=t.label}})};const ct=function(t,e){const n=t?.Common?.Text,a=n&&(t&&t?.Common?.Text?.annotations?.UI?.TextArrangement||e&&e?.UI?.TextArrangement);if(a){if(a.valueOf()==="UI.TextArrangementType/TextOnly"){return"Description"}else if(a.valueOf()==="UI.TextArrangementType/TextLast"){return"ValueDescription"}return"DescriptionValue"}return n?"DescriptionValue":"Value"};d.displayMode=ct;const ut=function(t,e,n){let a=st(e);const i=e.annotationPath;if(!i){return a}const o=t.getConverterContextFor(i).getDataModelObjectPath().targetObject;const r=o?.annotations;const s=t?.getDataModelObjectPath().targetObject?.annotations;const l=n.formatOptions;const c=n.constraints;a=Object.assign(a,{formatOptions:l,constraints:c,display:ct(r,s)});return a};d.fetchPropertyInfo=ut;const pt=function(t){let e=true;switch(t.filterExpression){case"SearchExpression":case"SingleRange":case"SingleValue":e=false;break;default:break}if(t.type&&t.type.indexOf("Boolean")>0){e=false}return e};d.isMultiValue=pt;const ft=function(t){return(t.$Type==="com.sap.vocabularies.UI.v1.DataField"||t.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||t.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath")&&t.Value.path?.includes("/")};const dt=function(t,e,n){const a=t.Value?.$target;if(a){const t=m(a)||v(a)||y(a)||h(a);const i=t?F(e.getDataModelObjectPath(),t).navigationProperties:undefined;if(i?.length){const t=i[0].name;if(!n.includes(t)){n.push(t)}}}};const gt=function(t,e,n){switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.FieldGroupType"){e.Target.$target.Data?.forEach(e=>{gt(t,e,n)})}break;case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":if(ft(e)){const a=P(F(n.getDataModelObjectPath(),e.Value.path),true).join("/");if(!t.includes(a)){t.push(a)}}dt(e,n,t);break;default:break}return t};const yt=function(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let i=arguments.length>4?arguments[4]:undefined;const o=W(e,t);const r=t.getEntityType();const s=n&&t.getEntityTypeAnnotation(n)?.annotation||r.annotations?.UI?.SelectionFields||[];let c=[];if(e.length===0&&!!i){t.getEntityTypeAnnotation(i).annotation?.forEach(e=>{c=gt(c,e,t)})}if(l.isDraftRoot(t.getEntitySet())){c.push("DraftAdministrativeData/CreationDateTime","DraftAdministrativeData/CreatedByUser","DraftAdministrativeData/LastChangeDateTime","DraftAdministrativeData/LastChangedByUser")}const u={...X(r,"",r.entityProperties,a,t),...J(r,c,false,t),...J(r,t.getManifestWrapper().getFilterConfiguration().navigationProperties,a,t)};let p=[];const f=k(r,t);if(f){p=f.SelectOptions}const d=s?.reduce((e,a)=>{const i=a.value;if(!o.has(i)){let a;if(n?.startsWith("@com.sap.vocabularies.UI.v1.SelectionFields")){a=""}else{a=n?.split("/@com.sap.vocabularies.UI.v1.SelectionFields")[0]}const o=a?a+"/"+i:i;const s=z(u,o,t,r);if(s){s.group="";s.groupLabel="";e.push(s)}}return e},[])||[];const g=Q(p,r,t,o,s);return{excludedFilterProperties:o,entityType:r,annotatedSelectionFields:s,filterFields:u,propertyInfoFields:d,defaultFilterFields:g}};const ht=function(t){const e=$(t,t?.type);if(t?.type===w&&(e.constraints.nullable===undefined||e.constraints.nullable===true)){e.formatOptions.parseKeepsEmptyString=false}return e};d.fetchTypeConfig=ht;const mt=function(t,e,n,a){let i=ut(e,t,a[t.key]),o="";if(t.conditionPath){o=t.conditionPath.replace(/\+|\*/g,"")}if(i){i=Object.assign(i,{maxConditions:i.isParameter?1:A(F(e.getDataModelObjectPath(),o)),required:t.required??(i.isParameter||n.includes(o)),caseSensitive:L(e),dataType:a[t.key].type})}return i};d.assignDataTypeToPropertyInfo=mt;const vt=function(t,e,n){const a={};if(n){t=t.concat(n)}t.forEach(function(t){if(t.annotationPath){const n=e.getConverterContextFor(t.annotationPath);const i=n.getDataModelObjectPath().targetObject;const o=ht(i);a[t.key]=o}else{a[t.key]={type:q}}});const i=e.getEntitySet();const o=D(i)?i.annotations.Capabilities?.FilterRestrictions:undefined;const r={};r.RequiredProperties=nt(o,"RequiredProperties")||[];r.NonFilterableProperties=nt(o,"NonFilterableProperties")||[];const s=e.getContextPath();const c=s.split("/");if(c.length>2){const t=c[c.length-1];c.splice(-1,1);const n=rt(e,t);const a=n&&n.FilterRestrictions;r.RequiredProperties=r.RequiredProperties.concat(nt(a,"RequiredProperties")||[]);r.NonFilterableProperties=r.NonFilterableProperties.concat(nt(a,"NonFilterableProperties")||[])}const u=r.RequiredProperties;const p=r.NonFilterableProperties;const f=[];t.forEach(function(t){const n=t.conditionPath.replace(/[+*]/g,"");if(!p.includes(n)){const n=mt(t,e,u,a);f.push(n)}});const d=e.getDataModelObjectPath();const g=e.getManifestWrapper().getSapFeManifestConfiguration()?.app?.hideDraft?.enabled;if(l.isObjectPathDraftSupported(d)){if(bt(e)&&!g){f.push(it())}}const y=ot(e);const h=Boolean(y&&!y.Searchable);if(s&&h!==true){if(!y||y?.Searchable){f.push(at())}}return f};d.processSelectionFields=vt;const bt=function(t){const e=rt(t,"DraftAdministrativeData");return e?.FilterRestrictions?.Filterable===false?false:true};d.showDraftEditStatus=bt;const Pt=function(t,e,n,a){const i=Z(e,n,a);lt(t,i);return M(t,i,{availability:R.overwrite,label:R.overwrite,type:R.overwrite,position:R.overwrite,slotName:R.overwrite,documentRefText:R.overwrite,template:R.overwrite,settings:R.overwrite,visualFilter:R.overwrite,required:R.overwrite})};d.insertCustomManifestElements=Pt;const Ft=t=>{t.sort(function(t,e){const n=t.groupLabel!==undefined&&t.groupLabel!==null;const a=e.groupLabel!==undefined&&e.groupLabel!==null;if(!n&&!a){return 0}if(n&&!a){return-1}if(!n&&a){return 1}return t.groupLabel.localeCompare(e.groupLabel)})};d.sortPropertyInfosByGroupLabel=Ft;const St=function(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";let a=arguments.length>3?arguments[3]:undefined;let i=arguments.length>4?arguments[4]:undefined;const o=yt(t,e,n,a,i);const r=Y(t);let s=o.propertyInfoFields;const l=o.entityType;s=r.concat(s);s=Pt(s,l,t,n);const c=vt(s,t,o.defaultFilterFields);Ft(c);let u=JSON.stringify(c);u=u.replace(/\{/g,"\\{");u=u.replace(/\}/g,"\\}");const p=u;let f=JSON.parse(JSON.stringify(o.propertyInfoFields));f=r.concat(f);const d=o.excludedFilterProperties;const g=l?.annotations?.UI?.FilterFacets;let y={};const h=t.getAnnotationsByTerm("UI","com.sap.vocabularies.UI.v1.FieldGroup");if(g===undefined||g.length<0){for(const t in h){y={...y,...H(h[t])}}}else{y=g.reduce((t,e)=>{for(let n=0;n<e?.Target?.$target?.Data?.length;n++){t[e?.Target?.$target?.Data[n]?.Value?.path]={group:e?.ID?.toString(),groupLabel:e?.Label?.toString()}}return t},{})}const m=o.filterFields;const v=f.concat(Object.keys(m).filter(t=>!d.has(t)).map(t=>Object.assign(m[t],y[t])));const b=Pt(v,l,t,n);const P=L(t);b.forEach(t=>{t.caseSensitive=P});return{selectionFields:b,sPropertyInfo:p}};d.getSelectionFields=St;const Tt=function(t,e,n){const a=nt(e,"RequiredProperties");const i=ot(t);const o=Boolean(i&&!i.Searchable);if(a.length>0||o||n?.FetchValues===2){return true}return false};d.getExpandFilterFields=Tt;return d},false);
//# sourceMappingURL=FilterBar.js.map