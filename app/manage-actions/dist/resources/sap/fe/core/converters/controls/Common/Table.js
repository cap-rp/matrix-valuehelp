/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/CriticalityFormatters","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/EntitySetHelper","sap/fe/macros/formatters/TableFormatter","sap/fe/macros/internal/helpers/ActionHelper","sap/ui/core/Lib","sap/ui/core/message/MessageType","../../ManifestSettings","../../helpers/Aggregation","../../helpers/ID","./Criticality","./table/Columns","./table/StandardActions"],function(e,t,n,a,i,o,r,s,l,c,u,d,f,p,g,y,b,v,h,m,T,C,A,M){"use strict";var P={};var E=M.isInDisplayMode;var I=M.isDraftOrStickySupported;var S=M.getStandardActionPaste;var F=M.getStandardActionMoveUpDown;var D=M.getStandardActionMassEdit;var w=M.getStandardActionInsights;var N=M.getStandardActionDelete;var x=M.getStandardActionCut;var O=M.getStandardActionCreate;var R=M.getStandardActionCopy;var L=M.getRestrictions;var U=M.getMassEditVisibility;var V=M.getInsertUpdateActionsTemplating;var j=M.getDeleteVisibility;var B=M.getCutVisibility;var $=M.getCreationRow;var H=M.generateStandardActionsContext;var q=M.StandardActionKeys;var G=A.updateLinkedProperties;var k=A.getTableColumns;var K=A.getRequiredProperties;var W=A.getColumnsFromEntityType;var z=A.findColumnByPath;var Q=A.ColumnType;var _=C.getMessageTypeFromCriticalityType;var J=T.getTableID;var Y=m.AggregationHelper;var X=h.VisualizationType;var Z=h.VariantManagementType;var ee=h.TemplateType;var te=h.SelectionMode;var ne=h.OperationGroupingMode;var ae=h.CreationMode;var ie=h.ActionType;var oe=p.getRestrictionsOnProperties;var re=f.isPathUpdatable;var se=f.isPathSearchable;var le=f.isPathDeletable;var ce=f.getTargetObjectPath;var ue=f.getNonUpdatableNavigationProperties;var de=f.getHierarchyParentNavigationPropertyPath;var fe=d.criticalityExpressionForIntegrationCards;var pe=u.isPathAnnotationExpression;var ge=u.isNavigationProperty;var ye=u.isAnnotationOfType;var be=c.generate;var ve=s.UI;var he=s.Entity;var me=r.KeyHelper;var Te=o.IssueType;var Ce=o.IssueSeverity;var Ae=o.IssueCategory;var Me=i.insertCustomElements;var Pe=i.Placement;var Ee=i.OverrideType;var Ie=a.removeDuplicateActions;var Se=a.prepareMenuActions;var Fe=a.isMenuAIOperation;var De=a.isActionAIOperation;var we=a.getVisibilityEnablementMenuActions;var Ne=a.getMatchingManifestAction;var xe=a.getEnabledForAnnotationAction;var Oe=a.getCopyAction;var Re=a.getAnnotationMenuActionItems;var Le=a.getActionsFromManifest;var Ue=a.dataFieldIsCopyAction;var Ve=a.addCollaborationCondition;var je=n.visibleExpression;var Be=n.isDataFieldForActionGroup;var $e=n.isDataFieldForActionAbstract;var He=n.isDataField;var qe=t.resolveBindingString;var Ge=t.pathInModel;var ke=t.or;var Ke=t.not;var We=t.isConstant;var ze=t.ifElse;var Qe=t.getExpressionFromAnnotation;var _e=t.formatResult;var Je=t.equal;var Ye=t.constant;var Xe=t.compileExpression;var Ze=t.and;function et(e,t,n,a,i){const o=l.isCollaborationDraftSupportedFromConverterContext(n);const r=At(e,t,n);const s=Le(n.getManifestControlConfiguration(t).actions,n,r.tableActions,i,true);const c=r.tableActions.filter(e=>e.type===ie.Copy);const u=r.tableActions.filter(e=>e.type!==ie.Copy);const d=[...u,a.create,...c,a.delete,a.massEdit,a.insights,a.creationRow,a.cut,a.copy,a.paste,a.moveUp,a.moveDown].filter(e=>e!==undefined);for(const e of Object.values(s.actions)){if((e.type===ie.Default||e.type===ie.Menu)&&!e.position?.anchor){e.position={anchor:q.Create,placement:Pe.Before}}}const f=Object.entries(s.actions);const p=Object.fromEntries(f.filter(e=>{let[t]=e;return t.startsWith("StandardAction::")}));const g=Object.fromEntries(f.filter(e=>{let[t]=e;return!p[t]}));const y={isNavigable:Ee.overwrite,enableOnSelect:Ee.overwrite,enableAutoScroll:Ee.overwrite,enabled:Ee.overwrite,visible:Ee.overwrite,visibleForContextMenu:Ee.overwrite,defaultValuesExtensionFunction:Ee.overwrite,command:Ee.overwrite,position:Ee.overwrite,menu:Ee.overwrite};const b=Re(u);const v=Ne(b,s.actions);const h=Me(b,v,y);let m=Me(d,g,y);m=Me(m,p,{position:Ee.overwrite});Se(m,h);m=Ie(m);m=we(m);if(o){Ve(m)}return{actions:m,commandActions:s.commandActions}}P.getTableActions=et;function tt(e){const t=e.getCustomAggregateDefinitions();const n={};t.forEach(t=>{const a=e._entityType.entityProperties.find(e=>e.name===t.qualifier);if(a){const e=t.annotations?.Aggregation?.ContextDefiningProperties??a.annotations.Aggregation?.ContextDefiningProperties;n[a.name]=e?.map(e=>e.value)??[]}});return n}const nt=function(e,t,n){const a=new Y(e,n);if(!a.isAnalyticsSupported()){return undefined}const i=new Set;t.forEach(e=>{const n=e;if(n.unit){const e=t.find(e=>e.name===n.unit);i.add(e.relativePath)}});const o=tt(a);const r={};t.forEach(n=>{const s=n;const l=e.entityProperties.find(e=>e.name===s.relativePath);if(s.propertyInfos!==undefined||!s.relativePath){return}let c=o[s.relativePath];let u=false;if(!c&&l&&!!a.isPropertyGroupable(l)){u=true;c=l.annotations.Aggregation?.ContextDefiningProperties?.map(e=>e.value)}if(!c||i.has(s.relativePath)){return}r[s.name]={fromGroupableProperty:u,relativePath:s.relativePath};const d=[];c.forEach(e=>{if(!u&&i.has(e)){return}const n=z(e,t);if(n){d.push(n.name)}});if(d.length){r[s.name].additionalProperties=d}});return r};P.getExtensionInfoFromEntityType=nt;function at(t,n,a,i){if(t.control.type==="AnalyticalTable"){const o=nt(n,t.columns,a),r=new Y(n,a);if(o){t.enableAnalytics=true;t.enable$select=false;t.enable$$getKeepAliveContext=false;t.analyticsExtensions=o;Ut(t);const e=r.getAllowedTransformations();t.enableBasicSearch=e?e.includes("search"):true;t.annotation.groupConditions=Lt(i,t.columns,t.control.type);t.annotation.aggregateConditions=Bt(i,t.columns,o)}else{e.error(`Aggregation not supported for this entity type: ${n.name}`)}t.control.type="GridTable"}else if(t.control.type==="ResponsiveTable"){t.annotation.groupConditions=Lt(i,t.columns,t.control.type)}else if(t.control.type==="TreeTable"){const e=new Y(n,a);const i=e.getAllowedTransformations();t.enableBasicSearch=i?i.includes("search"):true;t.enable$$getKeepAliveContext=true;t.annotation.changeSiblingForRootsSupported=n?.annotations.Hierarchy?.[`RecursiveHierarchyActions#${t.control.hierarchyQualifier??""}`]?.ChangeSiblingForRootsSupported??true;t.annotation.allowDropBetweenNodes=!!n.annotations.Hierarchy?.[`RecursiveHierarchyActions#${t.control.hierarchyQualifier??""}`]?.ChangeNextSiblingAction}if(l.isObjectPathDraftSupported(a.getDataModelObjectPath())){t.requestAtLeast["HasActiveEntity"]=["draftKeys"];if(t.control.analyticalConfiguration?.aggregationOnLeafLevel){t.requestAtLeast["IsActiveEntity"]=["draftKeys"]}if(l.isDraftRoot(a.getEntitySet())){t.requestAtLeast["HasDraftEntity"]=["draftKeys"];if(t.enableAnalytics!==true&&t.control.type!=="TreeTable"){t.requestAtLeast["DraftAdministrativeData/InProcessByUser"]=["draftKeys"];if(l.isCollaborationDraftSupportedFromConverterContext(a)&&a.getManifestWrapper().isFclEnabled()){t.requestAtLeast["DraftAdministrativeData/DraftAdministrativeUser"]=["draftKeys"]}}}}if(t.control.enableUploadPlugin){const e=a.getAnnotationEntityType().annotations?.UI?.MediaResource?.Stream?.$target;if(!e){throw"UI.MediaResource annotation with Stream property missing"}const n=t.actions.find(e=>e.key===q.Create);t.annotation.uploadTable={stream:e.name,fileName:e.annotations.Core?.ContentDisposition?.Filename?.path,fileNameMaxLength:e.annotations.Core?.ContentDisposition?.Filename?.$target?.maxLength,acceptableMediaTypes:e.annotations.Core?.AcceptableMediaTypes,maxLength:e.maxLength,uploadAction:n}}}P.updateTableVisualizationForType=at;function it(e,t,n,a){const i=t.getAnnotationEntityType(e);const o={};function r(e,t){if(e&&e.indexOf("/")!==0){if(!o[e]){o[e]=[t]}else{o[e].push(t)}}}function s(e,t){if(e?.length){e.forEach(e=>r(e,t))}}const c=(n||"").split(",");const u=c.filter(function(e){return i.resolvePath(e)});const d=(i.annotations.Common?.SemanticKey||[]).map(e=>e.value);const f=t.getEntitySet()?.annotations?.Capabilities;const p=l.getAlternateAndSecondaryKeys(i,t.getEntitySet());if(a){s(a.RequestAtLeast?.map(e=>e.value),"presentationVariant")}s(ot(e,i),"navigation");s(u,"operation");s(d,"semanticKey");s(p,"alternateAndSecondaryKeys");if(f){r(f.DeleteRestrictions?.Deletable?.path,"restriction");r(f.UpdateRestrictions?.Updatable?.path,"restriction")}return o}P.createRequestedProperties=it;function ot(e,t){const n=[];e.forEach(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&!e.Inline&&!e.Determining&&pe(e.NavigationAvailable)){const a=e.NavigationAvailable.path;if(t.resolvePath(a)){n.push(a)}}});return n}function rt(e,t){const n=e.getManifestWrapper();if(t&&n.getNavigationConfiguration(t)){const e=n.getNavigationConfiguration(t);if(Object.keys(e).length>0){return t}}const a=e.getDataModelObjectPath();const i=e.getContextPath();const o=n.getNavigationConfiguration(i);if(o&&Object.keys(o).length>0){return i}return a.targetEntitySet?a.targetEntitySet.name:a.startingEntitySet.name}P.getNavigationTargetPath=rt;function st(e){const t=e.getAnnotationEntityType()?.annotations?.UI?.HeaderInfo?.Title?.Value?.path;const n=e.getAnnotationEntityType()?.annotations?.Common?.SemanticKey;const a=e?.getAnnotationEntityType()?.annotations?.UI?.HeaderInfo?.TypeName;const i=[];if(n){n.forEach(function(e){i.push(e.value)})}return{headerInfoTitlePath:t,semanticKeyColumns:i,headerInfoTypeName:a}}function lt(e,t,n,a){const{presentationVariantAnnotation:i,isCondensedTableLayoutCompliant:o,selectionVariantAnnotation:r}=a??{};const s=sn(e,t,n,o,r);const{navigationPropertyPath:l}=qt(t);const c=rt(n,l);const u=n.getManifestWrapper().getNavigationConfiguration(c);const d=k(e,s.type,t,n);const f=ut(e,n);const p=st(n);const g=$t(e,t,n,s,u);const y=Ht(e,t,n,s,d,u,g,i);const b=et(e,t,n,g.standardActions,u);const v=ft(f,n);let h=s.header;h??=y.title===""?undefined:y.title;const m={type:X.Table,annotation:y,control:s,actions:b.actions,commandActions:b.commandActions,columns:d,operationAvailableMap:JSON.stringify(f),operationAvailableProperties:v,headerInfoTitle:p.headerInfoTitlePath,semanticKeys:p.semanticKeyColumns,headerInfoTypeName:p.headerInfoTypeName,enable$select:true,enable$$getKeepAliveContext:true,header:h,headerVisible:s.headerVisible,requestAtLeast:it(e,n,v,i),handlePatchSent:n.getManifestWrapper().getTemplateType()!==ee.ListReport};G(n,d);at(m,n.getAnnotationEntityType(e),n,i);return m}P.createTableVisualization=lt;function ct(e,t){const n=sn(undefined,"",e,false);const a=W({},e.getEntityType(),[],e,n.type,n.creationMode,{});const i=ut(undefined,e);const o=st(e);const r=rt(e,"");const s=e.getManifestWrapper().getNavigationConfiguration(r);const l=$t(undefined,"",e,n,s);const c={type:X.Table,annotation:Ht(undefined,"",e,n,t?[]:a,s,l),control:n,actions:[],columns:a,operationAvailableMap:JSON.stringify(i),operationAvailableProperties:ft(i,e),headerInfoTitle:o.headerInfoTitlePath,semanticKeys:o.semanticKeyColumns,headerInfoTypeName:o.headerInfoTypeName,enable$select:true,enable$$getKeepAliveContext:true,header:n.header,headerVisible:n.headerVisible,handlePatchSent:e.getManifestWrapper().getTemplateType()!==ee.ListReport,requestAtLeast:{}};G(e,a);at(c,e.getEntityType(),e);return c}P.createDefaultTableVisualization=ct;function ut(e,t){return y.getOperationAvailableMap(e,"table",t)}function dt(e){const t=L(e);const n=e.getEntitySet();const a=t.isUpdatable;const i=!We(a.expression)&&a.navigationExpression._type==="Unresolvable";const o=n?.annotations.Capabilities?.UpdateRestrictions?.Updatable;const r=pe(o)&&o.path;return i?r:""}function ft(e,t){const n=new Set;for(const t in e){const a=e[t];if(a===null){n.add(t)}else if(typeof a==="string"){n.add(a)}}if(n.size){const e=t.getEntityType();const a=e.annotations?.UI?.HeaderInfo?.Title?.Value?.path;if(a){n.add(a)}}return Array.from(n).join(",")}function pt(e,t,n){const a=[];e.forEach(e=>{if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&e?.ActionTarget?.isBound&&t===e?.ActionTarget.sourceEntityType||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&e.RequiresContext&&e?.Inline?.valueOf()!==true){if(typeof e.annotations?.UI?.Hidden?.valueOf()==="object"){a.push(Je(yt(e,n),false))}}});return a}function gt(e){let t;if(pe(e)){t=e.path}else{t=e}return t}function yt(e,t){const n=e.annotations?.UI?.Hidden;let a=gt(n);if(typeof a==="object"){return Ye(false)}else if(typeof a==="string"){if("visible"in e){a=a.substring(1,a.length-1)}if(a.indexOf("/")>0){const e=a.split("/");const n=e[0];if(ge(t?.targetObject)&&t.targetObject.partner===n){return Ge(e.slice(1).join("/"))}else{return Ye(true)}}else{return Ye(false)}}return Ye(true)}function bt(e,t,n){return Object.keys(n).some(a=>{if(a===e){if(t?.ActionTarget?.isBound||t?.RequiresContext){n[e].requiresSelection=true}return true}return false})}function vt(e,t,n){return e.some(e=>{if((e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")&&e?.Inline?.valueOf()!==true&&(e.annotations?.UI?.Hidden?.valueOf()===false||e.annotations?.UI?.Hidden?.valueOf()===undefined)){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){const a=be(["DataFieldForAction",e.Action]);if(bt(a,e,t)){return false}return e?.ActionTarget?.isBound&&n===e?.ActionTarget.sourceEntityType}else if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(bt(`DataFieldForIntentBasedNavigation::${e.SemanticObject}::${e.Action}`,e,t)){return false}return e.RequiresContext}}else if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"&&(e.annotations?.UI?.Hidden?.valueOf()===false||e.annotations?.UI?.Hidden?.valueOf()===undefined)){return vt(e.Actions,t,n)}return false})}function ht(e){const t=Object.keys(e).reduce((t,n)=>{const a=e[n];if(!a.menu){t.push(a)}else{t=[...t,...a.menu.filter(e=>typeof e!=="string")]}return t},[]);return!!t.find(e=>e.requiresSelection&&(e.visible===undefined||e.visible?.toString()==="true"))}function mt(e){const t=[];if(e){Object.keys(e).forEach(n=>{const a=e[n];if(a.requiresSelection===true&&a.visible!==undefined){if(typeof a.visible==="string"){t.push(qe(a?.visible?.valueOf(),"boolean"))}}})}return t}function Tt(e){const t=le(e.getDataModelObjectPath());const n=re(e.getDataModelObjectPath());return{isDeletable:!(We(t)&&t.value===false),isUpdatable:!(We(n)&&n.value===false)}}P.getCapabilityRestriction=Tt;function Ct(e,t,n,a,i,o){let r=arguments.length>6&&arguments[6]!==undefined?arguments[6]:Ye(false);let s=arguments.length>7&&arguments[7]!==undefined?arguments[7]:Ye(false);const l=n.getManifestControlConfiguration(t);const c=l.tableSettings?.type;let u=l.tableSettings?.selectionMode;if(c==="TreeTable"&&!u){return te.Multi}if(!e||u===te.None){if(i.isDeletable&&o){return Xe(ze(o,Ye(te.Multi),Ye(te.None)))}return te.None}if(u===te.ForceMulti){return te.Multi}else if(u===te.ForceSingle){return te.Single}let d=[],f=[];const p=Le(n.getManifestControlConfiguration(t).actions,n,[],undefined,false);let g,y;if(n.getTemplateType()===ee.ObjectPage){g=le(n.getDataModelObjectPath());y=g?Xe(g,true):g}const b=!We(r)||r.value!==false;if(!u||u===te.Auto){u=te.Multi}if(b){u=u===te.Single?te.Single:te.Multi}if(vt(e,p.actions,n.getEntityType())||ht(p.actions)){return u}d=pt(e,n.getEntityType(),n.getDataModelObjectPath());f=mt(p.actions);if(d.length===0&&f.length===0&&(s||o||b)){if(!a){if(i.isDeletable||y!=="false"||b){const e=ke(s||true,o||true,r);return Xe(ze(Ze(ve.IsEditable,e),Ye(u),Ye(te.None)))}else{return Xe(ze(s,Ye(te.Single),Ye(te.None)))}}else if(b){return u}else if(i.isDeletable&&o){return Xe(ze(o,Ye(u),Ye(te.None)))}else{return te.None}}else if(!a){if(i.isDeletable||y!=="false"||b){const e=ze(b&&!i.isDeletable,r,Ye(true));return Xe(ze(Ze(ve.IsEditable,e),Ye(u),ze(ke(...d.concat(f)),Ye(u),Ye(te.None))))}else{return Xe(ze(ke(...d.concat(f)),Ye(u),Ye(te.None)))}}else if(i.isDeletable||b){return u}else{return Xe(ze(ke(...d.concat(f),r),Ye(u),Ye(te.None)))}}P.getSelectionMode=Ct;function At(e,t,n){const a=[];const i=Oe(e.filter(e=>Ue(e)));if(i){a.push({type:ie.Copy,annotationPath:n.getEntitySetBasedAnnotationPath(i.fullyQualifiedName),key:me.generateKeyFromDataField(i),visible:Xe(je(i,n)),visibleForContextMenu:Xe(Mt(i,n)),text:i.Label?.toString()??b.getResourceBundleFor("sap.fe.core").getText("C_COMMON_COPY"),isNavigable:true})}e.filter(e=>!Ue(e)).forEach(e=>{if($e(e)&&e.Inline?.valueOf()!==true&&e.Determining?.valueOf()!==true){const t=Pt(e,n);if(t){a.push(t)}}else if(Be(e)){const t=Pt(e,n);if(t){a.push(t)}}});return{tableActions:a}}function Mt(e,t){return Ze(je(e,t),Je(Ge("contextmenu/inactiveContext","internal"),false))}function Pt(e,t){let n;let a;switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":n={type:ie.DataFieldForAction,annotationPath:t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:me.generateKeyFromDataField(e),visible:Xe(je(e,t)),visibleForContextMenu:Xe(Mt(e,t)),isNavigable:true,isAIOperation:De(e)===true||undefined};a=t.getEntityType().fullyQualifiedName;if(en(e,a)){n.enabled=xe(t,e.ActionTarget,true)}return n;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":return{type:ie.DataFieldForIntentBasedNavigation,annotationPath:t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:me.generateKeyFromDataField(e),visible:Xe(je(e,t)),visibleForContextMenu:Xe(Mt(e,t))};case"com.sap.vocabularies.UI.v1.DataFieldForActionGroup":return{type:ie.Menu,key:me.generateKeyFromDataField(e),id:me.generateKeyFromDataField(e),text:e.Label?.toString(),visible:Xe(je(e,t)),visibleForContextMenu:Xe(Mt(e,t)),isAIOperation:Fe(e.Actions)===true||undefined,menu:e.Actions.map(e=>Pt(e,t))};default:return}}function Et(e,t,n){let a=v.None;if(e){if(typeof e==="object"){a=Qe(e)}else{a=_(e)}}return _e([a,Ge(`filteredMessages`,"internal"),t&&he.HasActive,t&&he.IsActive,`${t}`,Ge("@$ui5.fe.contextPath"),ve.IsInactive],g.rowHighlighting,n)}function It(t,n,a){const i=a?.create;const o=t.outboundCreation??i?.outbound;const r=o?n.getManifestWrapper().getOutboundNavigationEntries()?.[o]:undefined;if(o&&r){return{mode:"External",outbound:o,outboundDetail:r}}else{if(t.creationMode===ae.External){e.warning(`Cannot find outbound parameters for "External" creation mode. Instead, the default mode "NewPage" is used.`);t.creationMode=ae.NewPage;delete t.outboundCreation}return undefined}}function St(t,n,a,i,o){const r=It(n,a,i);if(r){n.creationMode=ae.External;n.outboundCreation=r.outbound;return r}const s=a.getManifestControlConfiguration(o);const l=s?.tableSettings??{};const c=i?.detail;if(a.getTemplateType()===ee.ListReport&&![ae.NewPage,ae.External,ae.CreationDialog].includes(n.creationMode)){e.warning(`Creation mode '${n.creationMode}' can not be used within the List Report. Instead, the default mode "NewPage" is used.`);n.creationMode=ae.NewPage}else if(a.getTemplateType()!==ee.ListReport&&n.type==="TreeTable"&&![ae.NewPage,ae.Inline,ae.CreationDialog].includes(n.creationMode)){e.warning(`Creation mode '${n.creationMode}' can not be used with a Tree Table. Instead, the default mode "NewPage" is used.`);n.creationMode=ae.NewPage}let u;if(t){const e=a.getEntitySet()?.annotations;const t=e?.Common,i=e?.Session;u=t?.DraftRoot?.NewAction||i?.StickySessionSupported?.NewAction;if(n.creationMode===ae.CreationRow&&u){throw Error(`Creation mode '${ae.CreationRow}' can not be used with a custom 'new' action (${u})`)}if(c?.route){return{mode:n.creationMode,append:n.createAtEnd,newAction:u?.toString(),navigateToTarget:n.creationMode===ae.NewPage?c.route:undefined}}}if(n.creationMode===ae.NewPage){if(a.getTemplateType()===ee.ListReport){e.error("The creation mode 'NewPage' is used but the navigation configuration to the sub page is missing.")}else{n.creationMode=ae.Inline;if(l.creationMode?.createAtEnd===undefined){n.createAtEnd=false}e.info("The creation mode was changed from 'NewPage' to 'Inline' due to missing navigation configuration to the sub page.")}}return{mode:n.creationMode,append:n.createAtEnd,newAction:u?.toString()}}const Ft=function(e,t,n,a,i,o){let r;let s=Ye(v.None);const c=t.getEntityType();const u=e?.annotations?.UI?.Criticality;if(n&&e){const e=n.display?.target||n.detail?.outbound;const o=t.getEntitySet();s=Et(u,!!l.getDraftRoot(o)||!!l.getDraftNode(o),c);if(e){r={type:"Outbound",navigationTarget:e}}if(!e&&n.detail?.route){const e=l.getDraftRoot(o)!==undefined||l.getDraftNode(o)!==undefined;r={type:"Navigation",routePath:n.detail.route,targetPath:a,checkEditable:e,recreateContext:i==="AnalyticalTable"}}}const d=_e([Ge("/deepestPath","internal")],g.navigatedRow,c);return{navigationInfo:r,actionType:r?"Navigation":undefined,rowHighlighting:Xe(s),rowNavigated:Xe(d),rowCriticalityForInsights:u?fe(u):undefined,visible:Xe(Ze(Ke(ve.IsInactive),o?ve.isNodeLevelNavigable:true))}};const Dt=function(e,t,n){const a=`Property_Technical::${e}`;const i=t.find(e=>e.key===a);const o=!i&&t.find(t=>t.name===e&&!t.propertyInfos);if(o){const i={key:a,type:Q.Annotation,label:o.label,annotationPath:o.annotationPath,dataType:"Edm.String",availability:"Hidden",name:a,relativePath:o.relativePath,sortable:false,isGroupable:false,isKey:false,exportSettings:null,caseSensitive:false,aggregatable:false,filterable:false,extension:{technicallyGroupable:true,technicallyAggregatable:true}};t.push(i);n[e]=i.name}};function wt(e,t,n){const a=t.getManifestWrapper();const i=t.getManifestControlConfiguration(e);const o=a.getVariantManagement();const r=[];const s=n.type==="AnalyticalTable";const l=n.type==="ResponsiveTable";if(i?.tableSettings?.personalization!==undefined){const e=i.tableSettings.personalization;if(e===true){switch(n.type){case"AnalyticalTable":return["Sort","Column","Filter","Group","Aggregate"];case"ResponsiveTable":return["Sort","Column","Filter","Group"];default:return["Sort","Column","Filter"]}}else if(typeof e==="object"){if(e.sort){r.push("Sort")}if(e.column){r.push("Column")}if(e.filter){r.push("Filter")}if(e.group&&(s||l)){r.push("Group")}if(e.aggregate&&s){r.push("Aggregate")}return r.length>0?r:undefined}}else{r.push("Sort");r.push("Column");if(t.getTemplateType()===ee.ListReport){if(o===Z.Control||Nt(a,t)){r.push("Filter")}}else{r.push("Filter")}if(s){r.push("Group");r.push("Aggregate")}if(l){r.push("Group")}return r}}P.getP13nMode=wt;function Nt(e,t){return e.isFilterBarHidden()&&!t.getManifestWrapper().hasMultipleVisualizations()&&t.getTemplateType()!==ee.AnalyticalListPage}function xt(e,t,n){const a=oe(e).nonSortableProperties;const i={sorters:[]};if(t?.SortOrder){t.SortOrder.forEach(e=>{const t=e.Property;if(t?.$target!==undefined&&!a.includes(t.$target.name)){const a=Rt([t],n)[0];if(a){i.sorters.push({name:a,descending:!!e.Descending})}}})}return i.sorters.length?i:undefined}function Ot(e){if(!e){return undefined}const t=e.InitialExpansionLevel?.valueOf();return typeof t==="number"?t+1:undefined}function Rt(e,t){const n=[];let a,i;e.forEach(e=>{if(e?.value){a=t.find(t=>{i=t;return!i.propertyInfos&&i.relativePath===e?.value});if(a){n.push(a.name)}}});return n}function Lt(e,t,n){const a={groupLevels:[]};if(e?.GroupBy){let i=e.GroupBy;if(n==="ResponsiveTable"){i=i.slice(0,1)}a.groupLevels=Rt(i,t).map(e=>({name:e}))}return a.groupLevels.length?a:undefined}function Ut(e){const t={};e.columns.forEach(n=>{n=n;const a=Vt(e,n.name);if(a){const t=e.analyticsExtensions[a];n.aggregatable=!t.fromGroupableProperty;n.extension=t??{};if(!n.isGroupable&&!n.aggregatable){delete n.extension.additionalProperties}if(n.isGroupable&&n.extension.additionalProperties&&n.extension.additionalProperties.length){n.isGroupable=false;n.extension.technicallyGroupable=true}}if(n.additionalPropertyInfos?.length){n.additionalPropertyInfos.forEach(n=>{Dt(n,e.columns,t)})}jt(e,n)});e.columns.forEach(e=>{e=e;if(e.additionalPropertyInfos){e.additionalPropertyInfos=e.additionalPropertyInfos.map(e=>t[e]??e);e.propertyInfos=e.propertyInfos?.concat(e.additionalPropertyInfos)}})}function Vt(e,t){return Object.keys(e.analyticsExtensions).find(e=>e===t)}function jt(e,t){if(t.textArrangement?.mode==="Description"&&t.textArrangement.textProperty){const n=Vt(e,t.textArrangement.textProperty);if(n){const a=e.analyticsExtensions[n];if(a.additionalProperties?.length&&a.additionalProperties.includes(t.name)){const n=e.columns.find(e=>e.relativePath===t.relativePath&&e.propertyInfos);n?.propertyInfos?.push(t.name)}}}}function Bt(e,t,n){const a={};if(e?.Total){const n=e.Total;Rt(n,t).forEach(e=>{a[e]={}})}else{for(const e in n){if(!n[e].fromGroupableProperty){a[e]={}}}}return Object.keys(a).length?a:undefined}function $t(e,t,n,a,i){const o=St(e,a,n,i,t);const r=H(n,o.mode,a);const s=B(n,r);const l=j(n,r);const c=U(n,r);const u=V(r,I(n));const d={cut:x(n,r),copy:R(n,r),create:O(n,r),delete:N(n,r),paste:S(n,r,u),massEdit:D(n,r),insights:w(n,r,t),creationRow:$(n,r)};const f={creationBehaviour:o,cutButtonVisibilityExpression:s,deleteButtonVisibilityExpression:l,massEditButtonVisibilityExpression:c,isInsertUpdateActionsTemplated:u,standardActions:d};if(r.tableManifestConfiguration.type==="TreeTable"){f.standardActions.moveUp=F(n,r,true);f.standardActions.moveDown=F(n,r,false)}return f}P.getStandardActionsConfiguration=$t;function Ht(e,t,n,a,i,o,r,s){const l=n.getManifestControlConfiguration(t);const{navigationPropertyPath:c}=qt(t);const u=n.getDataModelObjectPath().targetEntityType.annotations?.UI?.HeaderInfo?.TypeNamePlural;const d=u&&Xe(Qe(u));const f=n.getDataModelObjectPath().targetEntitySet;const p=n.getManifestWrapper();const g=c.length===0;const y=wt(t,n,a);const b=c?J(t):J(n.getContextPath(),"LineItem");const v=Tt(n);const h=rt(n,c);const m=Ct(e,t,n,g,v,r.deleteButtonVisibilityExpression,r.massEditButtonVisibilityExpression,r.cutButtonVisibilityExpression);let T=c?10:30;if(s?.MaxItems){T=s.MaxItems.valueOf()}else if(a.type==="TreeTable"){T=200}else if(a.type==="GridTable"||a.type==="AnalyticalTable"){T=100}const C=p.getVariantManagement();const A=se(n.getDataModelObjectPath());return{id:b,apiId:be([b,"Table"]),entityName:f?f.name:"",entityTypeName:f&&f.entityType?f.entityType.name:"",collection:ce(n.getDataModelObjectPath()),navigationPath:c,row:Ft(e,n,o,h,a.type,a.analyticalConfiguration?.aggregationOnLeafLevel),p13nMode:y,isInsertUpdateActionsTemplated:r.isInsertUpdateActionsTemplated,updatablePropertyPath:dt(n),displayMode:E(n,true),create:r.creationBehaviour,selectionMode:m,variantManagement:C==="Control"&&!y?Z.None:C,threshold:T,sortConditions:xt(n,s,i),title:d,searchable:l.tableSettings?.isSearchable===false?false:a.type!=="AnalyticalTable"&&!(We(A)&&A.value===false),initialExpansionLevel:Ot(s),requiredProperties:K(n).filter(e=>e?.$target?.type!=="Edm.Boolean").map(e=>e.value)}}P.getTableAnnotationConfiguration=Ht;function qt(e){const[t,n]=e.split("@");let a=t;if(a.lastIndexOf("/")===a.length-1){a=a.substring(0,a.length-1)}return{navigationPropertyPath:a,annotationPath:n}}P.splitPath=qt;function Gt(e,t){const n=t.getEntityTypeAnnotation(e);const a=n.annotation;if(a){const e=[];a.SelectOptions?.forEach(t=>{const n=t.PropertyName;const a=n?.value??"";if(!e.includes(a)){e.push(a)}});return{text:a?.Text?.toString(),propertyNames:e}}return undefined}P.getSelectionVariantConfiguration=Gt;function kt(e,t,n){let a=e.enableFullScreen??n;if(!n&&a&&t.getTemplateType()===ee.ListReport){a=false;t.getDiagnostics().addIssue(Ae.Manifest,Ce.Low,Te.FULLSCREENMODE_NOT_ON_LISTREPORT)}return a}function Kt(e,t,n){let a;if(t!=="ResponsiveTable"){return undefined}switch(n.getTemplateType()){case ee.ListReport:case ee.ObjectPage:a=e.selectAll===false?"ClearAll":"Default";if(n.getTemplateType()===ee.ObjectPage&&n.getManifestWrapper().useIconTabBar()){a=!e.selectAll?"ClearAll":"Default"}break;case ee.AnalyticalListPage:a=!e.selectAll?"ClearAll":"Default";break;default:}return a}function Wt(e,t,n){if(e!=="ResponsiveTable"){if(n){return{rowCountMode:"Auto",rowCount:3}}else{return{rowCountMode:t.rowCountMode??"Fixed",rowCount:t.rowCount??(e==="GridTable"?5:10)}}}else{return{}}}function zt(e,t){return t.condensedTableLayout!==undefined&&e!=="ResponsiveTable"?t.condensedTableLayout:false}function Qt(e){return e.selectAll===true||e.selectionLimit===0?0:e.selectionLimit||200}function _t(e){return e.creationMode?.inlineCreationRowCount?e.creationMode?.inlineCreationRowCount:1}function Jt(e,t,n){return e.enableExport!==undefined?e.enableExport:t.getTemplateType()!=="ObjectPage"||n}function Yt(e){return e.frozenColumnCount}function Xt(e){return e.widthIncludingColumnHeader??false}function Zt(e,t,n,a){let i=false;const o={};const r=n.getAnnotationEntityType(t);if(e.quickVariantSelection){const t=(e.quickVariantSelection.paths??[]).reduce((e,t)=>{if(r.resolvePath(t.annotationPath)){e.push({annotationPath:t.annotationPath})}return e},[]);if(t.length){o.quickFilters={showCounts:e.quickVariantSelection.showCounts,paths:t}}}if(a){o.hiddenFilters={paths:[{annotationPath:`@${a.fullyQualifiedName.split("@")[1]}`}]}}i=!!e.quickVariantSelection?.hideTableTitle;return{filters:o,headerVisible:!(o?.quickFilters&&i)}}function en(e,t){let n=false;if(e.ActionTarget?.annotations?.Core?.OperationAvailable!==undefined){const a=e.ActionTarget?.isBound;const i=a&&e.ActionTarget?.sourceType!==t;const o=e.ActionTarget?.parameters[0]?.isCollection;if(!a||i||o){n=true}}return n}function tn(e,t,n){const a=n.getDataModelObjectPath();e.hierarchyQualifier=t.hierarchyQualifier;const i=de(a,e.hierarchyQualifier);const o=ue(a);e.isHierarchyParentNodeUpdatable=!o?.includes(i);e.isNodeMovable=nn(t.isNodeMovable,e);e.isNodeCopyable=nn(t.isNodeCopyable,e);e.isMoveToPositionAllowed=nn(t.isMoveToPositionAllowed,e);e.isCopyToPositionAllowed=nn(t.isCopyToPositionAllowed,e);e.createEnablement=nn(t.creationMode?.isCreateEnabled,e);if(t.creationMode?.nodeType?.propertyName&&t.creationMode?.nodeType?.values){const a=t.creationMode.nodeType.values;e.nodeType={propertyName:t.creationMode.nodeType.propertyName,values:Object.keys(a).map(t=>{const i=a[t];if(typeof i==="string"){return{value:t,text:i}}else{return{value:t,text:i.label,creationDialogFields:e.creationMode===ae.CreationDialog?rn(i.creationFields,n):undefined}}})}}if(t.creationMode?.createInPlace){e.createInPlace=true}}function nn(e,t){if(!e){return undefined}const n=e.lastIndexOf(".")||-1;const a=e.substring(0,n).replace(/\./gi,"/");const i=e.substring(n+1);if(!a.startsWith("/extension/")){if(!t.additionalRequiredModules){t.additionalRequiredModules=[a]}else if(!t.additionalRequiredModules.includes(a)){t.additionalRequiredModules.push(a)}}return{moduleName:a,methodName:i}}P.getCustomFunctionInfo=nn;function an(e){return e?.tableSettings?.disableRequestCache}function on(e,t){const n={visibleFields:[],ignoredFields:[],operationGroupingMode:t.getTemplateType()===ee.ListReport?ne.Isolated:ne.ChangeSet};if(!e.enableMassEdit){return{enabled:false,...n}}if(e.enableMassEdit===true){return{enabled:e.enableMassEdit,...n}}else if(typeof e.enableMassEdit==="object"){return{enabled:true,visibleFields:rn(e.enableMassEdit.visibleFields,t),ignoredFields:rn(e.enableMassEdit.ignoredFields,t),operationGroupingMode:e.enableMassEdit.operationGroupingMode&&Object.values(ne).includes(e.enableMassEdit.operationGroupingMode)?e.enableMassEdit.operationGroupingMode:n.operationGroupingMode,customFragment:e.enableMassEdit.customFragment,fromInline:e.enableMassEdit.fromInline}}return{enabled:false,...n}}P.getMassEditSettings=on;function rn(e,t){if(!e){return[]}if(e.includes("com.sap.vocabularies.UI.v1.FieldGroup")){e=e.startsWith("@")?e:`@${e}`;const n=t.getEntityTypeAnnotation(e);if(ye(n.annotation,"com.sap.vocabularies.UI.v1.FieldGroupType")){return n.annotation.Data.reduce((e,t)=>{if(He(t)&&pe(t.Value)){e.push(t.Value.path)}return e},[])}return[]}return e.replace(/\s/g,"").split(",").map(e=>e.trim())}function sn(e,t,n){let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;let i=arguments.length>4?arguments[4]:undefined;const o=n.getManifestWrapper();const r=n.getManifestControlConfiguration(t);const s=r?.tableSettings??{};const l=o.getSapFeManifestConfiguration();const c=l?.macros?.table?.defaultCreationMode==="InlineCreationRows"?ae.InlineCreationRows:undefined;const u=s.creationMode?.name??c??ae.NewPage;const d=!o.isPhone();const f=s.disableCopyToClipboard;const p=n.getTemplateType();const g=a&&o.isCondensedLayoutCompliant();const y=e?Zt(s,e,n,i):{};const b=s.creationMode?.customValidationFunction;const v=s.exportRequestSize;const h=ln(n,r);const m=s.analyticalConfiguration;const T=s.enablePaste??(n.getTemplateType()==="ObjectPage"||h==="TreeTable"&&n.getEntitySet()?.annotations.Common?.DraftRoot!==undefined);const C=Wt(h,s,p===ee.ListReport);const A=h!=="ResponsiveTable"?300:undefined;const M=zt(h,s);let P=false;if(s.creationMode?.inlineCreationRowsHiddenInEditMode){P=typeof s.creationMode?.inlineCreationRowsHiddenInEditMode==="string"?s.creationMode?.inlineCreationRowsHiddenInEditMode==="true":s.creationMode?.inlineCreationRowsHiddenInEditMode}let E;if(n.getTemplateType()==="ListReport"){E="illustratedMessage-Auto"}else{E=o.getUseTextForNoDataMessages()?"text":"illustratedMessage-ExtraSmall"}const I={createAtEnd:s.creationMode?.createAtEnd!==undefined?s.creationMode?.createAtEnd:![ae.Inline,ae.CreationDialog].includes(u),creationMode:u,creationDialogFields:u===ae.CreationDialog?rn(s.creationMode?.creationFields,n):undefined,customValidationFunction:b,hasDataStateIndicatorFilter:p===ee.ListReport,disableAddRowButtonForEmptyData:!b?!!s.creationMode?.disableAddRowButtonForEmptyData:false,enableAutoColumnWidth:d,enablePastingOfComputedProperties:s.enablePastingOfComputedProperties,ignoredFields:s.ignoredFields,readOnly:s.readOnly,enableExport:Jt(s,n,T),analyticalConfiguration:m,frozenColumnCount:Yt(s),widthIncludingColumnHeader:Xt(s),enableFullScreen:kt(s,n,o.isPhone()),massEdit:on(s,n),enableAddCardToInsights:s?.enableAddCardToInsights,enablePaste:T,disableCopyToClipboard:f,headerVisible:true,header:s.header,multiSelectMode:Kt(s,h,n),selectionLimit:Qt(s),inlineCreationRowCount:_t(s),inlineCreationRowsHiddenInEditMode:P,showRowCount:s?.quickVariantSelection?.paths?false:!o.getViewConfiguration()?.showCounts,type:h,disableRequestCache:an(r),useCondensedTableLayout:M&&g,isCompactType:o.isCompactType(),exportRequestSize:v,enableUploadPlugin:!!n.getAnnotationEntityType().annotations?.UI?.MediaResource?.Stream,modeForNoDataMessage:E,scrollThreshold:s.scrollThreshold??A};const S={...I,...C,...y};S.beforeRebindTable=s.beforeRebindTable;S.selectionChange=s.selectionChange;S.rowPress=s.rowPress;if(h==="TreeTable"){tn(S,s,n)}if(s.headerVisible!==undefined){S.headerVisible=s.headerVisible}if(S.creationMode===ae.External){S.outboundCreation=s.creationMode?.outbound}return S}P.getTableManifestConfiguration=sn;function ln(e,t){if(t?.tableSettings?.type){return t.tableSettings.type}return"ResponsiveTable"}return{getTableActions:et,createTableVisualization:lt,createDefaultTableVisualization:ct,getCapabilityRestriction:Tt,getSelectionMode:Ct,getP13nMode:wt,getStandardActionsConfiguration:$t,getTableAnnotationConfiguration:Ht,splitPath:qt,getSelectionVariantConfiguration:Gt,getTableManifestConfiguration:sn,updateTableVisualizationForType:at,createRequestedProperties:it,getNavigationTargetPath:rt,getCustomFunctionInfo:nn}},false);
//# sourceMappingURL=Table.js.map