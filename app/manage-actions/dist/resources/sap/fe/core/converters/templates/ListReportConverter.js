/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/ListReport/FilterBar","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/helpers/StableIdHelper","../../helpers/TypeGuards","../ManifestSettings","../controls/Common/DataVisualization","../controls/Common/KPI","../helpers/ID"],function(t,e,n,i,a,o,r,s,l,c){"use strict";var u={};var f=c.getTableID;var d=c.getIconTabBarID;var p=c.getFilterVariantManagementID;var y=c.getFilterBarID;var h=c.getDynamicListReportID;var m=c.getCustomTabID;var g=c.getChartID;var v=l.getKPIDefinitions;var C=s.isSelectionPresentationCompliant;var b=s.isPresentationCompliant;var T=s.getSelectionVariant;var P=s.getSelectionPresentationVariant;var w=s.getDefaultLineItem;var I=s.getDefaultChart;var S=s.getDataVisualizationConfiguration;var V=r.VisualizationType;var E=r.VariantManagementType;var M=r.TemplateType;var z=o.isAnnotationOfType;var D=a.generate;var F=i.insertCustomElements;var A=n.showDraftEditStatus;var L=n.getSelectionFields;var x=n.getManifestFilterFields;var k=n.getFilterBarHideBasicSearch;var B=e.getActionsFromManifest;var H=t.getExpressionFromAnnotation;var R=t.compileExpression;var W=function(t){t["Multi"]="Multi";t["Combined"]="Combined";t["Custom"]="Custom";t["Default"]="Default";return t}(W||{});var $=function(t){t["SingleTable"]="SingleTable";t["SingleChart"]="SingleChart";t["Combined"]="Combined";t["Custom"]="Custom";return t}($||{});const O=function(t,e){return t.type===e};const j=function(t,e){return t.viewType===e};function U(t){const e=[];t.forEach(function(t){if(!j(t,$.Custom)){const n=j(t,$.Combined)?t.secondaryVisualization.visualizations:t.presentation.visualizations;n.forEach(function(t){if(t.type===V.Table){e.push(t)}})}});return e}function N(t){const e=[];t.forEach(function(t){if(!j(t,$.Custom)){const n=j(t,$.Combined)?t.primaryVisualization.visualizations:t.presentation.visualizations;n.forEach(function(t){if(t.type===V.Chart){e.push(t)}})}});return e}const Q=function(t){const e={};for(const n in t){if(t[n]?.settings?.defaultValues?.length){e[n]=t[n]?.settings?.defaultValues}}return e};function K(t,e,n){const i=e.getManifestWrapper().getDefaultTemplateAnnotationPath();const a=P(t,i,e);const o="ALP flavor needs both chart and table to load the application";if(a){if(i){const t=a.PresentationVariant;if(!t){throw new Error("Presentation Variant is not configured in the SPV mentioned in the manifest")}if(!b(t,n)){if(n){throw new Error(o)}return undefined}}if(C(a,n)===true){return a}else if(n){throw new Error(o)}}const r=t.annotations?.UI?.PresentationVariant;if(r){if(b(r,n)){return r}else if(n){throw new Error(o)}}if(!n){return w(t)}return undefined}const q=function(t,e,n){const i=J(t[0],true);const a=J(t[1]?t[1]:t[0],false);if(i&&a){const t={primaryVisualization:i,secondaryVisualization:a,tableControlId:a.visualizations[0]?.type===V.Table?a.visualizations[0].annotation?.id:"",chartControlId:i.visualizations[0]?.type===V.Chart?i.visualizations[0].id:"",defaultPath:e,viewType:$.Combined,visible:O(n,W.Multi)?n.visible:undefined};return t}};const G=function(t,e,n){const i=_(e,V.Table)?.annotation.id;const a={presentation:e,title:tt(t,n),selectionVariantPath:et(n),visible:O(n,W.Multi)?n.visible:undefined};if(i){return{...a,...{tableControlId:i,viewType:$.SingleTable}}}return{...a,...{chartControlId:_(e,V.Chart)?.id,viewType:$.SingleChart}}};const J=function(t,e){const n=Object.assign({},t);const i=t.visualizations.find(t=>!!e&&t.type===V.Chart||!e&&t.type===V.Table);if(i){n.visualizations=[i]}else{const t=e?{visualization:"Primary",type:"chart"}:{visualization:"Secondary",type:"table"};throw new Error(`${t.visualization} visualization needs valid ${t.type}`)}return n};const X=function(t,e,n){const i=t.getEntityTypeAnnotation(e.annotationPath);const a=i.annotation;t=i.converterContext;const o=a;if(o||t.getTemplateType()===M.AnalyticalListPage){return S(o?t.getRelativeAnnotationPath(o.fullyQualifiedName,t.getEntityType()):"",t,{isCondensedTableLayoutCompliant:true,shouldCreateTemplateChartVisualization:true})}else{throw new Error(`Annotation Path for the ${n?"primary":"secondary"} visualization mentioned in the manifest is not found`)}};const Y=function(t,e){for(const n of t.visualizations){switch(n.type){case V.Table:const t=n.control.filters||{};t.hiddenFilters=t.hiddenFilters||{paths:[]};if(!e.keepPreviousPersonalization){n.annotation.id=f(e.key??"","LineItem");n.annotation.apiId=D([n.annotation.id,"Table"])}break;case V.Chart:n.id=g(e.key||"","Chart");n.multiViews=true;break;default:break}}};const Z=function(t){return{title:t.label,fragment:t.template,type:t.type,customTabId:m(t.key??""),visible:t.visible,viewType:$.Custom}};const _=function(t,e){return t.visualizations.find(t=>t.type===e)};const tt=function(t,e){if(O(e,W.Multi)){const n=t.getEntityTypeAnnotation(e.annotationPath).annotation;return R(H(n.Text))}return""};const et=function(t){if(O(t,W.Multi)){return t.annotation&&z(t.annotation,"com.sap.vocabularies.UI.v1.SelectionPresentationVariantType")?`@${t.annotation.SelectionVariant?.fullyQualifiedName.split("@")[1]}`:t.annotationPath}return undefined};const nt=function(t){if(!O(t,W.Custom)){return!O(t,W.Combined)&&t.annotation?t.converterContext.getRelativeAnnotationPath(t.annotation.fullyQualifiedName,t.converterContext.getEntityType()):""}return""};const it=function(t){if(!O(t,W.Custom)){const e=t.converterContext;const n=O(t,W.Multi)?{associatedSelectionVariant:t.selectionVariant,isMacroOrMultipleView:true}:{};const i=S(nt(t),e,{...{isCondensedTableLayoutCompliant:true},...n});if(!O(t,W.Combined)&&i.visualizations.length===2&&e.getTemplateType()===M.AnalyticalListPage){const e=q([i],"both",t);if(e){return e}}else if(O(t,W.Combined)){const{primary:n,secondary:i}=t;if(n?.length&&i?.length){const a=q([X(e,n[0],true),X(e,i[0],false)],t.defaultPath,t);if(a){return a}}else if(e.getTemplateType()===M.AnalyticalListPage){throw new Error("SecondaryItems in the Views is not present")}}else if(O(t,W.Multi)){Y(i,t)}const a=G(e,i,t);a.presentation.inMultiView=!!n.isMacroOrMultipleView;return a}else{return Z(t)}};const at=function(t,e){let n=[];const i=t.getManifestWrapper();if(e){e.paths.forEach(a=>{if(i.isCombinedViewConfiguration(a)){if(e.paths.length>1){throw new Error("ALP flavor cannot have multiple views")}else{n.push({converterContext:t,primary:a.primary,secondary:a.secondary,defaultPath:a.defaultPath,type:W.Combined})}}else if(i.isCustomViewConfiguration(a)){n.push({key:a.key,label:a.label,template:a.template,type:W.Custom,visible:a.visible})}else{const e=t.getConverterContextFor(a.contextPath||a.entitySet&&`/${a.entitySet}`||t.getContextPath()),i=e.getEntityType();if(i&&e){let t;const o=e.getEntityTypeAnnotation(a.annotationPath);const r=o.annotation;if(r){t=r.term==="com.sap.vocabularies.UI.v1.SelectionVariant"?K(i,e,false):r;n.push({selectionVariant:r.term==="com.sap.vocabularies.UI.v1.SelectionVariant"?r:undefined,converterContext:e,annotation:t,annotationPath:a.annotationPath,keepPreviousPersonalization:a.keepPreviousPersonalization,key:a.key,visible:a.visible,type:W.Multi})}}else{}}})}else{const e=t.getEntityType();if(t.getTemplateType()===M.AnalyticalListPage){n=rt(t,n)}else{n.push({annotation:K(e,t,false),converterContext:t,type:W.Default})}}return n.map(t=>it(t))};const ot=function(t,e){const n=t.getManifestWrapper();const i=n.getViewConfiguration();if(e.length>1&&!st(t)){return{showTabCounts:i?i.showCounts??n.hasMultipleEntitySets():undefined,id:d()}}return undefined};function rt(t,e){const n=t.getEntityType();const i=K(n,t,true);let a,o;if(i){e.push({annotation:i,converterContext:t,type:W.Default})}else{a=I(n);o=w(n);if(a&&o){const n=[{annotationPath:"@"+a.term}];const i=[{annotationPath:"@"+o.term}];e.push({converterContext:t,primary:n,secondary:i,defaultPath:"both",type:W.Combined})}else{throw new Error("ALP flavor needs both chart and table to load the application")}}return e}function st(t){return t.getManifestWrapper().hasMultipleVisualizations()||t.getTemplateType()===M.AnalyticalListPage}const lt=function(t){const e=t.getManifestWrapper();return F([],B(e.getHeaderActions(),t).actions)};u.getHeaderActions=lt;const ct=function(t,e){t.forEach(t=>{if(!j(t,$.Custom)&&!j(t,$.Combined)){t.presentation.visualizations.forEach(t=>{if(t.type===V.Chart&&t.filterId!==e){t.filterId=e}})}})};const ut=function(t,e){const n=t.getEntityType();const i=t.getContextPath();if(!i){throw new Error("An EntitySet is required to be able to display a ListReport, please adjust your `entitySet` property to point to one.")}const a=t.getManifestWrapper();const o=a.getViewConfiguration();const r=a.hasMultipleEntitySets();const s=at(t,o);const l=U(s);const c=N(s);const u=l.some(t=>t.control.type==="ResponsiveTable");let f="";let d="";const m=h();const g=y(i);const C=p(g);const b=a.getFilterConfiguration();const P=b?.initialLayout!==undefined?b?.initialLayout.toLowerCase():"compact";const w=b?.layout!==undefined?b?.layout.toLowerCase():"compact";const I=b.useSemanticDateRange!==undefined?b.useSemanticDateRange:true;const S=b.showClearButton!==undefined?b.showClearButton:false;const V=ft(s);if(V){d=V.chartId;f=V.tableId}const M=a.useHiddenFilterBar();const z=(a.isFilterBarHidden()||M)&&d==="";const D=L(t,l);const F=D.selectionFields;const B=D.sPropertyInfo;const H=k(l,c,t);const R=ot(t,s);const W=R?undefined:T(n,t);const $=I?Q(x(n,t)):{};const O=lt(t);if(r){ct(s,g)}const j=l.map(t=>t.annotation.apiId).concat(c.map(t=>t.apiId));const K=[...z&&!M?[]:[g],...a.getVariantManagement()!==E.Control?j:[],...R?[R.id]:[]];const q=R&&a.getStickyMultiTabHeaderConfiguration()?R.id:undefined;const G=e?.HiddenDraft?.enabled||l.every(t=>t.control.type==="TreeTable"||t.enableAnalytics||t.annotation.collection!==i);return{mainEntitySet:i,mainEntityType:`${i}/`,multiViewsControl:R,stickySubheaderProvider:q,singleTableId:f,singleChartId:d,dynamicListReportId:m,headerActions:O,easyFilterEnabled:!z&&e?.MagicFiltering,showPinnableToggle:u,filterBar:{propertyInfo:B,selectionFields:F,hideBasicSearch:H,showClearButton:S,disableDraftEditStateFilter:G,showDraftEditStatus:A(t)},views:s,filterBarId:z&&!M?"":g,filterConditions:{selectionVariant:W,defaultSemanticDates:$},variantManagement:{id:C,targetControlIds:K.join(",")},hasMultiVisualizations:st(t),templateType:a.getTemplateType(),useSemanticDateRange:I,filterInitialLayout:P,filterLayout:w,kpiDefinitions:v(t),hideFilterBar:z,useHiddenFilterBar:M,collapsedHeaderFragment:a.getCollapsedHeaderFragment(),expandedHeaderFragment:a.getExpandedHeaderFragment()}};u.convertPage=ut;function ft(t){const e=t.find(t=>(j(t,$.Combined)||j(t,$.SingleTable))&&!!t.tableControlId)?.tableControlId??"",n=t.find(t=>(j(t,$.Combined)||j(t,$.SingleChart))&&!!t.chartControlId)?.chartControlId??"";if(e||n){return{chartId:n,tableId:e}}return undefined}return u},false);
//# sourceMappingURL=ListReportConverter.js.map