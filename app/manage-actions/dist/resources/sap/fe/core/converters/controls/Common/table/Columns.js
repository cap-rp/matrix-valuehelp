/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/helpers/Aggregation","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/DataFieldHelper","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/DisplayModeFormatter","sap/fe/core/templating/EntitySetHelper","sap/fe/core/templating/FieldControlHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/formatters/TableFormatter"],function(e,t,n,a,i,o,r,s,l,c,u,p,f,d,m,g,y,v,h){"use strict";var b={};var I=v.isMultiValueField;var P=y.isTimezone;var T=y.getStaticUnitOrCurrency;var D=y.getStaticTimezone;var F=y.getAssociatedUnitPropertyPath;var S=y.getAssociatedUnitProperty;var C=y.getAssociatedTimezoneProperty;var O=y.getAssociatedTextPropertyPath;var U=y.getAssociatedTextProperty;var A=y.getAssociatedCurrencyPropertyPath;var $=y.getAssociatedCurrencyProperty;var x=g.isStaticallyMandatory;var E=g.hasFieldControlNotMandatory;var M=m.getRestrictionsOnProperties;var V=d.getDisplayMode;var N=f.getTargetObjectPath;var L=f.getContextRelativeTargetObjectPath;var w=f.getContextPropertyRestriction;var H=f.enhanceDataModelPath;var k=p.isTypeDefinition;var j=p.isProperty;var G=p.isPathAnnotationExpression;var B=p.isNavigationProperty;var R=p.isAnnotationOfType;var z=u.replaceSpecialChars;var K=l.UI;var _=s.KeyHelper;var Q=r.IssueSeverity;var W=r.IssueCategoryType;var q=r.IssueCategory;var Y=o.isReferencePropertyStaticallyHidden;var J=i.insertCustomElements;var X=i.Placement;var Z=i.OverrideType;var ee=a.AggregationHelper;var te=n.isRatingVisualizationFromDataFieldDefault;var ne=n.isDataPointFromDataFieldDefault;var ae=n.isDataFieldTypes;var ie=n.isDataFieldForAnnotation;var oe=n.isDataField;var re=n.hasFieldGroupTarget;var se=n.hasDataPointTarget;var le=n.getTargetValueOnDataPoint;var ce=n.getSemanticObjectPath;var ue=n.getDataFieldDataType;var pe=n.collectRelatedPropertiesRecursively;var fe=n.collectRelatedProperties;var de=t.TemplateType;var me=t.Importance;var ge=t.HorizontalAlign;var ye=t.CreationMode;var ve=e.pathInModel;var he=e.or;var be=e.not;var Ie=e.ifElse;var Pe=e.getExpressionFromAnnotation;var Te=e.formatResult;var De=e.equal;var Fe=e.constant;var Se=e.compileExpression;var Ce=e.and;var Oe=e.EDM_TYPE_MAPPING;let Ue=function(e){e["Default"]="Default";e["Annotation"]="Annotation";e["Slot"]="Slot";e["Computed"]="Computed";return e}({});b.ColumnType=Ue;function Ae(e,t,n,a){const i=dt(e,t,n,a);const o=Pt(a.getManifestControlConfiguration(n).columns??{},i,a,a.getAnnotationEntityType(e));const r=J(i,o,{width:Z.overwrite,widthIncludingColumnHeader:Z.overwrite,importance:Z.overwrite,horizontalAlign:Z.overwrite,availability:Z.overwrite,isNavigable:Z.overwrite,settings:Z.overwrite,formatOptions:Z.overwrite,exportSettings:Z.overwrite});return Tt(r,t,n,a)}b.getTableColumns=Ae;function $e(e,t){return t.find(t=>{const n=t;return n.propertyInfos===undefined&&n.relativePath===e})}b.findColumnByPath=$e;function xe(e,t){const n=e.getConverterContextFor(e.getContextPath()).getDataModelObjectPath();t.forEach(e=>{const a=e;if(a.propertyInfos===undefined&&a.relativePath){const e=H(n,a.relativePath);const i=e.targetObject;if(i){Ee(i,e,t,a);const n=C(i);const o=i?.annotations?.Common?.Timezone;if(n){const e=$e(n.name,t);a.timezone=e?.name}else if(o){a.timezoneText=o.toString()}Me(i,e,t,a)}}})}b.updateLinkedProperties=xe;function Ee(e,t,n,a){const i=A(e)||F(e);if(i){const e=H(t,i);const o=L(e);if(o){const e=$e(o,n);a.unit=e?.name}}else{const t=e?.annotations?.Measures?.ISOCurrency||e?.annotations?.Measures?.Unit;if(t){a.unitText=`${t}`}}}function Me(e,t,n,a){const i=V(e),o=O(e);if(o&&i!=="Value"){const e=H(t,o);const r=L(e);if(r){const e=$e(r,n);if(e&&e.name!==a.name){a.textArrangement={textProperty:e.name,mode:i};if(!e.exportSettings){e.exportSettings={type:"String"}}}}}}const Ve=function(e,t,n,a,i,o,r,s){if(n===undefined){n=[]}let l=[];const c=new ee(t,a);const u=c.getGroupableProperties();if(i==="AnalyticalTable"&&c.isAnalyticsSupported()&&u){l=u.map(e=>e.$target).filter(e=>e!==undefined).map(e=>U(e)).filter(e=>e&&!c.isPropertyGroupable(e)).map(e=>e?.name).filter(e=>e!==undefined)}t.entityProperties.forEach(t=>{const u=n.some(e=>e.name===t.name);if(!t.targetType&&!u&&!l.includes(t.name)){const l=fe(t.name,t,a,true,i);const u=Object.keys(l.properties);const p=Object.keys(l.additionalProperties);u.forEach(e=>{$t(r,l,e)});const f=Ne(t,a.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),t.name,true,true,c,a,r,s,o,l);if(u.length>0){f.propertyInfos=u;if(l.exportSettings.dataPointTargetValue){f.exportDataPointTargetValue=l.exportSettings.dataPointTargetValue}u.forEach(t=>{e[t]=l.properties[t].annotationProperty})}je(n,e,f);if(p.length>0){f.additionalPropertyInfos=p;p.forEach(t=>{e[t]=l.additionalProperties[t]})}n.push(f)}if(V(t)==="Description"){s?.nonSortableProperties.push(t.name);if(G(t?.annotations?.Common?.Text)){n.push(Ne(t,a.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),t.name,false,false,c,a,r,s,o))}}});const p=We(e,n,a,t,r,o,s);return n.concat(p)};b.getColumnsFromEntityType=Ve;const Ne=function(e,t,n,a,i,o,r,s,l,u,p,f){const d=ce(r,e);const m=Y(e);const g=e.name?Xe(e.name,true,false):undefined;const y=g!=e.name;const v=Ke(e,y);const h=ue(e);const b=At(e,h);const I=s[n]==="Description";const P=(!m||I)&&!l?.nonSortableProperties.includes(n);const T=!I&&!l?.nonFilterableProperties.includes(n);const D={className:e.type||h,formatOptions:b.formatOptions,constraints:b.constraints};let F=null;if(Ge(e)){F=Le(e,p)}const S=!m&&(i||s[n])?"Adaptation":"Hidden";const C=Ot(n,r);if(f){n=f}const O=a?n:`Property::${n}`;const U=(a?"DataField::":"Property::")+z(n);const A={key:U,type:Ue.Annotation,dataType:h??e.type,label:v??e.name,groupLabel:y?Ke(e):undefined,group:y?g:undefined,annotationPath:t,semanticObjectPath:d,availability:S,name:O,relativePath:n,sortable:P,filterable:T,isGroupable:o.isAnalyticsSupported()?!!o.isPropertyGroupable(e):P,isKey:e.isKey,exportSettings:F,caseSensitive:tt(r),typeConfig:D,importance:ft(r,e.annotations?.UI?.DataFieldDefault),required:bt(r,e,u),additionalLabels:C};Ct(e,A);ut(e,A);if(o.isAnalyticsSupported()&&c.isObjectPathDraftSupported(r.getDataModelObjectPath())&&(n==="HasActiveEntity"||n==="HasDraftEntity"||n==="IsActiveEntity")){A.extension={technicallyAggregatable:false,technicallyGroupable:true}}return A};const Le=function(e,t){let n,a,i,o,r,s,l,c;const u=t?Object.keys(t.properties):[];if(t&&u?.length===1){e=t.properties[u[0]].annotationProperty}const p=ue(e);if(j(e)){n=S(e);l=$(e);a=C(e);i=T(e);o=D(e);s=P(e);c=e.scale}n=t?.exportSettings?.unitProperty??n?.name??l?.name;a=t?.exportSettings?.timezoneProperty??a?.name;c=t?.exportSettings?.scale??c;const f=St(p,s,!!l,t?.exportSettings);if(a||f==="DateTime"&&!o){r=false}const d={type:f,inputFormat:we(p),delimiter:He(p),scale:c,unitProperty:n,unit:t?.exportSettings.unit??i,timezoneProperty:a,timezone:t?.exportSettings.timezone??o?.toString(),template:t?.exportSettings.template,wrap:t?.exportSettings.wrap,utc:r};if(d.unitProperty||d.unit){d.autoScale=true}return ke(d)};const we=function(e){return e==="Edm.Date"?"YYYY-MM-DD":undefined};const He=function(e){return e==="Edm.Int64"?true:undefined};const ke=function(e){for(const t in e){if(e[t]===undefined){delete e[t]}}return e};function je(e,t,n,a){const i=e.filter(e=>e.propertyInfos?.includes(n.relativePath)||a&&e.propertyInfos?.includes(a));if(i?.length===1&&(t[n.relativePath]||a&&t[a])&&i[0].propertyInfos?.length===1){n.label=i[0].label;n.tooltip=i[0].tooltip}}function Ge(e){let t,n;const a=e.annotations.UI?.DataFieldDefault;if(j(e)){if(Y(e)){return false}t=a?.$Type}else if(Y(e)){return false}else{n=e;t=n.$Type;if(t==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&n.Target?.$target?.$Type){t=n.Target?.$target?.$Type;return t!==undefined&&!"com.sap.vocabularies.UI.v1.ChartDefinitionType".includes(t)}else if(n.Value?.$target?.annotations?.Core?.MediaType?.term==="Org.OData.Core.V1.MediaType"&&n.Value?.$target?.annotations?.Core?.isURL!==true){return false}}return t?!["com.sap.vocabularies.UI.v1.DataFieldForAction","com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation","com.sap.vocabularies.UI.v1.DataFieldForActionGroup"].includes(t):true}const Be=function(e){switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":return!!e.Inline;case"com.sap.vocabularies.UI.v1.DataFieldWithAction":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":return true;default:return false}};const Re=function(e){const t=e.targetObject;let n;if(t){switch(t.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":case"com.sap.vocabularies.UI.v1.DataPointType":n=t.Value.$target;break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(t?.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.DataPointType"){n=t.Target.$target?.Value.$target}break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldForAction":default:n=undefined}}const a=Fe(false);const i=Fe(false);return Ce(...[be(De(Pe(t?.annotations?.UI?.Hidden),true)),Ie(!!n,n&&be(De(Pe(n.annotations?.UI?.Hidden),true)),true),he(be(a),i)])};const ze=function(e){const t=[];if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.FieldGroupType"){if(e?.annotations?.UI?.Hidden){return Se(be(De(Pe(e.annotations.UI.Hidden),true)))}else{e.Target.$target.Data?.forEach(e=>{t.push(Re({targetObject:e}))});return Se(Ie(he(...t),Fe(true),Fe(false)))}}else{return undefined}};const Ke=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!e){return undefined}if(j(e)||B(e)){const t=e.annotations?.UI?.DataFieldDefault;if(t&&!t.qualifier&&t.Label){return t.Label?.toString()}return e.annotations.Common?.Label?.toString()??e.name}else if(ae(e)){if(!!t&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation"){return e?.Label?.toString()}return e?.Label?.toString()??Se(Pe(e.Value?.$target?.annotations?.Common?.Label,[],e.Value?.$target?.name))}else if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){return e.Label?.toString()??Se(Pe(e.Target?.$target?.Value?.$target?.annotations?.Common?.Label?.valueOf()))}else{return e.Label?.toString()}};const _e=function(e){if(!e){return undefined}if(j(e)||e.annotations?.Common?.QuickInfo){return e.annotations?.Common?.QuickInfo?Se(Pe(e.annotations.Common.QuickInfo)):undefined}else if(ae(e)){return e.Value?.$target?.annotations?.Common?.QuickInfo?Se(Pe(e.Value.$target.annotations.Common.QuickInfo)):undefined}else if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){const t=e.Target?.$target;return t?.Value?.$target?.annotations?.Common?.QuickInfo?Se(Pe(t.Value.$target.annotations.Common.QuickInfo)):undefined}else{return undefined}};function Qe(e,t){return Te([ve(`semanticKeyHasDraftIndicator`,"internal"),ve(`filteredMessages`,"internal"),e,t],h.getErrorStatusTextVisibilityFormatter)}b.getRowStatusVisibility=Qe;const We=function(e,t,n,a,i,o,r){const s=[];const l={};const c=new ee(a,n);Object.keys(e).forEach(a=>{const u=e[a],p=n.getAbsoluteAnnotationPath(a),f=t.find(e=>e.name===a);const d=n.getConverterContextFor(n.getContextPath()).getDataModelObjectPath();const m=H(d,a);if(I(m)){const f=L(m,false,true);const d=Ne(u,p,a,true,false,c,n,i,r,o,undefined,f);xt(t,a,d);je(t,e,d,a);s.push(d);l[a]=f??a}else if(f===undefined){const l=Ne(u,p,a,true,false,c,n,i,r,o);xt(t,a,l);je(t,e,l);s.push(l)}else if(f.annotationPath!==p||f.propertyInfos){const f=`Property::${a}`;if(!t.some(e=>e.name===f)){const d=Ne(u,p,a,false,false,c,n,i,r,o);xt(t,a,d);je(t,e,d);s.push(d);l[a]=f}else if(t.some(e=>e.name===f)&&t.some(e=>e.propertyInfos?.includes(a))){l[a]=f}}else if(i[a]==="Description"&&!f.filterable&&!r?.nonFilterableProperties.includes(a)){r?.nonSortableProperties.push(a);const e=Ne(u,p,a,false,false,c,n,{},r,o);e.isGroupable=false;s.push(e)}});t.forEach(e=>{e.propertyInfos=e.propertyInfos?.map(e=>l[e]??e);e.additionalPropertyInfos=e.additionalPropertyInfos?.map(e=>l[e]??e)});return s};const qe=function(e){if(ae(e)&&e.Value?.path){return e.Value?.path}else if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target?.$target?.Value?.path){return e.Target?.$target?.Value.path}else{return _.generateKeyFromDataField(e)}};const Ye=function(e,t,n){const a=n.getManifestControlConfiguration(t)?.columns;const i=a&&Object.keys(a);return i&&!!i.find(function(t){return t===e&&a[t].showDataFieldsLabel})};const Je=function(e){let t="";switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":t=e?.Value?.path;break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":t=e?.Target?.value;break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldForActionGroup":case"com.sap.vocabularies.UI.v1.DataFieldWithActionGroup":t=_.generateKeyFromDataField(e);break}return t};const Xe=function(e,t,n){const a=t?e.lastIndexOf("/"):e.indexOf("/");if(a===-1){return e}return n?e.substring(a+1,e.length):e.substring(0,a)};const Ze=function(e,t){if(ae(e)&&G(e.Value)){const n=H(t.getDataModelObjectPath(),e.Value.path);return I(n)}else{return false}};const et=function(e,t,n,a){return!n.includes(t)&&((e.$Type==="com.sap.vocabularies.UI.v1.DataField"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation")&&Object.keys(a.properties).some(e=>{const t=Y(a.properties[e].annotationProperty);return!t&&!n.includes(e)})||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithAction")};const tt=function(e){const t=nt(e);return c.isFilteringCaseSensitive(undefined,t)};b.isFilteringCaseSensitive=tt;function nt(e){const t=e.getEntitySet();if(p.isEntitySet(t)){return t.annotations.Capabilities?.FilterFunctions??e.getEntityContainer().annotations.Capabilities?.FilterFunctions}return undefined}function at(e){return e===undefined?undefined:{textLinesEdit:4,...e}}function it(e,t){const n=[];let a=false;for(let i=0;i<e.length;i++){n.push(e[i].value);if(e[i].value===t){a=true}}return{values:n,semanticKeyFound:a}}function ot(e,t){let n=false;let a;if(e&&e.length>=1&&t&&t.length>=1){for(let i=0;i<e.length;i++){if([e[i]].some(e=>t.includes(e))){n=true;a=e[i];break}}}return{semanticKeyHasPropertyInFieldGroup:n,fieldGroupPropertyPath:a}}function rt(e,t){const n=[];let a={semanticKeyHasPropertyInFieldGroup:false,fieldGroupPropertyPath:undefined};if(e&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.FieldGroupType"){e.Target.$target.Data?.forEach(e=>{if((e.$Type==="com.sap.vocabularies.UI.v1.DataField"||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl")&&e.Value){n.push(e.Value.path)}a=ot(t,n)})}return{semanticKeyHasPropertyInFieldGroup:a.semanticKeyHasPropertyInFieldGroup,propertyPath:a.fieldGroupPropertyPath}}function st(e,t,n){if(!t){return{}}const a=it(t,e);const i=rt(n,a.values);if(i.semanticKeyHasPropertyInFieldGroup){return{fieldGroupDraftIndicatorPropertyPath:i.propertyPath,fieldGroupName:e,showErrorObjectStatus:Se(Qe(e,true))}}else if(a.semanticKeyFound){return{hasDraftIndicator:true,showErrorObjectStatus:Se(Qe(e,false))}}return{}}function lt(e){const t=e?.annotations?.UI?.Importance;if(t&&t.includes("UI.ImportanceType/High")){return 3}if(t&&t.includes("UI.ImportanceType/Medium")){return 2}if(t&&t.includes("UI.ImportanceType/Low")){return 1}return 0}function ct(e){const t=e?.annotations?.UI?.Importance;return t?t.split("/")[1]:me.None}function ut(e,t){const n=le(e);if(ne(e)&&typeof n==="string"&&t.exportSettings&&t.exportSettings?.unit!=="%"){t.exportDataPointTargetValue=n;t.exportSettings.template="{0}/"+n}}function pt(e){if(e&&e.length>0){let t=-1;let n=-1;let a;for(const i of e){n=lt(i);if(n>t){t=n;a=i}}return ct(a)}return me.None}function ft(e,t){if(!t){return undefined}const n=e.getDataModelObjectPath().targetEntityType.annotations.Common?.SemanticKey??[];const a=Dt(e);const i=[...n,...a].map(e=>e.$target?.fullyQualifiedName);let o;if(R(t,"com.sap.vocabularies.UI.v1.DataFieldForAnnotation")){const e=t.Target.$target;if(R(e,"com.sap.vocabularies.UI.v1.FieldGroupType")){const n=e.Data;if(n.some(function(e){return ae(e)&&i.includes(e.Value?.$target?.fullyQualifiedName)})){return me.High}else{if(t?.annotations?.UI?.Importance){return ct(t)}o=n.filter(function(e){return e?.annotations?.UI?.Importance});return pt(o)}}}return i.includes(t.Value?.$target?.fullyQualifiedName)?me.High:ct(t)}b.getImportance=ft;const dt=function(e,t,n,a){const i=a.getAnnotationEntityType(e),o=[],r={},s={},l=M(a),c=a.getManifestControlConfiguration(n),u=a.getManifestWrapper().getSapFeManifestConfiguration()?.macros?.table?.defaultCreationMode==="InlineCreationRows"?ye.InlineCreationRows:undefined,p=c?.tableSettings?.creationMode?.name??u??ye.Inline;const f=a.getAnnotationsByTerm("Common","com.sap.vocabularies.Common.v1.SemanticKey",[a.getEntityType()])[0];if(e){const i=a.getConverterContextFor(N(a.getDataModelObjectPath()));e.forEach(e=>{if(!Be(e)){return}let c=null;const u=ae(e)&&e.Value?.$target?.fullyQualifiedName?ce(a,e):undefined;const d=Je(e);const m=pe(e,a,t);const g=Object.keys(m.properties);const y=Object.keys(m.additionalProperties);const v=d?Xe(d,true,false):undefined;const h=v!=d;const b=Ke(e,h);const I=qe(e);const P=v?v.includes(`@${"com.sap.vocabularies.UI.v1.FieldGroup"}`):false;const T=P?Ye(I,n,a):false;const D=ue(e);const F=at(st(I,f,e));const S=H(a.getDataModelObjectPath(),d);const C=S.targetEntityType.navigationProperties;const O=C.filter(e=>!e.isCollection&&e.targetType.annotations.Common?.SAPObjectNodeType?.Name==="BusinessSituation");const U=O.length>=1?O[0]:undefined;if(U&&F){F.hasSituationsIndicator=true}let A;if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.FieldGroupType"){A=ze(e)}const $=Ze(e,i);if(!$&&Ge(e)){c=Le(e,m)}let x;if(D){x=At(e,D)}const E={className:D,formatOptions:{...F,...x?.formatOptions},constraints:{...x?.constraints}};const M={};if(!D||!E){M.widthCalculation=null}const V=!$&&et(e,d,l.nonSortableProperties,m);const N=Y(e)?"Hidden":"Default";const L={key:_.generateKeyFromDataField(e),type:Ue.Annotation,label:b??I,groupLabel:h?Ke(e):undefined,group:h?v:undefined,FieldGroupHiddenExpressions:A,annotationPath:a.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),semanticObjectPath:u,availability:N,name:I,showDataFieldsLabel:T,required:bt(a,e,p),relativePath:d,sortable:V,propertyInfos:g.length?g:undefined,additionalPropertyInfos:y.length>0?y:undefined,exportSettings:c,width:e.annotations?.HTML5?.CssDefaults?.width?.valueOf()||undefined,importance:ft(a,e),isNavigable:true,formatOptions:F,caseSensitive:tt(a),typeConfig:E,visualSettings:M,timezoneText:c?.timezone,isPartOfLineItem:true,dataType:D??"Edm.String",isMultiValue:$};const w=_e(e)??b;if(w){L.tooltip=w}if(m.exportSettings.dataPointTargetValue){L.exportDataPointTargetValue=m.exportSettings.dataPointTargetValue}o.push(L);g.forEach(t=>{r[t]=m.properties[t].annotationProperty;if($){l.nonSortableProperties.push(t)}$t(s,m,t);if(m.properties[t].displayModeOfPropertyUsedAsDescription==="Description"){Ut(a,S,e,r,d,l)}});y.forEach(e=>{r[e]=m.additionalProperties[e]})})}return Ve(r,i,o,a,t,p,s,l)};const mt=function(e,t,n,a){let i;if(Array.isArray(e)){i=e.map(function(e){const i=t.find(function(t){return t.relativePath===e&&t.propertyInfos===undefined});if(i){return i.name}else{const i=We({[e]:a.resolvePath(e)},t,n,a,{});t.push(i[0]);return i[0].name}})}return i};const gt=function(e,t,n){const a=t.Data;return a.some(function(t){if(oe(t)&&t?.Value?.$target.type!=="Edm.Boolean"){return x(t)||n===ye.InlineCreationRows&&Ft(t.Value.$target.fullyQualifiedName,e)}})};const yt=function(e,t,n){const a=t.Target.$target;const i=E(t);if(re(t)){if(gt(e,a,n)){return true}const t=a.Data;return t.some(t=>bt(e,t,n))}if(se(t)&&a.Visualization!=="UI.VisualizationType/Rating"){if(i){return false}if(x(t)){return true}return ht(e,a,n)}return false};const vt=function(e,t,n){return t.type!=="Edm.Boolean"&&!te(t)&&(x(t)||n===ye.InlineCreationRows&&Ft(t.fullyQualifiedName,e))};const ht=function(e,t,n){return x(t)||n===ye.InlineCreationRows&&Ft(t.Value.$target.fullyQualifiedName,e)};const bt=function(e,t,n){const a=n||ye.Inline;if(e.getTemplateType()===de.ListReport||e.getTemplateType()===de.AnalyticalListPage){return undefined}if(j(t)){return vt(e,t,a)?Se(K.IsEditable):undefined}if(ie(t)){return yt(e,t,a)?Se(K.IsEditable):undefined}if(oe(t)&&t.Value?.$target?.type!=="Edm.Boolean"){return x(t)||a===ye.InlineCreationRows&&Ft(t.Value.$target.fullyQualifiedName,e)?Se(K.IsEditable):undefined}return undefined};const It=function(e,t){if(Array.isArray(t)){e=t}if(e){return e.map(t=>`{${e.indexOf(t)}}`).join(`${"\n"}`)}return undefined};const Pt=function(e,t,n,a){const i={};function o(e,n){return t.some(e=>e.key===n)}function r(e){return e.type===Ue.Slot}function s(e){return e.type===undefined&&!!e.template}function l(e,t){const a=M(n);e.forEach(e=>{t.forEach(t=>{if(t.name===e){t.sortable=!a.nonSortableProperties.includes(e.replace("Property::",""));t.isGroupable=t.sortable;t.filterable=!a.nonFilterableProperties.includes(e.replace("Property::",""));t.isPartOfCustomColumn=true}})})}for(const c in e){const u=e[c];_.validateKey(c);const p={key:c,widthIncludingColumnHeader:u.widthIncludingColumnHeader,width:u.width||undefined,position:{anchor:u.position?.anchor,placement:u.position===undefined?X.After:u.position.placement},caseSensitive:tt(n)};if(o(u,c)){const e={...p,importance:u?.importance,horizontalAlign:u?.horizontalAlign,availability:u?.availability,type:Ue.Annotation,isNavigable:undefined,settings:u.settings,formatOptions:at(u.formatOptions),exportSettings:Et(u?.exportSettings,t,n,a,undefined,c)};i[c]=e}else{const e=mt(u.properties,t,n,a);const o=n.fetchTextFromMetaModel(u.tooltip),f=n.fetchTextFromMetaModel(u.header);const d=e?Et(u?.exportSettings,t,n,a,e):null;const m={...p,header:f,importance:u?.importance||me.None,horizontalAlign:u?.horizontalAlign||ge.Begin,availability:u?.availability||"Default",template:u.template,propertyInfos:e,exportSettings:d,id:`CustomColumn::${c}`,name:`CustomColumn::${c}`,formatOptions:{textLinesEdit:4},isGroupable:false,isNavigable:false,sortable:false,visualSettings:{widthCalculation:null},tooltip:o?o:f,properties:u.properties,required:u.required&&n.getTemplateType()!==de.ListReport&&n.getTemplateType()!==de.AnalyticalListPage?Se(K.IsEditable):undefined};if(e){l(e,t)}if(r(u)){const e={...m,type:Ue.Slot};i[c]=e}else if(s(u)){const e={...m,type:Ue.Default};i[c]=e}else{const e=`The annotation column '${c}' referenced in the manifest is not found`;n.getDiagnostics().addIssue(q.Manifest,Q.Low,e,W,W?.AnnotationColumns?.InvalidKey)}}}return i};function Tt(e,t,n,a){if(!["GridTable","TreeTable","AnalyticalTable"].includes(t)){return e}const i=e.find(e=>e.formatOptions?.hasSituationsIndicator!==undefined&&e.formatOptions?.hasSituationsIndicator===true);if(i?.formatOptions){i.formatOptions.hasSituationsIndicator=false;const t={key:"situationsIndicator",name:"situationsIndicator",propertyKey:i.name,isSituationsIndicator:true,availability:"Default",label:"{sap.fe.i18n>C_SITUATIONS_STATUS_COLUMN_LABEL_TOOLTIP}",tooltip:"{sap.fe.i18n>C_SITUATIONS_STATUS_COLUMN_LABEL_TOOLTIP}",type:Ue.Computed,formatOptions:null,exportSettings:null,clipboardSettings:null,propertyInfos:undefined,caseSensitive:false};const n=e.findIndex(e=>e.availability!=="Hidden");e.splice(n+1,0,t)}const o=e.filter(e=>e.formatOptions?.hasDraftIndicator===true);if(o.length&&a.getTemplateType()===de.ListReport&&(c.isDraftNode(a.getEntitySet())||c.isDraftRoot(a.getEntitySet()))){o.forEach(e=>{if(e?.formatOptions){e.formatOptions.hasDraftIndicator=false}});const t={key:"draftStatus",name:"draftStatus",propertyKey:o[0].name,isDraftIndicator:true,availability:"Default",label:"{sap.fe.i18n>C_DRAFT_STATUS_COLUMN_LABEL_TOOLTIP}",tooltip:"{sap.fe.i18n>C_DRAFT_STATUS_COLUMN_LABEL_TOOLTIP}",type:Ue.Computed,formatOptions:null,exportSettings:null,caseSensitive:false};let n=0;if(i){n=e.findIndex(e=>e.isSituationsIndicator===true)-1}else{n=e.findIndex(e=>e.availability!=="Hidden")}e.splice(n+1,0,t)}return e}b.addComputedColumns=Tt;function Dt(e){return w(e.getDataModelObjectPath(),e=>e?.InsertRestrictions?.RequiredProperties,false)}b.getRequiredProperties=Dt;function Ft(e,t){return Dt(t).map(e=>e.$target?.fullyQualifiedName).includes(e)}function St(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let a=arguments.length>3?arguments[3]:undefined;let i="String";if(!e||a?.dataPointTargetValue){return i}if(a?.isCurrency||n){return"Currency"}if(t){return"Timezone"}if(a?.wrap){return i}switch(e){case"Edm.Decimal":case"Edm.Int32":case"Edm.Int64":case"Edm.Double":case"Edm.Byte":i="Number";break;case"Edm.DateOfTime":case"Edm.Date":i="Date";break;case"Edm.DateTimeOffset":i="DateTime";break;case"Edm.TimeOfDay":i="Time";break;case"Edm.Boolean":i="Boolean";break;default:i="String"}return i}function Ct(e,t){const n=_e(e)??t.label;if(n){t.tooltip=n}}function Ot(e,t){const n=H(t.getDataModelObjectPath(),e).navigationProperties;if(n?.length>0){const e=[];n.forEach(t=>{e.push(Ke(t)||t.name)});return e}}function Ut(e,t,n,a,i,o){const r=t.navigationProperties.length!==e.getDataModelObjectPath().navigationProperties.length;if(r&&oe(n)){a[i]=n.Value.$target;o.nonSortableProperties.push(i)}else if(ie(n)&&re(n)){n.Target.$target.Data.forEach(t=>{if(oe(t)&&V(t.Value.$target)==="Description"){const n=H(e.getDataModelObjectPath(),t.Value.path);const i=n.navigationProperties.length!==e.getDataModelObjectPath().navigationProperties.length;if(i){a[t.Value.path]=t.Value.$target;o.nonSortableProperties.push(t.Value.path)}}})}}function At(e,t){let n;if(j(e)){n=k(e.targetType)?Oe[e.targetType.underlyingType]:Oe[e.type]}if(n===undefined&&t!==undefined){n=Oe[t]}const a={type:n?.type,constraints:{},formatOptions:{}};if(j(e)&&n!==undefined){a.constraints={scale:n.constraints?.$Scale?e.scale:undefined,precision:n.constraints?.$Precision?e.precision:undefined,maxLength:n.constraints?.$MaxLength?e.maxLength:undefined,nullable:n.constraints?.$Nullable?e.nullable:undefined,minimum:n.constraints?.["@Org.OData.Validation.V1.Minimum/$Decimal"]&&!isNaN(e.annotations?.Validation?.Minimum)?`${e.annotations?.Validation?.Minimum}`:undefined,maximum:n.constraints?.["@Org.OData.Validation.V1.Maximum/$Decimal"]&&!isNaN(e.annotations?.Validation?.Maximum)?`${e.annotations?.Validation?.Maximum}`:undefined,isDigitSequence:a.type==="sap.ui.model.odata.type.String"&&n.constraints?.[`@${"com.sap.vocabularies.Common.v1.IsDigitSequence"}`]&&e.annotations?.Common?.IsDigitSequence?true:undefined}}a.formatOptions={parseAsString:a?.type?.indexOf("sap.ui.model.odata.type.Int")===0||a?.type?.indexOf("sap.ui.model.odata.type.Double")===0?false:undefined,emptyString:a?.type?.indexOf("sap.ui.model.odata.type.Int")===0||a?.type?.indexOf("sap.ui.model.odata.type.Double")===0?"":undefined,parseKeepsEmptyString:a.type==="sap.ui.model.odata.type.String"&&a.constraints.nullable===false?true:undefined};return a}b.getTypeConfig=At;function $t(e,t,n){if(t.properties[n].displayModeOfPropertyUsedAsDescription&&!e[n]){e[n]=t.properties[n].displayModeOfPropertyUsedAsDescription}}function xt(e,t,n){const a=e.filter(e=>e.propertyInfos?.includes(t)&&e.isPartOfLineItem||e.isPartOfLineItem&&e.relativePath===n.relativePath);n.isPartOfLineItem=!!a.length;if(a.length&&!a?.some(e=>e.availability!=="Hidden")){n.sortable=false;n.isGroupable=false;n.filterable=false}}function Et(e,t,n,a,i,o){let r;if(o){r=t.find(e=>e.key===o);if(r?.exportSettings===null){return r?.exportSettings}}const s=e?.wrap??(!!(e?.property&&e.property?.length>1)||!!(i&&i.length>1));const l={...r?.exportSettings,type:e?.type??r?.exportSettings?.type,template:e?.template??It(i,e?.property)??r?.exportSettings?.template,property:e?.property?mt(e?.property,t,n,a):undefined,width:e?.width,wrap:s};return ke(l)}return b},false);
//# sourceMappingURL=Columns.js.map