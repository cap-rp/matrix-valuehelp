/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/objectPage/HeaderAndFooterAction","../../helpers/BindingHelper","../ManifestSettings","../controls/ObjectPage/Avatar","../controls/ObjectPage/HeaderFacet","../controls/ObjectPage/SubSection","../helpers/ConfigurableObject","../helpers/ID"],function(e,t,n,o,i,a,s,r,c,l){"use strict";var u={};var d=l.getSectionID;var f=l.getEditableHeaderSectionID;var v=l.getCustomSectionID;var p=c.insertCustomElements;var b=c.Placement;var g=c.OverrideType;var y=r.createSubSections;var m=r.createCustomSubSections;var S=r.createCustomHeaderFacetSubSections;var A=r.SubSectionType;var h=s.getHeaderFacetsFromManifest;var E=s.getHeaderFacetsFromAnnotations;var T=a.getAvatar;var C=i.VisualizationType;var w=i.TemplateType;var H=o.singletonPathVisitor;var M=o.UI;var F=n.getHiddenHeaderActions;var I=n.getHeaderDefaultActions;var O=n.getFooterDefaultActions;var L=t.removeDuplicateActions;var z=t.prepareMenuActions;var k=t.getVisibilityEnablementMenuActions;var V=t.getMatchingManifestAction;var P=t.getAnnotationMenuActionItems;var x=t.getActionsFromManifest;var j=e.not;var D=e.ifElse;var B=e.getExpressionFromAnnotation;var U=e.equal;var W=e.constant;var N=e.compileExpression;const _=(e,t)=>e.ID?.toString()||e.Label?.toString()||t;function R(e,t){const n=f();const o=e.getEntityType().annotations?.UI?.HeaderFacets;const i=o?y(o,e,true):[];const a=S(e);let s=[];if(a.length>0){let e=0;t.forEach(function(t){while(i.length>e&&i[e].visible==="false"){s.push(i[e]);e++}if(i.length>e&&(t.key===i[e].key||t.key.slice(t.key.lastIndexOf("::")+2)===i[e].key.slice(i[e].key.lastIndexOf("::")+2))){s.push(i[e]);e++}else{a.forEach(function(e){if(t.key===e.key){s.push(e)}})}})}else{s=i}const r={id:n,key:"EditableHeaderContent",title:"{sap.fe.i18n>T_COMMON_OBJECT_PAGE_HEADER_SECTION}",visible:N(M.IsEditable),subSections:s};return r}u.createEditableHeaderSection=R;function q(e){const t=e.getEntityType();const n=t.annotations?.UI?.Facets?.map(t=>J(t,e))||[];return n}function G(e,t){const n=e.getSections();const o=n?.[t];return o?.useSingleTextAreaFieldAsNotes??false}function J(e,t){const n=d(e);const o=_(e,n);const i=B(e.annotations?.UI?.Hidden,[],false,e=>H(e,t.getConvertedTypes(),[]));const a=G(t.getManifestWrapper(),o);const s={id:n,key:o,title:e.Label?N(B(e.Label)):undefined,showTitle:!!e.Label,visible:N(j(U(i,true))),subSections:y([e],t,undefined,a),useSingleTextAreaFieldAsNotes:a};return s}function K(e,t){const n={};Object.keys(e).forEach(o=>{n[o]=Q(e[o],o,t)});return n}function Q(e,t,n){const o=e.id||v(t);let i=e.position;if(!i){i={placement:b.After}}let a;if(!e.subSections){a={[t]:{...e,position:undefined,visible:"true",applyState:undefined,retrieveState:undefined}}}else{a=e.subSections}const s=m(a,n);const r={id:o,key:t,title:e.title,showTitle:!!e.title,visible:e.visible!==undefined?e.visible:"true",position:i,subSections:s,onSectionLoaded:e.onSectionLoaded,applyState:e.applyState,retrieveState:e.retrieveState};return r}const X=function(e,t){const n=I(e,t);const o=e.getManifestWrapper();const i={isNavigable:g.overwrite,enabled:g.overwrite,visible:g.overwrite,defaultValuesExtensionFunction:g.overwrite,command:g.overwrite,position:g.overwrite,menu:g.overwrite};const a=x(o.getHeaderActions(),e,n,undefined,undefined,F(e));const s=P(n);const r=V(s,a.actions);const c=p(s,r,i);let l=p(n,a.actions,i);z(l,c);l=L(l);l=k(l);return{actions:l,commandActions:a.commandActions}};u.getHeaderActions=X;const Y=function(e,t){const n=e.getManifestWrapper();const o=O(n.getViewLevel(),e,t);const i=x(n.getFooterActions(),e,o);const a={isNavigable:g.overwrite,enabled:g.overwrite,visible:g.overwrite,defaultValuesExtensionFunction:g.overwrite,command:g.overwrite,position:g.overwrite};const s=p(o,i.actions,a);return{actions:s,commandActions:i.commandActions}};u.getFooterActions=Y;function Z(e){return e?.presentation?.visualizations[0]?e.presentation.visualizations[0]:undefined}function $(e,t){return e.visible==="true"&&e?.presentation?.visualizations&&t?.type==="Table"&&t?.control?.type!=="ResponsiveTable"}function ee(e,t,n,o){if($(t,n)){const i=n.control;t.dataVisualizationOptions??={};if(!(o==="Page"&&e.length>1)){t.dataVisualizationOptions["rowCountMode"]="Auto";i.rowCountMode="Auto"}if(o!=="Tabs"){t.dataVisualizationOptions["useCondensedTableLayout"]=false;i.useCondensedTableLayout=false}}}function te(e,t){const n=e?.content?.length===1?e.content[0]:undefined;if(n?.type===A.DataVisualization){const e=(n.presentation?.visualizations[0]).control;if(e.type!=="ResponsiveTable"){n.dataVisualizationOptions??={};n.dataVisualizationOptions["rowCountMode"]="Auto";e.rowCountMode="Auto";if(t!=="Tabs"){n.dataVisualizationOptions["useCondensedTableLayout"]=false;e.useCondensedTableLayout=false}}}}function ne(e,t,n){let o;const i=t.subSections;if(i.length===1){const t=i[0];switch(t.type){case"DataVisualization":o=Z(t);ee(e,t,o,n);break;case"Mixed":te(t,n);break;default:break}return}oe(i)}function oe(e){let t;e.forEach(e=>{t=e;if(t?.presentation?.visualizations){t?.presentation?.visualizations.forEach(e=>{if(e.type===C.Table){e.control.useCondensedTableLayout=false}})}if(t?.content){t.content.forEach(e=>{e.presentation?.visualizations.forEach(e=>{if(e.type===C.Table){e.control.useCondensedTableLayout=false}})})}})}const ie=function(e){const t=e.getManifestWrapper();const n=p(q(e),K(t.getSections(),e),{title:g.overwrite,visible:g.overwrite,subSections:{actions:g.merge,title:g.overwrite,sideContent:g.overwrite,objectPageLazyLoaderEnabled:g.overwrite}});n.forEach(function(e){ne(n,e,t.getSectionLayout());e.subSections?.forEach(function(e){e.title=e.title==="undefined"?undefined:e.title;if(e.type==="Mixed"){e.content?.forEach(t=>{t.objectPageLazyLoaderEnabled=e.objectPageLazyLoaderEnabled})}if(e.type==="Mixed"&&e.content?.length){const t=e.content.find(e=>e.type===A.Form);if(e.sideContent){if(t){t.sideContent=e.sideContent}else{e.content[0].sideContent=e.sideContent}e.sideContent=undefined}if(t&&e.actions?.length){t.actions=e.actions;e.actions=[]}}})});return n};u.getSections=ie;function ae(e){const t=e.getManifestWrapper();return(e.getEntityType().annotations?.UI?.HeaderFacets||[]).length>0||Object.keys(t.getHeaderFacets()).length>0}function se(e){const t=e.getManifestWrapper();return D(!ae(e),W(false),D(U(t.isHeaderEditable(),false),W(true),j(M.IsEditable)))}const re=function(e){return N(se(e))};u.getShowHeaderContent=re;const ce=function(e){return N(j(se(e)))};u.getExpandedImageVisible=ce;const le=function(e,t){const n=e.getManifestWrapper();let o;const i=e.getEntityType();const a=p(E(e),h(n.getHeaderFacets()));const s=X(e,t);const r=Y(e,t);if(n.isHeaderEditable()&&(i.annotations.UI?.HeaderFacets||i.annotations.UI?.HeaderInfo)){o=R(e,a)}const c=ie(e);return{template:w.ObjectPage,header:{visible:n.getShowObjectPageHeader(),section:o,facets:a,actions:s.actions,showContent:re(e),hasContent:ae(e),avatar:T(e),title:{expandedImageVisible:ce(e)}},sections:c,footerActions:r.actions,headerCommandActions:s.commandActions,footerCommandActions:r.commandActions,showAnchorBar:n.getShowAnchorBar(),useIconTabBar:n.useIconTabBar(),transportSelection:n.getTransportSelection()}};u.convertPage=le;return u},false);
//# sourceMappingURL=ObjectPageConverter.js.map