/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/ID","sap/fe/core/formatters/FPMFormatter","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/UIFormatters"],function(e,t,n,i,o,a,r,s,l,c){"use strict";var u={};var f=c.getActionEnabledExpression;var p=l.replaceSpecialChars;var d=r.UI;var b=o.getCustomActionID;var v=i.Placement;var m=n.ActionType;var h=t.resolveBindingString;var g=t.pathInModel;var y=t.or;var A=t.not;var M=t.isConstant;var C=t.ifElse;var O=t.greaterOrEqual;var S=t.formatResult;var E=t.equal;var I=t.constant;var F=t.compileExpression;var x=t.and;let k=function(e){e["Accept"]="Accept";e["Attention"]="Attention";e["Back"]="Back";e["Critical"]="Critical";e["Default"]="Default";e["Emphasized"]="Emphasized";e["Ghost"]="Ghost";e["Negative"]="Negative";e["Neutral"]="Neutral";e["Reject"]="Reject";e["Success"]="Success";e["Transparent"]="Transparent";e["Unstyled"]="Unstyled";e["Up"]="Up";return e}({});u.ButtonType=k;const D="sap-icon://ai";u.aiIcon=D;const P=e=>{let t,n,i,o;e.forEach(e=>{t=e.visible?.valueOf()==="false";i=false;o=[];n=[];if(e.visible&&!(e.visible.valueOf()==="true"||e.visible.valueOf()==="false")){n.push(e.visible)}if(e?.menu?.length){e?.menu?.forEach(e=>{const t=e.visible;if(t&&(typeof t==="boolean"||t.valueOf()==="true")){i=true}else if(t&&t.valueOf()!=="false"){o.push(t.valueOf())}});if(t){e.visible=false.toString()}else if(!i&&!o.length){e.visible=false.toString()}else if(i&&!n.length){e.visible=true.toString()}else if(n.length||o.length){const t=o.map(e=>h(e,"boolean"));e.visible=F(x(h(e.visible||true,"boolean"),y(...t)))}else{e.visible=(!t).toString()}}});return e};u.getVisibilityEnablementMenuActions=P;function T(e){e.forEach(e=>{if(e.visible?.valueOf()==="false"){return}if(e.type==="ForAction"){e.visible=F(x(h(e.visible,"boolean"),A(E(d.hasCollaborationAuthorization,false))))}})}u.addCollaborationCondition=T;function B(e,t,n){const i=t.find(e=>e.key===n);const o=e[n];let a={...i??o};if(Object.keys(a).length===0){t.filter(e=>e.type===m.Menu).forEach(e=>{e.menu?.forEach(e=>{if(e.key===n){a=e}})})}if(i){a.enabled=o?.enabled??i.enabled;a.visible=o?.visible??i.visible;for(const e in o||{}){const t=e;if(!i[t]&&t!=="menu"){a[t]=o[t]}}}const r=a?.visible||a?.type===m.DataFieldForAction||a?.type===m.DataFieldForIntentBasedNavigation;return{action:a,canBeMenuItem:r}}function N(e,t,n,i){const{action:o,canBeMenuItem:a}=B(t,n,e.defaultAction);if(a){e.defaultAction=o}if(o.command){i[o.key]=o}}function U(e,t,n,i){const o=[];const a=n.find(t=>t.key===e.key);if(e.menu?.length!==0){for(const a of e.menu??[]){const{action:e,canBeMenuItem:r}=B(t,n,a);if(r){o.push(e)}if(e.command){i[a]=e}}}else if(a){a.menu?.forEach(e=>o.push(e))}const r=e;r.menu=o;const s=o.map(e=>h(e.visible,"boolean"));r.visible=F(x(h(e.visible,"boolean"),y(...s)))}function j(e,t){const n={};const i=[];const o={};for(const a in e){const r=e[a];if(r.defaultAction!==undefined){N(r,e,t,o)}if(r.type===m.Menu){U(r,e,t,o);if(!r.menu?.length){i.push(r.key)}}if(r.command){o[a]=r}n[a]=r}i.forEach(e=>delete n[e]);return{actions:n,commandActions:o}}const q=function(e,t,n){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(t&&e.enabled===undefined){return undefined}const o=R(e.enabled,n);const a=!i?"numberOfSelectedContexts":"contextmenu/numberOfSelectedContexts";return F(C(e.requiresSelection===true,C(e.enableOnSelect==="single",x(E(g(a,"internal"),1),o),x(O(g(a,"internal"),1),o)),o))};const W=function(e,t,n){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(t&&e.visible===undefined){return undefined}let o=R(e.visible,n);o=i?x(o,E(g("contextmenu/inactiveContext","internal"),false)):o;return F(o)};function z(e,t){if(!t){return}e.type=t.type;e.annotationPath=t.annotationPath;e.press=t.press;e.enabled=e.enabled??t.enabled;e.visible=e.visible??t.visible;e.visibleForContextMenu=e.visibleForContextMenu??t.visibleForContextMenu}function L(e,t,n,i,o,a,r){const s={};for(const a in e){const l=e[a];const c=l.press?.lastIndexOf(".")||-1;let u;if(n){for(const e of n){if(e.id?.startsWith("CustomAction::")){continue}if(e.key===a){u=e;break}else if(e.type==="Menu"){u=e.menu?.find(e=>e.key===a);if(u){break}}}}const f=!!u;if(l.facetName){r=l.facetName}s[a]={id:u?a:b(a),type:l.menu?m.Menu:m.Default,visible:W(l,f,t),visibleForContextMenu:W(l,f,t,true),enabled:q(l,f,t),enabledForContextMenu:q(l,f,t,true),handlerModule:l.press&&l.press.substring(0,c).replace(/\./gi,"/"),handlerMethod:l.press&&l.press.substring(c+1),press:l.press,text:l.text,noWrap:l.__noWrap,key:p(a),enableOnSelect:l.enableOnSelect,defaultValuesExtensionFunction:l.defaultValuesFunction,position:{anchor:l.position?.anchor,placement:l.position===undefined?v.After:l.position.placement},isNavigable:w(l,i,o),command:l.command,requiresSelection:l.requiresSelection===undefined?false:l.requiresSelection,enableAutoScroll:G(l),menu:l.menu??(u?.type===m.Menu?[]:undefined),facetName:l.inline?r:undefined,defaultAction:l.defaultAction,isAIOperation:l?.isAIOperation??undefined};z(s[a],u)}return j(s,n??[])}u.getActionsFromManifest=L;function R(e,t){const n=h(e,"boolean");let i;if(M(n)&&n.value===undefined){i=I(true)}else if(M(n)&&typeof n.value==="string"){const e=n.value;i=S([g("/","$view"),e,g("selectedContexts","internal")],a.customBooleanPropertyCheck,t.getDataModelObjectPath().contextLocation?.targetEntityType||t.getEntityType())}else{i=n}return i}const $=e=>{let t={};e.forEach(e=>{if(e?.menu?.length){const n=e.menu;t=n.reduce((e,t)=>{let{key:n}=t;if(n&&!e[n]){e[n]=true}return e},t)}});return e.filter(e=>!t[e.key])};u.removeDuplicateActions=$;function H(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(t?.annotations.Core?.OperationAvailable){const i=e.getDataModelObjectPath();let o=f(t,e.getConvertedTypes(),i,n);const a=s.isCollaborationDraftSupportedFromConverterContext(e)&&s.getDraftRoot(e.getEntitySet());if(a){o=x(o,d.hasCollaborationAuthorization)}return F(o)}return"true"}u.getEnabledForAnnotationAction=H;function V(e){return e?e.map(e=>({LocalProperty:{$PropertyPath:e.LocalProperty.value},SemanticObjectProperty:e.SemanticObjectProperty.toString()})):[]}u.getSemanticObjectMapping=V;function w(e,t,n){let i=true;if(n){const e=t&&(t.detail||t.display);i=e?.route?true:false}if(e&&e.afterExecution&&(e.afterExecution?.navigateToInstance===false||e.afterExecution?.enableAutoScroll===true)||!i){return false}return true}u.isActionNavigable=w;function G(e){return e?.afterExecution?.enableAutoScroll===true}u.enableAutoScroll=G;function _(e){return e.annotations?.UI?.IsCopyAction?.valueOf()===true&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"}u.dataFieldIsCopyAction=_;function J(t){if(t.length===1){return t[0]}if(t.length>1){e.error("Multiple actions are annotated with isCopyAction. There can be only one standard copy action.")}return undefined}u.getCopyAction=J;function K(e){const t=[];e.forEach(e=>{if(e.type==="Menu"&&!e.id?.startsWith("CustomAction::")&&e.menu){t.push(...e.menu)}});return t}u.getAnnotationMenuActionItems=K;function Q(e,t){const n={};for(const i in t){if(i.startsWith("DataFieldForAction::")&&e.find(e=>e.key===i)){n[i]=t[i]}}return n}u.getMatchingManifestAction=Q;function X(e,t){let n;e.forEach(e=>{if(e.type===m.Menu){e.menu?.forEach((i,o)=>{n=t.find(e=>e.key===i.key);if(n){e.menu?.splice(o,1,n)}})}})}u.prepareMenuActions=X;function Y(e){return e.every(Z)}u.isMenuAIOperation=Y;function Z(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){return e.ActionTarget?.annotations.UI?.IsAIOperation?.valueOf()===true}return false}u.isActionAIOperation=Z;return u},false);
//# sourceMappingURL=Action.js.map