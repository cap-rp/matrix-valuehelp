/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/ObjectPage/HeaderFacet","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/TypeGuards","../../ManifestSettings","../../annotations/DataField","../../helpers/ConfigurableObject","../../helpers/ID","../../objectPage/FormMenuActions","../Common/DataVisualization","../Common/Form"],function(e,t,a,n,i,o,s,r,c,l,u,d,f,v,p){"use strict";var m={};var g=p.isReferenceFacet;var b=p.createFormDefinition;var I=v.getDataVisualizationConfiguration;var F=f.getFormHiddenActions;var h=f.getFormActions;var y=d.getSubSectionID;var A=d.getSideContentID;var S=d.getFormID;var C=d.getCustomSubSectionID;var U=u.insertCustomElements;var D=u.Placement;var T=u.OverrideType;var k=l.isActionWithDialog;var L=c.ActionType;var M=r.isPathAnnotationExpression;var E=s.singletonPathVisitor;var N=o.KeyHelper;var O=i.IssueType;var P=i.IssueSeverity;var w=i.IssueCategory;var $=n.getStashedSettingsForHeaderFacet;var x=n.getHeaderFacetsFromManifest;var R=n.getDesignTimeMetadataSettingsForHeaderFacet;var V=a.removeDuplicateActions;var H=a.prepareMenuActions;var z=a.isMenuAIOperation;var B=a.isActionNavigable;var j=a.isActionAIOperation;var _=a.getVisibilityEnablementMenuActions;var G=a.getSemanticObjectMapping;var W=a.getMatchingManifestAction;var q=a.getEnabledForAnnotationAction;var K=a.getAnnotationMenuActionItems;var X=a.getActionsFromManifest;var Q=a.ButtonType;var J=t.resolveBindingString;var Y=t.ref;var Z=t.pathInModel;var ee=t.or;var te=t.notEqual;var ae=t.not;var ne=t.isConstant;var ie=t.ifElse;var oe=t.getExpressionFromAnnotation;var se=t.fn;var re=t.equal;var ce=t.compileExpression;var le=t.and;let ue=function(e){e["Unknown"]="Unknown";e["Form"]="Form";e["Notes"]="Notes";e["DataVisualization"]="DataVisualization";e["XMLFragment"]="XMLFragment";e["Placeholder"]="Placeholder";e["Mixed"]="Mixed";e["EmbeddedComponent"]="EmbeddedComponent";return e}({});m.SubSectionType=ue;const de=["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.Chart","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"];function fe(e,t,a,n){const i=e.reduce((e,t)=>{switch(t.$Type){case"com.sap.vocabularies.UI.v1.ReferenceFacet":e.push(t);break;case"com.sap.vocabularies.UI.v1.CollectionFacet":if(t.Facets.find(e=>e.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet")){e.splice(e.length,0,...t.Facets)}else{e.push(t)}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":break}return e},[]);return i.map(e=>Fe(e,i,t,0,!e?.Facets?.length,a,n))}m.createSubSections=fe;function ve(e){const t=x(e.getManifestWrapper().getHeaderFacets());const a=[];Object.keys(t).forEach(function(e){a.push(t[e]);return a});const n=a.reduce((e,t)=>{if(t.templateEdit){e.push(t)}return e},[]);return n.map(e=>pe(e))}m.createCustomHeaderFacetSubSections=ve;function pe(e){const t=C(e.key);const a={id:t,key:e.key,title:e.title,type:ue.XMLFragment,template:e.templateEdit||"",visible:e.visible,level:1,sideContent:undefined,stashed:e.stashed,flexSettings:e.flexSettings,actions:{},objectPageLazyLoaderEnabled:false};return a}const me=(e,t)=>e.ID?.toString()||e.Label?.toString()||t;function ge(e,t,a){for(let t=e.length-1;t>=0;t--){if(e[t].id?.startsWith("CustomAction::")&&(e[t].key.startsWith("DataFieldForAction::")||e[t].key.startsWith("DataFieldForIntentBasedNavigation::"))){e.splice(t,1)}}const n=F(t,a)||[],i={enabled:T.overwrite,visible:T.overwrite,command:T.overwrite,position:T.overwrite,menu:T.overwrite},o=h(t,a),s=X(o,a,e,undefined,undefined,n),r=K(e),c=W(r,s.actions),l=U(r,c,i);for(let t=e.length-1;t>=0;t--){if(e[t].id?.startsWith("CustomAction::")){for(const a in s.actions){if(a===e[t].key){e.splice(t,1);break}}}}let u=U(e,s.actions,i);H(u,l);u=V(u);u=_(u);u.forEach(e=>{if(e.type===L.Menu&&!!e.defaultAction){e.defaultAction.type=L.Default}});return{actions:u??e,commandActions:s.commandActions}}function be(e,t){let a=[];switch(e.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":a=e.Facets.filter(e=>g(e)).reduce((e,a)=>ye(e,a,t),[]);break;case"com.sap.vocabularies.UI.v1.ReferenceFacet":a=ye([],e,t);break;default:break}return ge(a,e,t)}function Ie(e){const t=re(oe(e),true);return ce(ie(t,Q.Ghost,Q.Transparent))}function Fe(t,a,n,i,o,s,r){const c=y(t);const l=t.annotations?.UI?.Hidden;const u=ae(re(true,oe(l,[],false,e=>E(e,n.getConvertedTypes(),[]))));const d=!ne(u)&&!M(l);const f=t.Label!==undefined?ce(oe(t.Label)):undefined;const v={id:c,key:me(t,c),title:f,type:ue.Unknown,annotationPath:n.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),visible:ce(u),isVisibilityDynamic:d,level:i,sideContent:undefined,objectPageLazyLoaderEnabled:n.getManifestWrapper().getEnableLazyLoading()};if(s){v.stashed=$(t,t,n);v.flexSettings={designtime:R(t,t,n)}}let p="";i++;switch(t.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":const c=t.Facets;const l=c.map((e,t)=>({index:t,facet:e})).filter(e=>{let{facet:t}=e;return g(t)&&t.Target.$target&&de.includes(t.Target.$target.term)});const m=c.filter(e=>!l.find(t=>t.facet===e));if(l.length>0){const a=[];const r=[];const c=[];for(const{facet:e}of l){a.push(Fe(e,[],n,i,true,s))}if(m.length>0){e.warning(`Warning: CollectionFacet '${t.ID}' includes a combination of either a chart or a table and other content. This can lead to rendering issues. Consider moving the chart or table into a separate CollectionFacet.`);const a={...t};a.Facets=m;r.push(Fe(a,[],n,i,o,s))}if(l.find(e=>{let{index:t}=e;return t===0})){c.push(...a);c.push(...r)}else{c.push(...r);c.push(...a)}const u={...v,type:ue.Mixed,level:i,content:c};return u}else{const e=be(t,n),a={...v,type:ue.Form,formDefinition:b(t,ce(u),n,e.actions,{useSingleTextAreaFieldAsNotes:r}),level:i,actions:e.actions.filter(e=>e.facetName===undefined),commandActions:e.commandActions};return a}case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!t.Target.$target){p=`Unable to find annotationPath ${t.Target.value}`}else{switch(t.Target.$target.term){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.PresentationVariant":case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":const e=I(t.Target.value,n,{isCondensedTableLayoutCompliant:De(t,a,n),doNotCheckApplySupported:s,shouldCreateTemplateChartVisualization:true});const c=v.title?v.title:"";const l=e.visualizations[0]?.annotation?.title||e.visualizations[0]?.title;const m=t.annotations?.UI?.PartOfPreview?.valueOf()!==false;const g=he(l??"",c,o);const F=ie(d,le(u,ae(re(f,"undefined")),g),le(ce(u)!==undefined,f!=="undefined",f!==undefined,u,g));const h={...v,type:ue.DataVisualization,level:i,presentation:e,isPartOfPreview:m,showSubSectionTitle:ce(g),dataVisualizationTitleVisible:ce(F)};return h;case"com.sap.vocabularies.UI.v1.FieldGroup":case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.DataPoint":case"com.sap.vocabularies.UI.v1.StatusInfo":case"com.sap.vocabularies.Communication.v1.Contact":const y=be(t,n),A={...v,type:ue.Form,level:i,formDefinition:b(t,ce(u),n,y.actions,{useSingleTextAreaFieldAsNotes:r}),actions:y.actions.filter(e=>e.facetName===undefined),commandActions:y.commandActions};return A;case"com.sap.vocabularies.UI.v1.Note":return{...v,type:ue.Notes};default:p=`For ${t.Target.$target.term} Fragment`;break}}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":p="For Reference URL Facet";break;default:break}const m={...v,type:ue.Unknown,text:p};return m}m.createSubSection=Fe;function he(e,t,a){return ee(ae(a),te(J(e),J(t)))}m.getShowSubSectionTitle=he;function ye(e,t,a){const n=t.Target.$target;const i=t.Target.value;let o={};let s=[];let r;[r]=i.split("@");if(r.length>0){if(r.lastIndexOf("/")===r.length-1){r=r.substring(0,r.length-1)}}else{r=undefined}if(n){switch(n.term){case"com.sap.vocabularies.UI.v1.FieldGroup":s=n.Data;o=X(a.getManifestControlConfiguration(n).actions,a,[],undefined,undefined,undefined,t.fullyQualifiedName).actions;break;case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.StatusInfo":if(n.qualifier){s=n}break;default:break}e=s.reduce((e,i)=>{switch(i.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":if(i.RequiresContext?.valueOf()===true){a.getDiagnostics().addIssue(w.Annotation,P.Low,O.MALFORMED_DATAFIELD_FOR_IBN.REQUIRESCONTEXT)}if(i.Inline?.valueOf()===true){a.getDiagnostics().addIssue(w.Annotation,P.Low,O.MALFORMED_DATAFIELD_FOR_IBN.INLINE)}if(i.Determining?.valueOf()===true){a.getDiagnostics().addIssue(w.Annotation,P.Low,O.MALFORMED_DATAFIELD_FOR_IBN.DETERMINING)}const o={};if(i.Mapping){o.semanticObjectMapping=G(i.Mapping)}e.push({type:L.DataFieldForIntentBasedNavigation,id:S(t,i),key:N.generateKeyFromDataField(i),text:i.Label?.toString(),annotationPath:"",enabled:i.NavigationAvailable!==undefined?ce(re(oe(i.NavigationAvailable),true)):"true",visible:ce(ae(re(oe(i.annotations?.UI?.Hidden),true))),buttonType:Ie(i.annotations?.UI?.Emphasized),press:ce(se("._intentBasedNavigation.navigate",[oe(i.SemanticObject),oe(i.Action),o])),customData:ce({semanticObject:oe(i.SemanticObject),action:oe(i.Action)})});break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":const s=a.getManifestControlConfiguration(n).actions;e.push(Ae(i,t,a,s,r));break;case"com.sap.vocabularies.UI.v1.DataFieldForActionGroup":e.push({type:L.Menu,text:i.Label?.toString(),key:N.generateKeyFromDataField(i),id:S(t,i),visible:ce(ae(re(oe(i.annotations?.UI?.Hidden),true))),isAIOperation:z(i.Actions)===true||undefined,menu:i.Actions.map(e=>{const i=a.getManifestControlConfiguration(n).actions;return Ae(e,t,a,i,r)})});break;default:break}return e},e)}return U(e,o)}function Ae(e,t,a,n,i){const o=N.generateKeyFromDataField(e);return{type:L.DataFieldForAction,id:S(t,e),key:N.generateKeyFromDataField(e),text:e.Label?.toString(),annotationPath:"",enabled:q(a,e.ActionTarget),binding:i&&!e.Inline?`{ 'path' : '${i}'}`:undefined,visible:ce(ae(re(oe(e.annotations?.UI?.Hidden),true))),requiresDialog:k(e),buttonType:Ie(e.annotations?.UI?.Emphasized),isAIOperation:j(e)===true||undefined,press:ce(se("invokeAction",[e.Action,{contexts:se("getBindingContext",[],Z("","$source")),invocationGrouping:e.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",label:e.Label?.toString(),model:se("getModel",[],Z("/","$source")),isNavigable:B(n&&n[o]),feFrameworkCall:true}],Y(".editFlow"))),facetName:e.Inline?t.fullyQualifiedName:undefined}}function Se(e){if(e){const t=e.annotations?.Common?.IsActionCritical;if(e.parameters.length>1||t){return"Dialog"}else{return"None"}}else{return"None"}}m.isDialog=Se;function Ce(e,t){const a={};Object.keys(e).forEach(n=>a[n]=Ue(e[n],n,t));return a}m.createCustomSubSections=Ce;function Ue(e,t,a){const n=e.sideContent?{template:e.sideContent.template,id:A(t),visible:false,equalSplit:e.sideContent.equalSplit}:undefined;let i=e.position;if(!i){i={placement:D.After}}const o=e.visible!==undefined?e.visible:true;const s=o&&typeof o==="string"&&o.indexOf("{=")===0;const r=X(e.actions,a);const c={type:ue.Unknown,id:e.id||C(t),actions:r.actions,key:t,title:e.title,level:1,position:i,visible:e.visible!==undefined?e.visible:"true",sideContent:n,isVisibilityDynamic:s,objectPageLazyLoaderEnabled:e.enableLazyLoading??false,componentName:"",settings:"",applyState:e.applyState,retrieveState:e.retrieveState};if(e.template||e.name){c.type=ue.XMLFragment;c.template=e.template||e.name||""}else if(e.embeddedComponent!==undefined){c.type=ue.EmbeddedComponent;c.componentName=e.embeddedComponent.name;if(e.embeddedComponent.settings!==undefined){c.settings=JSON.stringify(e.embeddedComponent.settings)}}else{c.type=ue.Placeholder}return c}m.createCustomSubSection=Ue;function De(e,t,a){const n=a.getManifestWrapper();if(n.useIconTabBar()){return Te(e,t)}else{const n=a.getEntityType();if(n.annotations?.UI?.Facets?.length&&n.annotations?.UI?.Facets?.length>1){return Te(e,t)}else{return true}}}function Te(e,t){return t.every(function(t){if(t!==e){if(t.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){const e=t;if(e.Target?.$target?.term==="com.sap.vocabularies.UI.v1.LineItem"||e.Target?.$target?.term==="com.sap.vocabularies.UI.v1.PresentationVariant"||e.Target.$target?.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){return e.annotations?.UI?.Hidden!==undefined?e.annotations?.UI?.Hidden:false}return true}else{const e=t;return e.Facets.every(function(e){const t=e;if(t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.LineItem"||t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.PresentationVariant"||t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){return t.annotations?.UI?.Hidden!==undefined?t.annotations?.UI?.Hidden:false}return true})}}return true})}return m},false);
//# sourceMappingURL=SubSection.js.map