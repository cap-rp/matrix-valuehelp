/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/UIFormatters","sap/ui/core/Lib","../../helpers/BindingHelper","../ManifestSettings"],function(e,t,n,i,a,o,r,s,l,c,u){"use strict";var f={};var d=u.ActionType;var p=c.singletonPathVisitor;var y=c.UI;var v=c.Draft;var g=s.isVisible;var b=r.isPathDeletable;var A=o.isEntitySet;var D=i.KeyHelper;var m=n.Placement;var h=t.isMenuAIOperation;var E=t.isActionAIOperation;var C=t.getSemanticObjectMapping;var I=t.getEnabledForAnnotationAction;var F=t.getCopyAction;var S=t.dataFieldIsCopyAction;var T=t.ButtonType;var O=e.pathInModel;var U=e.not;var B=e.ifElse;var N=e.getExpressionFromAnnotation;var P=e.fn;var H=e.equal;var M=e.constant;var k=e.compileExpression;var R=e.and;function x(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean(e.Determining?.valueOf())===t&&(e.ActionTarget?.isBound?.valueOf()!==true||e?.ActionTarget?.annotations?.Core?.OperationAvailable?.valueOf()!==false)?true:false)||[]}f.getIdentificationDataFieldForActions=x;function V(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean(e.Determining?.valueOf())===t&&(e.ActionTarget?.isBound?.valueOf()!==true||e?.ActionTarget?.annotations?.Core?.OperationAvailable?.valueOf()!==false)||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"?true:false)||[]}f.getIdentificationDataFieldForActionsOrGroups=V;function L(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&Boolean(e.Determining?.valueOf())===t?true:false)||[]}const j=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];f.IMPORTANT_CRITICALITIES=j;function w(e,t){const n=e.getDataModelObjectPath(),i=n.navigationProperties.map(e=>e.name),a=N(t,i,false,t=>p(t,e.getConvertedTypes(),[])),o=e.getManifestWrapper(),r=o.getViewLevel(),s=r>1?y.IsEditable:U(y.IsEditable);return B(t===undefined||t.valueOf()===false,s,R(s,H(a,false)))}f.getDeleteButtonVisibility=w;function $(e,t,n){const i=n.getEntitySet(),o=a.isDraftRoot(i);let r=B(t!==undefined,t,B(e!==undefined,H(N(e),true),M(true)));r=o?R(r,U(O("DraftAdministrativeData/InProcessByUser"))):r;return r}f.getDeleteButtonEnabled=$;function K(e,t,n,i,o,r){const s=n?.getEntitySet(),l=e.getEntitySet(),c=e.getManifestWrapper().isFclEnabled();let u;const f=G(n,t);const d=r?.HiddenDraft?.enabled;if(o&&o>1){u=a.isDraftNode(l)}else{u=a.isDraftRoot(s)}const p=G(n,i);const g=U(y.IsEditable);const b=B(o>1||d,B(i===undefined||i.valueOf()===false,R(g,H(O("rootEditVisible","internal"),true),B(c,H(O("/showEditButton","fclhelper"),true),true)),R(g,H(p,false),H(O("rootEditVisible","internal"),true),B(c,H(O("/showEditButton","fclhelper"),true),true))),B(t===undefined||t.valueOf()===false,g,R(g,H(f,false))));return B(u,R(b,v.HasNoDraftForCurrentUser),b)}f.getEditButtonVisibility=K;function G(e,t){const n=e.getDataModelObjectPath(),i=n.navigationProperties.map(e=>e.name),a=N(t,i,false,t=>p(t,e.getConvertedTypes(),i));return a}f.getHiddenExpression=G;function z(e,t,n){const i=e.getEntitySet(),o=a.isDraftRoot(i),r=a.isSticky(i);let s;if(o&&A(i)){s=i.annotations.Common?.DraftRoot?.EditAction}else if(r&&A(i)){s=i.annotations.Session?.StickySessionSupported?.EditAction}if(s){const i=e.getAbsoluteAnnotationPath(s);const a=e.resolveAbsolutePath(i).target;if(a?.annotations?.Core?.OperationAvailable===null){}else if(n>1){if(t!==undefined){return k(R(H(N(t),true),H(O("rootEditEnabled","internal"),true)))}else{return k(H(O("rootEditEnabled","internal"),true))}}else{return I(e,a??undefined)}}return"true"}f.getEditButtonEnabled=z;function W(e,t){const n=e.getContextPath();const i=a.getRootEntitySetPath(n);const o=e.getConverterContextFor("/"+i);const r=e.getEntitySet(),s=e.getEntityType(),c=o.getEntitySet(),u=o.getEntityType(),f=a.getStickySession(c),v=a.getDraftRoot(c),g=a.isCollaborationDraftSupportedFromConverterContext(e)&&v,m=a.getDraftNode(c),h=r&&r.annotations?.Capabilities?.DeleteRestrictions,E=a.isUpdateHidden(c,u),I=c&&A(c)&&E?.valueOf(),B=e.getDataModelObjectPath(),M=b(B,{pathVisitor:(t,n)=>p(t,e.getConvertedTypes(),n)}),x=M?k(M):M,G=V(e.getEntityType(),false);const W=e.getManifestWrapper().getViewLevel()===1?F(G.filter(e=>{if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){return S(e)}})):undefined;const _=G.filter(e=>!S(e));const q=[];if(A(r)&&v?.EditAction&&I!==true){q.push({type:d.DraftActions,key:"DraftActions"})}const J=e.getManifestWrapper().getViewLevel();const X=J>1?r?.annotations.Capabilities?.UpdateRestrictions?.Updatable:undefined;if(v||m){q.push({type:d.CollaborationAvatars,key:"CollaborationAvatars"})}Y(q,true,_,e);if((v?.EditAction||f?.EditAction)&&I!==true){let n=K(e,E,o,a.isUpdateHidden(r,s),J,t);if(g){n=R(n,U(H(y.hasCollaborationAuthorization,false)))}q.push({type:d.Primary,key:"EditAction",visible:k(n),enabled:z(o,X,J)})}if(x&&x!=="false"||h?.Deletable?.valueOf()!==false&&x!=="false"){const t=a.getDeleteHidden(r,s);let n=w(e,t);if(g){n=R(n,U(H(y.hasCollaborationAuthorization,false)))}q.push({type:d.Secondary,key:"DeleteAction",visible:k(n),enabled:k($(h?.Deletable,M,e)),parentEntityDeleteEnabled:x})}if(W){q.push({...Q(W,e),type:d.Copy,text:W.Label?.toString()??l.getResourceBundleFor("sap.fe.core").getText("C_COMMON_COPY")})}const Z=L(e.getEntityType(),false);Z.filter(e=>{const t=k(N(e?.Criticality));return!j.includes(t)}).forEach(t=>{if(t.RequiresContext?.valueOf()===true){throw new Error(`RequiresContext property should not be true for header IBN action : ${t.Label}`)}if(t.Inline?.valueOf()===true){throw new Error(`Inline property should not be true for header IBN action : ${t.Label}`)}const n={semanticObjectMapping:C(t.Mapping)};q.push({type:d.DataFieldForIntentBasedNavigation,text:t.Label?.toString(),annotationPath:e.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),buttonType:T.Ghost,visible:k(R(U(H(N(t.annotations?.UI?.Hidden),true)),U(H(O("shellNavigationNotAvailable","internal"),true)))),enabled:t.NavigationAvailable!==undefined?k(H(N(t.NavigationAvailable),true)):true,key:D.generateKeyFromDataField(t),isNavigable:true,press:k(P("._intentBasedNavigation.navigate",[N(t.SemanticObject),N(t.Action),n])),customData:k({semanticObject:N(t.SemanticObject),action:N(t.Action)})})});Y(q,false,_,e);return q}f.getHeaderDefaultActions=W;function _(e){const t=e.getEntityType();const n=t.annotations?.UI?.Identification?.filter(e=>e?.annotations?.UI?.Hidden?.valueOf()===true)||[];return n.map(e=>({type:d.Default,key:D.generateKeyFromDataField(e)}))}f.getHiddenHeaderActions=_;function q(e,t,n){const i=t.getEntitySet();const o=t.getEntityType();const r=a.getStickySession(i),s=A(i)&&(i.annotations.Common?.DraftRoot?.term??i.annotations.Session?.StickySessionSupported?.term),l=Boolean(s==="com.sap.vocabularies.Common.v1.DraftRoot"||n?.HiddenDraft?.enabled||r&&r?.SaveAction),c=e>1&&!n?.HiddenDraft?.enabled,u=Boolean(s==="com.sap.vocabularies.Common.v1.DraftRoot"||n?.HiddenDraft?.enabled||r&&r?.DiscardAction),f=e>1&&n?.HiddenDraft?.enabled&&!n?.HiddenDraft?.hideCreateNext;const p=x(t.getEntityType(),true);const y=p.filter(e=>{const t=k(N(e?.Criticality));return t&&j.includes(t)}).map(e=>Q(e,t));if(f){y.push({type:d.CreateNext,key:"CreateNextAction"})}if(i?.entityTypeName===o?.fullyQualifiedName&&l){y.push({type:d.Primary,key:"SaveAction"})}if(c){y.push({type:d.DefaultApply,key:"ApplyAction"})}p.filter(e=>{const t=k(N(e?.Criticality));return t&&!j.includes(t)}).forEach(e=>{y.push(Q(e,t))});if(u){y.push({type:d.Secondary,key:"CancelAction",position:{placement:m.End}})}return y}f.getFooterDefaultActions=q;function Q(e,t){let n=g(e);const i=a.isCollaborationDraftSupportedFromConverterContext(t)&&a.getDraftRoot(t.getEntitySet());if(i){n=R(n,U(H(y.hasCollaborationAuthorization,false)))}return{type:d.DataFieldForAction,annotationPath:t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:D.generateKeyFromDataField(e),visible:k(n),enabled:I(t,e.ActionTarget),isNavigable:true,isAIOperation:E(e)===true||undefined}}function Y(e,t,n,i){n.filter(e=>{const n=k(N(e?.Criticality));return t?j.includes(n):!j.includes(n)}).forEach(t=>{if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){e.push(Q(t,i))}else if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"){let n=U(H(N(t.annotations?.UI?.Hidden),true));const o=a.isCollaborationDraftSupportedFromConverterContext(i)&&a.getDraftRoot(i.getEntitySet());if(o){n=R(n,U(H(y.hasCollaborationAuthorization,false)))}e.push({type:d.Menu,text:t.Label,key:D.generateKeyFromDataField(t),id:D.generateKeyFromDataField(t),visible:k(n),menu:t.Actions.map(e=>Q(e,i)),isAIOperation:h(t.Actions)===true||undefined})}})}return f},false);
//# sourceMappingURL=HeaderAndFooterAction.js.map