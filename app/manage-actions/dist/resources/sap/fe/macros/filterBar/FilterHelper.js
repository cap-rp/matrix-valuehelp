/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/MetaModelConverter","sap/fe/core/templating/PropertyHelper","sap/fe/core/type/EDM","sap/fe/macros/field/FieldHelper","sap/ui/mdc/condition/Condition","sap/ui/mdc/enums/ConditionValidated","../CommonHelper","./SemanticDateOperators"],function(e,t,n,o,r,i,a,s,c){"use strict";var d={};var l=o.isTypeFilterable;var u=n.hasValueHelp;var f=t.getInvolvedDataModelObjects;const p={Contains:"NotContains",StartsWith:"NotStartsWith",EndsWith:"NotEndsWith",Empty:"NotEmpty",NotEmpty:"Empty",LE:"NOTLE",GE:"NOTGE",LT:"NOTLT",GT:"NOTGT",BT:"NOTBT",NE:"EQ",EQ:"NE"};function g(e){let t;if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,2}):(\d{1,2})/)){t=e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})\+(\d{1,2}):(\d{1,2})/)[0]}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2}).(\d{1,7})[+-](\d{1,2}):(\d{1,2})/)){t=e}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)){t=`${e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})T(\d{1,2}):(\d{1,2}):(\d{1,2})/)[0]}+0000`}else if(e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)){t=`${e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]}T00:00:00+0000`}else if(e.indexOf("Z")===e.length-1){t=`${e.split("Z")[0]}+0100`}else{t=undefined}return t}d._getDateTimeOffsetCompliantValue=g;function m(e){return e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)?e.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/)[0]:e.match(/^(\d{8})/)&&e.match(/^(\d{8})/)[0]}d._getDateCompliantValue=m;function h(e,t,n){if(!l(t)||!n){return undefined}if(e===undefined||e===null){return e}let o=e;switch(t){case"Edm.Boolean":if(typeof e==="boolean"){o=e}else{o=e==="true"||(e==="false"?false:undefined)}break;case"Edm.Double":case"Edm.Single":if(e===""&&n==="EQ"){break}const t=Number(e);o=isNaN(t)?undefined:parseFloat(e.toString());break;case"Edm.Byte":case"Edm.Int16":case"Edm.Int32":case"Edm.SByte":if(o===""&&n==="EQ"){break}const r=Number(e);o=isNaN(r)?undefined:parseInt(e.toString(),10);break;case"Edm.Date":o=m(e.toString());break;case"Edm.DateTimeOffset":o=g(e.toString());break;case"Edm.TimeOfDay":o=e.toString().match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)?e.toString().match(/(\d{1,2}):(\d{1,2}):(\d{1,2})/)?.[0]:undefined;break;default:}return o===null?undefined:o}d.getTypeCompliantValue=h;function E(t,n,o,r){let i=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];let a=n,s,c;if(n===undefined||n===null){return undefined}switch(t){case"CP":c="Contains";if(a){const t=a.indexOf("*");const n=a.lastIndexOf("*");if(t>-1){if(t===0&&n!==a.length-1){c="EndsWith";a=a.substring(1,a.length)}else if(t!==0&&n===a.length-1){c="StartsWith";a=a.substring(0,a.length-1)}else{a=a.substring(1,a.length-1)}}else{e.warning("Contains Option cannot be used without '*'.");return undefined}}break;case"EQ":c=t;if(i.length===0||i.includes("Empty")){c=n===""?"Empty":t}break;case"NE":c=n===""?"NotEmpty":t;break;case"BT":if(o===undefined||o===null){return}s=o;c=t;break;case"LE":case"GE":case"GT":case"LT":c=t;break;default:e.warning(`Selection Option is not supported : '${t}'`);return undefined}if(r==="E"){c=p[c]}const d={values:[],isEmpty:null,operator:c};if(c!=="Empty"){d.values.push(a);if(s){d.values.push(s)}}return d}d.resolveConditionValues=E;function y(e){return e.indexOf("/")>0?e.split("/")[1]:e}d.getRangeProperty=y;function b(e,t,n,o){const r=[];const i=u(t);e?.forEach(e=>{const a=o?o(e,t,n):N(e,t.type,i);if(a){r.push(a)}});return r}function v(e,t,n){const o=t.getMetaContext(`${n}/${e}`),r=f(o);return r.targetObject}function C(e,t,n,o){const r=e.PropertyName,i={},a=r.value||r?.$PropertyPath,s=e.Ranges??[];const c=v(a,t,n);if(c){const e=b(s,c,a,o);if(e.length){i[a]=(i[a]||[]).concat(e)}}return i}function O(e,t,n,o){let r={};if(!n){return r}const i=n.SelectOptions,s=n.Parameters;i?.forEach(n=>{const i=n.PropertyName;const a=i.value||i.$PropertyPath;if(Object.keys(r).includes(a)){r[a]=r[a].concat(C(n,t,e,o)[a])}else{r={...r,...C(n,t,e,o)}}});s?.forEach(e=>{const t=e.PropertyName.value||e.PropertyName.$PropertyPath;const n=o?{operator:"EQ",value1:e.PropertyValue,value2:null,path:t,isParameter:true}:{operator:"EQ",values:[e.PropertyValue],isEmpty:null,validated:a.Validated,isParameter:true};r[t]=[n]});return r}d.getFiltersConditionsFromSelectionVariant=O;function N(t,n,o){let r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];let s;try{const e=y(t.Sign);const c=y(t.Option);const d=h(t.Low,n,c);const l=t.High?h(t.High,n,c):undefined;const u=E(c,d,l,e,r);if(u){const e=o&&u.operator==="EQ"?a.Validated:a.NotValidated;s=i.createCondition(u.operator,u.values,null,null,e)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Core : FilterHelper : getConditions : ${n}`)}return s}d.getConditions=N;const T=function(e,t){const n={};const o=e.getInterface(1).getPath(),r=e.getInterface(1).getModel();if(t){for(const e in t){const t=r.getObject(`${o}/${e}@com.sap.vocabularies.Common.v1.FilterDefaultValue`);if(t!==undefined){const o=e;n[o]=[i.createCondition("EQ",[t],null,null,a.Validated)]}}}return n};const S=function(e,t){const n={};const o=e.getInterface(1);const r=o.getModel();const a=o.getPath();for(const e in t){if(t[e][0]){const o=e.split("::");let s="";const c=o.length;const d=o.slice(0,o.length-1).join("/");const l=o[c-1];if(d){const e=r.getObject(a+"/"+d);if(e.$kind==="NavigationProperty"&&e.$isCollection){s+=`${d}*/`}else if(e.$kind==="NavigationProperty"){s+=`${d}/`}}s+=l;const u="values"in t[e][0]?t[e][0].values:[];n[s]=[i.createCondition(t[e][0].operator,u,null,null,null)]}}return n};function $(){const e={};e["$editState"]=[i.createCondition("DRAFT_EDIT_STATE",["ALL"],null,null,a.Validated)];return e}d.getEditStatusFilter=$;function P(e,t,n,o){let r=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;let i;const a=e.getInterface(1).getPath(),s=e.getInterface(1).getModel(),c=s?.getObject(`${a}@`),d=s?.getObject(`${a}/`);if(c&&(c["@com.sap.vocabularies.Common.v1.DraftRoot"]||c["@com.sap.vocabularies.Common.v1.DraftNode"])&&r){i=$()}const l=t?.selectionVariant;const u=t?.defaultSemanticDates||{};const f=T(e,d);const p=S(e,u);let g={};if(l){g=O(a,s,l)}else if(f){g=f}if(p){g={...g,...p}}if(i){g={...g,...i}}const m=o?.controlConfiguration?.["@com.sap.vocabularies.UI.v1.SelectionFields"]??{};g=D(e.getInterface(1),g,m);return Object.keys(g).length>0?JSON.stringify(g).replace(/([{}])/g,"\\$1"):undefined}d.getFilterConditions=P;P.requiresIContext=true;function D(t,n,o){const i=t.getModel();const{filterFields:a={},useSemanticDateRange:c=true}=o;for(const o in n){try{const e=i.createBindingContext(`${t.getPath()}/${o}`);const d=e?.getObject();const l=a[o]?.settings;if(e){const i=r.operators(e,d,c,s.stringifyCustomData(l),t.getPath()||"");const a=i?i.split(","):[];n[o]=F(a,n[o],o)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : FilterBar : Error determining conditions for supported operators of property ${o} : ${n}`)}}return n}d.getConditionsOfSupportedOperators=D;function F(t,n,o){let r=n;const i=c.getSemanticDateOperations();if(t.length>0){r=n.filter(n=>{const r=n.operator;if(i.includes(r)&&!t.includes(r)){e.warning(`FE : FilterBar : ${r} not supported for property ${o}. Hence, not applied to FilterBar.`);return false}return true},[])}return r}return d},false);
//# sourceMappingURL=FilterHelper.js.map