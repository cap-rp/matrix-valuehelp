/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/merge","sap/fe/base/ClassSupport","sap/fe/base/HookSupport","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/StableIdHelper","sap/fe/macros/chart/Action","sap/fe/macros/chart/ChartRuntime","sap/fe/macros/chart/ChartUtils","sap/fe/macros/filter/FilterUtils","sap/fe/navigation/PresentationVariant","sap/ui/core/library","sap/ui/mdc/p13n/StateUtil","sap/ui/model/Filter","./MacroAPI","./chart/MdcChartTemplate","./chart/adapter/ChartPvToStateUtils","./insights/AnalyticalInsightsHelper","./insights/CommonInsightsHelper","./insights/InsightsService","./mdc/adapter/StateHelper"],function(t,e,n,r,a,i,o,l,s,c,u,p,g,h,f,d,y,b,C,m,v){"use strict";var S,P,w,_,A,I,M,V,D,x,z,T,O,E,j,k,H,U,R,F,B,K,N,q,L,$,W,G,J,Q,X,Y,Z,tt,et,nt,rt,at,it,ot,lt,st,ct,ut,pt,gt,ht,ft,dt,yt;function bt(t){return new Promise((e,n)=>{sap.ui.require([t],n=>{if(!(n&&n.__esModule)){n=n===null||!(typeof n==="object"&&t.endsWith("/library"))?{default:n}:n;Object.defineProperty(n,"__esModule",{value:true})}e(n)},t=>{n(t)})})}var Ct={};var mt=m.showInsightsCardPreview;var vt=m.showCollaborationManagerCardPreview;var St=m.getCardManifest;var Pt=C.showGenericErrorMessage;var wt=C.hasInsightActionEnabled;var _t=b.createChartCardParams;var At=d.getMdcChartTemplate;var It=p.TitleLevel;var Mt=i.generate;var Vt=a.getInvolvedDataModelObjects;var Dt=r.controllerExtensionHandler;var xt=n.xmlEventHandler;var zt=n.property;var Tt=n.implementInterface;var Ot=n.event;var Et=n.defineUI5Class;var jt=n.association;var kt=n.aggregation;function Ht(t,e,n,r){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Ut(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Rt(t,e)}function Rt(t,e){return Rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Rt(t,e)}function Ft(t,e,n,r,a){var i={};return Object.keys(r).forEach(function(t){i[t]=r[t]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(t,e,n)||n},i),a&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(a):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(t,e,i),null):i}function Bt(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let Kt=(S=Et("sap.fe.macros.Chart",{returnTypes:["sap.fe.macros.MacroAPI"]}),P=Tt("sap.fe.core.controllerextensions.viewState.IViewStateContributor"),w=Tt("sap.fe.macros.controls.section.ISingleSectionContributor"),_=zt({type:"string"}),A=zt({type:"string",required:true,expectedTypes:["EntitySet","EntityType","Singleton","NavigationProperty"],expectedAnnotations:["com.sap.vocabularies.UI.v1.Chart","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"]}),I=zt({type:"string",required:true,expectedTypes:["EntitySet","EntityType","Singleton","NavigationProperty"],expectedAnnotations:[]}),M=zt({type:"string"}),V=zt({type:"boolean",defaultValue:true}),D=zt({type:"string",defaultValue:"Multiple",allowedValues:["None","Single","Multiple"]}),x=zt({type:"string",allowedValues:["Control"]}),z=zt({type:"string",defaultValue:true}),T=zt({type:"string"}),O=zt({type:"object"}),E=zt({type:"boolean"}),j=zt({type:"string"}),k=jt({type:"sap.ui.core.Control"}),H=kt({type:"sap.ui.core.LayoutData"}),U=kt({type:"sap.fe.macros.chart.Action",altTypes:["sap.fe.macros.chart.ActionGroup"],multiple:true,defaultClass:o}),R=Ot(),F=Ot(),B=Ot(),K=Ot(),N=Ot(),q=xt(),L=xt(),$=Dt("collaborationManager","collectAvailableCards"),S(W=(G=function(n){function r(t,e){var r;if(t?._applyIdToContent){t.id=Mt([t.id,"::Chart"])}r=n.call(this,t,e)||this;Ht(r,"__implements__sap_fe_core_controllerextensions_viewState_IViewStateContributor",J,r);Ht(r,"__implements__sap_fe_macros_controls_section_ISingleSectionContributor",Q,r);Ht(r,"id",X,r);Ht(r,"metaPath",Y,r);Ht(r,"contextPath",Z,r);Ht(r,"header",tt,r);Ht(r,"headerVisible",et,r);Ht(r,"selectionMode",nt,r);Ht(r,"variantManagement",rt,r);Ht(r,"personalization",at,r);Ht(r,"headerLevel",it,r);Ht(r,"chartDelegate",ot,r);Ht(r,"_applyIdToContent",lt,r);Ht(r,"noDataText",st,r);r.prevDrillStack=[];r.initialControlState={};r.chartActions=[];r._commandActions=[];Ht(r,"filterBar",ct,r);Ht(r,"layoutData",ut,r);Ht(r,"actions",pt,r);Ht(r,"selectionChange",gt,r);Ht(r,"internalDataRequested",ht,r);Ht(r,"variantSelected",ft,r);Ht(r,"variantSaved",dt,r);Ht(r,"segmentedButtonPressed",yt,r);return r}Ct=r;Ut(r,n);var a=r.prototype;a.getSectionContentRole=function t(){return"consumer"};a.sendDataToConsumer=function t(e){this.content?.setHeader(e.title);this.content?.setHeaderStyle("H4");this.content?.setHeaderLevel(e.titleLevel)};a.getSelectedContexts=function t(){return this.content?.getBindingContext("internal")?.getProperty("selectedContexts")||[]};a.isA=function t(e){const r="sap.fe.macros.chart.ChartAPI";if(Array.isArray(e)&&e.includes(r)||e===r)return true;return n.prototype.isA.call(this,e)};a.onMetadataAvailable=function t(){if(!this.content){this.content=this.createContent()}};a.onAfterRendering=function t(e){const r=this.getPageController()?.getView();const a=r?.getBindingContext("internal");const i=this.getContent();const o=a?.getProperty("controls/showMessageStrip")||{};const l=i.data("entitySet"),s=`${l}Chart`,c=r?.getBindingContext();o[s]=i.data("draftSupported")==="true"&&!!c&&!c.getObject("IsActiveEntity");a.setProperty("controls/showMessageStrip",o);this.attachStateChangeHandler();n.prototype.onAfterRendering.call(this,e)};a.attachStateChangeHandler=function t(){g.detachStateChange(this.stateChangeHandler);g.attachStateChange(this.stateChangeHandler)};a.stateChangeHandler=function t(e){const n=e.getParameter("control");if(n.isA("sap.ui.mdc.Chart")){const t=n.getParent();if(t?.handleStateChange){t.handleStateChange()}}};a.refreshNotApplicableFields=function t(e){const n=this.getContent();return c.getNotApplicableFilters(e,n)};a.handleSelectionChange=function t(n){const r=n.getParameter("data");const a=n.getParameter("name")==="selectData";l.fnUpdateChart(n);this.fireEvent("selectionChange",e({},{data:r,selected:a}))};a.onInternalDataRequested=function t(){this.fireEvent("internalDataRequested")};a.collectAvailableCards=async function t(e){const n=this.content.getActions();if(wt(n,this.content.getFilter())){const t=await this.getCardManifestChart();if(Object.keys(t).length>0){e.push({card:t,title:this.getChartControl().getHeader(),callback:this.onAddCardToCollaborationManagerCallback.bind(this)})}}};a.hasSelections=function e(){const n=this.content;if(n){try{const t=n.getControlDelegate()?.getInnerChart(n);if(t){const e=s.getDimensionsFromDrillStack(t);const r=e.length>this.prevDrillStack.length;const a=e.length<this.prevDrillStack.length;const i=e.toString()===this.prevDrillStack.toString();let o;if(a&&e.length===1){o=s.getChartSelections(n,true)}else{o=s.getChartSelections(n)}if(r||a){this.prevDrillStack=e;return o.length>0}else if(i){return o.length>0}}}catch(e){t.error(`Error while checking for selections in Chart: ${e}`)}}return false};a.onAddCardToInsightsPressed=async function e(){try{const t=await _t(this);if(t){mt(t);return}}catch(e){Pt(this.content);t.error(e)}};a.getCardManifestChart=async function t(){const e=await _t(this);return St(e)};a.onAddCardToCollaborationManagerCallback=async function e(n){try{if(n){await vt(n,this.getPageController()?.collaborationManager.getService());return}}catch(e){Pt(this.content);t.error(e)}};a.getFilter=function t(){const e=s.getAllFilterInfo(this.content);if(e.filters.length){e.filters.forEach(t=>{if(t.getPath()){t.sPath=this.getChartPropertiesWithoutPrefixes(t.getPath())}});return new h({filters:e.filters,and:true})}return undefined};a.getChartControl=function t(){return this.content};a.getPropertyDataModel=function t(e){const n=this.content.data("targetCollectionPath");const r=this.content.getModel().getMetaModel();const a=r.createBindingContext(`${n}/${e}`);return Vt(a)};a.getChartPropertiesWithoutPrefixes=function t(e){if(e&&e.includes("fe_groupable")){e=this.getInternalChartNameFromPropertyNameAndKind(e,"groupable")}else if(e&&e.includes("fe_aggregatable")){e=this.getInternalChartNameFromPropertyNameAndKind(e,"aggregatable")}return e};a.getInternalChartNameFromPropertyNameAndKind=function t(e,n){return e.replace("_fe_"+n+"_","")};a._convertStateUtilToPresentationVariant=function t(e){const n=e.sorters?.map(t=>({Property:this.getChartPropertiesWithoutPrefixes(t.name),Descending:t.descending}));const r=e.supplementaryConfig?.properties?.chartType;const a=r?r.charAt(0).toUpperCase()+r.slice(1):undefined;const i="com.sap.vocabularies.UI.v1.ChartType/"+a;const o=[],l=[],s=[],c=[];(e.items??[]).forEach(t=>{t.name=this.getChartPropertiesWithoutPrefixes(t.name);const e=t.role?.length?t.role.substring(0,1).toUpperCase()+t.role?.substring(1,t.role.length):undefined;if(t.role==="category"||t.role==="series"||t.role==="category2"){o.push(t.name);s.push({Dimension:t.name,Role:`com.sap.vocabularies.UI.v1.ChartDimensionRoleType/${e}`})}else{l.push(t.name);c.push({Measure:t.name,Role:"com.sap.vocabularies.UI.v1.ChartDimensionRoleType/"+e})}});const p={Content:{ChartType:i,DimensionAttributes:s,Dimensions:o,MeasureAttributes:c,Measures:l},Type:"Chart"};const g=new u;g.setChartVisualization(p);g.setProperties({SortOrder:n??[]});return g};a.getPresentationVariant=async function e(){try{const t=await g.retrieveExternalState(this.content);return this._convertStateUtilToPresentationVariant(t)}catch(e){const n=this.getId();const r=e instanceof Error?e.message:String(e);t.error(`Chart Building Block (${n}) - get presentation variant failed : ${r}`);throw Error(r)}};a.setPresentationVariant=async function e(n){try{const t=this.content;const e=await this.getPresentationVariant();const r=await(t.getControlDelegate()?.fetchProperties(t));const a=y.convertPvToStateUtilPv(n,e,r);await g.applyExternalState(t,a)}catch(e){const n=e instanceof Error?e.message:String(e);t.error(`FE: Chart Building Block setPresentationVariant API failed with error: ${n}`);throw Error(n)}};a.getCurrentVariantKey=function t(){return this.content.getVariant().getCurrentVariantKey()};a.setCurrentVariantKey=function t(e){const n=this.content.getVariant();n.setCurrentVariantKey(e)};a.getSelectionVariant=async function t(){return v.getSelectionVariant(this.content)};a.setSelectionVariant=async function t(e){let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return v.setSelectionVariantToMdcControl(this.getContent(),e,n)};a.getControlState=function t(e){const n=this.initialControlState;if(e){return{fullState:e,initialState:n}}return e};a.setInitialState=async function e(){try{const t=await g.retrieveExternalState(this.content);this.initialControlState=t}catch(e){t.error(e)}};a.retrieveState=async function t(){const e={};e.innerChart=this.getControlState(await g.retrieveExternalState(this.content));const n=this.content.getVariant()?.getId();if(n){const t=this.content.getVariant();if(!e.variantManagement){e.variantManagement={variantId:t?.getCurrentVariantKey()}}else{e.variantManagement.variantId=t?.getCurrentVariantKey()}}return e};a.applyLegacyState=async function t(e,n,r){const a=this.content;const i=a.getVariant();const o=e(a);const l=i?e(i):null;const s={};if(o){s.innerChart={...s.innerChart,...o,fullState:{...s.innerChart?.fullState,...o.fullState},initialState:{...s.innerChart?.initialState,...o.initialState}}}if(l?.variantId){s.variantManagement={...s.variantManagement,variantId:l.variantId.toString()}}if(s&&Object.keys(s).length>0){await this.applyState(s,n,r)}};a.applyState=async function e(n,r,a){if(!n)return;const i=n.variantManagement?.variantId;const o=this.content?.getVariant();if(i!==undefined&&i!==o.getCurrentVariantKey()){const e=this.content?.getVariant();const n=e?.getVariants();const r=n?.some(t=>t.getKey()===i)?i:e?.getStandardVariantKey;try{const t=(await bt("sap/ui/fl/apply/api/ControlVariantApplyAPI")).default;await t.activateVariant({element:e,variantReference:r});await this.setInitialState()}catch(e){t.error(e);await this.setInitialState()}}else{await this.setInitialState()}const l=n.innerChart;let s;if(l){if(a&&l.initialState){s=await g.diffState(this.content,l.initialState,l.fullState)}else{s=l.fullState}await g.applyExternalState(this.content,s)}};a.handleStateChange=function t(){this.getPageController()?.getExtensionAPI().updateAppState()};a._createContent=function t(){const e=this._getOwner();if(e?.isA("sap.fe.core.TemplateComponent")){this.content.setFilter("");this.content.destroy();this.content=this.createContent()}};a.setProperty=function t(e,r,a){if(!this._applyingSettings&&r!==undefined&&Object.keys(this.getMetadata().getProperties()).includes(e)){n.prototype.setProperty.call(this,e,r,true);this._createContent()}else{n.prototype.setProperty.call(this,e,r,a)}return this};a.removeAggregation=function t(e,r,a){let i;if(!this._applyingSettings&&r!==undefined&&Object.keys(this.getMetadata().getAggregations()).includes(e)){i=n.prototype.removeAggregation.call(this,e,r,a);this._createContent()}else{i=n.prototype.removeAggregation.call(this,e,r,a)}return i};a.addAggregation=function t(e,r,a){if(!this._applyingSettings&&Object.keys(this.getMetadata().getAggregations()).includes(e)){n.prototype.addAggregation.call(this,e,r,a);this._createContent()}else{n.prototype.addAggregation.call(this,e,r,a)}return this};a.insertAggregation=function t(e,r,a,i){if(!this._applyingSettings&&Object.keys(this.getMetadata().getAggregations()).includes(e)){n.prototype.insertAggregation.call(this,e,r,a,i);this._createContent()}else{n.prototype.insertAggregation.call(this,e,r,a,i)}return this};a.createContent=function t(){if(this.contextPath){this._resolvedContextPath=this.contextPath.endsWith("/")?this.contextPath:this.contextPath+"/"}return At(this,this._getOwner()?.getRootController()?.getView().getViewData()??this._getOwner()?.getViewData(),this.getAppComponent()?.getDiagnostics()??{},this.getDataModelObjectForMetaPath(this.metaPath,this._resolvedContextPath))};return r}(f),J=Ft(G.prototype,"__implements__sap_fe_core_controllerextensions_viewState_IViewStateContributor",[P],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),Q=Ft(G.prototype,"__implements__sap_fe_macros_controls_section_ISingleSectionContributor",[w],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),X=Ft(G.prototype,"id",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=Ft(G.prototype,"metaPath",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=Ft(G.prototype,"contextPath",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),tt=Ft(G.prototype,"header",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),et=Ft(G.prototype,"headerVisible",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),nt=Ft(G.prototype,"selectionMode",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),rt=Ft(G.prototype,"variantManagement",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),at=Ft(G.prototype,"personalization",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),it=Ft(G.prototype,"headerLevel",[T],{configurable:true,enumerable:true,writable:true,initializer:function(){return It.Auto}}),ot=Ft(G.prototype,"chartDelegate",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),lt=Ft(G.prototype,"_applyIdToContent",[E],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),st=Ft(G.prototype,"noDataText",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),ct=Ft(G.prototype,"filterBar",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),ut=Ft(G.prototype,"layoutData",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),pt=Ft(G.prototype,"actions",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),gt=Ft(G.prototype,"selectionChange",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),ht=Ft(G.prototype,"internalDataRequested",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),ft=Ft(G.prototype,"variantSelected",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),dt=Ft(G.prototype,"variantSaved",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),yt=Ft(G.prototype,"segmentedButtonPressed",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),Ft(G.prototype,"handleSelectionChange",[q],Object.getOwnPropertyDescriptor(G.prototype,"handleSelectionChange"),G.prototype),Ft(G.prototype,"onInternalDataRequested",[L],Object.getOwnPropertyDescriptor(G.prototype,"onInternalDataRequested"),G.prototype),Ft(G.prototype,"collectAvailableCards",[$],Object.getOwnPropertyDescriptor(G.prototype,"collectAvailableCards"),G.prototype),G))||W);Ct=Kt;return Ct},false);
//# sourceMappingURL=Chart.js.map