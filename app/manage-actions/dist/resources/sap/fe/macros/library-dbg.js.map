{"version":3,"names":["macrosNamespace","_exports","thisLib","Library","init","name","apiVersion","dependencies","types","interfaces","controls","elements","version","noLibraryCSS","extensions","flChangeHandlers","NavigationType","DataType","registerEnum","Fragment","registerType","load","getType","mSettings","currentController","containingView","getController","targetControllerExtension","isA","getExtensionAPI","id","oController","childCustomData","undefined","contextPath","_fnSettingsPreprocessor","controlSettings","getMetadata","hasProperty","_len","arguments","length","args","Array","_key","result","apply","customDataKey","addCustomData","CustomData","key","value","_len2","_key2","then","AppComponent","registerInstanceDependentProcessForStartUp","FilterOperatorUtils","processCustomFilterOperators","catch","error","Log","rewriteNodes","parentNamespace","parentName","childNamespace","childName","oNode","_oVisitor","hasChildNodes","attributes","visitChildNodes","newNode","document","createElementNS","newParent","attributeNames","getAttributeNames","attributeName","setAttribute","getAttribute","appendChild","replaceWith","XMLPreprocessor","plugIn"],"sourceRoot":".","sources":["library.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport \"sap/f/library\";\nimport \"sap/fe/controls/library\";\nimport AppComponent from \"sap/fe/core/AppComponent\";\nimport type ExtensionAPI from \"sap/fe/core/ExtensionAPI\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type { IVisitorCallback } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport \"sap/fe/core/library\";\nimport \"sap/fe/macros/coreUI/factory\";\nimport FilterOperatorUtils from \"sap/fe/macros/filter/FilterOperatorUtils\";\nimport \"sap/fe/macros/filter/type/MultiValue\";\nimport \"sap/fe/macros/filter/type/Range\";\nimport \"sap/fe/macros/formatters/TableFormatter\";\nimport \"sap/fe/macros/macroLibrary\";\nimport DataType from \"sap/ui/base/DataType\";\nimport type Control from \"sap/ui/core/Control\";\nimport CustomData from \"sap/ui/core/CustomData\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport Library from \"sap/ui/core/Lib\";\nimport \"sap/ui/core/XMLTemplateProcessor\";\nimport \"sap/ui/core/library\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport XMLPreprocessor from \"sap/ui/core/util/XMLPreprocessor\";\nimport \"sap/ui/mdc/field/ConditionsType\";\nimport \"sap/ui/mdc/library\";\nimport \"sap/ui/unified/library\";\n\n/**\n * Library containing the building blocks for SAP Fiori elements.\n * @namespace\n * @public\n */\nexport const macrosNamespace = \"sap.fe.macros\";\n\n// library dependencies\nconst thisLib = Library.init({\n\tname: \"sap.fe.macros\",\n\tapiVersion: 2,\n\tdependencies: [\"sap.ui.core\", \"sap.ui.mdc\", \"sap.ui.unified\", \"sap.fe.core\", \"sap.fe.navigation\", \"sap.fe.controls\", \"sap.m\", \"sap.f\"],\n\ttypes: [\"sap.fe.macros.NavigationType\"],\n\tinterfaces: [],\n\tcontrols: [],\n\telements: [],\n\t// eslint-disable-next-line no-template-curly-in-string\n\tversion: \"${version}\",\n\tnoLibraryCSS: true,\n\textensions: {\n\t\tflChangeHandlers: {\n\t\t\t\"sap.fe.macros.controls.FilterBar\": \"sap/ui/mdc/flexibility/FilterBar\",\n\t\t\t\"sap.fe.macros.controls.Section\": \"sap/uxap/flexibility/ObjectPageSection\",\n\t\t\t\"sap.fe.macros.controls.section.SubSection\": \"sap/uxap/flexibility/ObjectPageSubSection\"\n\t\t}\n\t}\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n}) as any;\n\nexport enum NavigationType {\n\t/**\n\t * For External Navigation\n\t * @public\n\t */\n\tExternal = \"External\",\n\n\t/**\n\t * For In-Page Navigation\n\t * @public\n\t */\n\tInPage = \"InPage\",\n\n\t/**\n\t * For No Navigation\n\t * @public\n\t */\n\tNone = \"None\"\n}\n\nthisLib.NavigationType = NavigationType;\nDataType.registerEnum(\"sap.fe.macros.NavigationType\", thisLib.NavigationType);\nFragment.registerType(\"CUSTOM\", {\n\tload: (Fragment as { getType?: Function }).getType?.(\"XML\").load,\n\tinit: async function (\n\t\tmSettings: { containingView: View; id: string; childCustomData: Record<string, string> | undefined; contextPath?: string },\n\t\t...args: unknown[]\n\t) {\n\t\tconst currentController = mSettings.containingView.getController() as PageController;\n\t\tlet targetControllerExtension: PageController | ExtensionAPI = currentController;\n\t\tif (currentController && !currentController.isA<ExtensionAPI>(\"sap.fe.core.ExtensionAPI\")) {\n\t\t\ttargetControllerExtension = currentController.getExtensionAPI(mSettings.id);\n\t\t}\n\t\tmSettings.containingView = {\n\t\t\toController: targetControllerExtension\n\t\t} as unknown as View;\n\t\tconst childCustomData = mSettings.childCustomData ?? undefined;\n\t\tconst contextPath = mSettings.contextPath;\n\t\tdelete mSettings.childCustomData;\n\t\tdelete mSettings.contextPath;\n\t\t(this as { _fnSettingsPreprocessor?: Function })._fnSettingsPreprocessor = function (\n\t\t\tthis: Control,\n\t\t\tcontrolSettings: {\n\t\t\t\tcontextPath: unknown;\n\t\t\t}\n\t\t): unknown {\n\t\t\tif (this.getMetadata().hasProperty(\"contextPath\")) {\n\t\t\t\tcontrolSettings.contextPath ??= contextPath;\n\t\t\t}\n\n\t\t\treturn controlSettings;\n\t\t};\n\t\tconst result = await (Fragment as unknown as { getType: Function }).getType(\"XML\").init.apply(this, [mSettings, args]);\n\t\tif (childCustomData && result?.isA(\"sap.ui.core.Control\")) {\n\t\t\tfor (const customDataKey in childCustomData) {\n\t\t\t\t// UI5 adds 'bindingString' when its an adaptation project (SNOW: DINC0143515), which results in errors later\n\t\t\t\tif (customDataKey === \"bindingString\") {\n\t\t\t\t\tdelete childCustomData[customDataKey];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t(result as Control).addCustomData(new CustomData({ key: customDataKey, value: childCustomData[customDataKey] }));\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n});\n\nFragment.registerType(\"SCOPEDFEFRAGMENT\", {\n\tload: (Fragment as { getType?: Function }).getType?.(\"XML\").load,\n\tinit: function (\n\t\tmSettings: { containingView: View; id: string; childCustomData: Record<string, string> | undefined; contextPath?: string },\n\t\t...args: unknown[]\n\t) {\n\t\tconst contextPath = mSettings.contextPath;\n\t\tdelete mSettings.contextPath;\n\t\t(this as { _fnSettingsPreprocessor?: Function })._fnSettingsPreprocessor = function (\n\t\t\tthis: Control,\n\t\t\tcontrolSettings: {\n\t\t\t\tcontextPath: unknown;\n\t\t\t}\n\t\t): unknown {\n\t\t\tif (this.getMetadata().hasProperty(\"contextPath\")) {\n\t\t\t\tcontrolSettings.contextPath ??= contextPath;\n\t\t\t}\n\n\t\t\treturn controlSettings;\n\t\t};\n\t\treturn (Fragment as unknown as { getType: Function }).getType(\"XML\").init.apply(this, [mSettings, args]);\n\t}\n});\n\nLibrary.load({ name: \"sap.fe.macros\" })\n\t.then(() => {\n\t\tAppComponent.registerInstanceDependentProcessForStartUp(FilterOperatorUtils.processCustomFilterOperators);\n\t\treturn;\n\t})\n\t.catch((error: unknown) => {\n\t\tLog.error(`Error loading 'sap.fe.macros`, error as Error | string);\n\t});\n\nconst rewriteNodes = function (parentNamespace: string, parentName: string, childNamespace: string, childName: string): Function {\n\t// eslint-disable-next-line @typescript-eslint/require-await\n\treturn async (oNode: Element, _oVisitor: IVisitorCallback): Promise<void> => {\n\t\tif (oNode.hasChildNodes() && oNode.attributes.length === 0) {\n\t\t\tawait _oVisitor.visitChildNodes(oNode);\n\t\t\treturn; // In case a node has children and no attribute it's already formatted properly\n\t\t}\n\t\tconst newNode = document.createElementNS(childNamespace, childName);\n\t\tconst newParent = document.createElementNS(parentNamespace, parentName);\n\t\tconst attributeNames = oNode.getAttributeNames();\n\t\tif (attributeNames.length > 0) {\n\t\t\t// Only consider case where we have attributes, meaning the old syntax\n\t\t\tfor (const attributeName of attributeNames) {\n\t\t\t\tnewNode.setAttribute(attributeName, oNode.getAttribute(attributeName)!);\n\t\t\t}\n\t\t\tnewParent.appendChild(newNode);\n\t\t}\n\t\tawait _oVisitor.visitChildNodes(newParent);\n\t\toNode.replaceWith(newParent);\n\t};\n};\n\n// Rewrite the old shareOptions to the new one\nXMLPreprocessor.plugIn(\n\trewriteNodes(\"sap.fe.macros\", \"macros:shareOptions\", \"sap.fe.macros.share\", \"macroShare:ShareOptions\"),\n\t\"sap.fe.macros\",\n\t\"shareOptions\"\n);\n\nXMLPreprocessor.plugIn(\n\trewriteNodes(\"sap.fe.macros\", \"macros:formatOptions\", \"sap.fe.macros.field\", \"macroField:FieldFormatOptions\"),\n\t\"sap.fe.macros\",\n\t\"formatOptions\"\n);\n\nXMLPreprocessor.plugIn(\n\trewriteNodes(\"sap.fe.macros\", \"macros:formatOptions\", \"sap.fe.macros.field\", \"macroField:FieldFormatOptions\"),\n\t\"sap.m\",\n\t\"formatOptions\"\n);\n\nexport default thisLib;\n"],"mappings":"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","ignoreList":[],"file":"library-dbg.js"}