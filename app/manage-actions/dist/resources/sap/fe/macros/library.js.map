{"version":3,"file":"library.js","names":["macrosNamespace","_exports","thisLib","Library","init","name","apiVersion","dependencies","types","interfaces","controls","elements","version","noLibraryCSS","extensions","flChangeHandlers","NavigationType","DataType","registerEnum","Fragment","registerType","load","getType","async","mSettings","currentController","containingView","getController","targetControllerExtension","isA","getExtensionAPI","id","oController","childCustomData","undefined","contextPath","this","_fnSettingsPreprocessor","controlSettings","getMetadata","hasProperty","_len","arguments","length","args","Array","_key","result","apply","customDataKey","addCustomData","CustomData","key","value","_len2","_key2","then","AppComponent","registerInstanceDependentProcessForStartUp","FilterOperatorUtils","processCustomFilterOperators","catch","error","Log","rewriteNodes","parentNamespace","parentName","childNamespace","childName","oNode","_oVisitor","hasChildNodes","attributes","visitChildNodes","newNode","document","createElementNS","newParent","attributeNames","getAttributeNames","attributeName","setAttribute","getAttribute","appendChild","replaceWith","XMLPreprocessor","plugIn"],"sources":["./library.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport \"sap/f/library\";\nimport \"sap/fe/controls/library\";\nimport AppComponent from \"sap/fe/core/AppComponent\";\nimport type ExtensionAPI from \"sap/fe/core/ExtensionAPI\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type { IVisitorCallback } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport \"sap/fe/core/library\";\nimport \"sap/fe/macros/coreUI/factory\";\nimport FilterOperatorUtils from \"sap/fe/macros/filter/FilterOperatorUtils\";\nimport \"sap/fe/macros/filter/type/MultiValue\";\nimport \"sap/fe/macros/filter/type/Range\";\nimport \"sap/fe/macros/formatters/TableFormatter\";\nimport \"sap/fe/macros/macroLibrary\";\nimport DataType from \"sap/ui/base/DataType\";\nimport type Control from \"sap/ui/core/Control\";\nimport CustomData from \"sap/ui/core/CustomData\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport Library from \"sap/ui/core/Lib\";\nimport \"sap/ui/core/XMLTemplateProcessor\";\nimport \"sap/ui/core/library\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport XMLPreprocessor from \"sap/ui/core/util/XMLPreprocessor\";\nimport \"sap/ui/mdc/field/ConditionsType\";\nimport \"sap/ui/mdc/library\";\nimport \"sap/ui/unified/library\";\n\n/**\n * Library containing the building blocks for SAP Fiori elements.\n * @namespace\n * @public\n */\nexport const macrosNamespace = \"sap.fe.macros\";\n\n// library dependencies\nconst thisLib = Library.init({\n\tname: \"sap.fe.macros\",\n\tapiVersion: 2,\n\tdependencies: [\"sap.ui.core\", \"sap.ui.mdc\", \"sap.ui.unified\", \"sap.fe.core\", \"sap.fe.navigation\", \"sap.fe.controls\", \"sap.m\", \"sap.f\"],\n\ttypes: [\"sap.fe.macros.NavigationType\"],\n\tinterfaces: [],\n\tcontrols: [],\n\telements: [],\n\t// eslint-disable-next-line no-template-curly-in-string\n\tversion: \"${version}\",\n\tnoLibraryCSS: true,\n\textensions: {\n\t\tflChangeHandlers: {\n\t\t\t\"sap.fe.macros.controls.FilterBar\": \"sap/ui/mdc/flexibility/FilterBar\",\n\t\t\t\"sap.fe.macros.controls.Section\": \"sap/uxap/flexibility/ObjectPageSection\",\n\t\t\t\"sap.fe.macros.controls.section.SubSection\": \"sap/uxap/flexibility/ObjectPageSubSection\"\n\t\t}\n\t}\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n}) as any;\n\nexport enum NavigationType {\n\t/**\n\t * For External Navigation\n\t * @public\n\t */\n\tExternal = \"External\",\n\n\t/**\n\t * For In-Page Navigation\n\t * @public\n\t */\n\tInPage = \"InPage\",\n\n\t/**\n\t * For No Navigation\n\t * @public\n\t */\n\tNone = \"None\"\n}\n\nthisLib.NavigationType = NavigationType;\nDataType.registerEnum(\"sap.fe.macros.NavigationType\", thisLib.NavigationType);\nFragment.registerType(\"CUSTOM\", {\n\tload: (Fragment as { getType?: Function }).getType?.(\"XML\").load,\n\tinit: async function (\n\t\tmSettings: { containingView: View; id: string; childCustomData: Record<string, string> | undefined; contextPath?: string },\n\t\t...args: unknown[]\n\t) {\n\t\tconst currentController = mSettings.containingView.getController() as PageController;\n\t\tlet targetControllerExtension: PageController | ExtensionAPI = currentController;\n\t\tif (currentController && !currentController.isA<ExtensionAPI>(\"sap.fe.core.ExtensionAPI\")) {\n\t\t\ttargetControllerExtension = currentController.getExtensionAPI(mSettings.id);\n\t\t}\n\t\tmSettings.containingView = {\n\t\t\toController: targetControllerExtension\n\t\t} as unknown as View;\n\t\tconst childCustomData = mSettings.childCustomData ?? undefined;\n\t\tconst contextPath = mSettings.contextPath;\n\t\tdelete mSettings.childCustomData;\n\t\tdelete mSettings.contextPath;\n\t\t(this as { _fnSettingsPreprocessor?: Function })._fnSettingsPreprocessor = function (\n\t\t\tthis: Control,\n\t\t\tcontrolSettings: {\n\t\t\t\tcontextPath: unknown;\n\t\t\t}\n\t\t): unknown {\n\t\t\tif (this.getMetadata().hasProperty(\"contextPath\")) {\n\t\t\t\tcontrolSettings.contextPath ??= contextPath;\n\t\t\t}\n\n\t\t\treturn controlSettings;\n\t\t};\n\t\tconst result = await (Fragment as unknown as { getType: Function }).getType(\"XML\").init.apply(this, [mSettings, args]);\n\t\tif (childCustomData && result?.isA(\"sap.ui.core.Control\")) {\n\t\t\tfor (const customDataKey in childCustomData) {\n\t\t\t\t// UI5 adds 'bindingString' when its an adaptation project (SNOW: DINC0143515), which results in errors later\n\t\t\t\tif (customDataKey === \"bindingString\") {\n\t\t\t\t\tdelete childCustomData[customDataKey];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t(result as Control).addCustomData(new CustomData({ key: customDataKey, value: childCustomData[customDataKey] }));\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n});\n\nFragment.registerType(\"SCOPEDFEFRAGMENT\", {\n\tload: (Fragment as { getType?: Function }).getType?.(\"XML\").load,\n\tinit: function (\n\t\tmSettings: { containingView: View; id: string; childCustomData: Record<string, string> | undefined; contextPath?: string },\n\t\t...args: unknown[]\n\t) {\n\t\tconst contextPath = mSettings.contextPath;\n\t\tdelete mSettings.contextPath;\n\t\t(this as { _fnSettingsPreprocessor?: Function })._fnSettingsPreprocessor = function (\n\t\t\tthis: Control,\n\t\t\tcontrolSettings: {\n\t\t\t\tcontextPath: unknown;\n\t\t\t}\n\t\t): unknown {\n\t\t\tif (this.getMetadata().hasProperty(\"contextPath\")) {\n\t\t\t\tcontrolSettings.contextPath ??= contextPath;\n\t\t\t}\n\n\t\t\treturn controlSettings;\n\t\t};\n\t\treturn (Fragment as unknown as { getType: Function }).getType(\"XML\").init.apply(this, [mSettings, args]);\n\t}\n});\n\nLibrary.load({ name: \"sap.fe.macros\" })\n\t.then(() => {\n\t\tAppComponent.registerInstanceDependentProcessForStartUp(FilterOperatorUtils.processCustomFilterOperators);\n\t\treturn;\n\t})\n\t.catch((error: unknown) => {\n\t\tLog.error(`Error loading 'sap.fe.macros`, error as Error | string);\n\t});\n\nconst rewriteNodes = function (parentNamespace: string, parentName: string, childNamespace: string, childName: string): Function {\n\t// eslint-disable-next-line @typescript-eslint/require-await\n\treturn async (oNode: Element, _oVisitor: IVisitorCallback): Promise<void> => {\n\t\tif (oNode.hasChildNodes() && oNode.attributes.length === 0) {\n\t\t\tawait _oVisitor.visitChildNodes(oNode);\n\t\t\treturn; // In case a node has children and no attribute it's already formatted properly\n\t\t}\n\t\tconst newNode = document.createElementNS(childNamespace, childName);\n\t\tconst newParent = document.createElementNS(parentNamespace, parentName);\n\t\tconst attributeNames = oNode.getAttributeNames();\n\t\tif (attributeNames.length > 0) {\n\t\t\t// Only consider case where we have attributes, meaning the old syntax\n\t\t\tfor (const attributeName of attributeNames) {\n\t\t\t\tnewNode.setAttribute(attributeName, oNode.getAttribute(attributeName)!);\n\t\t\t}\n\t\t\tnewParent.appendChild(newNode);\n\t\t}\n\t\tawait _oVisitor.visitChildNodes(newParent);\n\t\toNode.replaceWith(newParent);\n\t};\n};\n\n// Rewrite the old shareOptions to the new one\nXMLPreprocessor.plugIn(\n\trewriteNodes(\"sap.fe.macros\", \"macros:shareOptions\", \"sap.fe.macros.share\", \"macroShare:ShareOptions\"),\n\t\"sap.fe.macros\",\n\t\"shareOptions\"\n);\n\nXMLPreprocessor.plugIn(\n\trewriteNodes(\"sap.fe.macros\", \"macros:formatOptions\", \"sap.fe.macros.field\", \"macroField:FieldFormatOptions\"),\n\t\"sap.fe.macros\",\n\t\"formatOptions\"\n);\n\nXMLPreprocessor.plugIn(\n\trewriteNodes(\"sap.fe.macros\", \"macros:formatOptions\", \"sap.fe.macros.field\", \"macroField:FieldFormatOptions\"),\n\t\"sap.m\",\n\t\"formatOptions\"\n);\n\nexport default thisLib;\n"],"mappings":"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","ignoreList":[]}