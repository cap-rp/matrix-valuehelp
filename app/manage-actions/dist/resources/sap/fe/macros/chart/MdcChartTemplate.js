/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/util/merge","sap/base/util/uid","sap/fe/base/BindingToolkit","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor","sap/fe/core/controls/CommandExecution","sap/fe/core/converters/ConverterContext","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/ManifestWrapper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/helpers/Aggregation","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/CommonHelper","sap/m/Button","sap/m/FlexItemData","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/m/OverflowToolbarLayoutData","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/Device","sap/ui/core/CustomData","sap/ui/core/Element","sap/ui/core/Popup","sap/ui/fl/variants/VariantManagement","sap/ui/mdc/Chart","sap/ui/mdc/actiontoolbar/ActionToolbarAction","sap/ui/mdc/chart/Item","sap/ui/mdc/p13n/PersistenceProvider","sap/ui/model/json/JSONModel","../internal/helpers/ActionHelper","../internal/helpers/DefaultActionHandler","./ChartHelper","sap/fe/base/jsx-runtime/jsx"],function(e,t,n,a,o,i,r,s,c,l,u,d,p,g,f,h,m,b,v,C,y,A,_,M,P,x,D,T,O,I,S,B,k,V,j,E,$,w,F,N,L,U,H,z,R,G,W){"use strict";var K={};var q=$.Dock;var J=y.getTargetObjectPath;var X=y.getContextRelativeTargetObjectPath;var Y=C.isPathAnnotationExpression;var Q=v.generate;var Z=h.AggregationHelper;var ee=f.getVisualizationsFromAnnotation;var te=f.getDataVisualizationConfiguration;var ne=g.aiIcon;var ae=p.isDataModelObjectPathForActionWithDialog;var oe=d.getInvolvedDataModelObjects;var ie=l.TemplateType;var re=r.escapeXMLAttributeValue;var se=o.resolveBindingString;var ce=o.pathInModel;var le=o.notEqual;const ue={"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1":"axis1","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis2":"axis2","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis3":"axis3","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis4":"axis4"};var de=function(e){e["Sort"]="Sort";e["Type"]="Type";e["Item"]="Item";e["Filter"]="Filter";return e}(de||{});function pe(e,t,n,a){let o=X(n);let i=[];if(e._metaPathContext?.getObject()?.$Type==="com.sap.vocabularies.UI.v1.PresentationVariantType"){i=e._metaPathContext.getObject().Visualizations}else if(e._metaPathContext?.getObject()?.$Type==="com.sap.vocabularies.UI.v1.SelectionPresentationVariantType"){i=e._metaPathContext.getObject().PresentationVariant?.Visualizations}if(i?.length&&!ge(i,a)){o=""}if(!o){o=`@${"com.sap.vocabularies.UI.v1.Chart"}`}const r=te(o,t,{isCondensedTableLayoutCompliant:e.useCondensedLayout,isMacroOrMultipleView:true,shouldCreateTemplateChartVisualization:false});return r.visualizations[0]}function ge(e,t){return e.some(e=>t?.includes(e.$AnnotationPath))}function fe(e){return`${e}-content`}function he(e,t){const n={};const a={};if(e.actions){Object.values(e.actions)?.forEach(e=>{if(e.isA("sap.fe.macros.chart.ActionGroup")){a[e.key]=me(e.key,e.text,null,false,true,{placement:e.placement,anchor:e.anchor},e.actions.map((t,n)=>e.key+"_Menu_"+n));e.actions?.forEach((t,n)=>{const o=e.key.concat("_Menu_",n);a[o]=me(o,t.text,t.press,!!t.requiresSelection,t.enabled===null||t.enabled===undefined?true:t.enabled)})}else if(e.isA("sap.fe.macros.chart.Action")){a[e.key]=me(e.key,e.text,e.press,!!e.requiresSelection,e.enabled===null||e.enabled==undefined?true:e.enabled,{placement:e.placement,anchor:e.anchor})}})}if(t&&e.actions){n[t]={actions:a}}return n}function me(e,t,n,a,o,i,r){const s={key:e,text:t,__noWrap:true,press:n,requiresSelection:a,enabled:o};if(i){s.position=i}if(r){s.menu=r}return s}function be(e){const t=`/${a()}`;const n=new H;n.setProperty(t,e);return n.createBindingContext(t)}function ve(t,n){const a=t.chartDefinition.annotationPath.split("/");const o=a.filter(function(e,t){return a.indexOf(e)==t}).toString().replaceAll(",","/");const i=oe(t._metaModel.createBindingContext(o),t._context).targetObject;const r=n.getAggregatedProperty();let s=[];const c=t._metaPathContext.getPath();const l=n.getAggregatedProperties();const u=i?.Measures?i.Measures:[];const d=i?.DynamicMeasures?i.DynamicMeasures:[];const p=l[0]?l[0].filter(function(e){return u.some(function(t){return e.Name===t.value})}):undefined;const g=c.replace(/@com.sap.vocabularies.UI.v1.(Chart|PresentationVariant|SelectionPresentationVariant).*/,"");const f=t.chartDefinition.transAgg;const h=t.chartDefinition.customAgg;if(r.length>0&&!d&&p&&p.length>0){e.warning("The transformational aggregate measures are configured as Chart.Measures but should be configured as Chart.DynamicMeasures instead. Please check the SAP Help documentation and correct the configuration accordingly.")}const m=u.some(e=>{const t=_e(h,e);return!!t});if(r.length>0&&!d?.length&&!m){throw new Error("Please configure DynamicMeasures for the chart")}if(r.length>0&&i){for(const e of d){s=Ae(s,e,g,i,t)}}for(const e of u){const n=e.value;const a=_e(h,e);const o={};if(a){s=Ce(s,o,a,n)}else if(r.length===0&&f[n]){s=ye(s,o,f,n)}Me(t._chart.MeasureAttributes,g,o,t)}const b=new H(s);b.$$valueAsPromise=true;return b.createBindingContext("/")}function Ce(t,n,a,o){if(o.includes("/")){e.error(`$expand is not yet supported. Measure: ${o} from an association cannot be used`)}n.key=a.value;n.role="axis1";n.label=a.label;n.propertyPath=a.value;t.push(n);return t}function ye(e,t,n,a){const o=n[a];t.key=o.name;t.role="axis1";t.propertyPath=a;t.aggregationMethod=o.aggregationMethod;t.label=o.label||t.label;e.push(t);return e}function Ae(t,n,a,o,i){const r=n.value||"";const s=oe(i._metaModel.createBindingContext(a+r),i._context).targetObject;if(r.includes("/")){e.error(`$expand is not yet supported. Measure: ${r} from an association cannot be used`)}else if(!s){throw new Error(`Please provide the right AnnotationPath to the Dynamic Measure ${n.value}`)}else if(n.value?.startsWith(`@${"com.sap.vocabularies.Analytics.v1.AggregatedProperty"}`)===null){throw new Error(`Please provide the right AnnotationPath to the Dynamic Measure ${n.value}`)}else{const e={key:s.Name.toString(),role:"axis1"};e.propertyPath=s.AggregatableProperty.value;e.aggregationMethod=s.AggregationMethod.toString();e.label=se(s.annotations?.Common?.Label?.toString()??s.AggregatableProperty.$target?.annotations?.Common?.Label?.toString()??"");Me(o.MeasureAttributes,a,e,i);t.push(e)}return t}function _e(e,t){if(t.value&&e[t.value]){t.label=e[t.value]?.label;return t}return null}function Me(e,t,n,a){if(e?.length){for(const o of e){Pe(o,t,n,a)}}}function Pe(e,t,n,a){const o=e.DynamicMeasure?e?.DynamicMeasure?.value:e?.Measure?.value;const i=e.DataPoint?e?.DataPoint?.value:null;const r=e.Role;const s=i?oe(a._metaModel.createBindingContext(t+i),a._context).targetObject:undefined;if(n.key===o){ke(n,r);Be(n,s)}}function xe(e){const t={};if(e.TargetValue){t.targetValue=e.TargetValue.$Path}if(e.ForecastValue){t.foreCastValue=e.ForecastValue.$Path}let n=null;if(e.Criticality){if(Y(e.Criticality)&&e.Criticality.path){n={Calculated:e.Criticality.path}}else{n={Static:e.Criticality.$EnumMember.replace("com.sap.vocabularies.UI.v1.CriticalityType/","")}}}else if(e.CriticalityCalculation){const t={};const a=De(t,e.CriticalityCalculation);if(a){n={ConstantThresholds:t}}else{n={DynamicThresholds:t}}}if(n){t.criticality=n}return t}function De(e,t){const n=["AcceptanceRangeLowValue","AcceptanceRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue","DeviationRangeLowValue","DeviationRangeHighValue"];e.ImprovementDirection=t.ImprovementDirection?.$EnumMember.replace("com.sap.vocabularies.UI.v1.ImprovementDirectionType/","");const a={oneSupplied:false,usedMeasures:[]};const o={oneSupplied:false};Te(n,a,o,t);Oe(n,e,a,o,t);return!a.oneSupplied}function Te(e,t,n,a){for(const o of e){t[o]=a[o]?a[o].$Path:undefined;t.oneSupplied=t.oneSupplied||t[o];if(!t.oneSupplied){n[o]=a[o];n.oneSupplied=n.oneSupplied||n[o]}else if(t[o]){t.usedMeasures.push(t[o])}}}function Oe(e,t,n,a,o){if(n.oneSupplied){for(const a of e){if(n[a]){t[a]=n[a]}}t.usedMeasures=n.usedMeasures}else{t.AggregationLevels=[];Ie(e,t,a,o)}}function Ie(e,t,n,a){let o={};if(n.oneSupplied){o={VisibleDimensions:null};for(const t of e){if(n[t]){o[t]=n[t]}}t.AggregationLevels?.push(o)}Se(e,t,a,o)}function Se(e,t,n,a){if(n.ConstantThresholds&&n.ConstantThresholds.length>0){for(const o of n.ConstantThresholds){const n=o.AggregationLevel?[]:null;if(n&&o.AggregationLevel&&o.AggregationLevel.length>0){for(const e of o.AggregationLevel){n.push(e.$PropertyPath)}}a={VisibleDimensions:n};for(const t of e){const e=o[t];if(e){a[t]=e}}t.AggregationLevels?.push(a)}}}function Be(e,t){if(t&&t.Value.$Path==e.key){e.dataPoint=G.formatJSONToString(xe(t))||""}}function ke(e,t){if(t!=null){const n=t.$EnumMember;e.role=ue[n]}}function Ve(e,t){if(e._commandActions.length>0){return e._commandActions.map(n=>Le(n,t,e))}return""}function je(e,t){if(e){if(e==="false"||e===false){t._personalization=undefined}else if(e==="true"||e===true){t._personalization=Object.values(de).join(",")}else if(Ee(e)===true){t._personalization=e}else{t._personalization=undefined}}}function Ee(e){let t=true;const n=e.split(",");const a=Object.values(de);n.forEach(e=>{if(!a.includes(e)){t=false}});return t}function $e(e){const t=e.variantManagement?e.variantManagement:e.chartDefinition.variantManagement;return e.personalization===undefined?"None":t}function we(t){const n=t.personalization;if(n){const e=$e(t);if(e==="Control"){return W(w,{id:Q([t._blockId,"VM"]),for:[t._blockId],showSetAsDefault:true,headerLevel:t.headerLevel,select:e=>{t.fireVariantSelected?.(e)},save:e=>{t.fireVariantSaved?.(e)}})}else if(e==="None"||e==="Page"){return""}}else if(!n){e.warning("Variant Management cannot be enabled when personalization is disabled")}return""}function Fe(e){if($e(e)==="None"){return W(U,{id:Q([e._blockId,"PersistenceProvider"]),for:e._blockId})}}function Ne(e,t,n,a,o){if(t){const i={actionContext:e,onExecuteAction:G.getPressEventForDataFieldForActionButton(o._blockId,t,n||""),onExecuteIBN:A.getPressHandlerForDataFieldForIBN(t,`\${internal>selectedContexts}`,false),onExecuteManifest:A.buildActionWrapper(a,o),chartOperationAvailableMap:n};o._commandActions.push(i)}}function Le(e,t,n){const a=e.actionContext.getObject();const o=a.annotationPath&&n._metaModel.createBindingContext(a.annotationPath);const i=o&&o.getObject();const r=n._metaModel.createBindingContext(a.annotationPath+"/Action");const c=A.getActionContext(r);const l=A.getPathToBoundActionOverload(r);const u=n._metaModel.createBindingContext(l).getObject();const d=re(G.getOperationAvailableMap(t.getObject(),{context:t}));const p=a.enabled?a.enabled:G.isDataFieldForActionButtonEnabled(u&&u.$IsBound,i.Action,n._context,d||"",a.enableOnSelect||"");let g;if(a.enabled){g=a.enabled}else if(i.RequiresContext){g="{= %{internal>numberOfSelectedContexts} >= 1}"}let f;switch(a.type){case"ForAction":f=p??a.enabled;break;case"ForNavigation":f=g??a.enabled;break;default:f=a.enabled;break}const h=W(s,{execute:t=>Ue(t,a,n._blockId,e.chartOperationAvailableMap,i),enabled:f,visible:dt(o,n)??a.visible,command:a.command});if(a.type=="ForAction"&&(!u||u.IsBound!==true||c[`@${"Org.OData.Core.V1.OperationAvailable"}`]!==false)){return h}else if(a.type=="ForAction"){return""}else{return h}}function Ue(e,t,n,a,o){const r=i.getTargetView(e.getSource());const s=r?.getController();switch(t.type){case"ForAction":const i=t.InvocationGrouping&&t.InvocationGrouping.$EnumMember==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";const c={contexts:r.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:i,controlId:n,operationAvailableMap:a,model:r.getModel(),label:o.Label};s.editFlow.invokeAction(o.Action,c);break;case"ForNavigation":const l={navigationContexts:r.getBindingContext("internal")?.getProperty("selectedContexts")};if(o.Mapping){l.semanticObjectMapping=JSON.stringify(o.Mapping)}s._intentBasedNavigation.navigate(o.SemanticObject,o.Action,l);break;default:m.actionWrapper(e,t.handlerModule,t.handlerMethod,{contexts:r.getBindingContext("internal")?.getProperty("selectedContexts")});break}}function He(e){if(e._chart){const t=[];const n=[];if(e._chart.Dimensions){G.formatDimensions(e._chartContext).getObject().forEach(n=>{n.id=Q([e.id,"dimension",n.key]);t.push(ze({id:n.id,key:n.key,label:n.label,role:n.role},"_fe_groupable_","groupable"))})}if(e.measures){G.formatMeasures(e.measures).forEach(t=>{t.id=Q([e.id,"measure",t.key]);n.push(ze({id:t.id,key:t.key,label:t.label,role:t.role},"_fe_aggregatable_","aggregatable"))})}if(t.length&&n.length){return t.concat(n)}}return""}function ze(e,t,n){return W(L,{id:e.id,propertyKey:t+e.key,type:n,label:se(e.label,"string"),role:e.role})}function Re(e){const t=We(e);if(e.chartDefinition?.onSegmentedButtonPressed){t.push(st(e))}if(e.chartDefinition.isInsightsEnabled){t.push(Ge(e.chartDefinition.isInsightsEnabled,e.chartDefinition.isInsightsVisible,e._blockId,e))}if(t.length>0){return t}return[]}function Ge(e,t,n,a){return W(N,{visible:t,children:W(_,{id:Q([n,"StandardAction::Insights"]),text:"{sap.fe.i18n>M_COMMON_INSIGHTS_CARD}",press:()=>{a.onAddCardToInsightsPressed()},enabled:e,children:{layoutData:W(S,{priority:"AlwaysOverflow"})}})})}function We(e){const t=Ke(e.chartActions??[]);return t.map(t=>{if(t.annotationPath||t.type==="Menu"&&!t.id?.startsWith("CustomAction")){return Ye(t,e._chartContext,false,e)}else if(t.hasOwnProperty("noWrap")){return qe(t,e._chartContext,e)}})}function Ke(e){for(const t of e){if(t.menu){t.menu.forEach(t=>{const n=e.map(e=>e.key).indexOf(t.key);if(n!==-1){e.splice(n,1)}})}}return e}function qe(e,t,n){let a=e.enabled;if((e.requiresSelection??false)&&e.enabled==="true"){a="{= %{internal>numberOfSelectedContexts} >= 1}"}if(e.type==="Default"){return et(e,{id:Q([n._blockId,e.id]),unittestid:"DataFieldForActionButtonAction",label:e.text?e.text:"",ariaHasPopup:undefined,press:e.press?e.press:"",enabled:a,visible:e.visible?e.visible:false},false,n)}else if(e.type==="Menu"){return Xe({id:Q([n._blockId,e.id]),text:e.text,visible:e.visible,enabled:a,useDefaultActionOnly:R.getUseDefaultActionOnly(e),buttonMode:R.getButtonMode(e),defaultAction:undefined,actions:e},t,n)}}function Je(e,t,n){let a;if(e.annotationPath){return Ye(e,t,true,n)}if(e.command){a={"jsx:command":`cmd:${e.command}|press`}}else if(e.noWrap??false){a={press:t=>{const n=e.handlerMethod?.split(".")[1];const a={...i.getTargetView(t.getSource()).getController()};if(a[n])a[n](t)}}}else{a={press:t=>{const n=i.getTargetView(t.getSource()).getBindingContext("internal")?.getProperty("selectedContexts");m.actionWrapper(t,e.handlerModule,e.handlerMethod,{contexts:n})}}}return W(I,{text:e.text,...a,visible:e.visible,enabled:e.enabled})}function Xe(e,t,n){const a=(e.actions?.menu).map(e=>Je(e,t,n));return W(N,{children:W(O,{text:e.text,type:"Transparent",id:e.id,visible:e.visible,enabled:e.enabled,useDefaultActionOnly:e.useDefaultActionOnly,buttonMode:e.buttonMode,menuPosition:q.BeginBottom,defaultAction:"props.defaultAction",children:{menu:W(T,{children:a})}})})}function Ye(e,t,n,a){const o=a._metaModel.createBindingContext(e.annotationPath??"");if(e.type==="ForNavigation"){return Qe(e,o,n,a)}else if(e.type==="ForAction"){return Ze(t,e,o,n,a)}else if(e.type==="Menu"){const n=e.menu?.map(e=>Ye(e,t,true,a));return W(N,{children:W(O,{text:e.text,type:"Transparent",id:e.key,visible:e.visible,enabled:e.enabled,menuPosition:q.BeginBottom,icon:e?.isAIOperation===true?ne:undefined,children:{menu:W(T,{children:n})}})})}return undefined}function Qe(e,t,n,a){let o="true";const i=t.getObject();if(e.enabled!==undefined){o=e.enabled}else if(i.RequiresContext){o="{= %{internal>numberOfSelectedContexts} >= 1}"}return et(e,{id:undefined,unittestid:"DataFieldForIntentBasedNavigationButtonAction",label:i.Label,ariaHasPopup:undefined,press:A.getPressHandlerForDataFieldForIBN(i,`\${internal>selectedContexts}`,false),enabled:o,visible:dt(t,a)},n,a,i)}function Ze(e,t,n,a,o){const i=o._metaModel.createBindingContext(t.annotationPath+"/Action");const r=o._metaModel.createBindingContext(A.getActionContext(i));const s=r?.getObject();const c=A.getPathToBoundActionOverload(i);const l=o._metaModel.createBindingContext(c).getObject();const u=n.getObject();if(!l||l.$IsBound!==true||s[`@${"Org.OData.Core.V1.OperationAvailable"}`]!==false){const i=rt(t,l,u,e,o._context);const r=oe(o._metaModel.createBindingContext(t.annotationPath));const s=ae(r);const c=re(G.getOperationAvailableMap(e.getObject(),{context:e}))||"";return et(t,{id:Q([o._blockId,oe(n)]),unittestid:"DataFieldForActionButtonAction",label:u.Label,ariaHasPopup:s,enabled:i,visible:dt(n,o)},a,o,u,c)}return undefined}function et(e,t,n,a,o,r){if(n){const n=e.command?{"jsx:command":`cmd:${e.command}|press`}:{press:t=>{const n=i.getTargetView(t.getSource());const s=n.getController();if(e.type==="ForAction"){const e={contexts:n.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:o?.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",controlId:a._blockId,operationAvailableMap:r,model:n.getModel(),label:o?.Label};s.editFlow.invokeAction(o?.Action,e)}else if(e.type==="ForNavigation"){const e={navigationContexts:n.getBindingContext("internal")?.getProperty("selectedContexts")};if(o?.Mapping){e.semanticObjectMapping=JSON.stringify(o.Mapping)}s._intentBasedNavigation.navigate(o.SemanticObject,o.Action,e)}}};return W(I,{text:t.label,...n,enabled:t.enabled,visible:t.visible})}else{return tt(e,t,a,o,r)}}function tt(e,t,n,a,o){return W(N,{children:W(_,{id:t.id,text:t.label,ariaHasPopup:t.ariaHasPopup,...nt(e,a,o,n),enabled:t.enabled,visible:t.visible,icon:e.isAIOperation===true?ne:undefined})})}function nt(e,t,n,a){let o={press:""};if(e.hasOwnProperty("noWrap")){if(e.command){o={"jsx:command":`cmd:${e.command}|press`}}else if(e.noWrap===true){o=at(e)}else if(!e.annotationPath){o=ot(e)}}else{o=e.command?{"jsx:command":`cmd:${e.command}|press`}:it(e,t,a,n)}return o}function at(e){return{press:t=>{const n=e.handlerMethod?.split(".")[1];const a={...i.getTargetView(t.getSource()).getController()};if(a[n])a[n](t)}}}function ot(e){return{press:t=>{const n=t.getSource().getBindingContext("internal")?.getProperty("selectedContexts");m.actionWrapper(t,e.handlerModule,e.handlerMethod,{contexts:n})}}}function it(e,t,n,a){return{press:o=>{const r=i.getTargetView(o.getSource());const s=r.getController();if(e.type==="ForAction"){const e={contexts:r.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:t?.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",controlId:n?._blockId,operationAvailableMap:a,model:r.getModel(),label:t?.Label};s.editFlow.invokeAction(t?.Action,e)}else if(e.type==="ForNavigation"){const e={navigationContexts:r.getBindingContext("internal")?.getProperty("selectedContexts")};if(t?.Mapping){e.semanticObjectMapping=JSON.stringify(t.Mapping)}s._intentBasedNavigation.navigate(t.SemanticObject,t.Action,e)}}}}function rt(e,t,n,a,o){return e.enabled!==undefined?e.enabled:G.isDataFieldForActionButtonEnabled(t&&t.$IsBound,n.Action,o,G.getOperationAvailableMap(a.getObject(),{context:a}),e.enableOnSelect||"")}function st(e){return W(N,{layoutInformation:{aggregationName:"end",alignment:"End"},children:W(B,{id:Q([e._blockId,"SegmentedButton","TemplateContentView"]),selectionChange:t=>{e.fireSegmentedButtonPressed?.(n(t.getParameters(),{selectedKey:t.getSource().getSelectedKey()}))},visible:le(ce("alpContentView","pageInternal"),"Table"),selectedKey:ce("alpContentView","pageInternal"),children:{items:ct()}})})}function ct(){const e=[];if(A.isDesktop()){e.push(lt("{sap.fe.i18n>M_COMMON_HYBRID_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Hybrid","sap-icon://chart-table-view"))}e.push(lt("{sap.fe.i18n>M_COMMON_CHART_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Chart","sap-icon://bar-chart"));e.push(lt("{sap.fe.i18n>M_COMMON_TABLE_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Table","sap-icon://table-view"));return e}function lt(e,t,n){return W(k,{tooltip:e,icon:n},t)}function ut(t,n){const a=X(t);if(!a){e.error(`Missing metaPath parameter for Chart`);return`@${"com.sap.vocabularies.UI.v1.Chart"}`}if(t.targetObject?.term==="com.sap.vocabularies.UI.v1.Chart"){return a}const o=n.getEntityTypeAnnotation(a);let i=[];switch(t.targetObject?.term){case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":if(t.targetObject.PresentationVariant){i=ee(t.targetObject,a,o.converterContext,true)}break;case"com.sap.vocabularies.UI.v1.PresentationVariant":i=ee(t.targetObject,a,o.converterContext,true);break;default:break}const r=i.find(e=>e.visualization.term==="com.sap.vocabularies.UI.v1.Chart");if(r){return r.annotationPath}else{e.error(`Bad metaPath parameter for chart: ${t.targetObject?.term}`);return`@${"com.sap.vocabularies.UI.v1.Chart"}`}}function dt(e,t){const n=e.getObject();if(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]&&n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path){const a=t._metaModel.createBindingContext(e.getPath()+`/@${"com.sap.vocabularies.UI.v1.Hidden"}/$Path`,n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path);return G.getHiddenPathExpressionForTableActionsAndIBN(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path,{context:a})}else if(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]){return!n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]}else{return true}}function pt(e,a,o,i,r){let s=Object.assign({},a);delete s.resourceModel;delete s.appComponent;s=t(s);let l={};const d=J(o.contextLocation??o);const p=o.contextLocation?.targetEntitySet?.name??o.targetEntitySet?.name;if(d===a?.contextPath||d===`/${a?.entitySet}`||p===a?.entitySet){l=s.controlConfiguration}s.controlConfiguration=n(l,r||{});return c.createConverterContextForMacro(o.startingEntitySet.name,e._metaModel,i,n,o.contextLocation,new u(s))}function gt(e,t,n,a){const o=pt(e,t,n,a);const i=ut(n,o);const r=he(e,i);return pt(e,t,n,a,r)}function ft(e){if(e._applyIdToContent){e._blockId=e.id.replace(/::Chart$/,"");e._contentId=e._blockId}else{e._blockId=e.id;e._contentId=fe(e.id)}}function ht(e,t,n,a){const o=e.getMetaPathObject(e.metaPath,e._resolvedContextPath);e._metaModel=e._getOwner()?.preprocessorContext?.models.metaModel;e._metaPathContext=e._metaModel.createBindingContext(o.getPath());e._context=e._metaModel.createBindingContext(e.contextPath??o?.getContextPath());const i=gt(e,t,a,n);const r=i.getManifestWrapper()?.getViewConfiguration();const s=r?.paths?.length>1;const c=i.getManifestWrapper()?.hasMultipleVisualizations()||i.getTemplateType()===ie.AnalyticalListPage;const l=new Z(i.getEntityType(),i,true);e._chartContext=G.getUiChart(e._metaPathContext);e._chart=e._chartContext.getObject();e._blockActions=[];e._commandActions=[];ft(e);if(e._chart){e.chartDefinition=pe(e,i,a,e._chartContext.getPath());const t=e._metaModel.createBindingContext(e.chartDefinition.collection);e.navigationPath=e.chartDefinition.navigationPath;e.autoBindOnInit=e.chartDefinition.autoBindOnInit;e.vizProperties=e.chartDefinition.vizProperties;e.chartActions=e.chartDefinition.actions;e.filter=mt(e);let n;if(e.chartDefinition?.personalization!==undefined){n=e.chartDefinition.personalization}else{switch(e.personalization){case"false":n=undefined;break;case"true":n=Object.values(de).join(",");break;default:n=e.personalization}}je(n,e);e.visible=e.chartDefinition.visible;let o=e._context.getPath();o=o[o.length-1]==="/"?o.slice(0,-1):o;e.draftSupported=b.isDraftSupported(e._metaModel,o);e._chartType=G.formatChartType(e._chart.ChartType);const r=G.getOperationAvailableMap(e._chart,{context:e._chartContext});if(Object.keys(e.chartDefinition?.commandActions).length>0){Object.keys(e.chartDefinition?.commandActions).forEach(t=>{const n=e.chartDefinition?.commandActions[t];const a=be(n);const o=n.annotationPath&&e._metaModel.createBindingContext(n.annotationPath);const i=o&&o.getObject();const s=re(r);Ne(a,i,s,n,e)})}e.measures=ve(e,l);const u=A.createPresentationPathContext(e._metaPathContext);e._sortConditions=G.getSortConditions(e._metaPathContext,e._metaPathContext.getObject(),u.getPath(),e.chartDefinition.applySupported);const d=e._metaModel.createBindingContext(e._chartContext.getPath()+"/Actions",e._chart.Actions);const p=A.getTargetCollectionPath(t);const g=e._metaModel.createBindingContext(p,t);const f=a.convertedTypes.resolvePath(d.getPath())?.target;e._customData={targetCollectionPath:e.chartDefinition.collection,entitySet:typeof g.getObject()==="string"?g.getObject():g.getObject("@sapui.name"),entityType:e.chartDefinition.collection+"/",operationAvailableMap:JSON.parse(r),multiSelectDisabledActions:z.getMultiSelectDisabledActions(f)+"",segmentedButtonId:Q([e._blockId,"SegmentedButton","TemplateContentView"]),customAgg:e.chartDefinition?.customAgg,transAgg:e.chartDefinition?.transAgg,applySupported:e.chartDefinition?.applySupported,vizProperties:JSON.parse(e.vizProperties),draftSupported:e.draftSupported,multiViews:e.chartDefinition?.multiViews||!c&&s,selectionPresentationVariantPath:{data:e.chartDefinition?.selectionPresentationVariantPath},chartDimensionKeyAndRole:e.chartDefinition?.chartDimensionKeyAndRole,chartMeasureKeyAndRole:e.chartDefinition?.chartMeasureKeyAndRole};if(e.chartDefinition.isParameterizedEntitySet){e._customData.entitySet=e.chartDefinition.collection.substring(1)}}else{e.autoBindOnInit=false;e.visible="true";e.navigationPath="";e._customData={targetCollectionPath:"",entitySet:"",entityType:"",operationAvailableMap:"",multiSelectDisabledActions:"",segmentedButtonId:"",customAgg:{},transAgg:{},applySupported:{},vizProperties:{}}}}function mt(e){const t=E.getElementById(e.filterBar);if(e.filterBar&&t?.isA("sap.fe.macros.filterBar.FilterBarAPI")){return fe(e.filterBar)}else if(t?.isA("sap.fe.macros.controls.FilterBar")){return e.filterBar}else if(e.filterBar){return fe(e.filterBar)}}function bt(e){if(e.chartDelegate){e.chartDelegate.payload.selectionMode=e.chartDefinition.selectionMode?.toUpperCase()??e.chartDelegate.payload.selectionMode??"MULTIPLE"}return e.chartDelegate?e.chartDelegate:{name:"sap/fe/macros/chart/ChartDelegate",payload:{chartContextPath:e._customData.targetCollectionPath,parameters:{$$groupId:"$auto.Workers"},selectionMode:e.chartDefinition.selectionMode?.toUpperCase()??e.selectionMode?.toUpperCase()??"MULTIPLE"}}}function vt(e){return[W(j,{value:e._customData.targetCollectionPath},"targetCollectionPath"),W(j,{value:e._customData.entitySet},"entitySet"),W(j,{value:e._customData.entityType},"entityType"),W(j,{value:e._customData.operationAvailableMap},"operationAvailableMap"),W(j,{value:e._customData.multiSelectDisabledActions},"multiSelectDisabledActions"),W(j,{value:e._customData.segmentedButtonId},"segmentedButtonId"),W(j,{value:e._customData.customAgg},"customAgg"),W(j,{value:e._customData.transAgg},"transAgg"),W(j,{value:e._customData.applySupported},"applySupported"),W(j,{value:e._customData.vizProperties},"vizProperties"),W(j,{value:e._customData.draftSupported},"draftSupported"),W(j,{value:e._customData.multiViews},"multiViews"),W(j,{value:e._customData.selectionPresentationVariantPath},"selectionPresentationVariantPath"),W(j,{value:e._customData.chartDimensionKeyAndRole},"chartDimensionKeyAndRole"),W(j,{value:e._customData.chartMeasureKeyAndRole},"chartMeasureKeyAndRole")]}function Ct(e){if(e._customData.targetCollectionPath===""){return}return W(P,{illustrationSize:x.Auto,illustrationType:D.BeforeSearch,title:e.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TITLE_TEXT"),description:e.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TEXT"),enableDefaultTitleAndDescription:false,enableVerticalResponsiveness:true})}function yt(e,t,n,a){ht(e,t,n,a);e.layoutData=W(M,{growFactor:"1",shrinkFactor:"1"});return W(F,{binding:{internal:"controls/"+e._blockId},id:e._contentId,chartType:e._chartType,sortConditions:e._sortConditions,header:e.chartDefinition.header??e.header??e._chart?.Title?.toString()??"",headerVisible:e.chartDefinition.headerVisible??e.headerVisible,minHeight:V.system.phone?"80vh":"400px",height:"100%",width:"100%",headerLevel:e.headerLevel,headerStyle:e.headerStyle,p13nMode:e._personalization?.split(","),filter:e.filter,noDataText:e._customData.targetCollectionPath===""?e.getTranslatedText("M_CHART_NO_ANNOTATION_SET_TEXT"):e.noDataText,autoBindOnInit:e.autoBindOnInit,delegate:bt(e),visible:e.visible,children:{customData:vt(e),dependents:[Ve(e,e._chartContext),Fe(e)],items:He(e),actions:e.chartActions?Re(e):e._blockActions,variant:we(e),noData:Ct(e)}})}K.getMdcChartTemplate=yt;return K},false);
//# sourceMappingURL=MdcChartTemplate.js.map