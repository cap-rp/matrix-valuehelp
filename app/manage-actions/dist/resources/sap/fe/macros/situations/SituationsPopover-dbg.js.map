{"version":3,"names":["bindTimestamp","timestampPropertyPath","path","type","constraints","precision","formatOptions","relative","currentSituationIndicator","createListPopover","controller","expectedNumberOfSituations","listDetailsPopover","listPopover","ResponsivePopover","showHeader","contentHeight","contentWidth","busyIndicatorDelay","placement","content","List","items","events","dataReceived","setContentHeight","parameters","$orderby","$expand","template","CustomListItem","press","goToDetails","HBox","ObjectStatus","icon","state","tooltip","getResourceModel","getText","addStyleClass","ObjectIdentifier","title","bindText","text","templateShareable","showNoData","goToList","unbindObject","close","openBy","event","pressedItem","getSource","context","getBindingContext","createPreviewPopover","getView","addDependent","bindElement","getPath","BusyLocker","unlock","lock","back","toolBarContent","resourceModel","push","Button","titleActive","popoverSettings","customHeader","Toolbar","VBox","Label","Text","shellServices","getAppComponent","getShellServices","navigationArguments","target","action","semanticObject","isNavigationSupported","supported","endButton","situationKey","getObject","undefined","params","SitnInstceKey","toExternal","showPopover","situationsNavigationProperty","bindingContext","numberOfSituations","popover","getModel","bindContext","getBoundContext","setBindingContext","_exports","__functionName"],"sourceRoot":".","sources":["SituationsPopover.ts"],"sourcesContent":["import BusyLocker from \"sap/fe/core/controllerextensions/BusyLocker\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport { bindText } from \"sap/fe/macros/situations/SituationsText\";\nimport Button from \"sap/m/Button\";\nimport CustomListItem from \"sap/m/CustomListItem\";\nimport HBox from \"sap/m/HBox\";\nimport Label from \"sap/m/Label\";\nimport List from \"sap/m/List\";\nimport ObjectIdentifier from \"sap/m/ObjectIdentifier\";\nimport ObjectStatus from \"sap/m/ObjectStatus\";\nimport type { $ResponsivePopoverSettings } from \"sap/m/ResponsivePopover\";\nimport ResponsivePopover from \"sap/m/ResponsivePopover\";\nimport Text from \"sap/m/Text\";\nimport Toolbar from \"sap/m/Toolbar\";\nimport VBox from \"sap/m/VBox\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type { AggregationBindingInfo, PropertyBindingInfo } from \"sap/ui/base/ManagedObject\";\nimport type Control from \"sap/ui/core/Control\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\n\nfunction bindTimestamp(timestampPropertyPath: string): PropertyBindingInfo {\n\treturn {\n\t\tpath: timestampPropertyPath,\n\t\ttype: \"sap.ui.model.odata.type.DateTimeOffset\",\n\t\tconstraints: { precision: 7 },\n\t\tformatOptions: { relative: true }\n\t};\n}\n\nlet currentSituationIndicator: Control | undefined;\n\nfunction createListPopover(controller: PageController, expectedNumberOfSituations: number): ResponsivePopover {\n\tlet listDetailsPopover: ResponsivePopover | null = null;\n\n\tconst listPopover = new ResponsivePopover({\n\t\tshowHeader: false,\n\t\tcontentHeight: `${expectedNumberOfSituations * 4.5}em`,\n\t\tcontentWidth: \"25em\",\n\t\tbusyIndicatorDelay: 200,\n\t\tplacement: \"Horizontal\",\n\t\tcontent: [\n\t\t\tnew List({\n\t\t\t\titems: {\n\t\t\t\t\tpath: \"_Instance\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tdataReceived: () => {\n\t\t\t\t\t\t\tlistPopover.setContentHeight();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tparameters: {\n\t\t\t\t\t\t$orderby: \"SitnInstceLastChgdAtDateTime desc\",\n\t\t\t\t\t\t$expand: \"_InstanceAttribute($expand=_InstanceAttributeValue)\" // required for formatting the texts\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: new CustomListItem({\n\t\t\t\t\t\ttype: \"Navigation\",\n\t\t\t\t\t\tpress: goToDetails,\n\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\tnew HBox({\n\t\t\t\t\t\t\t\titems: [\n\t\t\t\t\t\t\t\t\tnew ObjectStatus({\n\t\t\t\t\t\t\t\t\t\ticon: \"sap-icon://alert\",\n\t\t\t\t\t\t\t\t\t\tstate: \"Warning\",\n\t\t\t\t\t\t\t\t\t\ttooltip: getResourceModel(controller).getText(\"situation\")\n\t\t\t\t\t\t\t\t\t}).addStyleClass(\"sapUiTinyMarginEnd\"),\n\t\t\t\t\t\t\t\t\tnew ObjectIdentifier({\n\t\t\t\t\t\t\t\t\t\ttitle: bindText(\"SituationTitle\"),\n\t\t\t\t\t\t\t\t\t\ttext: bindTimestamp(\"SitnInstceLastChgdAtDateTime\")\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.addStyleClass(\"sapUiSmallMarginBeginEnd\")\n\t\t\t\t\t\t\t\t.addStyleClass(\"sapUiSmallMarginTopBottom\")\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t\ttemplateShareable: false\n\t\t\t\t} as AggregationBindingInfo,\n\t\t\t\tshowNoData: false\n\t\t\t})\n\t\t]\n\t});\n\n\tfunction goToList(): void {\n\t\tif (listDetailsPopover) {\n\t\t\tlistDetailsPopover.unbindObject();\n\t\t\tlistDetailsPopover.close();\n\t\t}\n\t\tif (currentSituationIndicator) {\n\t\t\tlistPopover.openBy(currentSituationIndicator);\n\t\t}\n\t}\n\n\tasync function goToDetails(event: UI5Event<{}, Control>): Promise<void> {\n\t\tconst pressedItem = event.getSource();\n\t\tconst context = pressedItem.getBindingContext();\n\n\t\tif (context && currentSituationIndicator) {\n\t\t\tif (listDetailsPopover === null) {\n\t\t\t\tlistDetailsPopover = await createPreviewPopover(controller, goToList);\n\t\t\t\tcontroller.getView().addDependent(listDetailsPopover);\n\t\t\t}\n\n\t\t\tlistDetailsPopover.bindElement({\n\t\t\t\tpath: context.getPath(),\n\t\t\t\tparameters: { $expand: \"_InstanceAttribute($expand=_InstanceAttributeValue)\" },\n\t\t\t\tevents: {\n\t\t\t\t\tdataReceived: () => {\n\t\t\t\t\t\tBusyLocker.unlock(listDetailsPopover!);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlistPopover.close();\n\n\t\t\tBusyLocker.lock(listDetailsPopover);\n\t\t\tlistDetailsPopover.openBy(currentSituationIndicator);\n\t\t}\n\t}\n\n\treturn listPopover;\n}\n\nasync function createPreviewPopover(controller: PageController, back?: (event: UI5Event) => void): Promise<ResponsivePopover> {\n\tconst toolBarContent: Control[] = [];\n\tconst resourceModel = getResourceModel(controller);\n\n\tif (back) {\n\t\ttoolBarContent.push(\n\t\t\tnew Button({\n\t\t\t\ttype: \"Back\",\n\t\t\t\ttooltip: resourceModel.getText(\"back\"),\n\t\t\t\tpress: back\n\t\t\t}).addStyleClass(\"sapUiNoMarginEnd\")\n\t\t);\n\t}\n\n\ttoolBarContent.push(\n\t\tnew ObjectStatus({\n\t\t\tstate: \"Warning\",\n\t\t\ticon: \"sap-icon://alert\",\n\t\t\ttooltip: resourceModel.getText(\"situationIconTooltip\")\n\t\t}).addStyleClass(\"sapUiSmallMarginBegin\")\n\t);\n\n\ttoolBarContent.push(\n\t\tnew ObjectIdentifier({\n\t\t\ttitleActive: false,\n\t\t\ttitle: bindText(\"SituationTitle\")\n\t\t}).addStyleClass(\"sapUiSmallMarginEnd\")\n\t);\n\n\tconst popoverSettings: $ResponsivePopoverSettings = {\n\t\tcontentWidth: \"25em\",\n\t\tcontentHeight: \"7em\",\n\t\tplacement: \"Horizontal\",\n\t\tcustomHeader: new Toolbar({ content: toolBarContent }),\n\t\tbusyIndicatorDelay: 100,\n\t\tcontent: [\n\t\t\tnew VBox({\n\t\t\t\titems: [\n\t\t\t\t\tnew Label({ text: bindTimestamp(\"SitnInstceLastChgdAtDateTime\") }),\n\t\t\t\t\tnew Text({ text: bindText(\"SituationText\") }).addStyleClass(\"sapUiTinyMarginTop\")\n\t\t\t\t]\n\t\t\t})\n\t\t]\n\t};\n\n\tconst shellServices = controller.getAppComponent().getShellServices();\n\tconst navigationArguments: { target: { action: string; semanticObject: string }; params?: Record<string, string> } = {\n\t\ttarget: {\n\t\t\taction: \"displayExtended\",\n\t\t\tsemanticObject: \"SituationInstance\"\n\t\t}\n\t};\n\tconst isNavigationSupported = await shellServices.isNavigationSupported([navigationArguments]);\n\n\tif (isNavigationSupported[0].supported) {\n\t\tpopoverSettings.endButton = new Button({\n\t\t\ttext: resourceModel.getText(\"showDetails\"),\n\n\t\t\tpress: (event: UI5Event<{}, Button>): void => {\n\t\t\t\tconst situationKey = event.getSource().getBindingContext()?.getObject(`SitnInstceKey`);\n\n\t\t\t\tif (situationKey !== undefined && situationKey !== null) {\n\t\t\t\t\tnavigationArguments.params = { SitnInstceKey: situationKey };\n\t\t\t\t\tshellServices.toExternal(navigationArguments);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\treturn new ResponsivePopover(popoverSettings).addStyleClass(\"sapUiPopupWithPadding\").addStyleClass(\"sapUiResponsivePadding--header\");\n}\n\nexport async function showPopover(\n\tcontroller: PageController,\n\tevent: UI5Event<{}, Control>,\n\tsituationsNavigationProperty: string\n): Promise<void> {\n\tcurrentSituationIndicator = event.getSource();\n\n\tconst bindingContext = currentSituationIndicator.getBindingContext() as Context,\n\t\tnumberOfSituations = bindingContext.getObject(`${situationsNavigationProperty}/SitnNumberOfInstances`);\n\n\tlet popover: ResponsivePopover;\n\tconst context = bindingContext\n\t\t.getModel()\n\t\t.bindContext(situationsNavigationProperty, bindingContext, {\n\t\t\t$expand: \"_Instance($expand=_InstanceAttribute($expand=_InstanceAttributeValue))\"\n\t\t})\n\t\t.getBoundContext();\n\n\tif (numberOfSituations <= 1) {\n\t\tpopover = await createPreviewPopover(controller);\n\t\tpopover.setBindingContext(context);\n\t\tpopover.bindElement({ path: \"_Instance/0\" });\n\t} else {\n\t\tpopover = createListPopover(controller, numberOfSituations);\n\t\tpopover.setBindingContext(context);\n\t}\n\n\tcontroller.getView().addDependent(popover);\n\tpopover.openBy(currentSituationIndicator);\n}\n\nshowPopover.__functionName = \"rt.showPopover\";\n"],"mappings":"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","ignoreList":[],"file":"SituationsPopover-dbg.js"}