/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/m/MenuItem","sap/ui/fl/util/ManagedObjectModel","sap/ui/performance/trace/FESRHelper","../TableRuntime"],function(t,e,n,o,i,s,a,c,r){"use strict";var l={};var u=i.generate;let d=function(){function i(){this.contextMenuActive=false}l=i;var d=i.prototype;d.setupMixin=function t(e){};d.alignContextMenuWithTableToolbarChanges=function t(e){const n=e.getContextMenu();const o=[];const i=e.getActions();i?.forEach(t=>{const i=t.getAggregation("action");if(this._isActionSplit(i)){this._splitActionsInContextMenu(i,n)}if(this._isActionCombined(i)){this._combineActionInContextMenu(i,n,e)}const s=this._getCorrespondingContextMenuAction(i,n);if(s){this._alignTextAndVisiblityInContextMenu(i,s,t);o.push(s)}});if(o.length){o.forEach((t,e)=>{const o=n.indexOfItem(t);if(o!==e){n.removeItem(t);n.insertItem(t,e)}})}};d._isActionCombined=function t(e){if(e.getMetadata().getName()==="sap.m.MenuButton"){const t=e.getDependents();const n=t.filter(t=>t instanceof a);return n.some(t=>t.getName().includes("$sap.m.flexibility.MenuButtonModel"))}return false};d._combineActionInContextMenu=function t(e,n,o){const i=n.getItems();const s=this._findOrCreateMenuButtonInContextMenu(e,o);const a=e.getMenu().getItems();for(const t of a){const o=t;for(const t of i){const i=t.data("actionId");const a=o.data("actionId");if(i===a+"::ContextMenu"||i===a.replace("::ActionMenu","::ContextMenu")){t.setText(o.getText());n.removeItem(t);s.addItem(t)}if(t.getItems().length>0&&!t.getId().includes(e.getId())){const e=this._findActionInSubMenu(t.getItems(),o);if(e){e.setText(o.getText());s.addItem(e);if(t.getItems().length===0){t.destroy()}}}}}};d._findActionInSubMenu=function t(e,n){for(const t of e){if(t.data("actionId")===n.data("actionId").replace("::ActionMenu","::ContextMenu")||t.data("actionId")===n.data("actionId")+"::ContextMenu"){const n=t;e.splice(e.indexOf(t),1);return n}}return undefined};d._findOrCreateMenuButtonInContextMenu=function t(e,n){const o=n.getContextMenu();const i=o.getItems();for(const t of i){if(t.getId().includes(e.getId())){return t}}const a=new s({id:u([n.getId(),e.getId(),"::ContextMenu"]),text:e.getText()});o.addItem(a);return a};d._splitActionsInContextMenu=function t(e,n){const o=n.getItems();for(let t=0;t<o.length;t++){if(o[t].getItems().length>0){if(o[t].getItems().some(t=>t.data("actionId")===e.data("actionId").replace("::ActionMenu","::ContextMenu"))){const e=o[t];const i=e.getItems();n.removeItem(e);i.forEach((e,o)=>{n.insertItem(e,t+o)})}}}};d._getCorrespondingContextMenuAction=function t(e,n){const o=n.getItems();for(const t of o){if(e.getId()+"::ContextMenu"===t.getId()||t.data("actionId")===e.data("actionId")?.replace("::ActionMenu","::ContextMenu")){return t}if(t.getId().includes(e.getId())){return t}}return null};d._alignTextAndVisiblityInContextMenu=function t(e,n,o){n.setText(e.getText());const i=e.getVisible()&&o.getVisible();if(i!==n.getVisible()){n.setVisible(i)}};d._isActionSplit=function t(e){if(e.getMetadata().getName()==="sap.m.MenuButton"){return false}const n=e.getDependents();const o=n.filter(t=>t instanceof a);return o.some(t=>t.getName()==="$sap.m.flexibility.SplitButtonsModel")};d.setContextMenuActive=function t(e){this.contextMenuActive=e};d.isContextMenuActive=function t(){return this.contextMenuActive};d.setCollaborationManagerMenuItemVisibility=function t(n,i){const s=n.getContextMenu();const a=s.getItems();const r=a?.find(t=>t.getId().includes("ContextMenu::CollaborationManager"));if(r){const t=e.getAppComponent(n);const s=t?.getCollaborativeToolsService();const a=s?.collaborationService.cmHelperService?.getOptions();const l=n?.getParent()?.getTableDefinition();const u=l?.annotation?.row?.navigationInfo?.type;if(a&&u==="Navigation"&&i.length>0){const t=e.getTargetView(n);const s=t.getController().collaborativeDraft;const a=i[0].getModel()?.getMetaModel();const l=o.isDraftSupported(a,i[0].getPath());const u=s.isCollaborationEnabled()||!l?true:i.some(t=>t.getObject().IsActiveEntity||t.getObject().HasActiveEntity);r.setVisible(u);c.setSemanticStepname(r,"press","CM:ShareLink")}else{r.setVisible(false)}}};d._onContextMenuPress=function e(o){const i=o.getSource(),s=i.getSelectedContexts(),a=o.getParameter("bindingContext"),c=this.getBindingContext("internal");const l=this.getRelevantSelection(s,a);let u=true;u=l.some(t=>!t.isInactive());c?.setProperty("contextmenu/inactiveContext",!u);const d=l.filter(function(t){return!t.isInactive()});c?.setProperty("contextmenu/selectedContexts",d);c?.setProperty("contextmenu/numberOfSelectedContexts",d.length);c?.setProperty("contextmenu/numberOfSelectedContextsForDelete",l.length);if(d.length>0){this.alignContextMenuWithTableToolbarChanges(i)}this.setCollaborationManagerMenuItemVisibility(i,d);const g=i.getContextMenu();const f=g.getItems();const p=f.filter(t=>t.getVisible());if(p.length===0){o.preventDefault()}const m=l.some(t=>t.isExpanded()!==undefined);const x=l.some(t=>t.isExpanded());c?.setProperty("contextmenu/isExpandable",m);c?.setProperty("contextmenu/isCollapsable",x);c?.setProperty("controlId",i.getId());n.updateDeleteInfoForSelectedContexts(c,l,true);if(!i.data("enableAnalytics")){const t=i?.data("navigationAvailableMap");r.setIntentBasedNavigationEnablement(c,t,d,true)}const I=i?.data("updatablePropertyPath");const M=i?.data("draft");const b=i.data("displayModePropertyBinding")==="true"&&M!=="undefined";const C=[];for(const t of d){if(r.isUpdatableContext(I,t,b)){C.push(t)}}c?.setProperty("contextmenu/updatableContexts",C);const h=this.getTableDefinition();if(h.control.createEnablement&&l.length===1){r._updateCreateEnablement(c,h.control.createEnablement,i,l[0],h.control.nodeType,true)}r.updateCutCopyPasteEnablement(c.getObject(),i,true);r.updateMoveUpDownEnablement(c.getObject(),i,true);t.setActionEnablement(c,JSON.parse(h.operationAvailableMap),d,"table",true)};d.getRelevantSelection=function t(e,n){let o;if(e.includes(n)){o=e}else{o=[n]}return o};return i}();l=d;return l},false);
//# sourceMappingURL=ContextMenuHandler.js.map