/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/controllerextensions/viewState/IViewStateContributorMixin","sap/ui/mdc/p13n/StateUtil"],function(t,e,i){"use strict";function n(t){return new Promise((e,i)=>{sap.ui.require([t],i=>{if(!(i&&i.__esModule)){i=i===null||!(typeof i==="object"&&t.endsWith("/library"))?{default:i}:i;Object.defineProperty(i,"__esModule",{value:true})}e(i)},t=>{i(t)})})}var a={};function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}let l=function(e){function o(){return e.apply(this,arguments)||this}a=o;r(o,e);var l=o.prototype;l.retrieveState=async function t(){const e={};e.innerTable=this.getControlState(await i.retrieveExternalState(this.content));const n=this.getQuickFilter();if(n){const t=n.getSelectedKey();if(!e.quickFilter){e.quickFilter={}}e.quickFilter.selectedKey=t}const a=this.content.getVariant()?.getId();if(a){const t=this.content.getVariant();if(!e.variantManagement){e.variantManagement={variantId:t?.getCurrentVariantKey()}}else{e.variantManagement.variantId=t?.getCurrentVariantKey()}}return e};l.setInitialState=async function e(){try{const t=await i.retrieveExternalState(this.content);this.initialControlState=t}catch(e){t.error(e)}};l.applyLegacyState=async function t(e,i,n){const a=this.content;const r=a.getVariant();const o=this.getQuickFilter();const l=e(a);const s=r?e(r):null;const c=o?.content?e(o.content):null;const u={};if(l){u.innerTable={...u.innerTable,...l,fullState:{...u.innerTable?.fullState,...l.fullState},initialState:{...u.innerTable?.initialState,...l.initialState}}}if(s?.variantId){u.variantManagement={...u.variantManagement,variantId:s.variantId.toString()}}if(c?.selectedKey){u.quickFilter={...u.quickFilter,selectedKey:c.selectedKey.toString()}}if(u&&Object.keys(u).length>0){await this.applyState(u,i,n)}};l.applyState=async function e(a,r,o){if(!a)return;await this.content.initialized();const l=a?.innerTable;const s=a?.variantManagement?.variantId;const c=this.content?.getVariant();const u=a?.quickFilter?.selectedKey;const f=this.getQuickFilter();if(s!==undefined&&s!==c.getCurrentVariantKey()){const e=this.content?.getVariant();const i=e?.getVariants();const a=i?.some(t=>t.getKey()===s)?s:e?.getStandardVariantKey;try{const t=(await n("sap/ui/fl/apply/api/ControlVariantApplyAPI")).default;await t.activateVariant({element:e,variantReference:a});await this.setInitialState()}catch(e){t.error(e);await this.setInitialState()}}else{await this.setInitialState()}let p;if(l){if(o&&l.initialState){if(!l.initialState.supplementaryConfig){l.initialState.supplementaryConfig={}}p=await i.diffState(this.content,l.initialState,l.fullState)}else{if(a&&!a?.supplementaryConfig){a.supplementaryConfig={}}p=l.fullState}await i.applyExternalState(this.content,p)}if(u&&u!==f?.getSelectedKey()){f?.setSelectedKey(u);this.onQuickFilterSelectionChange()}if(this.initialLoad&&this.filterBar){const e=this.getFilterBarControl(this.filterBar);if(e&&e.isA("sap.fe.macros.filterBar.FilterBarAPI")){e.waitForInitialState().then(()=>{this.content.rebind();return}).catch(()=>{t.error("Error while waiting for initial state of filter bar")})}}};return o}(e);a=l;return a},false);
//# sourceMappingURL=TableAPIStateHandler.js.map