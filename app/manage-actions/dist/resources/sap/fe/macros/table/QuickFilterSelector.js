/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/table/Utils","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Select","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/fe/base/jsx-runtime/jsx"],function(t,e,n,i,r,o,a,s,c,l,u,h,g,d,f,p){"use strict";var b,m,y,S,C,v,P,I,T;var B={};var A=c.getTargetObjectPath;var F=c.getTargetNavigationPath;var w=c.enhanceDataModelPath;var x=s.isAnnotationOfType;var O=a.generate;var M=o.getInvolvedDataModelObjects;var j=n.property;var z=n.defineUI5Class;var k=e.pathInModel;var E=e.notEqual;function K(t,e,n,i){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function L(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,D(t,e)}function D(t,e){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},D(t,e)}function $(t,e,n,i,r){var o={};return Object.keys(i).forEach(function(t){o[t]=i[t]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,i){return i(t,e,n)||n},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(t,e,o),null):o}function _(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let Q=(b=z("sap.fe.macros.table.QuickFilterSelector"),m=j({type:"string"}),y=j({type:"string[]"}),S=j({type:"boolean"}),b(C=(v=function(e){function n(t,n){var i;i=e.call(this,t,n)||this;K(i,"id",P,i);K(i,"paths",I,i);K(i,"showCounts",T,i);return i}B=n;L(n,e);var r=n.prototype;r.onMetadataAvailable=function t(){this.metaDataAvailable=true;if(!this.content&&this.metaPath){this.initializeContent()}};r.setMetaPath=function t(e){this.metaPath=e;if(!this.content&&this.metaDataAvailable===true){this.initializeContent()}};r.onSelChange=function t(){const e=this.getMDCTable().getParent();if(e?.isA("sap.fe.macros.table.TableAPI")){e.onQuickFilterSelectionChange()}};r.getSegmentedButtonSelector=function t(e){const n=this.paths.map((t,n)=>p(h,{...this.getSelectorItemProperties(n,e)}));return p(u,{id:`${this.id}-content`,enabled:E(k("hasPendingFilters","pageInternal"),true),ariaLabelledBy:[this.getSelectorAriaLabelledById()],selectionChange:this.onSelChange.bind(this),children:{items:n}})};r.getSelectSelector=function t(e){const n=this.paths.map((t,n)=>p(f,{...this.getSelectorItemProperties(n,e)}));return p(g,{id:`${this.id}-content`,enabled:E(k("hasPendingFilters","pageInternal"),true),ariaLabelledBy:[this.getSelectorAriaLabelledById()],autoAdjustWidth:true,change:this.onSelChange.bind(this),children:{items:n}})};r.getSelectorItemProperties=function t(e,n){return{key:this.paths[e],text:this.getSelectorItemText(e,n)}};r.getSelectorAriaLabelledById=function t(){return O([`${this.id}-content`,"AriaText"])};r.getSelectorItemText=function t(e,n){const i=` ({internal>quickFilters/counts/${e}})`;const r=M(n);const o=w(r,this.paths[e]).targetObject;const a=o?.Text?.toString()??"";return`${a}${this.showCounts?i:""}`};r.registerSideEffectForQuickFilter=function t(e,n){const i=M(e,n);const r=i.contextLocation?.targetEntityType.fullyQualifiedName;const o=F(i,true);if(o&&r){const t=new Set;for(const e of this.paths){const n=w(i,e).targetObject;if(n.SelectOptions&&x(n,"com.sap.vocabularies.UI.v1.SelectionVariantType")){n.SelectOptions.forEach(e=>{const n=e.PropertyName?.value;if(n){const e=w(i,n);t.add(A(e,true))}})}}this.getAppComponent().getSideEffectsService().addControlSideEffects(r,{sourceProperties:Array.from(t),targetEntities:[{$NavigationPropertyPath:o}],sourceControlId:`${this.id}-content`})}};r.getAccessibilityControl=function t(){const e=`{sap.fe.i18n>M_TABLE_QUICKFILTER_ARIA}`;const n=p(d,{text:e,id:this.getSelectorAriaLabelledById()});n.toStatic();return n};r.initializeContent=function t(){if(this.metaPath){const t=this.getMetaPathObject(this.metaPath);if(t){const e=this._getOwner()?.getMetaModel();const n=e?.createBindingContext(t.getPath());const i=e?.createBindingContext(t.getContextPath());if(!n||!i){return}if(this.showCounts){this.registerSideEffectForQuickFilter(n,i)}const r=this.paths.length>3?this.getSelectSelector(n):this.getSegmentedButtonSelector(n);r.addDependent(this.getAccessibilityControl());this.content=r}}};r.getMDCTable=function t(){if(!this.mdcTable){let t=this.content;while(t&&!t.isA("sap.ui.mdc.Table")){t=t.getParent()}this.mdcTable=t;return this.mdcTable}else{return this.mdcTable}};r.getSelectedKey=function t(){return this.content?.getSelectedKey()||this.content?.getItems()[0].getKey()||""};r.setSelectedKey=function t(e){this.content?.setSelectedKey(e)};r.setCountsAsLoading=function t(){const e={};const n=this.getBindingContext("internal");for(const t in this.content?.getItems()){e[t]="..."}n.setProperty("quickFilters",{counts:e})};r.refreshSelectedCount=function t(){const e=this.getMDCTable().getRowBinding().getCount();if(this.showCounts===true&&e!==undefined){const t=this.content?.getItems().findIndex(t=>t.getKey()===this.getSelectedKey());if(t!==undefined&&t>-1){this.getBindingContext("internal")?.setProperty(`quickFilters/counts/${t}`,l.getCountFormatted(e))}}};r.refreshUnSelectedCounts=async function e(){if(!this.content){return Promise.resolve()}const n=this.getMDCTable();const r=this.content.getItems();const o=this.getBindingContext("internal");const a=this.getPageController();const s=a.getChartControl?.();const c=s?.getParent();const u=async t=>{const e=t.getKey();const a=i.getFiltersFromAnnotation(n,e);const s=await l.getListBindingForCount(n,n.getBindingContext(),{batchGroupId:"$auto",additionalFilters:[...g,...a]});const c=r.findIndex(t=>t.getKey()===e);if(c>-1){o.setProperty(`quickFilters/counts/${c}`,l.getCountFormatted(s))}};const h=c?.hasSelections()&&c?.getFilter();const g=l.getHiddenFilters(n);if(h){g.push(h)}const d=r.filter(t=>t.getKey()!==this.getSelectedKey()).map(async t=>u(t));try{await Promise.all(d)}catch(e){t.error("Error while retrieving the binding promises",e)}};return n}(r),P=$(v.prototype,"id",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),I=$(v.prototype,"paths",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),T=$(v.prototype,"showCounts",[S],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),v))||C);B=Q;return B},false);
//# sourceMappingURL=QuickFilterSelector.js.map