/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ResourceModelHelper","sap/ui/core/Lib"],function(t,e,r){"use strict";var o={};var n=e.getLocalizedText;let i=function(){function e(){}o=e;var i=e.prototype;i.setupMixin=function t(e){};i.setTableBindingInfo=function t(e){this.tableBindingInfo=e};i.setDownloadUrl=async function e(){this.downloadUrl=undefined;if(this.getTableDefinition().enableAnalytics===true){return}let r;const o=this.getContent();try{const t=o.getPropertyHelper();let e=[];for(const r of o.getColumns()){e=e.concat(t.getColumnExportSettings(r))}const n={};const i=this.getDataModelObjectForMetaPath(this.metaPath,this.contextPath)?.targetEntityType.keys.map(t=>t.name);const a=e.map(t=>Array.isArray(t.property)?t.property.join(","):t.property);i?.forEach(t=>{if(!a.includes(t)){a.push(t)}});const s=Object.keys(this.getTableDefinition().requestAtLeast);s?.forEach(t=>{if(!a.includes(t)){a.push(t)}});n["$select"]=a.join(",");if(this.tableBindingInfo?.parameters?.$search){n.$search=this.tableBindingInfo.parameters.$search}if(this.tableBindingInfo?.parameters?.$$aggregation){n.$$aggregation=this.tableBindingInfo.parameters.$$aggregation}const l=o.getRowBinding();const p=l.getModel().bindList(l.getPath(),l.getContext(),this.tableBindingInfo?.sorter,this.tableBindingInfo?.filters,n);r=await p.requestDownloadUrl();p.destroy()}catch(e){t.debug("Error while computing the download URL for the export",e)}if(r){this.downloadUrl=r}};i._onBeforeExport=function t(r){const o=r.getParameter("userExportSettings")?.splitCells===true;const n=r.getSource(),i=r.getParameter("exportSettings"),a=this.getTableDefinition();e.updateExportSettings(i,a,n,o)};e.updateExportSettings=function t(e,o,i,a){const s=o.columns;this.setStaticSizeLimit(o,e);const l=e.workbook.columns;for(let t=l.length-1;t>=0;t--){const e=l[t];const o=r.getResourceBundleFor("sap.fe.macros");e.label=n(e.label,i);this.translateBooleanValueForExport(e,o);if(a){this.setExportConfig(s,l,t);this.addTargetValueColumn(s,l,o,t)}}const p=i.getParent().downloadUrl;if(p){e.dataSource.dataUrl=p}return e};e.setStaticSizeLimit=function t(e,r){if(!e.enableAnalytics&&(e.control.type==="ResponsiveTable"||e.control.type==="GridTable")){r.dataSource.sizeLimit=e.control.exportRequestSize??1e3}};e.translateBooleanValueForExport=function t(e,r){if(e.type==="Boolean"){e.falseValue=r.getText("no");e.trueValue=r.getText("yes")}};e.setExportConfig=function t(e,r,o){const n=e.find(t=>!t.propertyInfos&&t.relativePath===r[o].property.toString());if(n?.exportSettings){const t=["scale","delimiter","format","utc","type","inputFormat"];for(const e of t){if(n.exportSettings[e]){r[o]={...r[o],...{[e]:n.exportSettings[e]}};if(r[o].type==="Currency"){r[o].type="Number"}}}}};e.addTargetValueColumn=function t(e,r,o,n){const i=e?.find(t=>{if(!this.isPropertyFromExport(t,r[n])){return false}return this.columnWithTargetValueToBeAdded(t,r[n])});if(i){const t={label:o.getText("TargetValue"),property:Array.isArray(r[n].property)?r[n].property:[r[n].property],template:i.exportDataPointTargetValue};r.splice(n+1,0,t)}};e.isPropertyFromExport=function t(e,r){if(e.relativePath===r.property||r.property.includes(e.relativePath)||r.property.includes(e.name)){return true}if(e.propertyInfos?.length===1&&r.property[0]===e.propertyInfos[0]){return true}return false};e.columnWithTargetValueToBeAdded=function t(e,r){let o=false;if(e.exportDataPointTargetValue&&e.propertyInfos?.length===1){delete r.template;o=true}return o};return e}();o=i;return o},false);
//# sourceMappingURL=TableExport.js.map