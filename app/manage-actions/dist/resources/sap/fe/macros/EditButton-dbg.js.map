{"version":3,"names":["EditButton","_dec","defineUI5Class","_dec2","property","type","_dec3","bindToState","_class","_class2","_BuildingBlock","_this","_len","arguments","length","args","Array","_key","call","_initializerDefineProperty","_descriptor","_descriptor2","_exports","_inheritsLoose","_proto","prototype","onMetadataAvailable","_ownerComponent","content","createContent","buildEmphasizedButtonExpression","metaPath","identification","getTarget","annotations","UI","Identification","dataFieldsWithCriticality","filter","dataField","$Type","Criticality","dataFieldsBindingExpressions","map","criticalityVisibleBindingExpression","getExpressionFromAnnotation","and","not","equal","Hidden","or","constant","compileExpression","ifElse","ButtonType","Ghost","Emphasized","_easyEditDocument","getAppComponent","getEnvironmentCapabilities","getCapabilities","EasyEdit","controller","getPageController","view","getView","getModel","getProperty","editFlow","editDocument","apply","getBindingContext","easyEditDialog","getOwnerComponent","runAsOwner","EasyFillDialog","getEditableFields","_getEditableFields","bind","open","addDependent","allFields","findAggregatedObjects","control","isA","editableFields","forEach","field","propertyRelativePath","getMainPropertyRelativePath","isEditable","getEditable","Promise","resolve","_createId","id","createId","metaPathObject","getMetaPathObject","getOwnerContextPath","_jsx","CommandExecution","execute","command","MenuButton","enabled","bindState","text","buttonMode","useDefaultActionOnly","children","_jsxs","Menu","MenuItem","icon","getTranslatedText","Button","BuildingBlock","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sourceRoot":".","sources":["EditButton.tsx"],"sourcesContent":["import type { EntityType } from \"@sap-ux/vocabularies-types\";\nimport { UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport type { BindingToolkitExpression, CompiledBindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport { and, compileExpression, constant, equal, getExpressionFromAnnotation, ifElse, not, or } from \"sap/fe/base/BindingToolkit\";\nimport { defineUI5Class, property, type EnhanceWithUI5 } from \"sap/fe/base/ClassSupport\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport CommandExecution from \"sap/fe/core/controls/CommandExecution\";\nimport type MetaPath from \"sap/fe/core/helpers/MetaPath\";\nimport type Field from \"sap/fe/macros/Field\";\nimport EasyFillDialog from \"sap/fe/macros/ai/EasyFillDialog\";\nimport Button from \"sap/m/Button\";\nimport Menu from \"sap/m/Menu\";\nimport MenuButton from \"sap/m/MenuButton\";\nimport MenuItem from \"sap/m/MenuItem\";\nimport { ButtonType } from \"sap/m/library\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\n\n@defineUI5Class(\"sap.fe.macros.EditButton\")\nexport default class EditButton extends BuildingBlock<Button, { enabled: boolean }> {\n\t@property({ type: \"string\" })\n\ttext?: string;\n\n\t@property({ type: \"boolean\", bindToState: true })\n\tenabled?: boolean;\n\n\tonMetadataAvailable(_ownerComponent: TemplateComponent): void {\n\t\tsuper.onMetadataAvailable(_ownerComponent);\n\t\tthis.content = this.createContent();\n\t}\n\n\tbuildEmphasizedButtonExpression(metaPath: MetaPath<EntityType> | null): CompiledBindingToolkitExpression {\n\t\tconst identification = metaPath?.getTarget()?.annotations?.UI?.Identification;\n\t\tconst dataFieldsWithCriticality =\n\t\t\tidentification?.filter((dataField) => dataField.$Type === UIAnnotationTypes.DataFieldForAction && dataField.Criticality) || [];\n\n\t\tconst dataFieldsBindingExpressions = dataFieldsWithCriticality.length\n\t\t\t? dataFieldsWithCriticality.map((dataField) => {\n\t\t\t\t\tconst criticalityVisibleBindingExpression = getExpressionFromAnnotation(dataField.Criticality);\n\t\t\t\t\treturn and(\n\t\t\t\t\t\tnot(equal(getExpressionFromAnnotation(dataField.annotations?.UI?.Hidden), true)),\n\t\t\t\t\t\tor(\n\t\t\t\t\t\t\tequal(criticalityVisibleBindingExpression, \"UI.CriticalityType/Negative\"),\n\t\t\t\t\t\t\tequal(criticalityVisibleBindingExpression, \"1\"),\n\t\t\t\t\t\t\tequal(criticalityVisibleBindingExpression as BindingToolkitExpression<number>, 1),\n\t\t\t\t\t\t\tequal(criticalityVisibleBindingExpression, \"UI.CriticalityType/Positive\"),\n\t\t\t\t\t\t\tequal(criticalityVisibleBindingExpression, \"3\"),\n\t\t\t\t\t\t\tequal(criticalityVisibleBindingExpression as BindingToolkitExpression<number>, 3)\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t  })\n\t\t\t: ([constant(false)] as BindingToolkitExpression<boolean>[]);\n\n\t\t// If there is at least one visible dataField with criticality negative or positive, the type is set as Ghost\n\t\t// else it is emphasized\n\t\treturn compileExpression(ifElse(or(...dataFieldsBindingExpressions), ButtonType.Ghost, ButtonType.Emphasized));\n\t}\n\n\tasync _easyEditDocument(): Promise<void> {\n\t\tif (this.getAppComponent()?.getEnvironmentCapabilities().getCapabilities().EasyEdit) {\n\t\t\tconst controller = this.getPageController();\n\t\t\tconst view = controller.getView();\n\t\t\tif (!this.getPageController()?.getModel(\"ui\").getProperty(\"/isEditable\")) {\n\t\t\t\tawait controller.editFlow.editDocument.apply(controller.editFlow, [view?.getBindingContext()]);\n\t\t\t}\n\t\t\t// Open easy create dialog\n\t\t\tconst easyEditDialog = this.getPageController()\n\t\t\t\t.getOwnerComponent()\n\t\t\t\t?.runAsOwner(() => {\n\t\t\t\t\treturn new EasyFillDialog({ getEditableFields: this._getEditableFields.bind(this) });\n\t\t\t\t});\n\n\t\t\teasyEditDialog.open();\n\t\t\tview?.addDependent(easyEditDialog);\n\t\t}\n\t}\n\n\tasync _getEditableFields(): Promise<unknown> {\n\t\t// Connect all sections\n\t\tconst allFields = this.getPageController()\n\t\t\t.getView()\n\t\t\t?.findAggregatedObjects(true, (control: ManagedObject): boolean => {\n\t\t\t\treturn control.isA(\"sap.fe.macros.Field\");\n\t\t\t}) as EnhanceWithUI5<Field>[];\n\t\tconst editableFields: Record<string, { isEditable: boolean }> = {};\n\t\tallFields.forEach((field) => {\n\t\t\tconst propertyRelativePath = field.getMainPropertyRelativePath();\n\t\t\tif (propertyRelativePath) {\n\t\t\t\teditableFields[propertyRelativePath] = { isEditable: field.getEditable() };\n\t\t\t}\n\t\t});\n\t\treturn Promise.resolve(editableFields);\n\t}\n\n\t_createId(id: string): string {\n\t\treturn this.getPageController().getView().createId(id);\n\t}\n\n\tcreateContent(): Button {\n\t\tconst metaPathObject = this.getMetaPathObject<EntityType>(this.getOwnerContextPath()!);\n\t\tif (this.getAppComponent()?.getEnvironmentCapabilities().getCapabilities().EasyEdit) {\n\t\t\tthis.getPageController()\n\t\t\t\t.getView()\n\t\t\t\t?.addDependent(<CommandExecution execute={this._easyEditDocument.bind(this)} command=\"EasyEdit\" />);\n\t\t\treturn (\n\t\t\t\t<MenuButton\n\t\t\t\t\tid={this._createId(\"fe::StandardAction::EditMenu\")}\n\t\t\t\t\tenabled={this.bindState(\"enabled\")}\n\t\t\t\t\ttype={this.buildEmphasizedButtonExpression(metaPathObject)}\n\t\t\t\t\tdt:designtime=\"not-adaptable\"\n\t\t\t\t\ttext={this.text}\n\t\t\t\t\tjsx:command={\"cmd:Edit|defaultAction\"}\n\t\t\t\t\tbuttonMode=\"Split\"\n\t\t\t\t\tuseDefaultActionOnly=\"true\"\n\t\t\t\t>\n\t\t\t\t\t<Menu>\n\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\tid={this._createId(\"fe::StandardAction::Edit\")}\n\t\t\t\t\t\t\ticon=\"sap-icon://edit\"\n\t\t\t\t\t\t\ttext=\"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_EDIT}\"\n\t\t\t\t\t\t\tjsx:command=\"cmd:Edit|press\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\tid={this._createId(\"fe::StandardAction::EasyEdit\")}\n\t\t\t\t\t\t\ticon=\"sap-icon://ai\"\n\t\t\t\t\t\t\tjsx:command=\"cmd:EasyEdit|press\"\n\t\t\t\t\t\t\ttext={this.getTranslatedText(\"C_EASYEDIT_BUTTON\")}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Menu>\n\t\t\t\t</MenuButton>\n\t\t\t);\n\t\t} else {\n\t\t\treturn (\n\t\t\t\t<Button\n\t\t\t\t\tid={this._createId(\"fe::StandardAction::Edit\")}\n\t\t\t\t\tdt:designtime=\"not-adaptable\"\n\t\t\t\t\ttext={this.text}\n\t\t\t\t\ttype={this.buildEmphasizedButtonExpression(metaPathObject)}\n\t\t\t\t\tjsx:command=\"cmd:Edit|press\"\n\t\t\t\t\tenabled={this.bindState(\"enabled\")}\n\t\t\t\t/>\n\t\t\t) as Button;\n\t\t}\n\t}\n}\n"],"mappings":"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","ignoreList":[],"file":"EditButton-dbg.js"}