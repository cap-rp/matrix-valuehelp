/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/StandardRecommendationHelper","sap/ui/core/Lib","sap/ui/model/Filter","sap/ui/model/FilterType","sap/ui/model/Sorter","sap/ui/model/json/JSONModel"],function(e,t,n,i,a,r,s){"use strict";var o={};var l=t.standardRecommendationHelper;var c=function(e){e["recommendation"]="recommendation";e["recentValue"]="recentValue";e["other"]="other";return e}(c||{});o.AdditionalValueGroupKey=c;const u={requestForAdditionalValueContextData:async function(e,t,n,i,a,s){let o;const l=[];const u=[...e.filter(e=>e.groupKey===c.recommendation)].reverse();n.parameters.$select=i.qualifiers[i.valueHelpQualifier].vhProperties??[];const d=n.parameters.$search;n.parameters.$search=d;if(i.isValueListWithFixedValues){n.parameters.$count=true}const f=[];a.forEach(e=>f.push(new r(e.name??"",e.descending)));const h=t.getModel();const g=this.getAdditionalValueContextBindings(u,d,i,h,n,f);if(g.length>0){if(g.length===2){l.push(g[0].requestContexts(0,10,"additionalValue"));o=g[1]}else{o=g[0]}l.push(o.requestContexts(0,i.isValueListWithFixedValues?100:10,"additionalValue"))}await h.submitBatch("additionalValue");const p=await Promise.all(l);const m=o?.getCount();if(m&&m>100){s.getBindingContext("internal")?.setProperty("allListBinding",o)}let V=[],y=[];if(u.length>0){V=p[0];if(d||i.isValueListWithFixedValues){y=p[1]}}else if(d||i.isValueListWithFixedValues){y=p[0]}const x=V.map(e=>e.getObject());const A=y.map(e=>e.getObject());return{recommendationValuesContextData:x,othersValuesContextData:A}},getAdditionalValueContextBindings:function(e,t,n,i,a,r){const s=[];const o=[...this.getValueHelpBindingFilters(a)];const l=this.getAdditionalValueFilters(e,[...o]);if(e.length>0){s.push(i.bindList(a.path,undefined,undefined,l,a.parameters))}if(t||n.isValueListWithFixedValues){s.push(i.bindList(a.path,undefined,r,o,a.parameters))}return s},getValueHelpBindingFilters:function(e){if(e.filters){if(Array.isArray(e.filters)){return e.filters}else{return[e.filters]}}return[]},resumeValueListBindingAndResetChanges:async function(e){if(e.isSuspended()){await e.resumeAsync()}try{await e.resetChanges()}catch(e){}},sortAndFilterListBinding:function(e,t){e.filter(i.NONE,a.Application);if(t.length){const n=[];t.forEach(e=>n.push(new r(e.name??"",e.descending,this.getSorterFunction)));e.sort(n)}else e.sort(new r("",false,this.getSorterFunction))},getAdditionalValueFilters:function(e,t){e.forEach(e=>{if(e.values.length>0){const n=e.values;const a=e.propertyPath;n.forEach(e=>{t.push(new i({path:a,value1:e,operator:"EQ"}))})}});return t},getSorterFunction:function(e){const t=n.getResourceBundleFor("sap.fe.macros");const i=e.getProperty("@$fe.additionalValueGroupKey");if(i===c.recommendation){return t.getText("M_ADDITIONALVALUEHELPER_RECOMMENDATIONS")}else if(i===c.recentValue){return t.getText("M_ADDITIONALVALUEHELPER_RECENTVALUE")}else{return t.getText("M_ADDITIONALVALUEHELPER_OTHERS")}},createTransientContextsForAdditionalValueContextData:function(e,t,n,i){this.createGroupedTransientContexts(n,i,c.other);this.createGroupedTransientContexts(t,i,c.recentValue);this.createGroupedTransientContexts(e,i,c.recommendation)},createGroupedTransientContexts:function(t,n,i){[...t].reverse().forEach(async t=>{t["@$fe.additionalValueGroupKey"]=i;const a=n.create(t);try{await a.created()}catch(t){if(!t.canceled){e.error(t.name)}}})},getRelevantRecommendations:function(e,t,n,i){const a=[];let r;if(Object.keys(e).length>0){n=this.getRecommendationPropertyPath(n);if(e.version===2&&i){n=i}r=this.getAdditionalValueFromPropertyPath(n,t,e);if(r&&Object.keys(r).length>0){r.additionalValues.forEach(e=>{a.push(e.value)});return a}else{return null}}},_checkForKeysInRecommendations:function(e,t){for(const n in e){if(e[n]!==t[n]){return false}}return true},getAdditionalValueFromKeys:function(e,t){const n=t?.getObject();let i={};if(t&&n){if(Array.isArray(e)){e.forEach(e=>{const t=e.keyProperties;const a=this._checkForKeysInRecommendations(t,n);if(a){i=e}})}}return i},_getRecommendation:function(e,t,n){let i=Object.assign(n,{});if(Object.keys(n).includes(e)){return n[e]}else{while(Object.keys(i).length>0&&!Object.keys(i).includes(e)){const a=e.split("/");if(a.length>1){const r=a[0];a.splice(0,1);e=a.join("/");n=this.getAdditionalValueFromPropertyPath(r,t,n);n=this.getAdditionalValueFromKeys(n,t);if(Object.keys(n).length>0){i=Object.assign(n,{});n=this.getAdditionalValueFromPropertyPath(e,t,n)}else{return{}}}else{return{}}}return n}},getAdditionalValueFromPropertyPath:function(e,t,n){if(n.version===2){return l.getStandardRecommendations(t,e,n)}if(n){return this._getRecommendation(e,t,n)}},getRecommendationPropertyPath:function(e){const t=e.split("/");t.splice(0,2);return t.join("/")},getRelevantOthersValuesContextData:function(e,t,n,i){return n.filter(n=>!this.checkValuesMatch(n,e,i)&&!this.checkValuesMatch(n,t,i))},getRelevantRecentValuesContextData:function(e,t,n,i,a){const r=new s({recentValuesContextData:t});const o=r.bindList("/recentValuesContextData",undefined,undefined,this.getValueHelpBindingFilters(a));t=o.getAllCurrentContexts().map(e=>e.getObject());return t.filter(t=>this.filterRecentValuesContextData(t,i,n,e))},filterRecentValuesContextData:function(e,t,n,i){for(const a in e){if(typeof e[a]==="object"){if(this.filterRecentValuesContextData(e[a],t,n,i)){return true}}else if(typeof e[a]==="string"){if(!t&&i.length===0||e[a].includes(t)||n.includes(a)&&this.checkValuesMatch(e,i,n)){return true}}}return false},checkValuesMatch:function(e,t,n){for(const i of t){let t=true;for(const a of n){if(e[a]!==i[a]){t=false;break}}if(t){return true}}return false},getRelevantRecommendationValuesContextData:function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let n=arguments.length>2?arguments[2]:undefined;const i=[];t.forEach(t=>{const a=e.find(e=>e[n]===t);if(a){i.push(a)}});return i},updateFinished:async function t(n){const i=n.getSource();const a=i.getBindingContext("internal"),r=a?.getProperty("allListBinding");const{actual:s,total:o,reason:l}=n.getParameters();if(r&&l==="Growing"&&s===o){const t=await r.requestContexts(o,100),n=t.map(e=>e.getObject());n.forEach(async t=>{const n=i.getBinding("items").create(t,undefined,true);try{await n.created()}catch(t){if(t){e.error(t.name)}}})}}};o.additionalValueHelper=u;return o},false);
//# sourceMappingURL=AdditionalValueHelper.js.map