/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/formatters/CollaborationFormatter","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TitleHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/SemanticObjectHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/field/FieldTemplating","sap/fe/macros/internal/valuehelp/AdditionalValueFormatter","sap/fe/macros/situations/SituationsIndicator","sap/ui/mdc/enums/FieldEditMode"],function(t,e,a,i,o,n,r,s,d,l,c,p,u,f,m,y,h,P,M,g){"use strict";var v={};var x=h.setEditStyleProperties;var O=h.isUsedInNavigationWithQuickViewFacets;var b=h.isRetrieveTextFromValueListEnabled;var I=h.hasPropertyInsertRestrictions;var E=h.getVisibleExpression;var S=h.getValueBinding;var D=h.getTextBindingExpression;var F=h.getDraftIndicatorVisibleBinding;var C=h.getDataModelObjectPathForValue;var T=m.manageSemanticObjectsForCurrentUser;var j=m.getPropertyWithSemanticObject;var U=f.isSemanticKey;var A=f.getAssociatedExternalIdPropertyPath;var V=f.getAssociatedExternalIdProperty;var L=u.getTargetObjectPath;var w=u.getRelativePaths;var $=u.getContextRelativeTargetObjectPath;var R=u.enhanceDataModelPath;var k=p.isPropertyPathExpression;var B=p.isProperty;var N=p.isPathAnnotationExpression;var W=c.getTitleBindingExpression;var H=l.generate;var _=s.getRequiredPropertiesFromUpdateRestrictions;var q=s.getRequiredPropertiesFromInsertRestrictions;var Q=r.UI;var K=i.isDataField;var G=e.CollaborationFieldGroupPrefix;var z=t.transformRecursively;var J=t.pathInModel;var X=t.not;var Y=t.ifElse;var Z=t.getExpressionFromAnnotation;var tt=t.formatWithTypeInformation;var et=t.formatResult;var at=t.equal;var it=t.constant;var ot=t.compileExpression;var nt=t.and;function rt(t,e,a,i,o,n,r,s){const d={...t};Object.defineProperty(d,"value",{get:()=>t.value});Object.defineProperty(d,"description",{get:()=>t.description});d.change=t.change;d.metaPath=r?r:t.metaPath;d.contextPath=s?s:t.contextPath;d.visible=t.visible;if(!d.vhIdPrefix){d.vhIdPrefix="FieldValueHelp";d._flexId=t.id;if(!d.idPrefix){d.idPrefix=t.id}}d.formatOptions??={};d.formatOptions=mt(d);d.formatOptions.showOnlyUnitDecimals=a?.getProperty("/sapFeManifestConfiguration/app/showOnlyUnitDecimals")===true;d.valueHelpMetaPath=r?r:d.metaPath;dt(d,d.valueHelpMetaPath?.getModel());d.convertedMetaPath=vt(d.convertedMetaPath);Ft(d);ft(d);d.dataSourcePath=L(d.dataModelPath);pt(d);d.entityType=d.odataMetaModel.createBindingContext(`/${d.dataModelPath.targetEntityType.fullyQualifiedName}`);if(d.formatOptions?.forInlineCreationRows===true){d.hasPropertyInsertRestrictions=I(d.dataModelPath)}ct(d);st(d);lt(d);d.formatOptions=d.formatOptions?d.formatOptions:{};St(d,d.dataModelPathExternalID||d.dataModelPath,e,a);Ot(d,d.convertedMetaPath,d.dataModelPath,i,o);It(d,o);d.valueState=Dt(d);if(d.editStyle==="InputWithValueHelp"){d.editStylePlaceholder=gt(d)}Tt(d);jt(d,a);const l=["Avatar","AmountWithCurrency"];if(d.displayStyle&&!l.includes(d.displayStyle)&&d.dataModelPath.targetObject){d.text=d.text??d.value??h.getTextBinding(d.dataModelPathExternalID||d.dataModelPath,d.formatOptions)}else{d.text=""}if(d.formatOptions.showEmptyIndicator){d.emptyIndicatorMode=String(d.formatOptions.showEmptyIndicator)==="true"?"On":undefined}else{d.emptyIndicatorMode=undefined}if(B(d.convertedMetaPath)&&d.convertedMetaPath.annotations?.UI?.DataFieldDefault!==undefined){d.metaPath=d.odataMetaModel.createBindingContext(`@${"com.sap.vocabularies.UI.v1.DataFieldDefault"}`,r?r:d.metaPath)}if(!n){d.computedEditMode=ot(Y(at(d.readOnly,true),"Display","Editable"))}d.eventHandlers={change:()=>{},liveChange:()=>{},validateFieldGroup:()=>{},handleTypeMissmatch:()=>{},handleFileSizeExceed:()=>{},handleUploadComplete:()=>{},uploadStream:()=>{},removeStream:()=>{},handleOpenUploader:()=>{},handleCloseUploader:()=>{},openExternalLink:()=>{},onFocusOut:()=>{},linkPressed:()=>{},displayAggregationDetails:()=>{},onDataFieldWithNavigationPath:()=>{},showCollaborationEditUser:()=>{},onDataFieldActionButton:()=>{},onDataFieldWithIBN:()=>{}};return d}v.setUpField=rt;function st(t){const e=y.getEditableExpressionAsObject(t.propertyForFieldControl,t.convertedMetaPath,t.dataModelPath);if(d.isCollaborationDraftSupported(t.odataMetaModel)&&t.editMode!==g.Display){const a=true;const i=y.getCollaborationExpression(t.dataModelPath,o.hasCollaborationActivity);const n=ot(nt(e,X(i)));const r=ot(Y(i,it("ReadOnly"),Y(nt(Q.IsInactive,!!t.hasPropertyInsertRestrictions),"Display",t.editModeAsObject)));t.collaborationEnabled=a;t.collaborationExpression=i;t.editableExpression=n;t.computedEditMode=r}else{t.editableExpression=ot(e)}}v.computeCollaborationProperties=st;function dt(t,e){t.convertedMetaPath=a.convertMetaModelContext(t.metaPathContext?t.metaPathContext:t.metaPath);let i=a.getInvolvedDataModelObjects(t.metaPathContext?t.metaPathContext:t.metaPath,t.contextPath);i=C(i)||i;t.dataModelPath=i;t.property=i.targetObject;t.odataMetaModel=e;t.propertyForFieldControl=i?.targetObject?.Value?(i?.targetObject).Value:i?.targetObject}v.computeCommonProperties=dt;function lt(t){const e=q((t.contextPathContext?t.contextPathContext:t.contextPath)?.getPath().replaceAll("/$NavigationPropertyBinding/","/"),t.odataMetaModel);const a=_((t.contextPathContext?t.contextPathContext:t.contextPath)?.getPath().replaceAll("/$NavigationPropertyBinding/","/"),t.odataMetaModel);const i={requiredPropertiesFromInsertRestrictions:e,requiredPropertiesFromUpdateRestrictions:a};const o=y.getEnabledExpression(t.propertyForFieldControl,t.convertedMetaPath,false,t.dataModelPath);const n=y.getRequiredExpression(t.propertyForFieldControl,t.convertedMetaPath,false,false,i,t.dataModelPath);t.enabledExpression=o;t.requiredExpression=n}v.computeEditableExpressions=lt;function ct(t){if(t.editMode!==undefined&&t.editMode!==null){t.editModeAsObject=t.editMode}else{const e=t.formatOptions?.measureDisplayMode?t.formatOptions.measureDisplayMode==="ReadOnly":false;t.editModeAsObject=y.getEditMode(t.propertyForFieldControl,t.dataModelPath,e,true,t.convertedMetaPath);t.computedEditMode=ot(Y(nt(Q.IsInactive,!!t.hasPropertyInsertRestrictions),"Display",t.editModeAsObject))}}v.computeEditMode=ct;function pt(t){const e=V(t.property);if(e){if(t.property)t.property.type=e.type;if(K(t.convertedMetaPath)){t.convertedMetaPath.Value.$target.type=e.type}const i=A(t.property);const o=t.metaPath.getModel().createBindingContext(t.contextPath?.getPath()+"/"+i,t.metaPath);t.convertedMetaPathExternalID=a.convertMetaModelContext(o);let n=a.getInvolvedDataModelObjects(o,t.contextPath);n=C(n)||n;t.dataModelPathExternalID=n}}v.computeExternalID=pt;function ut(t,e){const a=["InputWithValueHelp","TextArea","DatePicker","TimePicker","DateTimePicker","InputWithUnit","Input","InputMask","Masked"];if(!e){return}const i=e.getSideEffectsService();const o=i.computeFieldGroupIds(t.dataModelPath.targetEntityType?.fullyQualifiedName??"",t.dataModelPath.targetObject?.fullyQualifiedName??"");t.mainPropertyRelativePath=B(t.dataModelPath.targetObject)?$(t.dataModelPath):undefined;if(t.collaborationEnabled&&a.includes(t.editStyle||"")){const e=`${G}${t.dataSourcePath}`;o.push(e)}return o.length?o:undefined}function ft(t){if(t._flexId&&!t._apiId){t._apiId=t._flexId;t._flexId=Ct(t._flexId)}if(t.idPrefix){t.editStyleId=H([t.idPrefix,"Field-edit"])}if(t.formatOptions?.fieldMode==="nowrapper"&&t.editMode==="Display"){if(t._flexId){t.displayStyleId=t._flexId}else{t.displayStyleId=t.idPrefix?H([t.idPrefix,"Field-content"]):undefined}}else if(t.idPrefix){t.displayStyleId=H([t.idPrefix,"Field-display"])}}v.computeIDs=ft;function mt(t){return{...t.formatOptions,textAlignMode:t.formatOptions.textAlignMode??"Form",showEmptyIndicator:t.formatOptions.showEmptyIndicator??true,displayMode:t.formatOptions.displayMode,measureDisplayMode:t.formatOptions.measureDisplayMode,textLinesEdit:t.formatOptions.textLinesEdit,textMaxLines:t.formatOptions.textMaxLines,textMaxCharactersDisplay:t.formatOptions.textMaxCharactersDisplay,textExpandBehaviorDisplay:t.formatOptions.textExpandBehaviorDisplay,textMaxLength:t.formatOptions.textMaxLength,fieldEditStyle:t.formatOptions.fieldEditStyle,radioButtonsHorizontalLayout:t.formatOptions.radioButtonsHorizontalLayout,showTime:t.formatOptions.showTime,showTimezone:t.formatOptions.showTimezone,showDate:t.formatOptions.showDate}}v.getFormatOptions=mt;function yt(t,e){let a=J($(e));const i=t?.displayMode;const o=k(e.targetObject)?e.targetObject.$target:e.targetObject;const r=o.annotations?.Common?.Text;if(r===undefined){return undefined}a=tt(o,a);switch(i){case"ValueDescription":const t=w(e);return ot(Z(r,t));case"DescriptionValue":return ot(et([a],n.formatToKeepWhitespace));default:return undefined}}function ht(t,e){const a={};if(t){const i=t[e];if(i){Object.keys(i).forEach(function(t){a[t]=i[t]})}}return a}function Pt(t,e,a,i,o){if(o){t.hasQuickView=true;t.quickViewType="Facets"}if(i){const i=T(t.semanticObject,a,e);if(i.hasReachableStaticSemanticObject||i.dynamicSemanticObjects.length){t.hasQuickView=true;t.quickViewType=o?"FacetsAndSemanticLinks":"SemanticLinks";t.dynamicSemanticObjects=i.hasReachableStaticSemanticObject!==true?i.dynamicSemanticObjects:undefined}}}function Mt(t,e){return!!j(e)||t.semanticObject!==undefined&&t.semanticObject!==""}function gt(t){let e;const a=t.editStylePlaceholder;const i=t.formatOptions.textAlignMode;if(i==="Table"){e=t.dataModelPath.targetEntityType}const o=t.dataModelPath.targetObject?.name;const n=J(`${o}@$ui5.fe.recommendations.placeholderValue`);const r=J(`${o}@$ui5.fe.recommendations.placeholderDescription`);const s=et([n,r,J(`/recommendationsData`,"internal"),J(`/currentCtxt`,"internal"),J(`${o}@$ui5.fe.messageType`),a,t.formatOptions.displayMode],P.formatPlaceholder,e);return ot(s)}v.setInputWithValuehelpPlaceholder=gt;function vt(t){const e={...t};if(t?.term==="com.sap.vocabularies.UI.v1.DataPoint"){e.$Type=t.$Type||"com.sap.vocabularies.UI.v1.DataPointType"}return e}v.setUpDataPointType=vt;function xt(t,e){const a=t?.getManifestEntry("sap.fe");return e?.annotations?.Measures?.ISOCurrency?a?.macros?.table?.currency?.decimalPadding??3:a?.macros?.table?.unitOfMeasure?.decimalPadding??3}v.getDecimalPadding=xt;function Ot(t,e,a,i,o){const n=t;const r=a.targetObject;if(!a.targetObject){n.displayStyle="Text";return n}n.hasUnitOrCurrency=r.annotations?.Measures?.Unit!==undefined||r.annotations?.Measures?.ISOCurrency!==undefined;n.hasValidAnalyticalCurrencyOrUnit=y.hasValidAnalyticalCurrencyOrUnit(a);n.textFromValueList=ot(et([J($(a)),`/${r.fullyQualifiedName}`,n.formatOptions.displayMode],"sap.fe.macros.field.FieldRuntime.retrieveTextFromValueList"));if(r.annotations?.UI?.IsImage){n.displayStyle="File";return n}if(r.annotations?.UI?.IsImageURL){n.displayStyle="Avatar";return n}if(r.annotations?.UI?.InputMask){n.displayStyle="Text";return n}if(r.annotations?.Common?.Masked){n.displayStyle="Masked";return n}if(r.type==="Edm.Stream"){n.displayStyle="File";return n}bt(a,n);switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataPointType":n.displayStyle="DataPoint";return n;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.DataPointType"){n.displayStyle="DataPoint";return n}else if(e.Target?.$target?.$Type==="com.sap.vocabularies.Communication.v1.ContactType"){n.displayStyle="Contact";return n}break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":n.displayStyle="Button";return n;case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":n.displayStyle="Link";return n}const s=O(a,r);const d=Mt(n,a);if(U(r,a)&&n.formatOptions.semanticKeyStyle){Pt(n,i,a,d,s);Et(n,a);n.showErrorIndicator=a.contextLocation?.targetObject?._type==="NavigationProperty"&&!n.formatOptions.fieldGroupDraftIndicatorPropertyPath;n.situationsIndicatorPropertyPath=a.targetObject.name;n.displayStyle=n.formatOptions.semanticKeyStyle==="ObjectIdentifier"?"ObjectIdentifier":"LabelSemanticKey";return n}if(e.Criticality){Pt(n,i,a,d,s);n.displayStyle="ObjectStatus";return n}if((r.annotations?.Measures?.ISOCurrency||r.annotations?.Measures?.Unit)&&String(n.formatOptions.isCurrencyOrUnitAligned)==="true"&&n.formatOptions.measureDisplayMode!=="Hidden"){const e=Ut.getDecimalPadding(o,r);n.valueAsStringBindingExpression=n.value?n.value:S(a,n.formatOptions,false,true,undefined,true,false,e,true);n.unitBindingExpression=ot(y.getBindingForUnitOrCurrency(a,true,!!t.formatOptions.showOnlyUnitDecimals));n.displayStyle="NumberWithUnitOrCurrencyAligned";return n}if(r.annotations?.Communication?.IsEmailAddress||r.annotations?.Communication?.IsPhoneNumber){n.displayStyle="Link";return n}if(r.annotations?.UI?.MultiLineText){n.displayStyle="ExpandableText";return n}if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){n.displayStyle="Link";return n}n.displayStyle="Text";Pt(n,i,a,d,s);if(n.hasQuickView){n.displayStyle="LinkWithQuickView"}return n}v.setUpDisplayStyle=Ot;function bt(t,e){if(U(t.targetObject,t)){e.hasSituationsIndicator=M.getSituationsNavigationProperty(t.targetEntityType)!==undefined;if(t.contextLocation?.targetEntitySet?.annotations?.Common?.DraftRoot&&t.targetEntitySet?.annotations?.Common?.DraftRoot&&e.formatOptions?.hasDraftIndicator===true){e.draftIndicatorVisible=F(t.targetObject?.name);e.addDraftIndicator=true}}}function It(t,e){const a=t;x(a,a.convertedMetaPath,a.dataModelPath);a.fieldGroupIds=ut(a,e);return a}v.setUpEditStyle=It;function Et(t,e){const a=t.formatOptions?.semanticKeyStyle;const i=t.formatOptions.displayMode;t.identifierTitle=W(e,D,{displayMode:i,splitTitleOnTwoLines:t.formatOptions.semanticKeyStyle==="ObjectIdentifier"},undefined,undefined);t.identifierText=a==="ObjectIdentifier"?yt(t.formatOptions,e):undefined}v.setUpObjectIdentifierTitleAndText=Et;function St(t,e,a,i){const o=ht(a,(t.metaPathContext?t.metaPathContext:t.metaPath).getPath());if(!t.formatOptions.displayMode){t.formatOptions.displayMode=y.getDisplayMode(e)}if(t.formatOptions.displayMode==="Description"){t.valueAsStringBindingExpression=t.value?t.value:S(e,t.formatOptions,true,true,undefined,true)}t.formatOptions.textLinesEdit=o.textLinesEdit||o.formatOptions&&o.formatOptions.textLinesEdit||t.formatOptions.textLinesEdit||4;t.formatOptions.textMaxLines=o.textMaxLines||o.formatOptions&&o.formatOptions.textMaxLines||t.formatOptions.textMaxLines;if(i?.getProperty("/retrieveTextFromValueList")){t.formatOptions.retrieveTextFromValueList=b(e.targetObject,t.formatOptions);if(t.formatOptions.retrieveTextFromValueList){const a=!!e?.targetEntityType?.annotations?.UI?.TextArrangement;t.formatOptions.displayMode=a?t.formatOptions.displayMode:"DescriptionValue"}}}v.setUpFormatOptions=St;function Dt(t){let e;const a=t.formatOptions?.textAlignMode?t.formatOptions?.textAlignMode:"Form";const i=J($(t.dataModelPath));const o=w(t.dataModelPath);const n=Z(t.dataModelPath?.targetObject?.annotations?.Common?.Text,o);const r=t.dataModelPath.targetObject?.name;const s=J(`${r}@$ui5.fe.recommendations.placeholderValue`);const d=J(`${r}@$ui5.fe.recommendations.placeholderDescription`);if(a==="Table"){e=et([s,d,J(`/recommendationsData`,"internal"),J(`/isEditable`,"ui"),t.dataSourcePath,i,n],P.formatValueState,t.dataModelPath.targetEntityType)}else{e=et([s,d,J(`/recommendationsData`,"internal"),J(`/isEditable`,"ui"),t.dataSourcePath,i,n],P.formatValueState)}t.valueState=ot(e);return t.valueState}v.setUpValueState=Dt;function Ft(t){const e=a.getInvolvedDataModelObjects(t.metaPathContext?t.metaPathContext:t.metaPath,t.contextPath);t.visible??=E(e,t.formatOptions);t.displayVisible=t.formatOptions?.fieldMode==="nowrapper"?t.visible:undefined}v.setUpVisibleProperties=Ft;function Ct(t){return`${t}-content`}function Tt(t){if(t.displayStyle==="File"){t.fileRelativePropertyPath=$(t.dataModelPath)||"";const e=t.property.annotations.Core?.ContentDisposition?.Filename;if(N(e)){const a=R(t.dataModelPath,e.path);t.fileFilenameExpression=$(a)??""}}}function jt(t,e){if(t.displayStyle==="File"||t.displayStyle==="Avatar"){t.inlineEditEnabled=undefined;return}t.inlineEditEnabled=t.inlineEditEnabled===true||e?.getProperty("/isInlineEditEnabled")===true?true:undefined;if(t.inlineEditEnabled&&t.editModeAsObject!=="Display"){const e=y.getEditableExpressionAsObject(t.propertyForFieldControl,t.convertedMetaPath,t.dataModelPath);t.hasInlineEdit=z(e,"PathInModel",t=>{if(t.path==="isEditable"&&t.modelName==="ui"){return it(true)}return t},true)}}const Ut={getDecimalPadding:xt,setUpField:rt,computeExternalID:pt,setUpDisplayStyle:Ot,setUpObjectIdentifierTitleAndText:Et,setUpValueState:Dt};return Ut},false);
//# sourceMappingURL=FieldStructureHelper.js.map