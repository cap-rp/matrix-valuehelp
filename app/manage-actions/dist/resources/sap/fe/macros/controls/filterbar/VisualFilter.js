/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/macros/CommonHelper","sap/fe/macros/controls/filterbar/utils/VisualFilterUtils","sap/fe/macros/filter/FilterUtils","sap/fe/macros/filterBar/FilterHelper","sap/m/VBox","sap/ui/core/Lib"],function(t,e,r,n,i,a,o,s){"use strict";var c,l,u,f,g;var d=a.getFiltersConditionsFromSelectionVariant;var p=t.implementInterface;var h=t.defineUI5Class;function _(t,e,r,n){r&&Object.defineProperty(t,e,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function m(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,E(t,e)}function E(t,e){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},E(t,e)}function I(t,e,r,n,i){var a={};return Object.keys(n).forEach(function(t){a[t]=n[t]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(r,n){return n(t,e,r)||r},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(t,e,a),null):a}function P(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let b=(c=h("sap.fe.macros.controls.filterbar.VisualFilter"),l=p("sap.ui.core.IFormContent"),c(u=(f=function(t){function a(){var e;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++){n[i]=arguments[i]}e=t.call(this,...n)||this;_(e,"__implements__sap_ui_core_IFormContent",g,e);return e}m(a,t);var o=a.prototype;o.onAfterRendering=function t(){let e;const a=this.getInteractiveChart();const o=this.data("infoPath");const c=a.getBinding("segments")||a.getBinding("bars")||a.getBinding("points");const l=a.getBindingContext("internal");const u=s.getResourceBundleFor("sap.fe.macros");const f=a.data("showOverlayInitially");const g=a.data("selectionVariantAnnotation")?a.data("selectionVariantAnnotation"):{SelectOptions:[]};const p=a.data("requiredProperties")?r.parseCustomData(a.data("requiredProperties")):[];const h=a.getModel().getMetaModel();const _=c?c.getPath():"";let m=this.getParent()?.getParent()?.getParent();if(m.getMetadata().getElementName()==="sap.ui.mdc.filterbar.p13n.AdaptationFilterBar"){m=m.getParent()?.getParent()?.getParent()}let E={};let I=[];let P;if(m.isA("sap.fe.macros.controls.FilterBar")){E=m.getConditions();I=i.getFilterPropertyInfo(m);P=m.data("entityType").split("/")[1]}const b=a.data("parameters")?a.data("parameters"):[];const v=d(_,h,g,n.getCustomConditions.bind(n));const y=n.convertFilterCondions(v);const R={};Object.keys(E).forEach(function(t){if(E[t].length){R[t]=E[t]}});Object.keys(y).forEach(function(t){if(!R[t]){R[t]=y[t]}});if(f===true){if(!Object.keys(g).length){if(p.length>1){l.setProperty(o,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{e=h.getObject(`${_}/${p[0]}@com.sap.vocabularies.Common.v1.Label`)||p[0];l.setProperty(o,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",e)})}}else{const t=[];const e=[];if(g.SelectOptions){g.SelectOptions.forEach(function(e){t.push(e.PropertyName.$PropertyPath)})}if(g.Parameters){g.Parameters.forEach(function(e){t.push(e.PropertyName.$PropertyPath)})}p.forEach(function(r){if(!t.includes(r)){e.push(r)}});const r=n.getErrorInfoForNoInitialOverlay(e,u,_,h);l.setProperty(o,r)}}if(!this._oChartBinding||this._oChartBinding!==c){if(this._oChartBinding){this.detachDataReceivedHandler(this._oChartBinding)}this.attachDataRecivedHandler(c);this._oChartBinding=c}const C=l.getProperty(o)&&l.getProperty(o).showError;const T=_!==""?_.split("/")[1].split("(")[0]:"";if(b&&b.length&&P===T){const t=i.getBindingPathForParameters(m,R,I,b);if(t){c.sPath=t}}if(c&&c.isSuspended()&&!C){c.resume()}};o.attachDataRecivedHandler=function t(e){if(e){e.attachEvent("dataReceived",{},this.onInternalDataReceived,this);this._oChartBinding=e}};o.detachDataReceivedHandler=function t(e){if(e){e.detachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=undefined}};o.getInteractiveChart=function t(){return this.getItems()[1].getItems()[0]};o.onInternalDataReceived=function t(r){const i=this.getId();const a=e.getTargetView(this);const o=this.getInteractiveChart();const c=this.data("infoPath");const l=o.getBindingContext("internal");const u=s.getResourceBundleFor("sap.fe.macros");const f=o.data("uom");n.updateChartScaleFactorTitle(o,a,i,c);if(r.getParameter("error")){const t=u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");const e=u.getText("M_VISUAL_FILTERS_ERROR_DATA_TEXT");n.applyErrorMessageAndTitle(t,e,c,a)}else if(r.getParameter("data")){const t=r.getSource().getCurrentContexts();if(t&&t.length===0){n.setNoDataMessage(c,u,a)}else{l.setProperty(c,{})}n.setMultiUOMMessage(t,o,c,u,a)}if(f&&(f["ISOCurrency"]&&f["ISOCurrency"].$Path||f["Unit"]&&f["Unit"].$Path)){const t=r.getSource().getContexts();const e=t&&t[0].getObject();n.applyUOMToTitle(o,e,a,c)}};return a}(o),g=I(f.prototype,"__implements__sap_ui_core_IFormContent",[l],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),f))||u);return b},false);
//# sourceMappingURL=VisualFilter.js.map