/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/templating/UIFormatters","sap/m/BusyDialog","./FieldWrapper"],function(e,t,i,r,a,l,n,o,s){"use strict";var u,c,p,d,f,b,y,g,h,v,m,C,w,E,_,x,P,B,I,z,S,U,T;var A=l.getResourceModel;var M=a.UI;var D=t.property;var O=t.defineUI5Class;var k=t.aggregation;var L=e.compileExpression;function j(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function R(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,V(e,t)}function V(e,t){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},V(e,t)}function q(e,t,i,r,a){var l={};return Object.keys(r).forEach(function(e){l[e]=r[e]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},l),a&&void 0!==l.initializer&&(l.value=l.initializer?l.initializer.call(a):void 0,l.initializer=void 0),void 0===l.initializer?(Object.defineProperty(e,t,l),null):l}function F(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let N=(u=O("sap.fe.macros.controls.FileWrapper"),c=D({type:"sap.ui.core.URI"}),p=D({type:"string"}),d=D({type:"string"}),f=D({type:"string"}),b=k({type:"sap.m.Avatar",multiple:false}),y=k({type:"sap.ui.core.Icon",multiple:false}),g=k({type:"sap.m.Link",multiple:false}),h=k({type:"sap.m.Text",multiple:false}),v=k({type:"sap.ui.unified.FileUploader",multiple:false}),m=k({type:"sap.m.Button",multiple:false}),u(C=(w=function(e){function t(t,i){var r;r=e.call(this,t,i)||this;j(r,"uploadUrl",E,r);j(r,"propertyPath",_,r);j(r,"filename",x,r);j(r,"mediaType",P,r);j(r,"avatar",B,r);j(r,"icon",I,r);j(r,"link",z,r);j(r,"text",S,r);j(r,"fileUploader",U,r);j(r,"deleteButton",T,r);r._busy=false;r.avatarCacheBustingInitialized=false;return r}R(t,e);var a=t.prototype;a.enhanceAccessibilityState=function e(t,i){return i};a.onBeforeRendering=function e(){this._setAriaLabelledBy();this._setAriaRequired();this._addSideEffects();this._refreshAvatar()};a._setAriaLabelledBy=function e(){if(this.link){const e=this.getParent();const t={labelledby:undefined};if(e&&e.enhanceAccessibilityState){e.enhanceAccessibilityState(this.link,t)}if(t.labelledby){this.addAriaLabelledBy(t.labelledby)}}};a.getIdForLabel=function e(){const t=this.link||this.text||this.avatar;return t.getIdForLabel()};a._refreshAvatar=function e(){const t=i.getTargetView(this);const r=t.getController().collaborativeDraft;if(r.isCollaborationEnabled()){const e=this.avatar?.getBindingInfo("src").binding;if(e&&!this.avatarCacheBustingInitialized){e.attachEvent("change",()=>{this.avatar?.refreshAvatarCacheBusting()});this.avatarCacheBustingInitialized=true}}};a._setAriaRequired=function e(){const t=i.getTargetView(this),a=t.getViewData().fullContextPath,l=t.getModel().getMetaModel(),o=l.getContext(a),s=l.createBindingContext(this.propertyPath,o),u=r.getInvolvedDataModelObjects(s,o);const c=u.targetObject;this.requiredExpression=n.getRequiredExpression(c,undefined,false,false,{},u)};a._addSideEffects=function e(){const t=[],a=i.getTargetView(this),l=a.getViewData().fullContextPath,n=a.getModel().getMetaModel(),o=n.getMetaPath(l),s=n.getContext(l),u=r.getInvolvedDataModelObjects(s),c=this.data("sourcePath"),p=c.replace(`${o}`,""),d=p.replace(this.propertyPath,"");t.push({$NavigationPropertyPath:p});if(this.filename){t.push({$NavigationPropertyPath:d+this.filename})}if(this.mediaType){t.push({$NavigationPropertyPath:d+this.mediaType})}this._getSideEffectController()?.addControlSideEffects(u.targetEntityType.fullyQualifiedName,{sourceProperties:[p],targetEntities:t,sourceControlId:this.getId()})};a._getSideEffectController=function e(){const t=this._getViewController();return t?t._sideEffects:undefined};a._getViewController=function e(){const t=i.getTargetView(this);return t&&t.getController()};a.getUploadUrl=function e(){const t=this.getBindingContext();return t&&this.uploadUrl?this.uploadUrl.replace(t.getPath(),t.getCanonicalPath()):""};a.setUIBusy=function e(t){const i=this;this._busy=t;if(t){if(!this.busyDialog){this.busyDialog=new o({text:A(this).getText("M_FILEWRAPPER_BUSY_DIALOG_TITLE"),showCancelButton:false})}setTimeout(function(){if(i._busy){i.busyDialog?.open()}},1e3)}else{this.busyDialog?.close(false)}};a.getUIBusy=function e(){return this._busy};t.render=function e(t,r){let a,l;if(r.avatar){a="100%";l="3rem"}else{a=i.getIsEditable(r)?"calc(100% - 5rem)":"100%";l="4.5rem"}t.openStart("div",r);t.style("width",r.width);t.openEnd();t.openStart("div");t.style("display","flex");t.style("box-sizing","border-box");t.style("justify-content","space-between");t.style("align-items","center");t.style("flex-wrap","wrap");t.style("align-content","stretch");t.style("width","100%");t.openEnd();t.openStart("div");t.style("display","flex");t.style("align-items","center");t.style("max-width",a);t.style("min-width",l);t.openEnd();if(r.avatar){t.renderControl(r.avatar)}else{t.renderControl(r.icon);t.renderControl(r.link);if(r.requiredExpression&&r.requiredExpression===L(M.IsEditable)&&i.getIsEditable(r)){t.accessibilityState(r.link,{required:true,labelledby:r.ariaLabelledBy[0]})}else{t.accessibilityState(r.link,{labelledby:r.ariaLabelledBy[0]})}t.renderControl(r.text)}t.close("div");t.openStart("div");t.style("display","flex");t.style("align-items","center");t.openEnd();t.renderControl(r.fileUploader);t.renderControl(r.deleteButton);t.close("div");t.close("div");t.close("div")};a.destroy=function e(t){const i=this._getSideEffectController();if(i){i.removeControlSideEffects(this)}delete this.busyDialog;s.prototype.destroy.apply(this,[t])};return t}(s),E=q(w.prototype,"uploadUrl",[c],{configurable:true,enumerable:true,writable:true,initializer:null}),_=q(w.prototype,"propertyPath",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),x=q(w.prototype,"filename",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),P=q(w.prototype,"mediaType",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),B=q(w.prototype,"avatar",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),I=q(w.prototype,"icon",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),z=q(w.prototype,"link",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),S=q(w.prototype,"text",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),U=q(w.prototype,"fileUploader",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),T=q(w.prototype,"deleteButton",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),w))||C);return N},false);
//# sourceMappingURL=FileWrapper.js.map