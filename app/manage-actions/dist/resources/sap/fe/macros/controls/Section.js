/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/base/HookSupport","sap/fe/core/CommonUtils","sap/fe/core/helpers/FPMHelper","sap/fe/macros/controls/section/mixin/SectionStateHandler","sap/ui/core/Component","sap/uxap/ObjectPageSection"],function(e,t,i,n,o,s,l,a){"use strict";var r,c,u,d,g,S,b,h,f,p,A,m;var T=t.property;var j=t.mixin;var C=t.defineUI5Class;function F(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function y(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,v(e,t)}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function k(e,t,i,n,o){var s={};return Object.keys(n).forEach(function(e){s[e]=n[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function O(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let P=(r=C("sap.fe.macros.controls.Section",{designtime:"sap/uxap/designtime/ObjectPageSection.designtime"}),c=j(s),u=T({type:"string"}),d=T({type:"boolean"}),g=T({type:"string"}),S=T({type:"string"}),r(b=c(b=(h=function(t){function s(e,i){var n;n=t.call(this,e,i)||this;F(n,"onSectionLoaded",f,n);F(n,"useSingleTextAreaFieldAsNotes",p,n);F(n,"applyStateHandler",A,n);F(n,"retrieveStateHandler",m,n);n.registerDelegate();return n}y(s,t);var a=s.prototype;a.registerDelegate=function e(){const t={onAfterRendering:()=>{const e=n.getTargetView(this);let t=this.getSubSections();t=t.filter(e=>{const t=e.getBlocks();return t.length===0});if(t.length){t.forEach(t=>{const i={onBeforeRendering:()=>{if(this.useSingleTextAreaFieldAsNotes){this.checkAndAdjustSectionContentForTextArea()}this.checkAndAdjustForSingleContent(e);t.removeEventDelegate(i)}};t.addEventDelegate(i)})}else{if(this.useSingleTextAreaFieldAsNotes){this.checkAndAdjustSectionContentForTextArea()}this.checkAndAdjustForSingleContent(e)}}};this.addEventDelegate(t)};a.setOnSectionLoaded=function e(t){const i=t.split(".");this._sectionLoadMethodName=i?.pop();this._sectionLoadModuleName=i?.join("/");this.setProperty("onSectionLoaded",t)};a.applySettings=function e(n,o){t.prototype.applySettings.call(this,n,o);const s=l.getOwnerComponentFor(this);const a=s.getRootController();if(a){i.initControllerExtensionHookHandlers(this,a)}return this};a.updateNonTableSubSectionBackground=function e(t){if(this.hasStyleClass("sapUiTableOnObjectPageAdjustmentsForSection")){t.forEach(e=>{let{subSection:t,tablesAdjusted:i}=e;if(i){t.removeStyleClass("sapUiAdjustedSectionSubsectionWithoutTable")}else{t.addStyleClass("sapUiAdjustedSectionSubsectionWithoutTable")}})}};a.checkAndAdjustSectionContentForTextArea=function e(){const t=this.getVisibleSubSections();const i=t.reduce((e,t)=>{let i;const n=this.getSingleContent([t]);if(n){i=this.adjustForSingleContent(n).tablesAdjusted}e.push({subSection:t,tablesAdjusted:i});return e},[]);this.updateNonTableSubSectionBackground(i)};a.checkAndAdjustForSingleContent=function t(i){if(i?.getViewData()?.sectionLayout==="Page"){const t=this.getSingleContent();if(t&&(t.isA("sap.fe.macros.controls.section.ISingleSectionContributor")||this.checkIfNotesReuseComponent(t))){const{tablesAdjusted:e}=this.adjustForSingleContent(t);const i=this.getVisibleSubSections();this.updateNonTableSubSectionBackground([{subSection:i[0],tablesAdjusted:e}])}else if(this._sectionLoadModuleName&&this._sectionLoadMethodName){return o.loadModuleAndCallMethod(this._sectionLoadModuleName,this._sectionLoadMethodName,i,this)}else if(this.getSubSections().length>1){this.checkAndAdjustTitles()}else{e.debug("Section cannot be adjusted for single content : Interface 'ISingleSectionContributor' is not implemented")}}else{this.checkAndAdjustTitles()}};a.checkIfNotesReuseComponent=function e(t){if(t.isA("sap.m.VBox")&&t.getId().includes("NoteSection")){return true}return false};a.checkAndAdjustTitles=function e(){const t=this.getVisibleSubSections();if(t.length===1){const{tablesAdjusted:e}=this.adjustSectionContentWithTitle(t[0]);this.updateNonTableSubSectionBackground([{subSection:t[0],tablesAdjusted:e}])}else{const e=t.reduce((e,t)=>{let i;let n;const o=t.getBlocks();if(o.length===2&&o[1]?.isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock")){i=this.adjustSectionContentWithTitle(t).tablesAdjusted}else if(o.length===1&&o[0]?.isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock")){n=o[0].getAggregation("content");if(n.isA("sap.fe.macros.controls.section.ISingleSectionContributor")){i=this.adjustForSingleContent(n,{sectionFromReferenceFacet:true,SubSection:t,showTitle:this.getVisibleSubSections().length>1}).tablesAdjusted}else if(n?.isA("sap.ui.layout.DynamicSideContent")){n=n.getMainContent instanceof Function&&n?.getMainContent();if(n&&n.length===1){n=n[0];i=this.adjustForSingleContent(n,{sectionFromReferenceFacet:true,SubSection:t}).tablesAdjusted}}}e.push({subSection:t,tablesAdjusted:i});return e},[]);this.updateNonTableSubSectionBackground(e)}};a.adjustSectionContentWithTitle=function e(t){let i={};const n=t.getBlocks();let o;if(n.length===2&&n[1].isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock")){o=n[1].getAggregation("content");if(o&&o.isA("sap.fe.macros.controls.section.ISingleSectionContributor")&&n[0].isA("sap.m.Title")){i=this.adjustForSingleContent(o,{sectionfromCollectionFacet:true,Title:n[0],SubSection:t,showTitle:this.getVisibleSubSections().length>1})}else if(o&&o.isA("sap.ui.layout.DynamicSideContent")){o=o.getMainContent instanceof Function&&o?.getMainContent();if(o&&o.length===1){o=o[0];i=this.adjustForSingleContent(o,{sectionfromCollectionFacet:true,Title:n[0],SubSection:t})}}}return{subSection:t,tablesAdjusted:i.tablesAdjusted}};a.getSingleContent=function e(t){const i=t??this.getVisibleSubSections();if(i.length===1){const e=i[0].getBlocks();if(e.length===1&&e[0].isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock")){return e[0].getAggregation("content")}else if(e.length===2&&e[0].isA("sap.ui.core.InvisibleText")&&e[1].isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock"))return e[1].getAggregation("content")}};a.getVisibleSubSections=function e(){const t=this.getSubSections();return t.reduce((e,t)=>{if(t.getVisible()){e.push(t)}return e},[])};a.getSectionTitle=function e(){let t=this.getTitle();if(this.getVisibleSubSections().length===1){t=this.getVisibleSubSections()[0].getTitle()}return t};a.adjustForSingleContent=function e(t,i){const n=new Set;const o=t;const s=o.getSectionContentRole&&o.getSectionContentRole();if(s==="provider"){const e=o.getDataFromProvider&&o.getDataFromProvider(this.useSingleTextAreaFieldAsNotes);if(e&&this.getTitle()===e.title){this.setTitle(e.title);this.setShowTitle(true);n.add("sapUiTableOnObjectPageAdjustmentsForSection")}}else if(s==="consumer"){let e=this.getSectionTitle();if(i?.sectionfromCollectionFacet){e=i?.Title?.getText();i?.Title?.setVisible(false);i?.SubSection?.setShowTitle(false)}else if(i?.sectionFromReferenceFacet){e=i?.SubSection?.getTitle();i?.SubSection?.setShowTitle(false)}if(e===""&&i?.SubSection){e=(i?.SubSection).getTitle()}if(o.sendDataToConsumer){const t=this.getSubSections();const s=!!(t?.length>1);o.sendDataToConsumer({titleLevel:this.getTitleLevel(),title:e,headerStyle:s?"H5":"H4"});this.setShowTitle(!!i?.showTitle);n.add("sapUiTableOnObjectPageAdjustmentsForSection");if(!s)t[0].setShowTitle(false)}}else if(t?.isA("sap.m.Title")){const e=t;e.setText(this.getTitle());e.setTitleStyle("H4");e.setLevel(this.getTitleLevel());this.setShowTitle(false);n.add("sapUiTableOnObjectPageAdjustmentsForSection")}else if(this.checkIfNotesReuseComponent(t)){const e=t.getItems();e.forEach(e=>{const t=e.getAggregation("headerToolbar");if(t){t?.getContent().forEach(e=>{if(e.isA("sap.m.Title")){const t=e;t.setText(this.getTitle());t.setTitleStyle("H4");t.setLevel(this.getTitleLevel())}})}});this.setShowTitle(false);n.add("sapUiTableOnObjectPageAdjustmentsForSection")}this.addStyleClass(Array.from(n).join(" "));return{tablesAdjusted:n.has("sapUiTableOnObjectPageAdjustmentsForSection")}};return s}(a),f=k(h.prototype,"onSectionLoaded",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),p=k(h.prototype,"useSingleTextAreaFieldAsNotes",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),A=k(h.prototype,"applyStateHandler",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),m=k(h.prototype,"retrieveStateHandler",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),h))||b)||b);return P},false);
//# sourceMappingURL=Section.js.map