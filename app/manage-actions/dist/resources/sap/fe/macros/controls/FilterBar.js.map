{"version":3,"file":"FilterBar.js","names":["FilterBar","_dec","defineUI5Class","_dec2","property","type","defaultValue","_dec3","association","multiple","_class","_class2","_MdcFilterBar","idOrProps","settings","_this","call","this","_initializerDefineProperty","_descriptor","_descriptor2","_isInitialized","_initializeStatus","_inheritsLoose","_proto","prototype","async","waitForInitialization","isInitialized","setToggleControl","vToggle","_oSegmentedButton","Element","getElementById","toggleControl","detachEvent","_toggleLayout","bind","attachEvent","setAssociation","then","targetKey","getSelectedKey","_oFilterBarLayout","isA","_oSecondaryFilterBarLayout","VisualFilterContainer","setShowAdaptFiltersButton","oCurrentFilterBarLayout","oFilterItems","getFilterItems","aFilterFields","getAllFilterFields","aSortedFilterFields","getSortedFilterFields","aButtons","getAllButtons","aVisualFilterFields","getAllVisualFilterFields","setAllFilterFields","forEach","oFilterField","iIndex","removeFilterField","insertFilterField","oButton","removeButton","addButton","setAggregation","invalidate","catch","error","Log","aFilterItems","aFilterIds","oFilterItem","push","getId","sort","aFirstItem","aSecondItem","sFirstItemVFId","sSecondItemVFId","getContent","oInnerControl","indexOf","_createInnerLayout","FilterContainer","_cLayoutItem","FilterItemLayout","getInner","addStyleClass","_addButtons","oInnerLayout","oFilterContainerInnerLayoutEventDelegate","onBeforeRendering","initialLayout","removeEventDelegate","addEventDelegate","exit","getSegmentedButton","MdcFilterBar","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./FilterBar.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { association, defineUI5Class, property } from \"sap/fe/base/ClassSupport\";\nimport FilterContainer from \"sap/fe/macros/controls/filterbar/FilterContainer\";\nimport type VisualFilter from \"sap/fe/macros/controls/filterbar/VisualFilter\";\nimport VisualFilterContainer from \"sap/fe/macros/controls/filterbar/VisualFilterContainer\";\nimport type Button from \"sap/m/Button\";\nimport type SegmentedButton from \"sap/m/SegmentedButton\";\nimport type Control from \"sap/ui/core/Control\";\nimport { default as Element } from \"sap/ui/core/Element\";\nimport type { $FilterBarSettings } from \"sap/ui/mdc/FilterBar\";\nimport MdcFilterBar from \"sap/ui/mdc/FilterBar\";\nimport type FilterField from \"sap/ui/mdc/FilterField\";\nimport type IFilterContainer from \"sap/ui/mdc/filterbar/IFilterContainer\";\nimport FilterItemLayout from \"sap/ui/mdc/filterbar/aligned/FilterItemLayout\";\n\n@defineUI5Class(\"sap.fe.macros.controls.FilterBar\")\nclass FilterBar extends MdcFilterBar {\n\t@property({ type: \"string\", defaultValue: \"compact\" })\n\tinitialLayout!: string;\n\n\t/**\n\t * Control which allows for switching between visual and normal filter layouts\n\t */\n\t@association({\n\t\ttype: \"sap.m.SegmentedButton\",\n\t\tmultiple: false\n\t})\n\ttoggleControl!: string;\n\n\tconstructor(idOrProps?: PropertiesOf<FilterBar> & $FilterBarSettings, settings?: PropertiesOf<FilterBar> & $FilterBarSettings) {\n\t\tsuper(idOrProps as unknown as string, settings);\n\t\tthis._initializeStatus();\n\t}\n\n\tprivate async _initializeStatus(): Promise<void> {\n\t\tawait this.waitForInitialization();\n\t\tthis._isInitialized = true;\n\t}\n\n\tisInitialized(): boolean {\n\t\treturn !!this._isInitialized;\n\t}\n\n\tprivate _isInitialized = false;\n\n\tprivate _oSegmentedButton?: SegmentedButton;\n\n\tprivate _oSecondaryFilterBarLayout?: IFilterContainer;\n\n\tprivate _oFilterBarLayout!: IFilterContainer;\n\n\tprivate _cLayoutItem: typeof FilterItemLayout;\n\n\tsetToggleControl(vToggle: string | SegmentedButton): void {\n\t\tif (typeof vToggle === \"string\") {\n\t\t\tthis._oSegmentedButton = Element.getElementById(vToggle) as SegmentedButton;\n\t\t} else {\n\t\t\tthis._oSegmentedButton = vToggle;\n\t\t}\n\n\t\tif (this.toggleControl && this._oSegmentedButton) {\n\t\t\tthis._oSegmentedButton.detachEvent(\"selectionChange\", this._toggleLayout.bind(this));\n\t\t}\n\t\tif (this._oSegmentedButton) {\n\t\t\tthis._oSegmentedButton.attachEvent(\"selectionChange\", this._toggleLayout.bind(this));\n\t\t}\n\t\tthis.setAssociation(\"toggleControl\", vToggle, true);\n\t}\n\n\t_toggleLayout(): void {\n\t\t// Since primary layout is always compact\n\t\t// hence set the secondary layout as visual filter only for the first time only\n\t\tthis.waitForInitialization()\n\t\t\t.then(() => {\n\t\t\t\tconst targetKey = this._oSegmentedButton?.getSelectedKey();\n\t\t\t\tif (\n\t\t\t\t\t(targetKey === \"visual\" &&\n\t\t\t\t\t\tthis._oFilterBarLayout?.isA<VisualFilterContainer>(\"sap.fe.macros.controls.filterbar.VisualFilterContainer\")) ||\n\t\t\t\t\t(targetKey === \"compact\" &&\n\t\t\t\t\t\t!this._oFilterBarLayout?.isA<VisualFilterContainer>(\"sap.fe.macros.controls.filterbar.VisualFilterContainer\"))\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (!this._oSecondaryFilterBarLayout) {\n\t\t\t\t\tthis._oSecondaryFilterBarLayout = new VisualFilterContainer() as unknown as IFilterContainer;\n\t\t\t\t}\n\n\t\t\t\t// do not show Adapt Filters Button for visual layout\n\t\t\t\tif (this._oSecondaryFilterBarLayout?.isA<VisualFilterContainer>(\"sap.fe.macros.controls.filterbar.VisualFilterContainer\")) {\n\t\t\t\t\tthis.setShowAdaptFiltersButton(false);\n\t\t\t\t} else {\n\t\t\t\t\tthis.setShowAdaptFiltersButton(true);\n\t\t\t\t}\n\n\t\t\t\t// get all filter fields and button of the current layout\n\t\t\t\tconst oCurrentFilterBarLayout = this._oFilterBarLayout;\n\t\t\t\tconst oFilterItems = this.getFilterItems();\n\t\t\t\tconst aFilterFields = oCurrentFilterBarLayout.getAllFilterFields();\n\t\t\t\tconst aSortedFilterFields = this.getSortedFilterFields(oFilterItems, aFilterFields);\n\t\t\t\tconst aButtons = oCurrentFilterBarLayout.getAllButtons();\n\t\t\t\tconst aVisualFilterFields =\n\t\t\t\t\toCurrentFilterBarLayout.getAllVisualFilterFields &&\n\t\t\t\t\t(oCurrentFilterBarLayout.getAllVisualFilterFields() as Record<string, VisualFilter> | undefined);\n\t\t\t\tif (this._oSecondaryFilterBarLayout?.isA<VisualFilterContainer>(\"sap.fe.macros.controls.filterbar.VisualFilterContainer\")) {\n\t\t\t\t\tthis._oSecondaryFilterBarLayout.setAllFilterFields(aSortedFilterFields, aVisualFilterFields);\n\t\t\t\t}\n\t\t\t\t// use secondary filter bar layout as new layout\n\t\t\t\tthis._oFilterBarLayout = this._oSecondaryFilterBarLayout!;\n\n\t\t\t\t// insert all filter fields from current layout to new layout\n\t\t\t\taFilterFields.forEach((oFilterField: FilterField, iIndex: number) => {\n\t\t\t\t\toCurrentFilterBarLayout.removeFilterField(oFilterField);\n\t\t\t\t\tthis._oFilterBarLayout.insertFilterField(oFilterField, iIndex);\n\t\t\t\t});\n\t\t\t\t// insert all buttons from the current layout to the new layout\n\t\t\t\taButtons.forEach((oButton: Button) => {\n\t\t\t\t\toCurrentFilterBarLayout.removeButton(oButton);\n\t\t\t\t\tthis._oFilterBarLayout.addButton(oButton);\n\t\t\t\t});\n\n\t\t\t\t// set the current filter bar layout to the secondary one\n\t\t\t\tthis._oSecondaryFilterBarLayout = oCurrentFilterBarLayout;\n\n\t\t\t\t// update the layout aggregation of the filter bar and rerender the same.\n\t\t\t\tthis.setAggregation(\"layout\", this._oFilterBarLayout, true);\n\t\t\t\tthis._oFilterBarLayout.invalidate();\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tLog.error(error);\n\t\t\t});\n\t}\n\n\tgetSortedFilterFields(aFilterItems: FilterField[], aFilterFields: FilterField[]): FilterField[] {\n\t\tconst aFilterIds: string[] = [];\n\t\taFilterItems.forEach(function (oFilterItem: FilterField) {\n\t\t\taFilterIds.push(oFilterItem.getId());\n\t\t});\n\t\taFilterFields.sort(function (aFirstItem: FilterField, aSecondItem: FilterField) {\n\t\t\tlet sFirstItemVFId, sSecondItemVFId;\n\t\t\t(aFirstItem.getContent() as unknown as Control[]).forEach(function (oInnerControl: Control) {\n\t\t\t\tif (oInnerControl.isA<FilterField>(\"sap.ui.mdc.FilterField\")) {\n\t\t\t\t\tsFirstItemVFId = oInnerControl.getId();\n\t\t\t\t}\n\t\t\t});\n\t\t\t(aSecondItem.getContent() as unknown as Control[]).forEach(function (oInnerControl: Control) {\n\t\t\t\tif (oInnerControl.isA<FilterField>(\"sap.ui.mdc.FilterField\")) {\n\t\t\t\t\tsSecondItemVFId = oInnerControl.getId();\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn aFilterIds.indexOf(sFirstItemVFId ?? \"\") - aFilterIds.indexOf(sSecondItemVFId ?? \"\");\n\t\t});\n\t\treturn aFilterFields;\n\t}\n\n\t_createInnerLayout(): void {\n\t\tthis._oFilterBarLayout = new FilterContainer();\n\t\tthis._cLayoutItem = FilterItemLayout;\n\t\tthis._oFilterBarLayout.getInner().addStyleClass(\"sapUiMdcFilterBarBaseAFLayout\");\n\t\tthis._addButtons();\n\n\t\t// TODO: Check with MDC if there is a better way to load visual filter on the basis of control property\n\t\t// _createInnerLayout is called on Init by the filter bar base.\n\t\t// This mean that we do not have access to the control properties yet\n\t\t// and hence we cannot decide on the basis of control properties whether initial layout should be compact or visual\n\t\t// As a result we have to do this workaround to always load the compact layout by default\n\t\t// And toogle the same in case the initialLayout was supposed to be visual filters.\n\t\tconst oInnerLayout = this._oFilterBarLayout.getInner();\n\t\tconst oFilterContainerInnerLayoutEventDelegate = {\n\t\t\tonBeforeRendering: (): void => {\n\t\t\t\tif (this.initialLayout === \"visual\") {\n\t\t\t\t\tthis._toggleLayout();\n\t\t\t\t}\n\t\t\t\toInnerLayout.removeEventDelegate(oFilterContainerInnerLayoutEventDelegate);\n\t\t\t}\n\t\t};\n\t\toInnerLayout.addEventDelegate(oFilterContainerInnerLayoutEventDelegate);\n\n\t\tthis.setAggregation(\"layout\", this._oFilterBarLayout, true);\n\t}\n\n\texit(): void {\n\t\tsuper.exit();\n\t\t// Sometimes upon external navigation this._SegmentedButton is already destroyed\n\t\t// so check if it exists and then only remove stuff\n\t\tif (this._oSegmentedButton) {\n\t\t\tthis._oSegmentedButton.detachEvent(\"selectionChange\", this._toggleLayout);\n\t\t\tdelete this._oSegmentedButton;\n\t\t}\n\t}\n\n\tgetSegmentedButton(): SegmentedButton | undefined {\n\t\treturn this._oSegmentedButton;\n\t}\n}\ninterface FilterBar {\n\t_addButtons(): void;\n}\nexport default FilterBar;\n"],"mappings":"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","ignoreList":[]}