/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/controls/easyFill/EasyFillPlaceholder","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/converters/MetaModelConverter","sap/fe/core/templating/PropertyHelper","sap/fe/macros/Field","sap/fe/macros/field/FieldTemplating","sap/m/Button","sap/m/Dialog","sap/m/FlexBox","sap/m/FlexItemData","sap/m/FormattedText","sap/m/OverflowToolbar","sap/m/ScrollContainer","sap/m/TextArea","sap/m/Title","sap/m/ToolbarSpacer","sap/m/VBox","sap/m/library","sap/ui/core/InvisibleText","sap/ui/core/Title","sap/ui/layout/form/ColumnLayout","sap/ui/layout/form/Form","sap/ui/layout/form/FormContainer","sap/ui/layout/form/FormElement","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,a,i,n,r,s,o,l,c,d,u,h,g,p,f,m,b,C,y,E,x,T,P,_,v,S,I,w,F){"use strict";var M,A,O,D,L,V,B;function j(e){return new Promise((t,a)=>{sap.ui.require([e],a=>{if(!(a&&a.__esModule)){a=a===null||!(typeof a==="object"&&e.endsWith("/library"))?{default:a}:a;Object.defineProperty(a,"__esModule",{value:true})}t(a)},e=>{a(e)})})}var U={};var z=x.FlexDirection;var $=c.getValueBinding;var Y=o.isImmutable;var N=o.isComputed;var R=o.getLabel;var G=r.CollaborationUtils;var k=a.property;var W=a.defineUI5Class;var H=a.defineReference;var q=a.createReference;var Q=t.transformRecursively;function X(e,t,a,i){a&&Object.defineProperty(e,t,{enumerable:a.enumerable,configurable:a.configurable,writable:a.writable,value:a.initializer?a.initializer.call(i):void 0})}function J(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,K(e,t)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function Z(e,t,a,i,n){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=a.slice().reverse().reduce(function(a,i){return i(e,t,a)||a},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer?(Object.defineProperty(e,t,r),null):r}function ee(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let te=(M=W("sap.fe.macros.ai.EasyFillDialog"),A=H(),O=k({type:"Function"}),M(D=(L=function(t){function a(e,a){var i;i=t.call(this,e,a)||this;X(i,"$reviewArea",V,i);X(i,"getEditableFields",B,i);return i}U=a;J(a,t);var n=a.prototype;n.onMetadataAvailable=function e(a){t.prototype.onMetadataAvailable.call(this,a);this.state.newValues={};this.state.hasValues=false;this.content=this.createContent()};n.onConfirm=async function e(t){const a=this.getPageController().getView()?.getBindingContext();const i=[];const n=this._bindingContext?.getObject()??this.state.newValues;for(const e in n){if(e!=="__bindingInfo"&&!e.startsWith("@$")){if(typeof n[e]!=="object"){a?.setProperty(e,n[e]);i.push(this.applyUpdatesForChange(this.getPageController().getView(),a.getPath(e)))}}}await Promise.all(i);this.content?.close()};n.applyUpdatesForChange=async function t(a,i){const n=a.getModel().getMetaModel();const r=n.getMetaContext(i);const o=s.getInvolvedDataModelObjects(r);const l=a.getBindingContext();try{const e=[];const t=G.getAppComponent(a).getSideEffectsService();const r=n.getMetaPath(l.getPath());const s=n.getMetaPath(i).replace(r,"").slice(1);e.push(t.requestSideEffects([s],l,"$auto"));const c=t.computeFieldGroupIds(o.targetEntityType.fullyQualifiedName,o.targetObject.fullyQualifiedName);if(c.length){const t=a.getController();const i=t._sideEffects.getSideEffectsMapForFieldGroups(c,l);Object.keys(i).forEach(a=>{const n=i[a];e.push(t._sideEffects.requestSideEffects(n.sideEffects,n.context,"$auto",undefined,true))})}await Promise.all(e)}catch(t){e.error("Failed to update data after change:"+t);throw t}};n.onCancel=function e(){this.content?.close()};n.open=function e(){this.content?.open()};n._getFieldMapping=function e(t){const a={};if(t){const e=t.getMetaPath().getTarget();let i;switch(e._type){case"EntitySet":case"Singleton":i=e.entityType;break;case"NavigationProperty":i=e.targetType;break}if(i!==undefined){for(const e of i.entityProperties){if(!Y(e)&&!N(e)&&e.annotations.UI?.Hidden?.valueOf()!==true){a[e.name]={description:R(e)??e.name,dataType:e.type}}}}}return a};n.generateListBinding=function e(t,a){const i=a.bindList(t,undefined,[],[],{$$updateGroupId:"submitLater"});i.refreshInternal=()=>{};return i};n.onEasyEditPressed=async function e(){const t=this.getOwnerPageDefinition();const a=this._getFieldMapping(t);const i=await j("ux/eng/fioriai/reuse/easyfill/EasyFill");const n=this.getModel();const r=this.generateListBinding(n.getMetaModel().getMetaPath(this.getPageController().getView()?.getBindingContext()?.getPath()),this.getModel());this._bindingContext=r.create({},true);const s=await i.extractFieldValuesFromText(this.state.enteredText,a);if(s.success){const e=s.data;const t=await(this.getEditableFields?.())??{};this.state.hasValues=false;this.state.hasIncorrectValues=false;this.$reviewArea.current?.removeAllItems();const i=w(v,{editable:true,class:"sapUiSmallMarginTopBottom",visible:this.bindState("hasValues"),children:{layout:w(_,{columnsM:2,columnsL:2,columnsXL:2,labelCellsLarge:1,emptyCellsLarge:1})}});const n=w(v,{editable:false,class:"sapUiSmallMarginTopBottom",visible:this.bindState("hasIncorrectValues"),children:{layout:w(_,{columnsM:2,columnsL:2,columnsXL:2,labelCellsLarge:1,emptyCellsLarge:1})}});const r=w(S,{children:{title:w(P,{text:this.getTranslatedText("C_EASYEDIT_PREVIOUS_VALUES")})}});const o=w(S,{children:{title:w(P,{text:this.getTranslatedText("C_EASYEDIT_PREVIOUS_VALUES")})}});const c=w(S,{children:{title:w(P,{text:this.getTranslatedText("C_EASYEDIT_NEW_VALUES")})}});const d=w(S,{children:{title:w(P,{text:this.getTranslatedText("C_EASYEDIT_NEW_VALUES")})}});const u=this.getPageController().getModel("ui")?.createBindingContext("/easyEditDialog");this.getPageController().getModel("ui").setProperty("/easyEditDialog",{});u.setProperty("isEditable",true);c.setBindingContext(u,"ui");i.addFormContainer(r);i.addFormContainer(c);n.addFormContainer(o);n.addFormContainer(d);const h={};const g={};c.setBindingContext(this._bindingContext);d.setBindingContext(this.getModel("$componentState")?.createBindingContext("/incorrectValues"));d.setModel(this.getModel("$componentState"));for(const i in e){if(t[i]&&t[i].isEditable===true){h[i]=e[i];this._bindingContext.setProperty(i,e[i]);this.state.hasValues=true;let t=$(this.getDataModelObjectForMetaPath(i,this.getOwnerContextPath()),{},false,false,undefined,false,false,0,false,true);t=Q(t,"PathInModel",e=>{e.modelName="$componentState";e.path="/newValues/"+e.path;return e});r.addFormElement(w(I,{label:a[i].description,children:w(l,{metaPath:i,contextPath:this.getOwnerContextPath(),readOnly:true})}));c.addFormElement(w(I,{label:a[i].description,children:w(l,{metaPath:i,contextPath:this.getOwnerContextPath()})}))}else{g[i]=e[i];this.state.hasIncorrectValues=true;o.addFormElement(w(I,{label:a[i].description,children:w(l,{metaPath:i,contextPath:this.getOwnerContextPath(),readOnly:true})}));d.addFormElement(w(I,{label:a[i].description,children:w(l,{metaPath:i,contextPath:this.getOwnerContextPath(),readOnly:true})}))}}const p=q();this.$reviewArea.current?.addItem(w(m,{vertical:true,class:"sapUiContentPadding",children:{content:w(E,{ref:p,children:{items:[w(C,{text:this.getTranslatedText("C_EASYEDIT_FILLED_FIELDS"),visible:this.bindState("hasValues")}),i,w(C,{text:this.getTranslatedText("C_EASYEDIT_INCORRECT_FIELDS"),class:"sapUiSmallMarginTopBottom",visible:this.bindState("hasIncorrectValues")}),n]}})}}));p.current?.setBindingContext(this.getPageController().getView()?.getBindingContext());p.current?.setModel(this.getPageController().getModel());p.current?.setModel(this.getPageController().getModel("ui"),"ui");this.state.newValues=h;this.state.incorrectValues=g}};n.createContent=function e(){const t=w(T,{text:this.getTranslatedText("C_EASYEDIT_DIALOG_DESCRIPTION")});return w(u,{title:this.getTranslatedText("C_EASYEDIT_DIALOG_TITLE"),resizable:true,horizontalScrolling:false,verticalScrolling:false,contentWidth:"1100px",contentHeight:"800px",escapeHandler:()=>{this.onCancel()},afterClose:()=>{this.destroy()},children:{content:F(h,{direction:z.Row,renderType:"Bare",width:"100%",height:"100%",children:[F(h,{width:"40%",id:this.createId("inputArea"),direction:z.Column,class:"sapUiContentPadding",renderType:"Bare",children:[w(p,{htmlText:this.getTranslatedText("C_EASYEDIT_DIALOG_DESCRIPTION"),class:"sapUiMarginEnd"}),t,w(b,{value:this.bindState("enteredText"),width:"100%",rows:20,growing:true,growingMaxLines:30,ariaLabelledBy:t}),w(d,{text:this.getTranslatedText("C_EASYEDIT_BUTTON"),icon:"sap-icon://ai",enabled:true,press:this.onEasyEditPressed.bind(this),children:{layoutData:w(g,{alignSelf:"End"})}})]}),w(h,{id:this.createId("reviewArea"),ref:this.$reviewArea,width:"60%",renderType:"Bare",direction:z.Column,class:"sapFeEasyFillReviewArea",children:w(i,{})})]}),footer:F(f,{children:[w(y,{}),w(d,{text:this.getTranslatedText("C_EASYEDIT_DIALOG_SAVE"),type:"Emphasized",enabled:this.bindState("hasValues"),press:this.onConfirm.bind(this)}),w(d,{text:this.getTranslatedText("C_EASYEDIT_DIALOG_CANCEL"),type:"Transparent",press:this.onCancel.bind(this)})]})}})};return a}(n),V=Z(L.prototype,"$reviewArea",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),B=Z(L.prototype,"getEditableFields",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),L))||D);U=te;return U},false);
//# sourceMappingURL=EasyFillDialog.js.map