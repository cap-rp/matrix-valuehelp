/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/macros/CommonHelper","sap/fe/macros/controls/filterbar/utils/VisualFilterUtils","sap/fe/macros/filter/FilterUtils","sap/fe/macros/filterBar/FilterHelper","sap/ui/core/Lib","sap/ui/mdc/condition/Condition","sap/ui/mdc/odata/v4/TypeMap","sap/ui/mdc/util/FilterUtil","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,r,n,i,s,o,a,l,f,c,g){"use strict";var u=s.getFiltersConditionsFromSelectionVariant;const d={selectionChanged(t){const r=t.getSource();const i=r.data("outParameter");const s=r.data("valuelistProperty");const o=r.data("dimension");const l=r.data("dimensionText");const f=r.data("multipleSelectionAllowed");const c=r.data("dimensionType");const g=t.getParameter("bar")||t.getParameter("point")||t.getParameter("segment");const u=t.getParameter("selected");const d=r.getModel("$field");let p=d.getProperty("/conditions");if(!i||s!==o){e.error("VisualFilter: Cannot sync values with regular filter as out parameter is not configured properly!")}else{let t=g?.getBindingContext()?.getObject(s);if(t){let e=g?.getBindingContext()?.getObject(l);if(typeof e!=="string"&&!(e instanceof String)){e=undefined}if(u){if(f===false){p=[]}if(c==="Edm.DateTimeOffset"){t=n._parseDateTime(t)}const r=a.createItemCondition(t,e||undefined,{},{});p.push(r)}else{p=p.filter(function(e){if(c==="Edm.DateTimeOffset"){return e.operator!=="EQ"||Date.parse(e.values[0])!==Date.parse(t)}return e.operator!=="EQ"||e.values[0]!==t})}d.setProperty("/conditions",p)}else{e.error("VisualFilter: No vaue found for the outParameter")}}},getAggregationSelected(e){let t=[];if(!this.getBindingContext()){return}for(let r=0;r<=e.length-1;r++){const n=e[r];if(n.operator==="EQ"){t.push(n.values[0])}}const r=this.getParent();const i=r.data("dimension");const s=r.data("dimensionType");let o=this.getBindingContext()?.getObject(i);if(s==="Edm.DateTimeOffset"){o=n._parseDateTime(o)}if(r.data("multipleSelectionAllowed")===false&&t.length>1){t=[t[0]]}return t.includes(o)},getFiltersFromConditions(){for(var t=arguments.length,s=new Array(t),a=0;a<t;a++){s[a]=arguments[a]}const d=this.getParent();const p=d.getParent()?.getParent()?.getParent()?.getParent()?.getParent();const m=d.data("inParameters").customData;const h=d.data("draftSupported")===true;const P=i.getFilterPropertyInfo(p);const y={};const E=[];let T;let F=[];const C=d.data("parameters");const v=d.data("selectionVariantAnnotation");const L=d.getBinding("bars")||d.getBinding("points")||d.getBinding("segments");const _=L.getPath();const b=d.getModel().getMetaModel();const S=L.getPath();const M=u(S,b,v,n.getCustomConditions.bind(n));for(const e in P){P[e].typeConfig=l.getTypeConfig(P[e].dataType,{},{})}const I=n.convertFilterCondions(M);Object.keys(I).forEach(function(e){y[e]=I[e];const t=m.find(function(t){return t.valueListProperty===e});const r=t?t.localDataProperty:e;if(!C||C&&!C.includes(e)){for(const t in P){const i=P[t];if(r===i.name){if(i?.typeConfig?.baseType==="DateTime"){if(y[e]){y[e].forEach(function(e){e.values[0]=n._formatDateTime(e.values[0])})}}E.push({name:e,typeConfig:i.typeConfig})}}}});m.forEach(function(e,t){if(s[t].length>0){y[e.valueListProperty]=s[t];if(!C||C&&!C.includes(e.valueListProperty)){for(const t in P){const r=P[t];if(r.name===e.localDataProperty){if(r?.typeConfig?.baseType==="DateTime"){if(y[e.valueListProperty]){y[e.valueListProperty].forEach(function(e){e.values[0]=n._formatDateTime(e.values[0])})}}E.push({name:e.valueListProperty,typeConfig:r.typeConfig})}}}}});const V=d.getBindingContext("internal");const D=d.data("infoPath");let O;const R=o.getResourceBundleFor("sap.fe.macros");const A=r.parseCustomData(d.data("requiredProperties"));if(A.length){const e=Object.keys(y)||[];const t=[];A.forEach(function(r){if(!e.includes(r)){t.push(r)}});if(!t.length){O=V.getProperty(`${D}/showError`);V.setProperty(D,{errorMessageTitle:"",errorMessage:"",showError:false})}else if(t.length>1){V.setProperty(D,{errorMessageTitle:R.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:R.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF"),showError:true});return}else{const e=b.getObject(`${S}/${t[0]}@com.sap.vocabularies.Common.v1.Label`)||t[0];V.setProperty(D,{errorMessageTitle:R.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:R.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",e),showError:true});return}}else{O=V.getProperty(`${D}/showError`);V.setProperty(D,{errorMessageTitle:"",errorMessage:"",showError:false})}const w=p.data("entityType").split("/")[1];const B=_.split("/")[1].split("(")[0];if(C&&C.length&&w===B){const e=O?i.getBindingPathForParameters(p,y,P,C):undefined;if(e){L.sPath=e}}if(C&&C.length){C.forEach(function(e){if(y[e]){delete y[e]}})}if(Object.keys(y).length>0&&E.length){try{T=f.getFilterInfo(p,y,E,[]).filters}catch(t){e.debug("VisualFilter: Error while getting filters from MDCFilterUtil")}if(T){if(!T.getFilters()){F.push(T)}else if(T.getFilters()){F=T.getFilters()}}}if(h){F.push(new c("IsActiveEntity",g.EQ,true))}if(F&&F.length>0){L?.filter(F)}else if(!Object.keys(y).length){L?.filter()}if(O&&L?.isSuspended()){L?.resume()}return F},getFilterCounts(e){if(this.data("multipleSelectionAllowed")===false&&e.length>0){return`(1)`}if(e.length>0){return`(${e.length})`}else{return undefined}},scaleVisualFilterValue(e,t,r,i,s){if(t){return n.getFormattedNumber(s,t,r)}else if(i){return n.getFormattedNumber(s,undefined,undefined,i)}else if(r>0){r=r>2?2:r;return n.getFormattedNumber(s,undefined,r)}else{return e}},fireValueHelp(e){e.getSource().getParent()?.getParent()?.getParent()?.getParent()?.fireEvent("valueHelpRequest")}};t.set("sap.fe.macros.visualfilters.VisualFilterRuntime",d);return d},false);
//# sourceMappingURL=VisualFilterRuntime.js.map