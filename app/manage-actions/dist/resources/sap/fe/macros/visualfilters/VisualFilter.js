/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/merge","sap/fe/base/ClassSupport","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/converters/ConverterContext","sap/fe/core/converters/ManifestWrapper","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/helpers/Aggregation","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/m/Button","sap/m/Label","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/Title","sap/m/ToolbarSpacer","sap/m/VBox","sap/ui/core/CustomData","../controls/filterbar/VisualFilter","./InteractiveChartHelper","./VisualFilterRuntime","./fragments/InteractiveCharts","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs"],function(e,t,r,i,n,a,o,l,s,u,c,h,p,g,f,b,m,d,y,A,w,T,M,v,C){"use strict";var I,V,P,_,S,H,z,D,E,U,O,x,F,L,B,R,j,q,N,$,k,W,Y,G,J,K,Q,X,Z,ee,te,re,ie,ne,ae,oe,le,se,ue,ce,he,pe,ge,fe,be,me,de,ye,Ae,we,Te,Me,ve,Ce,Ie,Ve,Pe,_e,Se,He,ze;var De={};var Ee=T.getVisualFilterChart;var Ue=u.generate;var Oe=l.AggregationHelper;var xe=o.getDefaultSelectionVariant;var Fe=r.property;var Le=r.implementInterface;var Be=r.event;var Re=r.defineUI5Class;function je(e,t,r,i){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function qe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ne(e,t)}function Ne(e,t){return Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ne(e,t)}function $e(e,t,r,i,n){var a={};return Object.keys(i).forEach(function(e){a[e]=i[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},a),n&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(n):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}function ke(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let We=(I=Re("sap.fe.macros.visualfilters.VisualFilter"),V=Le("sap.ui.core.IFormContent"),P=Fe({type:"boolean"}),_=Fe({type:"string"}),S=Be(),H=Fe({type:"string",required:true}),z=Fe({type:"string"}),D=Fe({type:"string",required:true}),E=Fe({type:"string",required:true}),U=Fe({type:"string"}),O=Fe({type:"string"}),x=Fe({type:"string"}),F=Fe({type:"array"}),L=Fe({type:"boolean"}),B=Fe({type:"boolean"}),R=Fe({type:"boolean"}),j=Fe({type:"boolean"}),q=Fe({type:"array"}),N=Fe({type:"string"}),$=Fe({type:"boolean"}),k=Fe({type:"string"}),W=Fe({type:"boolean"}),Y=Fe({type:"boolean"}),G=Fe({type:"boolean"}),J=Fe({type:"string"}),K=Fe({type:"string"}),Q=Fe({type:"string"}),X=Fe({type:"string"}),Z=Fe({type:"boolean"}),ee=Fe({type:"boolean"}),I(te=(re=function(r){function i(e,t){var i;i=r.call(this,e,t)||this;je(i,"__implements__sap_ui_core_IFormContent",ie,i);je(i,"showValueHelp",ne,i);je(i,"valueHelpIconSrc",ae,i);je(i,"valueHelpRequest",oe,i);je(i,"id",le,i);je(i,"title",se,i);je(i,"contextPath",ue,i);je(i,"metaPath",ce,i);je(i,"outParameter",he,i);je(i,"valuelistProperty",pe,i);je(i,"selectionVariantAnnotation",ge,i);je(i,"inParameters",fe,i);je(i,"multipleSelectionAllowed",be,i);je(i,"required",me,i);je(i,"showOverlayInitially",de,i);je(i,"renderLineChart",ye,i);je(i,"requiredProperties",Ae,i);je(i,"filterBarEntityType",we,i);je(i,"showError",Te,i);je(i,"chartMeasure",Me,i);je(i,"UoMHasCustomAggregate",ve,i);je(i,"showValueHelpButton",Ce,i);je(i,"customAggregate",Ie,i);je(i,"groupId",Ve,i);je(i,"errorMessageTitle",Pe,i);je(i,"errorMessage",_e,i);je(i,"_contentId",Se,i);je(i,"draftSupported",He,i);je(i,"isValueListWithFixedValues",ze,i);return i}De=i;qe(i,r);var o=i.prototype;o.onMetadataAvailable=function r(i){this.groupId="$auto.visualFilters";this.path=this.metaPath;const o=this._getOwner();this.contextPath=this.contextPath??o?.preprocessorContext?.fullContextPath;const l=this.getDataModelObjectForMetaPath(this.metaPath,this.contextPath);if(this.contextPath){this._resolvedContextPath=this.contextPath.endsWith("/")?this.contextPath:this.contextPath+"/"}const u=this.getMetaModel();const c=this.getAppComponent()?.getDiagnostics()??{};const h=this._getOwner()?.getRootController()?.getView().getViewData()??this._getOwner()?.getViewData();const p=n.createConverterContextForMacro(l?.startingEntitySet?.name,u,c,t,l?.contextLocation,new a(h,this.getAppComponent()));const g=new Oe(p.getEntityType(),p);const f=g.getCustomAggregateDefinitions();const b=l?.targetObject;let m;const d=b&&b.Visualizations;this.getChartAnnotation(d,p);let y=[],w=[];if(this.chartAnnotation?.Measures?.length){w=f.filter(e=>e.qualifier===this.chartAnnotation?.Measures[0].value);m=w.length>0?w[0].qualifier:this.chartAnnotation.Measures[0].value;y=g.getAggregatedProperties()[0]}if(y&&y.length>0&&!this.chartAnnotation?.DynamicMeasures&&w.length===0&&this.chartAnnotation?.Measures&&this.chartAnnotation?.Measures.length>0){e.warning("The transformational aggregate measures are configured as Chart.Measures but should be configured as Chart.DynamicMeasures instead. Please check the SAP Help documentation and correct the configuration accordingly.")}if(this.chartAnnotation?.DynamicMeasures){if(w.length===0){m=p.getConverterContextFor(p.getAbsoluteAnnotationPath(this.chartAnnotation.DynamicMeasures[0].value)).getDataModelObjectPath().targetObject?.Name.toString();y=g.getAggregatedProperty()}else{e.warning("The dynamic measures have been ignored as visual filters can deal with only 1 measure and the first (custom aggregate) measure defined under Chart.Measures is considered.")}}if(f.some(function(e){return e.qualifier===m})){this.customAggregate=true}const T=xe(p.getEntityType());this.checkSelectionVariant(T);const M=this.getAggregateProperties(y,m);if(M){this.aggregateProperties=M}const v=d&&this.chartAnnotation?.Measures&&this.chartAnnotation?.Measures[0]?.$target?.annotations;const C=M?.AggregatableProperty?.$target?.annotations;this.checkIfUOMHasCustomAggregate(f,v,C);const I=v?.UI?.Hidden;const V=I?.valueOf();const P=this.chartAnnotation?.ChartType;this.chartType=P;this.showValueHelpButton=this.getshowValueHelpButton(P,V);this.draftSupported=s.isDraftSupported(u,this.contextPath);this.errorMessage=this.getErrorMessage(V,m);this.chartMeasure=m;this.measureDimensionTitle=A.getMeasureDimensionTitle(this.chartAnnotation,this.customAggregate,this.aggregateProperties);const _=this.getDataModelObjectForMetaPath(this.contextPath);this.toolTip=A.getToolTip(this.chartAnnotation,_,this.path,this.customAggregate,this.aggregateProperties,this.renderLineChart);this.UoMVisibility=A.getUoMVisiblity(this.chartAnnotation,this.showError);this.scaleUoMTitle=A.getScaleUoMTitle(this.chartAnnotation,_,this.path,this.customAggregate,this.aggregateProperties);this.collection=_;this.sortOrder=b?.SortOrder;this.filterCountBinding=A.getfilterCountBinding(this.chartAnnotation);const S=this.getPageController()?.getView().getId();if(this._contentId){this._contentId=`${S}--${this._contentId}`}this.selectionVariant=this.selectionVariantAnnotation?this.getDataModelObjectForMetaPath(this.selectionVariantAnnotation)?.targetObject:undefined;this.content=this.createContent()};o.checkIfUOMHasCustomAggregate=function e(t,r,i){const n=r?.Measures;const a=i?.Measures;const o=this.getUoM(n,a);if(o&&t.some(function(e){return e.qualifier===o})){this.UoMHasCustomAggregate=true}else{this.UoMHasCustomAggregate=false}};o.getChartAnnotation=function e(t,r){if(t){for(let e of t){const t=e&&e.value;this.chartAnnotation=r.getEntityTypeAnnotation(t)&&r.getEntityTypeAnnotation(t).annotation}}};o.setShowValueHelp=function e(t){if(this.content?.isA("sap.fe.macros.controls.filterbar.VisualFilter")){if(this.content?.getItems().length>0){const e=this.getVisualFilterControl();e?.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setVisible(t)}});this.setProperty("showValueHelp",t)}}};o.setValueHelpIconSrc=function e(t){if(this.content?.isA("sap.fe.macros.controls.filterbar.VisualFilter")){if(this.content?.getItems().length>0){const e=this.getVisualFilterControl();e?.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setIcon(t)}});this.setProperty("valueHelpIconSrc",t)}}};o.getVisualFilterControl=function e(){if(this.content?.isA("sap.fe.macros.controls.filterbar.VisualFilter")){return(this.content?.getItems()[0]).getItems()[0]}};o.getErrorMessage=function e(t,r){let i;if(this.chartAnnotation){if(this.chartAnnotation.ChartType==="UI.ChartType/Line"||this.chartAnnotation.ChartType==="UI.ChartType/Bar"){i=true}else{i=false}}if(typeof t==="boolean"&&t||!i||this.renderLineChart===false){this.showError=true;this.errorMessageTitle=t||!i?this.getTranslatedText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"):this.getTranslatedText("M_VISUAL_FILTER_LINE_CHART_INVALID_DATATYPE");if(t){return this.getTranslatedText("M_VISUAL_FILTER_HIDDEN_MEASURE",[r])}else if(!i){return this.getTranslatedText("M_VISUAL_FILTER_UNSUPPORTED_CHART_TYPE")}else{return this.getTranslatedText("M_VISUAL_FILTER_LINE_CHART_UNSUPPORTED_DIMENSION")}}};o.getshowValueHelpButton=function e(t,r){const i=this.chartAnnotation?.Dimensions[0]&&this.chartAnnotation?.Dimensions[0].$target&&this.chartAnnotation.Dimensions[0].$target.type;if(i==="Edm.Date"||i==="Edm.Time"||i==="Edm.DateTimeOffset"){return false}else if(typeof r==="boolean"&&r){return false}else if(!(t==="UI.ChartType/Bar"||t==="UI.ChartType/Line")){return false}else if(this.renderLineChart===false&&t==="UI.ChartType/Line"){return false}else if(this.isValueListWithFixedValues===true){return false}else{return true}};o.checkSelectionVariant=function t(r){let i;if(this.selectionVariantAnnotation){i=this.getDataModelObjectForMetaPath(this.selectionVariantAnnotation)?.targetObject}if(!i&&r){i=r}if(i&&i.SelectOptions&&!this.multipleSelectionAllowed){for(const t of i.SelectOptions){if(t.PropertyName?.value===this.chartAnnotation?.Dimensions[0].value){if(t.Ranges.length>1){e.error("Multiple SelectOptions for FilterField having SingleValue Allowed Expression")}}}}};o.getAggregateProperties=function e(t,r){let i;if(!t){return}t.some(function(e){if(e.Name===r){i=e;return true}});return i};o.getUoM=function e(t,r){let i=t?.ISOCurrency;let n=t?.Unit;if(!i&&!n&&r){i=r.ISOCurrency;n=r.Unit}return i?.path||n?.path};o.getRequired=function e(){if(this.required){return M(h,{text:"",width:"0.5rem",required:"true",children:{layoutData:M(g,{priority:"Never"})}})}else{return""}};o.getTitle=function e(){return M(f,{id:Ue([this._contentId,"MeasureDimensionTitle"]),text:this.measureDimensionTitle,tooltip:this.toolTip,titleStyle:"H6",level:"H3",class:"sapUiTinyMarginEnd sapUiNoMarginBegin"})};o.getUoMTitle=function e(t){if(this.UoMVisibility){return M(f,{id:Ue([this._contentId,"ScaleUoMTitle"]),visible:t,text:this.scaleUoMTitle,titleStyle:"H6",level:"H3",width:"4.15rem"})}else{return""}};o.getToolBarSpacer=function e(){if(this.showValueHelpButton){return M(b,{})}else{return""}};o.getValueHelp=function e(t){if(this.showValueHelpButton){return M(c,{id:Ue([this._contentId,"VisualFilterValueHelpButton"]),type:"Transparent",ariaHasPopup:"Dialog",text:this.filterCountBinding,enabled:t,press:e=>{w.fireValueHelp(e)},children:{layoutData:M(g,{priority:"Never"}),customData:M(d,{value:this.multipleSelectionAllowed},"multipleSelectionAllowed")}})}else{return""}};o.getToolbar=function e(t){return M(p,{style:"Clear",children:{content:C(v,{children:[this.getRequired(),this.getTitle(),this.getUoMTitle(t),this.getToolBarSpacer(),this.getValueHelp(t)]})}})};o.createContent=function e(){const t=Ue([this.path]);const r="{= !${internal>"+t+"/showError}}";const i=document.body.classList.contains("sapUiSizeCozy");const n=i?"13rem":"100%";const a=i?"100%":"7.5rem";const o=this._contentId?Ue([this._contentId]):undefined;return M(y,{id:o,height:n,width:"20.5rem",class:"sapUiSmallMarginBeginEnd",children:{customData:M(d,{value:Ue([this.path])},"infoPath"),items:C(v,{children:[M(m,{height:"2rem",class:"sapUiTinyMarginTopBottom",children:this.getToolbar(r)}),M(m,{height:a,width:"100%",children:Ee(this)})]})}})};return i}(i),ie=$e(re.prototype,"__implements__sap_ui_core_IFormContent",[V],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),ne=$e(re.prototype,"showValueHelp",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=$e(re.prototype,"valueHelpIconSrc",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=$e(re.prototype,"valueHelpRequest",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),le=$e(re.prototype,"id",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),se=$e(re.prototype,"title",[z],{configurable:true,enumerable:true,writable:true,initializer:function(){return""}}),ue=$e(re.prototype,"contextPath",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=$e(re.prototype,"metaPath",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),he=$e(re.prototype,"outParameter",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=$e(re.prototype,"valuelistProperty",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=$e(re.prototype,"selectionVariantAnnotation",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=$e(re.prototype,"inParameters",[F],{configurable:true,enumerable:true,writable:true,initializer:null}),be=$e(re.prototype,"multipleSelectionAllowed",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),me=$e(re.prototype,"required",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),de=$e(re.prototype,"showOverlayInitially",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),ye=$e(re.prototype,"renderLineChart",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),Ae=$e(re.prototype,"requiredProperties",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),we=$e(re.prototype,"filterBarEntityType",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),Te=$e(re.prototype,"showError",[$],{configurable:true,enumerable:true,writable:true,initializer:null}),Me=$e(re.prototype,"chartMeasure",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),ve=$e(re.prototype,"UoMHasCustomAggregate",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),Ce=$e(re.prototype,"showValueHelpButton",[Y],{configurable:true,enumerable:true,writable:true,initializer:null}),Ie=$e(re.prototype,"customAggregate",[G],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Ve=$e(re.prototype,"groupId",[J],{configurable:true,enumerable:true,writable:true,initializer:function(){return"$auto.visualFilters"}}),Pe=$e(re.prototype,"errorMessageTitle",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),_e=$e(re.prototype,"errorMessage",[Q],{configurable:true,enumerable:true,writable:true,initializer:null}),Se=$e(re.prototype,"_contentId",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),He=$e(re.prototype,"draftSupported",[Z],{configurable:true,enumerable:true,writable:true,initializer:null}),ze=$e(re.prototype,"isValueListWithFixedValues",[ee],{configurable:true,enumerable:true,writable:true,initializer:null}),re))||te);De=We;return De},false);
//# sourceMappingURL=VisualFilter.js.map