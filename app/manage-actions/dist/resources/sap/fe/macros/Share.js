/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/controls/CommandExecution","sap/fe/core/helpers/BindingHelper","sap/m/Menu","sap/m/MenuItem","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/macros/share/ShareOptions","sap/m/OverflowToolbarMenuButton","sap/ui/base/BindingParser","./share/MsTeamsOptions","./share/ShareAPI","sap/fe/base/jsx-runtime/jsx"],function(e,t,n,a,i,s,r,o,l,c,u,h,p,m,f,b,d){"use strict";var M,g,A,_,S,O,C,I,T,E,y,w,v,B,R,L,k,N,V,x,P,D,z,H,j,J,U,F,G,$,W;function q(e){return new Promise((t,n)=>{sap.ui.require([e],n=>{if(!(n&&n.__esModule)){n=n===null||!(typeof n==="object"&&e.endsWith("/library"))?{default:n}:n;Object.defineProperty(n,"__esModule",{value:true})}t(n)},e=>{n(e)})})}var K={};var Q=s.UI;var X=n.property;var Y=n.defineUI5Class;var Z=n.defineReference;var ee=n.aggregation;var te=t.resolveBindingString;var ne=t.or;var ae=t.not;var ie=t.isConstant;var se=t.constant;var re=t.compileExpression;var oe=t.and;function le(e,t,n,a){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(a):void 0})}function ce(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ue(e,t)}function ue(e,t){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ue(e,t)}function he(e,t,n,a,i){var s={};return Object.keys(a).forEach(function(e){s[e]=a[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=n.slice().reverse().reduce(function(n,a){return a(e,t,n)||n},s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function pe(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const me={COLLABORATION_MSTEAMS_CARD:"COLLABORATION_MSTEAMS_CARD",COLLABORATION_MSTEAMS_TAB:"COLLABORATION_MSTEAMS_TAB",COLLABORATION_MSTEAMS_CHAT:"COLLABORATION_MSTEAMS_CHAT"};const fe={...me,...{SEND_EMAIL:"SEND_EMAIL",SHARE_JAM:"SHARE_JAM",SAVE_AS_TILE:"SAVE_AS_TILE",MS_TEAMS_GROUP:"MS_TEAMS_GROUP",SHARE_COLLABORATION_MANAGER:"SHARE_COLLABORATION_MANAGER"}};let be=(M=Y("sap.fe.macros.Share"),g=X({type:"string"}),A=ee({type:"sap.fe.macros.share.ShareOptions",defaultClass:h,isDefault:true}),_=ee({type:"sap.fe.macros.share.MsTeamsOptions",defaultClass:f}),S=Z(),O=Z(),C=Z(),I=Z(),T=Z(),E=Z(),y=Z(),w=Z(),v=Z(),B=Z(),R=Z(),M(L=(k=function(t){function n(e,n){var a;let i;if(typeof e!=="string"){n=e;i=n.id}else{i=e}n??={};n.shareAPIId=i;n.id=undefined;a=t.call(this,undefined,n)||this;le(a,"shareAPIId",N,a);le(a,"shareOptions",V,a);le(a,"msTeamsOptions",x,a);le(a,"menuButton",P,a);le(a,"cmdExecution",D,a);le(a,"menu",z,a);le(a,"saveAsTileMenuItem",H,a);le(a,"shareAsCollaborationManager",j,a);le(a,"shareViaJAMMenuItem",J,a);le(a,"sendEmailMenuItem",U,a);le(a,"shareAsCardMenuItem",F,a);le(a,"shareViaChatMenuItem",G,a);le(a,"shareAsTabMenuItem",$,a);le(a,"msTeamsGroupMenuItem",W,a);return a}K=n;ce(n,t);var s=n.prototype;s.onMetadataAvailable=function e(n){t.prototype.onMetadataAvailable.call(this,n);this.content=this.createContent(n.getAppComponent())};s._initializeMenuItems=async function e(t,n){let a=false;if(n.getEnvironmentCapabilities().getCapabilities().Collaboration){const{default:e}=await q("sap/suite/ui/commons/collaboration/CollaborationHelper");a=await e.isTeamsModeActive()}if(a){this.menuButton.current?.unbindProperty("visible",true);this.menuButton.current?.setVisible(false);return}const i=t.getController();const s=n.getShellServices();const r=await s.waitForPluginsLoad();if(!r){const e=this.menuButton.current?.getAggregation("_control");e?.attachEventOnce("press",{},()=>this._initializeMenuItems,this)}this._blockInternalConfig=this._getShareBlockConfig(t);await this._addMenuItems(i,s);this.setShareOptionsVisibility()};s._addMenuItems=async function e(t,n){this._addSendEmailOption(t);await this._addShellBasedMenuItems(t,n)};s._addSendEmailOption=function e(t){if(this.shareOptions?.showSendEmail??true){this?.menu?.current?.addItem(d(o,{ref:this.sendEmailMenuItem,text:this.getTranslatedText("T_SEMANTIC_CONTROL_SEND_EMAIL"),icon:"sap-icon://email",press:async()=>t.share._triggerEmail()}))}};s._addShellBasedMenuItems=async function e(t,n){const a=n.hasUShell();if(a){this._addShareViaJAMOption(t,n);await this._addMSTeamsOptions(t);await this._addCollaborationManagerOption(t);await this._addSaveAsTileOption(t)}};s._addCollaborationManagerOption=async function t(n){try{const e=n.getAppComponent().getCollaborativeToolsService();const t=await e.getCollaborationManagerOption();if(t&&(this.shareOptions?.showCollaborationManager??false)){const e=d(o,{ref:this.shareAsCollaborationManager,text:t.text,icon:t.icon,press:async e=>this._collaborationManagerButtonPress(t.press,e)});c.setSemanticStepname(e,"press",t.fesrStepName);this?.menu?.current?.addItem(e)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Adding Collaboration Manager Option : ${n}`)}};s._collaborationManagerButtonPress=async function e(t,n){const i=n.getSource();const s=a.getTargetView(i);const r=s.getController();await r.share._adaptShareMetadata();const o=s.getModel("shareInfo");if(o){const e=o.getData();const{collaborationInfo:n}=e;t(n.appTitle,n.url)}};s._addShareViaJAMOption=function e(t,n){const a=!!n.isJamActive?.();if(a){this?.menu?.current?.addItem(d(o,{ref:this.shareViaJAMMenuItem,text:this.getTranslatedText("T_COMMON_SAPFE_SHARE_JAM"),icon:"sap-icon://share-2",press:async()=>t.share._triggerShareToJam()}))}};s._addMSTeamsOptions=async function t(n){try{if(this._blockInternalConfig?.showMsTeamsOptions===false){return}const e=n.getAppComponent().getCollaborativeToolsService();const t=await e.getTeamsCollabOptionsViaShare({isShareAsCardEnabled:this._getIsShareAsCardEnabled()});if(!t){return}for(const e of t){const t=this._getMsTeamsMenuItemSettings(e);const n=t.items;const a=Array.isArray(n)&&n.length?fe.MS_TEAMS_GROUP:e.key;this._addMsTeamsMenuItem(t,a,e.fesrStepName)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Buildingblock : Share : adding MS teams options : ${n}`)}};s._addSaveAsTileOption=async function t(n){try{const{default:e}=await q("sap/ushell/ui/footerbar/AddBookmarkButton");const t=new e;if(t.getEnabled()){this?.menu?.current?.addItem(d(o,{ref:this.saveAsTileMenuItem,text:t.getText(),icon:t.getIcon(),press:async()=>n.share._saveAsTile(this.saveAsTileMenuItem.current),children:{dependents:[t]}}))}else{t.destroy()}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Buildingblock : Share : adding Save as tile option : ${n}`)}};s._getIsShareAsCardEnabled=function t(){const n=this.msTeamsOptions?.enableCard??false;if(typeof n==="boolean"){return n}else if(typeof n==="string"){try{return n==="true"||Boolean(m.complexParser(n))}catch(t){e.error(t)}}return true};s._getMsTeamsMenuItemSettings=function e(t){const n=this._getMsTeamsSubOptions(t?.subOptions);const a={text:t.text,icon:t.icon,items:n};if(n.length===0){a.press=async e=>this.collaborationMenuItemPress(e);a["customData"]=new l({key:"collaborationData",value:t})}return a};s._addMsTeamsMenuItem=function e(t,n,a){const i=d(o,{ref:this._getMenuItemReference(n),text:t.text,icon:t.icon,customData:t.customData,items:t.items});if(t.press){i.attachPress(t.press);if(a){c.setSemanticStepname(i,"press",a)}}this?.menu?.current?.addItem(i)};s._getMsTeamsSubOptions=function e(t){if(!Array.isArray(t)){return[]}return t.reduce((e,t)=>{const n=d(o,{ref:this._getMenuItemReference(t.key),text:t.text,icon:t.icon,press:async e=>this.collaborationMenuItemPress(e),customData:new l({key:"collaborationData",value:t})});if(t.fesrStepName){c.setSemanticStepname(n,"press",t.fesrStepName)}return[...e,n]},[])};s.collaborationMenuItemPress=async function t(n){const i=n.getSource();const s=a.getTargetView(i);const r=s.getController();await r.share._adaptShareMetadata();const o=s.getModel("shareInfo");if(o){const t=o.getData();const{collaborationInfo:n}=t;const a=i.data("collaborationData");const s=r.getAppComponent().getCollaborativeToolsService();const l=(await s.getCollaborationServices()).oTeamsHelperService;if(a["key"]===me.COLLABORATION_MSTEAMS_CARD){const t=l.isFeatureFlagEnabled();const a=t?await r.share.getCardDefinition():undefined;let i;if(a){const e=r.getAppComponent().getShellServices();const{semanticObject:t,action:n}=e.parseShellHash(document.location.hash);i=`${t}_${n}`}else{const n=!t?"Feature flag disabled in collaboration teams helper":"Card definition was not created";e.info(`FE V4 : Share block : share as Card : ${n}`)}n["cardManifest"]=a;n["cardId"]=i}l.share(a,n)}};s.setShareOptionsVisibility=function e(){const t=Object.keys(fe);const n=t.reduce((e,t)=>{const n=this._getShareOptionVisibilityExpression(t);this._setShareOptionVisibility(t,n);return[...e,n]},[]);const a=ne(...n);if(this.menuButton.current&&this.cmdExecution.current){this._bindUIVisibility(this.menuButton.current,a);this._bindUIVisibility(this.cmdExecution.current,a)}};s._getMenuItemReference=function e(t){let n;switch(t){case fe.COLLABORATION_MSTEAMS_CARD:n=this.shareAsCardMenuItem;break;case fe.COLLABORATION_MSTEAMS_CHAT:n=this.shareViaChatMenuItem;break;case fe.COLLABORATION_MSTEAMS_TAB:n=this.shareAsTabMenuItem;break;case fe.SEND_EMAIL:n=this.sendEmailMenuItem;break;case fe.SHARE_JAM:n=this.shareViaJAMMenuItem;break;case fe.SAVE_AS_TILE:n=this.saveAsTileMenuItem;break;case fe.MS_TEAMS_GROUP:n=this.msTeamsGroupMenuItem;break;case fe.SHARE_COLLABORATION_MANAGER:n=this.shareAsCollaborationManager;break;default:break}return n};s._getShareOptionVisibilityExpression=function e(t){const n=this._getMenuItemReference(t);if(!n?.current){return se(false)}let a;switch(t){case fe.COLLABORATION_MSTEAMS_CARD:case fe.COLLABORATION_MSTEAMS_CHAT:case fe.COLLABORATION_MSTEAMS_TAB:a=this._getMSTeamsShareOptionVisibility(t);break;case fe.SHARE_COLLABORATION_MANAGER:a=this._getCollaborationOptionExpression();break;case fe.SEND_EMAIL:{const e=te(this.shareOptions?.showSendEmail??true,"boolean");const t=te(this._blockInternalConfig.showSendEmail??true,"boolean");if(ie(t)&&t.value===false){a=se(false)}else if(ie(t)&&t.value===true){a=this.shareOptions?.showSendEmail??true}else{a=oe(e,t)}break}case fe.SHARE_JAM:case fe.SAVE_AS_TILE:{a=se(true);break}case fe.MS_TEAMS_GROUP:{const e=this._getShowMsTeamsOptionsExpression();const t=Object.keys(me);const n=t.reduce((e,t)=>{const n=this._getMSTeamsShareOptionVisibility(t);return[...e,n]},[]);a=oe(e,ne(...n));break}default:a=se(false)}return a};s._getCollaborationOptionExpression=function e(){const t=this.shareOptions?.showCollaborationManager??false;const n=te(t,"boolean");const a=this._blockInternalConfig.showCollaborationManager??true;const i=te(a,"boolean");return oe(n,i)};s._getShowMsTeamsOptionsExpression=function e(){const t=this._blockInternalConfig.showMsTeamsOptions??true;return te(t,"boolean")};s._getShareAsCardVisibility=function e(){let t;const n=this._getMenuItemReference(fe.COLLABORATION_MSTEAMS_CARD);if(n?.current){const e=this._getShowMsTeamsOptionsExpression();const n=this.msTeamsOptions?.enableCard??true;const a=te(n,"boolean");const i=this._blockInternalConfig.enableCard??true;const s=te(i,"boolean");const r=oe(a,s);t=oe(ae(Q.IsEditable),e,r)}else{t=se(false)}return t};s._getMSTeamsShareOptionVisibility=function e(t){if(t===fe.COLLABORATION_MSTEAMS_CARD){return this._getShareAsCardVisibility()}const n=this._getMenuItemReference(t);return n?.current?this._getShowMsTeamsOptionsExpression():se(false)};s._setShareOptionVisibility=function e(t,n){const a=this._getMenuItemReference(t);if(a?.current){this._bindUIVisibility(a.current,n)}};s._bindUIVisibility=function t(n,a){const i=re(a);if(i&&i.startsWith("{")&&i?.endsWith("}")){try{const e=m.complexParser(i);n.bindProperty("visible",e)}catch(t){e.error(t)}}else if(i==="false"){n.unbindProperty("visible",true);n.setVisible(false)}};s._getShareBlockConfig=function e(t){const n=t.getViewData();const a=n?.share;const i=t.getController();const s=i.getAppComponent().getManifestEntry("sap.fe")?.app?.share;const r=this._getOptionBlockConfig(s?.showSendEmail,a?.showSendEmail);const o=this._getOptionBlockConfig(s?.showCollaborationManager,a?.showCollaborationManager);const l=this._getOptionBlockConfig(s?.teams?.showMsTeamsOptions,a?.teams?.showMsTeamsOptions);const c=this._getOptionBlockConfig(s?.teams?.asCard,a?.teams?.asCard);return{showSendEmail:r,showMsTeamsOptions:l,enableCard:c,showCollaborationManager:o}};s._getOptionBlockConfig=function e(t,n){const a=typeof t==="string"?te(t):se(t??true);const i=typeof n==="string"?te(n):se(n??true);return re(oe(a,i))};s.createContent=function t(n){const a=d(b,{id:this.shareAPIId,children:d(p,{text:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE}",ref:this.menuButton,icon:"sap-icon://action",tooltip:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE} (Ctrl+Shift+S)",children:d(r,{ref:this.menu})})});this.getPageController().getView().addDependent(d(i,{ref:this.cmdExecution,command:"Share",execute:()=>{this.menuButton.current?.getMenu().openBy(this.menuButton.current,true)}}));this.isInitialized=this._initializeMenuItems(this.getPageController().getView(),n).catch(t=>{e.error(t)});return a};return n}(u),N=he(k.prototype,"shareAPIId",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),V=he(k.prototype,"shareOptions",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),x=he(k.prototype,"msTeamsOptions",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),P=he(k.prototype,"menuButton",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),D=he(k.prototype,"cmdExecution",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),z=he(k.prototype,"menu",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),H=he(k.prototype,"saveAsTileMenuItem",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),j=he(k.prototype,"shareAsCollaborationManager",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),J=he(k.prototype,"shareViaJAMMenuItem",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),U=he(k.prototype,"sendEmailMenuItem",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),F=he(k.prototype,"shareAsCardMenuItem",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),G=he(k.prototype,"shareViaChatMenuItem",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),$=he(k.prototype,"shareAsTabMenuItem",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),W=he(k.prototype,"msTeamsGroupMenuItem",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),k))||L);K=be;return K},false);
//# sourceMappingURL=Share.js.map