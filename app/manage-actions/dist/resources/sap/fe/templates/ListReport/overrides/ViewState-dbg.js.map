{"version":3,"names":["NavType","NavLibrary","VariantManagementType","CoreLibrary","VariantManagement","TemplateContentView","ViewStateOverride","_bSearchTriggered","applyInitialStateOnly","onBeforeStateApplied","aPromises","navigationType","oView","getView","oController","getController","oFilterBar","_getFilterBarControl","aTables","_getControls","setSuspendSelection","push","waitForInitialization","hybrid","_clearFilterConditions","forEach","oTable","initialized","adaptBindingRefreshControls","aControls","base","aViewControls","aControlsToRefresh","KeepAliveHelper","getControlsForRefresh","Array","prototype","apply","adaptStateControls","aStateControls","oFilterBarVM","_getFilterBarVM","_isMultiMode","_getMultiModeControl","_hasMultiVisualizations","_getSegmentedButton","Chart","Table","byId","retrieveAdditionalStates","mAdditionalStates","bPendingFilter","getBindingContext","getProperty","dataLoaded","sAlpContentView","alpContentView","applyAdditionalStates","oAdditionalStates","filterBarAPI","getParent","getLiveMode","triggerSearch","oInternalModelContext","Device","system","desktop","Hybrid","getModel","setProperty","getPath","view","variantManagement","viewData","getViewData","Page","Control","_getFilterBarVariantControl","None","_fnClearStateBeforexAppNav","StateUtil","retrieveExternalState","then","oExternalState","oCondition","filter","field","condition","catch","oError","Log","error","aItems","oClearConditions","applyExternalState","items"],"sourceRoot":".","sources":["ViewState.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport type ViewState from \"sap/fe/core/controllerextensions/ViewState\";\nimport KeepAliveHelper from \"sap/fe/core/helpers/KeepAliveHelper\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport CoreLibrary from \"sap/fe/core/library\";\nimport type { PropertyInfo } from \"sap/fe/macros/DelegateUtil\";\nimport type FilterBarAPI from \"sap/fe/macros/filterBar/FilterBarAPI\";\nimport NavLibrary from \"sap/fe/navigation/library\";\nimport type { default as ListReportController } from \"sap/fe/templates/ListReport/ListReportController.controller\";\nimport Device from \"sap/ui/Device\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type VariantManagement from \"sap/ui/fl/variants/VariantManagement\";\nimport type FilterBar from \"sap/ui/mdc/FilterBar\";\nimport type Table from \"sap/ui/mdc/Table\";\nimport StateUtil from \"sap/ui/mdc/p13n/StateUtil\";\n\ntype LRViewData = {\n\tcontrolConfiguration?: Record<string, Record<string, unknown>>;\n\tentitySet?: string;\n\tcontextPath?: string;\n\tvariantManagement?: boolean;\n};\n\nconst NavType = NavLibrary.NavType,\n\tVariantManagementType = CoreLibrary.VariantManagement,\n\tTemplateContentView = CoreLibrary.TemplateContentView;\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nconst ViewStateOverride = {\n\t_bSearchTriggered: false,\n\tapplyInitialStateOnly: function (): boolean {\n\t\treturn true;\n\t},\n\tonBeforeStateApplied: function (\n\t\tthis: ViewState & typeof ViewStateOverride,\n\t\taPromises: Promise<unknown>[],\n\t\tnavigationType?: string\n\t): void {\n\t\tconst oView = this.getView(),\n\t\t\toController = oView.getController() as ListReportController,\n\t\t\toFilterBar = oController._getFilterBarControl(),\n\t\t\taTables = oController._getControls(\"table\") as Table[];\n\t\tif (oFilterBar) {\n\t\t\toFilterBar.setSuspendSelection(true);\n\t\t\taPromises.push(oFilterBar.waitForInitialization());\n\t\t\t//This is required to remove any existing or default filter conditions before restoring the filter bar state in hybrid navigation mode.\n\t\t\tif (navigationType === NavType.hybrid) {\n\t\t\t\tthis._clearFilterConditions(oFilterBar);\n\t\t\t}\n\t\t}\n\t\taTables.forEach(function (oTable: Table): void {\n\t\t\taPromises.push((oTable as unknown as { initialized: () => Promise<unknown> }).initialized());\n\t\t});\n\n\t\tdelete this._bSearchTriggered;\n\t},\n\tadaptBindingRefreshControls: function (this: ViewState, aControls: Control[]): void {\n\t\tconst oView = this.base.getView(),\n\t\t\toController = oView.getController() as ListReportController,\n\t\t\taViewControls = oController._getControls(),\n\t\t\taControlsToRefresh = KeepAliveHelper.getControlsForRefresh(oView, aViewControls);\n\n\t\tArray.prototype.push.apply(aControls, aControlsToRefresh);\n\t},\n\tadaptStateControls: function (this: ViewState & typeof ViewStateOverride, aStateControls: UI5Element[]): void {\n\t\tconst oView = this.base.getView(),\n\t\t\toController = oView.getController() as ListReportController;\n\t\tconst oFilterBarVM = this._getFilterBarVM(oView);\n\t\tif (oFilterBarVM) {\n\t\t\taStateControls.push(oFilterBarVM);\n\t\t}\n\t\tif (oController._isMultiMode()) {\n\t\t\taStateControls.push(oController._getMultiModeControl());\n\t\t}\n\t\tif (oController._hasMultiVisualizations()) {\n\t\t\taStateControls.push(oController._getSegmentedButton(TemplateContentView.Chart)!);\n\t\t\taStateControls.push(oController._getSegmentedButton(TemplateContentView.Table)!);\n\t\t}\n\t\taStateControls.push(oView.byId(\"fe::ListReport\")!);\n\t},\n\tretrieveAdditionalStates: function (\n\t\tthis: ViewState & typeof ViewStateOverride,\n\t\tmAdditionalStates: { dataLoaded: boolean; alpContentView: string }\n\t): void {\n\t\tconst oView = this.getView(),\n\t\t\toController = oView.getController() as ListReportController,\n\t\t\tbPendingFilter = (oView.getBindingContext(\"internal\") as InternalModelContext).getProperty(\"hasPendingFilters\");\n\n\t\tmAdditionalStates.dataLoaded = !bPendingFilter || !!this._bSearchTriggered;\n\t\tif (oController._hasMultiVisualizations()) {\n\t\t\tconst sAlpContentView = oView.getBindingContext(\"internal\")!.getProperty(\"alpContentView\");\n\t\t\tmAdditionalStates.alpContentView = sAlpContentView;\n\t\t}\n\n\t\tdelete this._bSearchTriggered;\n\t},\n\tapplyAdditionalStates: function (\n\t\tthis: ViewState & typeof ViewStateOverride,\n\t\toAdditionalStates?: { dataLoaded: boolean; alpContentView?: string }\n\t): void {\n\t\tconst oView = this.getView(),\n\t\t\toController = oView.getController() as ListReportController,\n\t\t\toFilterBar = oController._getFilterBarControl();\n\n\t\tif (oAdditionalStates) {\n\t\t\tif (oFilterBar) {\n\t\t\t\tconst filterBarAPI = oFilterBar.getParent() as FilterBarAPI;\n\n\t\t\t\t// Trigger search if live mode is enabled or data is loaded\n\t\t\t\tif (oFilterBar.getLiveMode() || oAdditionalStates.dataLoaded === true) {\n\t\t\t\t\tfilterBarAPI.triggerSearch();\n\t\t\t\t\tthis._bSearchTriggered = true;\n\t\t\t\t}\n\t\t\t\t// Handle case when data is not yet loaded\n\t\t\t\telse if (oAdditionalStates.dataLoaded === false) {\n\t\t\t\t\t// Prevent data from being loaded on navigating back\n\t\t\t\t\t(oFilterBar as { _bSearchTriggered?: boolean })._bSearchTriggered = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (oController._hasMultiVisualizations()) {\n\t\t\t\tconst oInternalModelContext = oView.getBindingContext(\"internal\") as InternalModelContext;\n\t\t\t\tif (!Device.system.desktop && oAdditionalStates.alpContentView == TemplateContentView.Hybrid) {\n\t\t\t\t\toAdditionalStates.alpContentView = TemplateContentView.Chart;\n\t\t\t\t}\n\t\t\t\toInternalModelContext\n\t\t\t\t\t.getModel()\n\t\t\t\t\t.setProperty(`${oInternalModelContext.getPath()}/alpContentView`, oAdditionalStates.alpContentView);\n\t\t\t}\n\t\t}\n\t},\n\t/************************************* private helper *****************************************/\n\n\t/**\n\t * Variant management used by filter bar.\n\t * @param view View of the LR filter bar\n\t * @returns VariantManagement if used\n\t */\n\t_getFilterBarVM: (view: View): VariantManagement | undefined => {\n\t\tlet variantManagement;\n\t\tconst viewData = view.getViewData() as LRViewData;\n\t\tswitch (viewData.variantManagement) {\n\t\t\tcase VariantManagementType.Page:\n\t\t\t\tvariantManagement = view.byId(\"fe::PageVariantManagement\");\n\t\t\t\tbreak;\n\t\t\tcase VariantManagementType.Control:\n\t\t\t\tvariantManagement = (view.getController() as ListReportController)._getFilterBarVariantControl();\n\t\t\t\tbreak;\n\t\t\tcase VariantManagementType.None:\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t\treturn variantManagement as VariantManagement | undefined;\n\t},\n\n\t/*\n\t * Sets filtered: false flag to every field so that it can be cleared out\n\t *\n\t * @param oFilterBar filterbar control is used to display filter properties in a user-friendly manner to populate values for a query\n\t * @returns promise which will be resolved to object\n\t * @private\n\t */\n\t_fnClearStateBeforexAppNav: async function (oFilterBar: FilterBar): Promise<unknown> {\n\t\treturn StateUtil.retrieveExternalState(oFilterBar)\n\t\t\t.then((oExternalState: { filter: Record<string, Record<string, boolean>[]> }) => {\n\t\t\t\tconst oCondition = oExternalState.filter;\n\t\t\t\tfor (const field in oCondition) {\n\t\t\t\t\tif (field !== \"$editState\" && field !== \"$search\" && oCondition[field]) {\n\t\t\t\t\t\toCondition[field].forEach((condition: Record<string, boolean>) => {\n\t\t\t\t\t\t\tcondition[\"filtered\"] = false;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn oCondition;\n\t\t\t})\n\t\t\t.catch(function (oError: unknown): void {\n\t\t\t\tLog.error(\"Error while retrieving the external state\", oError as string);\n\t\t\t});\n\t},\n\n\t_clearFilterConditions: async function (oFilterBar: FilterBar): Promise<unknown> {\n\t\tconst aItems: PropertyInfo[] = [];\n\t\treturn oFilterBar.waitForInitialization().then(async () => {\n\t\t\tconst oClearConditions = await this._fnClearStateBeforexAppNav(oFilterBar);\n\t\t\treturn StateUtil.applyExternalState(oFilterBar, {\n\t\t\t\tfilter: oClearConditions,\n\t\t\t\titems: aItems\n\t\t\t});\n\t\t});\n\t}\n};\n\nexport default ViewStateOverride;\n"],"mappings":";;;;;;;EAyBA,MAAMA,OAAO,GAAGC,UAAU,CAACD,OAAO;IACjCE,qBAAqB,GAAGC,WAAW,CAACC,iBAAiB;IACrDC,mBAAmB,GAAGF,WAAW,CAACE,mBAAmB;;EAEtD;EACA;EACA,MAAMC,iBAAiB,GAAG;IACzBC,iBAAiB,EAAE,KAAK;IACxBC,qBAAqB,EAAE,SAAAA,CAAA,EAAqB;MAC3C,OAAO,IAAI;IACZ,CAAC;IACDC,oBAAoB,EAAE,SAAAA,CAErBC,SAA6B,EAC7BC,cAAuB,EAChB;MACP,MAAMC,KAAK,GAAG,IAAI,CAACC,OAAO,CAAC,CAAC;QAC3BC,WAAW,GAAGF,KAAK,CAACG,aAAa,CAAC,CAAyB;QAC3DC,UAAU,GAAGF,WAAW,CAACG,oBAAoB,CAAC,CAAC;QAC/CC,OAAO,GAAGJ,WAAW,CAACK,YAAY,CAAC,OAAO,CAAY;MACvD,IAAIH,UAAU,EAAE;QACfA,UAAU,CAACI,mBAAmB,CAAC,IAAI,CAAC;QACpCV,SAAS,CAACW,IAAI,CAACL,UAAU,CAACM,qBAAqB,CAAC,CAAC,CAAC;QAClD;QACA,IAAIX,cAAc,KAAKX,OAAO,CAACuB,MAAM,EAAE;UACtC,IAAI,CAACC,sBAAsB,CAACR,UAAU,CAAC;QACxC;MACD;MACAE,OAAO,CAACO,OAAO,CAAC,UAAUC,MAAa,EAAQ;QAC9ChB,SAAS,CAACW,IAAI,CAAEK,MAAM,CAAwDC,WAAW,CAAC,CAAC,CAAC;MAC7F,CAAC,CAAC;MAEF,OAAO,IAAI,CAACpB,iBAAiB;IAC9B,CAAC;IACDqB,2BAA2B,EAAE,SAAAA,CAA2BC,SAAoB,EAAQ;MACnF,MAAMjB,KAAK,GAAG,IAAI,CAACkB,IAAI,CAACjB,OAAO,CAAC,CAAC;QAChCC,WAAW,GAAGF,KAAK,CAACG,aAAa,CAAC,CAAyB;QAC3DgB,aAAa,GAAGjB,WAAW,CAACK,YAAY,CAAC,CAAC;QAC1Ca,kBAAkB,GAAGC,eAAe,CAACC,qBAAqB,CAACtB,KAAK,EAAEmB,aAAa,CAAC;MAEjFI,KAAK,CAACC,SAAS,CAACf,IAAI,CAACgB,KAAK,CAACR,SAAS,EAAEG,kBAAkB,CAAC;IAC1D,CAAC;IACDM,kBAAkB,EAAE,SAAAA,CAAsDC,cAA4B,EAAQ;MAC7G,MAAM3B,KAAK,GAAG,IAAI,CAACkB,IAAI,CAACjB,OAAO,CAAC,CAAC;QAChCC,WAAW,GAAGF,KAAK,CAACG,aAAa,CAAC,CAAyB;MAC5D,MAAMyB,YAAY,GAAG,IAAI,CAACC,eAAe,CAAC7B,KAAK,CAAC;MAChD,IAAI4B,YAAY,EAAE;QACjBD,cAAc,CAAClB,IAAI,CAACmB,YAAY,CAAC;MAClC;MACA,IAAI1B,WAAW,CAAC4B,YAAY,CAAC,CAAC,EAAE;QAC/BH,cAAc,CAAClB,IAAI,CAACP,WAAW,CAAC6B,oBAAoB,CAAC,CAAC,CAAC;MACxD;MACA,IAAI7B,WAAW,CAAC8B,uBAAuB,CAAC,CAAC,EAAE;QAC1CL,cAAc,CAAClB,IAAI,CAACP,WAAW,CAAC+B,mBAAmB,CAACxC,mBAAmB,CAACyC,KAAK,CAAE,CAAC;QAChFP,cAAc,CAAClB,IAAI,CAACP,WAAW,CAAC+B,mBAAmB,CAACxC,mBAAmB,CAAC0C,KAAK,CAAE,CAAC;MACjF;MACAR,cAAc,CAAClB,IAAI,CAACT,KAAK,CAACoC,IAAI,CAAC,gBAAgB,CAAE,CAAC;IACnD,CAAC;IACDC,wBAAwB,EAAE,SAAAA,CAEzBC,iBAAkE,EAC3D;MACP,MAAMtC,KAAK,GAAG,IAAI,CAACC,OAAO,CAAC,CAAC;QAC3BC,WAAW,GAAGF,KAAK,CAACG,aAAa,CAAC,CAAyB;QAC3DoC,cAAc,GAAIvC,KAAK,CAACwC,iBAAiB,CAAC,UAAU,CAAC,CAA0BC,WAAW,CAAC,mBAAmB,CAAC;MAEhHH,iBAAiB,CAACI,UAAU,GAAG,CAACH,cAAc,IAAI,CAAC,CAAC,IAAI,CAAC5C,iBAAiB;MAC1E,IAAIO,WAAW,CAAC8B,uBAAuB,CAAC,CAAC,EAAE;QAC1C,MAAMW,eAAe,GAAG3C,KAAK,CAACwC,iBAAiB,CAAC,UAAU,CAAC,CAAEC,WAAW,CAAC,gBAAgB,CAAC;QAC1FH,iBAAiB,CAACM,cAAc,GAAGD,eAAe;MACnD;MAEA,OAAO,IAAI,CAAChD,iBAAiB;IAC9B,CAAC;IACDkD,qBAAqB,EAAE,SAAAA,CAEtBC,iBAAoE,EAC7D;MACP,MAAM9C,KAAK,GAAG,IAAI,CAACC,OAAO,CAAC,CAAC;QAC3BC,WAAW,GAAGF,KAAK,CAACG,aAAa,CAAC,CAAyB;QAC3DC,UAAU,GAAGF,WAAW,CAACG,oBAAoB,CAAC,CAAC;MAEhD,IAAIyC,iBAAiB,EAAE;QACtB,IAAI1C,UAAU,EAAE;UACf,MAAM2C,YAAY,GAAG3C,UAAU,CAAC4C,SAAS,CAAC,CAAiB;;UAE3D;UACA,IAAI5C,UAAU,CAAC6C,WAAW,CAAC,CAAC,IAAIH,iBAAiB,CAACJ,UAAU,KAAK,IAAI,EAAE;YACtEK,YAAY,CAACG,aAAa,CAAC,CAAC;YAC5B,IAAI,CAACvD,iBAAiB,GAAG,IAAI;UAC9B;UACA;UAAA,KACK,IAAImD,iBAAiB,CAACJ,UAAU,KAAK,KAAK,EAAE;YAChD;YACCtC,UAAU,CAAqCT,iBAAiB,GAAG,KAAK;UAC1E;QACD;QAEA,IAAIO,WAAW,CAAC8B,uBAAuB,CAAC,CAAC,EAAE;UAC1C,MAAMmB,qBAAqB,GAAGnD,KAAK,CAACwC,iBAAiB,CAAC,UAAU,CAAyB;UACzF,IAAI,CAACY,MAAM,CAACC,MAAM,CAACC,OAAO,IAAIR,iBAAiB,CAACF,cAAc,IAAInD,mBAAmB,CAAC8D,MAAM,EAAE;YAC7FT,iBAAiB,CAACF,cAAc,GAAGnD,mBAAmB,CAACyC,KAAK;UAC7D;UACAiB,qBAAqB,CACnBK,QAAQ,CAAC,CAAC,CACVC,WAAW,CAAC,GAAGN,qBAAqB,CAACO,OAAO,CAAC,CAAC,iBAAiB,EAAEZ,iBAAiB,CAACF,cAAc,CAAC;QACrG;MACD;IACD,CAAC;IACD;;IAEA;AACD;AACA;AACA;AACA;IACCf,eAAe,EAAG8B,IAAU,IAAoC;MAC/D,IAAIC,iBAAiB;MACrB,MAAMC,QAAQ,GAAGF,IAAI,CAACG,WAAW,CAAC,CAAe;MACjD,QAAQD,QAAQ,CAACD,iBAAiB;QACjC,KAAKtE,qBAAqB,CAACyE,IAAI;UAC9BH,iBAAiB,GAAGD,IAAI,CAACvB,IAAI,CAAC,2BAA2B,CAAC;UAC1D;QACD,KAAK9C,qBAAqB,CAAC0E,OAAO;UACjCJ,iBAAiB,GAAID,IAAI,CAACxD,aAAa,CAAC,CAAC,CAA0B8D,2BAA2B,CAAC,CAAC;UAChG;QACD,KAAK3E,qBAAqB,CAAC4E,IAAI;QAC/B;UACC;MACF;MACA,OAAON,iBAAiB;IACzB,CAAC;IAED;AACD;AACA;AACA;AACA;AACA;AACA;IACCO,0BAA0B,EAAE,eAAAA,CAAgB/D,UAAqB,EAAoB;MACpF,OAAOgE,SAAS,CAACC,qBAAqB,CAACjE,UAAU,CAAC,CAChDkE,IAAI,CAAEC,cAAqE,IAAK;QAChF,MAAMC,UAAU,GAAGD,cAAc,CAACE,MAAM;QACxC,KAAK,MAAMC,KAAK,IAAIF,UAAU,EAAE;UAC/B,IAAIE,KAAK,KAAK,YAAY,IAAIA,KAAK,KAAK,SAAS,IAAIF,UAAU,CAACE,KAAK,CAAC,EAAE;YACvEF,UAAU,CAACE,KAAK,CAAC,CAAC7D,OAAO,CAAE8D,SAAkC,IAAK;cACjEA,SAAS,CAAC,UAAU,CAAC,GAAG,KAAK;YAC9B,CAAC,CAAC;UACH;QACD;QACA,OAAOH,UAAU;MAClB,CAAC,CAAC,CACDI,KAAK,CAAC,UAAUC,MAAe,EAAQ;QACvCC,GAAG,CAACC,KAAK,CAAC,2CAA2C,EAAEF,MAAgB,CAAC;MACzE,CAAC,CAAC;IACJ,CAAC;IAEDjE,sBAAsB,EAAE,eAAAA,CAAgBR,UAAqB,EAAoB;MAChF,MAAM4E,MAAsB,GAAG,EAAE;MACjC,OAAO5E,UAAU,CAACM,qBAAqB,CAAC,CAAC,CAAC4D,IAAI,CAAC,YAAY;QAC1D,MAAMW,gBAAgB,GAAG,MAAM,IAAI,CAACd,0BAA0B,CAAC/D,UAAU,CAAC;QAC1E,OAAOgE,SAAS,CAACc,kBAAkB,CAAC9E,UAAU,EAAE;UAC/CqE,MAAM,EAAEQ,gBAAgB;UACxBE,KAAK,EAAEH;QACR,CAAC,CAAC;MACH,CAAC,CAAC;IACH;EACD,CAAC;EAAC,OAEatF,iBAAiB;AAAA","ignoreList":[],"file":"ViewState-dbg.js"}