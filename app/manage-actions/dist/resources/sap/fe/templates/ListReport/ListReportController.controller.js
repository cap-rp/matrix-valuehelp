/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/PageController","sap/fe/core/controllerextensions/IntentBasedNavigation","sap/fe/core/controllerextensions/InternalIntentBasedNavigation","sap/fe/core/controllerextensions/InternalRouting","sap/fe/core/controllerextensions/KPIManagement","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/Share","sap/fe/core/controllerextensions/SideEffects","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/EditState","sap/fe/core/helpers/MessageStrip","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/fe/macros/chart/ChartUtils","sap/fe/macros/filter/FilterUtils","sap/fe/navigation/SelectionVariant","sap/fe/templates/ListReport/ExtensionAPI","sap/fe/templates/ListReport/overrides/SideEffects","sap/fe/templates/TableScroller","sap/ui/Device","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/mvc/OverrideExecution","sap/ui/mdc/p13n/StateUtil","sap/ui/thirdparty/hasher","./ListReportTemplating","./overrides/IntentBasedNavigation","./overrides/Share","./overrides/ViewState"],function(t,e,i,n,r,o,a,s,l,g,c,u,d,h,p,f,y,b,C,_,P,m,w,I,V,B,S,F,A,v,E,M,x,T){"use strict";var R,D,L,O,z,N,H,k,j,K,U,$,q,J,W,G,Q,X,Y,Z,tt,et,it,nt,rt,ot,at,st,lt;var gt=S.InvisibleMessageMode;var ct=f.getResourceModel;var ut=i.usingExtension;var dt=i.publicExtension;var ht=i.privateExtension;var pt=i.finalExtension;var ft=i.extensible;var yt=i.defineUI5Class;function bt(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function Ct(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_t(t,e)}function _t(t,e){return _t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_t(t,e)}function Pt(t,e,i,n,r){var o={};return Object.keys(n).forEach(function(t){o[t]=n[t]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(t,e,o),null):o}function mt(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const wt=b.TemplateContentView,It=b.InitialLoadMode;let Vt=(R=yt("sap.fe.templates.ListReport.ListReportController"),D=ut(s.override({onAfterBinding:function(){this.getView().getController()._onAfterBinding()}})),L=ut(a.override({getEntitySet:function(){return this.base.getCurrentEntitySet()}})),O=ut(u.override(w)),z=ut(o.override(M)),N=ut(c.override(x)),H=ut(d.override(T)),k=ut(l),j=ut(g),K=dt(),U=pt(),$=ht(),q=ft("After"),J=dt(),W=ft(F.After),G=dt(),Q=ft(F.After),X=dt(),Y=ft(F.After),R(Z=(tt=function(i){function o(){var e;for(var n=arguments.length,r=new Array(n),o=0;o<n;o++){r[o]=arguments[o]}e=i.call(this,...r)||this;bt(e,"_routing",et,e);bt(e,"_intentBasedNavigation",it,e);bt(e,"_sideEffects",nt,e);bt(e,"intentBasedNavigation",rt,e);bt(e,"share",ot,e);bt(e,"viewState",at,e);bt(e,"kpiManagement",st,e);bt(e,"placeholder",lt,e);e.formatters={setALPControlMessageStrip(t,e,i){let n="";e=e==="true"||e===true;const r=this._getFilterBarControl();if(r&&Array.isArray(t)&&t.length>0&&e){const o=p.getLabels(t,r.data("entityType"),r,ct(r));const a=!i?.enableSearch;n=e?p.getALPText(o,r,a):p.getText(o,r,"");return n}}};e.handlers={onInlineEditSave(){this.inlineEditFlow.inlineEditSave()},onFilterSearch(){const t=this._getFilterBarControl().getParent();t.triggerSearch()},onFiltersChanged(t){const e=this._getFilterBarControl();if(e){const i=this.getView().getBindingContext("internal");this.onPendingFilters();if(i&&t.getParameter("conditionsBased")){i.setProperty("hasPendingFilters",true)}if(i){this._storeFilterBarSelectionVariant(e,i)}}},onVariantSelected(t){const e=t.getSource();const i=t.getParameter("key");const n=this._getMultiModeControl();if(n&&!e?.getParent()?.isA("sap.ui.mdc.ActionToolbar")){n?.invalidateContent();n?.setFreezeContent(true)}setTimeout(()=>{const t=this._getFilterBarControl();const r=this._getDynamicListReportControl();const o=t?.getFilterItems().find(function(t){return t.getRequired()&&t.getConditions().length===0});if(o){r.setHeaderExpanded(true)}if(this._shouldAutoTriggerSearch(e)){const t=this._getFilterBarControl().getParent();t.triggerSearch()}else if(!this._getApplyAutomaticallyOnVariant(e,i)){n?.setFreezeContent(false);this.getExtensionAPI().updateAppState();r.setHeaderExpanded(true)}},0)},onVariantSaved(){setTimeout(()=>{this.getExtensionAPI().updateAppState()},1e3)},onSearch(){const e=this._getFilterBarControl();const i=this.getView().getBindingContext("internal");const n=this.getChartControl();const r=_.getEditStateIsHideDraft(e.getConditions());i.setProperty("hasPendingFilters",false);i.setProperty("hideDraftInfo",r);const o=this._getDynamicListReportControl();if(!this._getMultiModeControl()){this._updateALPNotApplicableFields(i,e)}if(n){n.getBindingContext("internal").setProperty("",{});const t=n.getBindingContext("pageInternal");const e=t.getProperty(`${t.getPath()}/alpContentView`);if(e===wt.Chart){this.hasPendingChartChanges=true}if(e===wt.Table){this.hasPendingTableChanges=true}}if(!V.system.desktop&&i.getProperty("searchTriggeredByInitialLoad")===true){if(o.getHeaderExpanded()!==false){o.setHeaderExpanded(false)}i.setProperty("searchTriggeredByInitialLoad",false)}A.retrieveExternalState(e).then(t=>{this.filterBarConditions=t.filter;return}).catch(function(e){t.error("Error while retrieving the external state",e)});if(this.getView().getViewData().liveMode===false){this.getExtensionAPI().updateAppState()}if(V.system.phone){const t=this._getDynamicListReportControl();if(!this._isInitLoadEnabled()){t.setHeaderExpanded(true)}else{t.setHeaderExpanded(false);this.setFilterToggleVisibility(false)}}},async onChevronPressNavigateOutBound(t,e,i,n){return t._intentBasedNavigation.onChevronPressNavigateOutBound(t,e,i,n)},onChartSelectionChanged(t){const e=t.getSource().getContent(),i=this._getTable(),n=t.getParameter("data"),r=this.getView().getBindingContext("internal");if(n){C.setChartFilters(e)}const o=r.getProperty(`${r.getPath()}/alpContentView`);if(o===wt.Chart){this.hasPendingChartChanges=true}else if(i){i.rebind();this.hasPendingChartChanges=false}},onSegmentedButtonPressed(t){const e=t.getParameters().selectedKey||t.getParameters().key;const i=this.getView().getBindingContext("internal");i.setProperty("alpContentView",e);const n=this.getChartControl();const r=this._getTable();switch(e){case wt.Table:if(r){this._updateTable(r)}break;case wt.Chart:if(n){this._updateChart(n)}break;case wt.Hybrid:if(r){this._updateTable(r)}if(n){this._updateChart(n)}break;default:break}this.getExtensionAPI().updateAppState()},onDynamicPageTitleStateChanged(t){const e=this._getFilterBarControl();if(e){this.setFilterToggleVisibility(!!t.getParameter("isExpanded"));if(t.getParameter("isExpanded")===false){B.getInstance().announce(e.getAssignedFiltersText().filtersText,gt.Assertive)}}}};return e}Ct(o,i);var a=o.prototype;a.getExtensionAPI=function t(){if(!this.extensionAPI){this.extensionAPI=new m(this)}return this.extensionAPI};a.onInit=function t(){r.prototype.onInit.apply(this);const e=this.getView().getBindingContext("internal");const i=this._getFilterBarControl();if(i){this._storeFilterBarSelectionVariant(i,e)}e.setProperty("hasPendingFilters",true);e.setProperty("hideDraftInfo",false);e.setProperty("uom",{});e.setProperty("scalefactor",{});e.setProperty("scalefactorNumber",{});e.setProperty("currency",{});e.setProperty("isInsightsSupported",false);if(this._hasMultiVisualizations()){let t=this._getDefaultPath();if(!V.system.desktop&&t===wt.Hybrid){t=wt.Chart}e.setProperty("alpContentView",t)}this.filterBarConditions={};this.getAppComponent().getRouterProxy().waitForRouteMatchBeforeNavigation();this._setInitLoad();const n=this.getView();const o=n.getModel("ui");const a=`/${n.getId()}`;o.setProperty(a,{isEditable:false});n.bindElement({path:a,model:"ui"})};a.onExit=function t(){delete this.filterBarConditions;if(this.extensionAPI){this.extensionAPI.destroy()}delete this.extensionAPI};a._onAfterBinding=function e(){const i=this._getControls("table");let r=true;if(h.isEditStateDirty()){this._getMultiModeControl()?.invalidateContent();const e=this._getTable();const o=e?.getRowBinding();if(o){r=false;const a=e?.getParent();n.getAppComponent(this.getView()).getRoutingService().waitForBindingCleanup().then(()=>{o.attachEventOnce("dataReceived",()=>{this._updateTableActions(i)});if(a.getTableDefinition().control.type==="TreeTable"){this.getModel().resetChanges()}a.refresh();return}).catch(e=>{t.warning("Error while waiting refreshing ListReport table",e)})}h.setEditStateProcessed()}if(r){this._updateTableActions(i)}const o=this.getView().getBindingContext("internal");if(!o.getProperty("initialVariantApplied")){const t=this.getView().getId();this.pageReady.waitFor(this._applyAppState(t));o.setProperty("initialVariantApplied",true)}const a=n.getAppComponent(this.getView()).getEnvironmentCapabilities();a.isInsightsEnabled().then(t=>{o.setProperty("isInsightsSupported",t);return}).catch(e=>{t.error("Error while checking if insights are enabled",e)})};a.onPageReady=async function t(e){if(e.forceFocus){this._setInitialFocus()}await this.getAppComponent().getShellServices().setBackNavigation(undefined)};a.onViewNeedsRefresh=function t(e){};a.onPendingFilters=function t(){};a.getCurrentEntitySet=function t(){return this._getTable()?.data("targetCollectionPath").slice(1)};a.onAfterClear=function t(){};a._updateTableActions=function t(e){let i=[];e.forEach(function(t){i=n.getIBNActions(t,i)});n.updateDataFieldForIBNButtonsVisibility(i,this.getView());n.updateMenuButtonVisiblity(i)};a._scrollTablesToRow=function t(e){this._getControls("table").forEach(function(t){I.scrollTableToRow(t,e)})};a._focusSilent=function t(e){const i=e.getFocusInfo();i.targetInfo={silent:true};e.focus(i)};a._setInitialFocus=function e(){const i=this._getDynamicListReportControl(),n=i.getHeaderExpanded(),r=this._getFilterBarControl();if(r&&!this._isFilterBarHiddenUsed()){if(!r.getShowMessages()){r.setShowMessages(true)}if(n){const t=r.getFilterItems().find(function(t){return t.getRequired()&&t.getConditions().length===0});if(t){if(t.isA("sap.ui.mdc.FilterField")){this._focusSilent(t)}else{t.focus()}}else if(this._isInitLoadEnabled()&&r.getFilterItems().length>0){const t=r.getFilterItems()[0];if(t.isA("sap.ui.mdc.FilterField")){this._focusSilent(t)}else{t.focus()}}else{this.getView().byId(`${this._getFilterBarControlId()}-btnSearch`)?.focus()}}else if(this._isInitLoadEnabled()){this._getTable()?.focusRow(0).catch(function(e){t.error("Error while setting initial focus on the table ",e)})}}else{this._getTable()?.focusRow(0).catch(function(e){t.error("Error while setting initial focus on the table ",e)})}};a._getPageTitleInformation=function t(){const e=this.getAppComponent().getManifestEntry("sap.app");return{title:e.title,subtitle:e.subTitle||"",intent:"",icon:""}};a._getFilterBarControl=function t(){return this.getView().byId(this._getFilterBarControlId())};a._getDynamicListReportControl=function t(){return this.getView().byId(this._getDynamicListReportControlId())};a._getAdaptationFilterBarControl=function t(){const e=this._getFilterBarControl().getInbuiltFilter?.();return e?.getParent()?e:undefined};a._applyAppState=async function t(e){await this.getAppComponent().getAppStateHandler().applyAppState(e,this.getView());const i=this._getFilterBarControl();if(i){i.setSuspendSelection(false)}else if(this._isFilterBarHidden()){const t=this.getView().getBindingContext("internal");t.setProperty("hasPendingFilters",false);if(this._isMultiMode()){this._getMultiModeControl().setCountsOutDated(true)}}};a._getSegmentedButton=function t(e){const i=(e==="Chart"?this.getChartControl():this._getTable())?.data("segmentedButtonId");return this.getView().byId(i)};a._getControlFromPageModelProperty=function t(e){const i=this._getPageModel()?.getProperty(e);return i?this.getView().byId(i):undefined};a._getDynamicListReportControlId=function t(){return this._getPageModel()?.getProperty("/dynamicListReportId")||""};a._getFilterBarControlId=function t(){return this._getPageModel()?.getProperty("/filterBarId")||""};a.getChartControl=function t(){return this._getControlFromPageModelProperty("/singleChartId")};a._getVisualFilterBarControl=function t(){const e=y.generate(["visualFilter",this._getFilterBarControlId()]);return e?this.getView().byId(e):undefined};a._getFilterBarVariantControl=function t(){return this._getControlFromPageModelProperty("/variantManagement/id")};a._getMultiModeControl=function t(){return this.getView().byId("fe::TabMultipleMode::Control")};a._getIconTabBar=function t(){return this.getView().byId("fe::TabMultipleMode")};a._getTable=function t(){if(this._isMultiMode()){const t=this._getMultiModeControl()?.getSelectedInnerControl()?.content;return t?.isA("sap.ui.mdc.Table")?t:undefined}else{return this._getControlFromPageModelProperty("/singleTableId")}};a._getControls=function t(e){if(this._isMultiMode()){const t=[];const i=this._getMultiModeControl().content;i.getItems().forEach(i=>{const n=this.getView().byId(i.getKey());if(n&&e){if(i.getKey().includes(`fe::${e}`)){t.push(n)}}else if(n!==undefined&&n!==null){t.push(n)}});return t}else if(e==="Chart"){const t=this.getChartControl();return t?[t]:[]}else{const t=this._getTable();return t?[t]:[]}};a._getDefaultPath=function t(){const e=E.getDefaultPath(this._getPageModel()?.getProperty("/views")||[]);switch(e){case"primary":return wt.Chart;case"secondary":return wt.Table;case"both":default:return wt.Hybrid}};a._isMultiMode=function t(){return!!this._getPageModel()?.getProperty("/multiViewsControl")};a._isInitLoadEnabled=function t(){const e=this.getView().getViewData().initialLoad;return e===It.Enabled};a._hasMultiVisualizations=function t(){return this._getPageModel()?.getProperty("/hasMultiVisualizations")};a._disableInitLoad=function t(){const e=this._getFilterBarControl();if(e){e.setSuspendSelection(true)}};a._applyAutomaticallyOnStandardVariant=function t(){return false};a._setInitLoad=function t(){if(!this._isInitLoadEnabled()){this._disableInitLoad()}const e=E.getVariantBackReference(this.getView().getViewData(),this._getPageModel()?.getData());const i=e&&this.getView().byId(e);if(i){i?.registerApplyAutomaticallyOnStandardVariant?.(this._applyAutomaticallyOnStandardVariant.bind(this))}};a._setShareModel=function t(){const i=e.get("sap.ushell.Container.getUser");const n={bookmarkTitle:document.title,bookmarkCustomUrl:function(){const t=v.getHash();return t?`#${t}`:window.location.href},isShareInJamActive:!!i&&i().isJamActive()};const r=this.getOwnerComponent().getModel("_templPriv");r.setProperty("/listReport/share",n)};a._updateALPNotApplicableFields=function t(e,i){const n={};const r={},o=this._getControls("table"),a=this._getControls("Chart");if(!o.length||!a.length){return}a.forEach(function(t){const e=t.data("targetCollectionPath"),o=e.slice(1),a=`${o}Chart`;if(!n[a]){n[a]=_.getNotApplicableFilters(i,t)}r[a]=n[a]});e.setProperty("controls/ignoredFields",r)};a._isFilterBarHidden=function t(){return this.getView().getViewData().hideFilterBar||false};a._isFilterBarHiddenUsed=function t(){return this.getView().getViewData().useHiddenFilterBar||false};a._getApplyAutomaticallyOnVariant=function t(e,i){if(!e||!i){return false}const n=e.getVariants();const r=n.find(function(t){return t&&t.getKey()===i});return r&&r.getProperty("executeOnSelect")||false};a._shouldAutoTriggerSearch=function t(e){if(this.getView().getViewData().initialLoad===It.Auto&&(!e||e.getStandardVariantKey()===e.getCurrentVariantKey())){const t=this._getFilterBarControl();if(t){const i=t.getConditions();for(const t in i){if(e&&!t.startsWith("$")&&Array.isArray(i[t])&&i[t].length){const t=e.getVariants().find(t=>t.getKey()===e.getCurrentVariantKey());return t&&t.getExecuteOnSelect()}}}}return false};a._updateTable=function t(e){if(!e.isTableBound()||this.hasPendingChartChanges){e.rebind();this.hasPendingChartChanges=false}};a._updateChart=function t(e){const i=e.getControlDelegate()._getChart(e);if(!(i&&i.isBound("data"))||this.hasPendingTableChanges){e.getControlDelegate().rebind(e,i.getBindingInfo("data"));this.hasPendingTableChanges=false}};a.setFilterToggleVisibility=function t(e){const i=this._getFilterBarControl();i?.getSegmentedButton()?.setVisible(e)};a._storeFilterBarSelectionVariant=async function e(i,n){try{const t=i.getParent();const e=await t.getSelectionVariant();n.setProperty("filterBarSelectionVariant",e)}catch(e){const i=e instanceof Error?e.message:String(e);t.error(`FE : Error fetching selection variant on filter change: ${i}`)}};a.getFilterBarSelectionVariant=function t(){const e=this.getView().getBindingContext("internal");return e?.getProperty("filterBarSelectionVariant")||new P};return o}(r),et=Pt(tt.prototype,"_routing",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),it=Pt(tt.prototype,"_intentBasedNavigation",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),nt=Pt(tt.prototype,"_sideEffects",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),rt=Pt(tt.prototype,"intentBasedNavigation",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),ot=Pt(tt.prototype,"share",[N],{configurable:true,enumerable:true,writable:true,initializer:null}),at=Pt(tt.prototype,"viewState",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),st=Pt(tt.prototype,"kpiManagement",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),lt=Pt(tt.prototype,"placeholder",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),Pt(tt.prototype,"getExtensionAPI",[K,U],Object.getOwnPropertyDescriptor(tt.prototype,"getExtensionAPI"),tt.prototype),Pt(tt.prototype,"onPageReady",[$,q],Object.getOwnPropertyDescriptor(tt.prototype,"onPageReady"),tt.prototype),Pt(tt.prototype,"onViewNeedsRefresh",[J,W],Object.getOwnPropertyDescriptor(tt.prototype,"onViewNeedsRefresh"),tt.prototype),Pt(tt.prototype,"onPendingFilters",[G,Q],Object.getOwnPropertyDescriptor(tt.prototype,"onPendingFilters"),tt.prototype),Pt(tt.prototype,"onAfterClear",[X,Y],Object.getOwnPropertyDescriptor(tt.prototype,"onAfterClear"),tt.prototype),tt))||Z);return Vt},false);
//# sourceMappingURL=ListReportController.controller.js.map