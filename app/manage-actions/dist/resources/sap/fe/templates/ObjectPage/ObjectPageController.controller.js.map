{"version":3,"file":"ObjectPageController.controller.js","names":["ProgrammingModel","FELibrary","ObjectPageController","_dec","defineUI5Class","_dec2","usingExtension","Placeholder","_dec3","Share","override","ShareOverrides","_dec4","InternalRouting","InternalRoutingOverride","_dec5","Paginator","PaginatorOverride","_dec6","MessageHandler","MessageHandlerOverride","_dec7","IntentBasedNavigation","IntentBasedNavigationOverride","_dec8","CollaborationManager","CollaborationManagerOverride","_dec9","InternalIntentBasedNavigation","getNavigationMode","bIsStickyEditMode","this","getView","getController","getStickyEditMode","undefined","_dec10","ViewState","ViewStateOverrides","_dec11","PageReady","isContextExpected","_dec12","publicExtension","_dec13","finalExtension","_dec14","_dec15","extensible","OverrideExecution","After","_class","_class2","_PageController","_this","_len","arguments","length","args","Array","_key","call","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","_descriptor5","_descriptor6","_descriptor7","_descriptor8","_descriptor9","_descriptor10","clearTitleHierarchyCacheSetUp","mergePatchDraft","handlers","onPrimaryAction","oController","oView","oContext","sActionName","mParameters","mConditions","iViewLevel","getViewData","viewLevel","positiveActionVisible","positiveActionEnabled","onCallAction","editActionVisible","editActionEnabled","_editDocument","CommonUtils","getIsEditable","_saveDocument","_applyDocument","onTableContextChange","event","tableAPI","getSource","table","content","currentActionPromise","editFlow","getCurrentActionPromise","tableContexts","_getTableBinding","getCurrentContexts","actionResponse","controlId","getId","actionData","oData","keys","newItem","findIndex","tableContext","tableData","getObject","every","key","dialog","InstanceManager","getOpenDialogs","find","data","attachEventOnce","focusRow","deleteCurrentActionPromise","e","Log","error","messageButton","fireModelContextChange","syncTask","invokeAction","feFrameworkCall","then","_showMessagePopover","bind","catch","onDataPointTitlePressed","oSource","oManifestOutbound","sControlConfig","sCollectionPath","JSON","parse","oTargetInfo","oDataPointOrChartBindingContext","getBindingContext","sMetaPath","getModel","getMetaModel","getMetaPath","getPath","aSemanticObjectMapping","getSemanticObjectMapping","aNavigationData","_getChartContextData","additionalNavigationParameters","map","oNavigationData","metaPath","parameters","oParams","_intentBasedNavigation","getOutboundParams","Object","customData","getCustomData","getKey","_getImplicitSemanticObjectMappingForDataPoints","getValue","semanticObject","action","navigate","navigationContexts","semanticObjectMapping","onChevronPressNavigateOutBound","sOutboundTarget","sCreatePath","onNavigateChange","oEvent","getExtensionAPI","updateAppState","bSectionNavigated","oInternalModelContext","sectionLayout","getProperty","oSubSection","getParameter","_updateFocusInEditMode","onVariantSelected","onVariantSaved","setTimeout","navigateToSubSection","vDetailConfig","oDetailConfig","oObjectPage","byId","oSection","sectionId","subSectionId","getSubSections","getParent","getVisible","sTitle","getResourceModel","getText","entitySet","MessageBox","setSelectedSection","fireNavigate","section","subSection","closeOPMessageStrip","view","bIsInEditMode","internalModel","messagestripInternalModelContext","bindContext","_getMessageStripBindingContextPath","getBoundContext","contextBoundMessages","Messaging","getMessageModel","getData","filter","message","getTargets","getPersistent","removeMessages","setProperty","hideMessage","_inheritsLoose","_proto","prototype","sId","mCustomSectionExtensionAPIs","ExtensionAPI","extensionAPI","onInit","_getObjectPageLayoutControl","page","visibility","items","_getBatchGroupsForView","getEnableLazyLoading","attachEvent","_handleSubSectionEnteredViewPort","messageBinding","bindList","attachChange","_fnShowOPMessage","onExit","destroy","oMessagePopover","isOpen","close","isKeepAlive","setKeepAlive","collaborativeDraft","isConnected","disconnect","detachChange","messages","_showMessages","oTable","getRowBinding","checkSectionsForNonResponsiveTable","subSections","changeClassForTables","lastVisibleSubSection","blocks","getBlocks","getMoreBlocks","searchTableInBlock","tableType","isA","getType","getTableDefinition","control","rowCountMode","addStyleClass","detachEvent","subSectionIndex","block","onBeforeRendering","PageController","apply","retrieveTextFromValueList","CommonHelper","setMetaModel","getAppComponent","onAfterRendering","getUseIconTabBar","sections","getSections","_getAllSubSections","_onBeforeBinding","aTables","_findTables","oInternalModel","aBatchGroups","oFastCreationRow","push","reason","NavigationReason","EditFlowAction","_closeSideContent","opContext","hasPendingChanges","some","getBinding","resetChanges","item","getCreationRow","setBindingContext","fnScrollToPresentSection","isFirstRendering","bPersistOPScroll","_initializePagination","listBinding","_disableBlocksBindings","placeholder","isPlaceholderEnabled","showPlaceholder","oNavContainer","oContainer","enableAnimation","getFirstEditableInput","domEditableElement","_getFirstEditableInput","UI5Element","closestTo","_getFirstClickableElement","oFirstClickableElement","aActions","getHeaderTitle","getActions","oAction","getEnabled","objectPage","aSections","bUseIconTabBar","iSkip","bEditableHeader","editableHeaderContent","iSection","aSubSections","iSubSection","isVisibilityDynamic","forEach","subBlock","actions","_getFirstEmptyMandatoryFieldFromSubSection","aBlocks","blockControl","aFormContainers","getFormContainers","getContent","formContainer","aFormElements","getFormElements","formElement","aFields","getFields","getRequired","debug","oMandatoryField","oFieldToFocus","getContentEdit","focusInfo","getFocusInfo","targetInfo","silent","focus","_onBackNavigationInDraft","messageHandler","removeTransitionMessages","navBack","currentURL","document","URL","history","back","_routing","navigateBackFromContext","getRouterProxy","checkIfBackHasSameContext","getShellServices","setBackNavigation","warning","draft","processDataLossOrDraftDiscardConfirmation","Function","NavigationType","BackNavigation","_onAfterBinding","inputBindingContext","_sideEffects","clearFieldGroupsValidity","bindingContext","aIBNActions","getIBNActions","oTableRowBinding","ModelHelper","isStickySessionSupported","removeCachesAndMessages","oActionOperationAvailableMap","tableDefinition","operationAvailableMap","ActionRuntime","setActionEnablement","clearSelection","oObjectPageTitle","aIBNHeaderActions","concat","updateDataFieldForIBNButtonsVisibility","oModel","oFinalUIState","Promise","resolve","handleTableModifications","oBinding","fnHandleTablePatchEvents","TableHelper","enableFastCreationRow","getContext","fnHandleChange","computeModelsForEditMode","isCollaborationDraftSupported","connect","oError","_updateRelatedApps","currentBinding","handlePatchSent","TableUtils","whenBound","_triggerVisibleSubSectionsEvents","updateEditButtonVisibilityAndEnablement","recommendations","clearRecommendations","_updateAvailableCards","displayCollaborationMessage","redirectedToNonDraft","_setOPMessageStripInternalContext","applyAppState","getAppStateHandler","pageReady","waitFor","async","cards","collaborationManager","collectAvailableCards","cardObject","updateCards","parentAppId","getCollaborationManagerService","addCardsToCollaborationManager","shareAvailableCards","internalModelContext","findElements","elem","messageStrip","entityName","resourceBundle","Library","getResourceBundleFor","collaborationMessage","Message","type","MessageType","Information","target","addMessages","onPageReady","setFocus","isInDisplayMode","oSelectedSection","getElementById","getSelectedSection","ctxt","oBindingContext","bIsStickyMode","oAppComponent","isEditable","fetchAndApplyRecommendations","context","forceFocus","_checkDataPointTitleForExternalNavigation","Device","support","touch","saveButton","autoQueueUnlock","autoQueueLock","isLocked","unlock","detachBrowserEvent","attachBrowserEvent","lock","_getPageTitleInformation","oObjectPageSubtitle","oCustomData","objectPageDescription","appComponent","rootViewController","getRootViewController","fnClearCacheTitle","clearTitleHierarchyCache","title","subtitle","intent","icon","description","_executeHeaderShortcut","sButtonId","oButton","oElement","fireButtonPress","_executeFooterShortcut","getFooter","getMetadata","getName","_executeTabShortCut","oExecution","iSectionIndexMax","sCommand","getCommand","newSection","iSelectedSectionIndex","indexOfSection","_getFooterVisibility","sViewId","isHiddenDraftEnabled","getEnvironmentCapabilities","getCapabilities","HiddenDraft","enabled","oMessage","isErrorMessage","validation","messageValidation","includes","err","oRet","isEditMode","currentPageView","isFclEnabled","getRightmostView","getRootContainer","getCurrentPage","oMessageButton","oItemBinding","getLength","setVisible","openBy","BusyLocker","editDocument","finally","propertyPath","LocalProperty","$PropertyPath","SemanticObjectProperty","_validateDocument","getActiveElement","byPassSideEffects","isTransient","created","holdMessagesForControl","ret","executeGlobalValidation","showMessages","sideEffectsService","getSideEffectsService","entityType","getEntityTypeFromContext","globalSideEffects","getGlobalODataEntitySideEffects","all","requestSideEffects","sideEffects","draftRootContext","createRootContext","Draft","executeDraftValidation","skipBindingToView","model","awaitCreateDocuments","executeSideEffectsOnError","isCollaborationEnabled","dialogAction","CollaborationDiscard","getUserAction","creationRow","tableBinding","contextKeys","startsWith","createDocument","creationMode","createAtEnd","skipSideEffects","bindings","saveDocument","bExecuteSideEffectsOnError","RecommendationDialogDecision","Continue","_cancelDocument","cancelButton","lastFocusedControlId","shouldSkipDiscardPopover","isDocumentModified","UiModelConstants","DocumentModified","afterCancel","promiseResult","cancelDocument","skipDiscardPopover","applyDocument","showRelatedApps","updateRelatedAppsDetails","_findControlInSubSection","aParentElement","aSubsection","aControls","bIsChart","item1","getAggregation","chartControl","getChartControl","oSubElement","getMainContent","_getAllBlocks","_findCharts","aCharts","oBlock","oContent","setShowSideContent","oChartContext","sChartPath","oContextData","oChartContextData","_scrollTablesToRow","sRowPath","TableScroller","scrollTableToRow","_mergeMultipleContexts","oPageContext","aLineContext","aAttributes","aPageAttributes","sMetaPathLine","sPathLine","sPagePath","oMetaModel","sMetaPathPage","replace","oSingleContext","oSubChartContextData","contextData","removeSensitiveData","oPageLevelSV","addPageContextToSelectionVariant","SelectionVariant","selectionVariant","attributes","oViewData","oConfigurations","controlConfiguration","aConfigurations","sKey","oConfiguration","requestGroupId","paginatorCurrentContext","bindingToUse","paginator","initialize","setBreadcrumbLinks","source","promises","newPath","pathParts","split","metaModel","path","shift","splice","pathPart","getRouter","getRouteInfoByHash","parameterPath","resultContext","getTitleInfoFromPath","titleHierarchyInfos","hierarchyPosition","link","titleHierarchyInfo","indexOf","getLinks","Link","setText","setHref","encodeURI","addLink","oDataPoints","getHeaderFacetItemConfigForExternalNavigation","getRoutingService","getOutbounds","oShellServices","requestObject","fnGetLinks","fnOnError","fnSetLinkEnablement","id","aSupportedLinks","sLinkId","supported","oSubDataPoints","oPageData","oDataPoint","oLink","oLinkContext","oLinkData","oMixedContext","merge","oMapping","sMainProperty","sMappedProperty","hasOwnProperty","oNewMapping","isNavigationSupported","params","aLinks","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer","getOwnPropertyDescriptor"],"sources":["./ObjectPageController.controller.ts"],"sourcesContent":["import type { SemanticObjectMappingType } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport Log from \"sap/base/Log\";\nimport merge from \"sap/base/util/merge\";\nimport type { EnhanceWithUI5 } from \"sap/fe/base/ClassSupport\";\nimport { defineUI5Class, extensible, finalExtension, publicExtension, usingExtension } from \"sap/fe/base/ClassSupport\";\nimport ActionRuntime from \"sap/fe/core/ActionRuntime\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport PageController from \"sap/fe/core/PageController\";\nimport BusyLocker from \"sap/fe/core/controllerextensions/BusyLocker\";\nimport IntentBasedNavigation from \"sap/fe/core/controllerextensions/IntentBasedNavigation\";\nimport InternalIntentBasedNavigation from \"sap/fe/core/controllerextensions/InternalIntentBasedNavigation\";\nimport InternalRouting from \"sap/fe/core/controllerextensions/InternalRouting\";\nimport MessageHandler from \"sap/fe/core/controllerextensions/MessageHandler\";\nimport PageReady from \"sap/fe/core/controllerextensions/PageReady\";\nimport Paginator from \"sap/fe/core/controllerextensions/Paginator\";\nimport Placeholder from \"sap/fe/core/controllerextensions/Placeholder\";\nimport Share from \"sap/fe/core/controllerextensions/Share\";\nimport ViewState from \"sap/fe/core/controllerextensions/ViewState\";\nimport CollaborationManager from \"sap/fe/core/controllerextensions/cards/CollaborationManager\";\nimport draft from \"sap/fe/core/controllerextensions/editFlow/draft\";\nimport UiModelConstants from \"sap/fe/core/controllerextensions/editFlow/editFlowConstants\";\nimport NavigationReason from \"sap/fe/core/controllerextensions/routing/NavigationReason\";\nimport type CommandExecution from \"sap/fe/core/controls/CommandExecution\";\nimport { RecommendationDialogDecision } from \"sap/fe/core/controls/Recommendations/ConfirmRecommendationDialog\";\nimport type { HiddenDraft, MicroChartManifestConfiguration } from \"sap/fe/core/converters/ManifestSettings\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport FELibrary from \"sap/fe/core/library\";\nimport type { TitleInformation } from \"sap/fe/core/rootView/RootViewBaseController\";\nimport { type WrappedCard } from \"sap/fe/core/services/CollaborationManagerServiceFactory\";\nimport type ChartBlock from \"sap/fe/macros/Chart\";\nimport CommonHelper from \"sap/fe/macros/CommonHelper\";\nimport type MacroAPI from \"sap/fe/macros/MacroAPI\";\nimport type SummarizationButton from \"sap/fe/macros/ai/SummarizationButton\";\nimport type FormAPI from \"sap/fe/macros/form/FormAPI\";\nimport type MessageButton from \"sap/fe/macros/messages/MessageButton\";\nimport type ShareAPI from \"sap/fe/macros/share/ShareAPI\";\nimport type TableAPI from \"sap/fe/macros/table/TableAPI\";\nimport TableHelper from \"sap/fe/macros/table/TableHelper\";\nimport TableUtils from \"sap/fe/macros/table/Utils\";\nimport SelectionVariant from \"sap/fe/navigation/SelectionVariant\";\nimport type { default as ObjectPageExtensionAPI } from \"sap/fe/templates/ObjectPage/ExtensionAPI\";\nimport { default as ExtensionAPI } from \"sap/fe/templates/ObjectPage/ExtensionAPI\";\nimport CollaborationDiscard from \"sap/fe/templates/ObjectPage/components/CollaborationDiscardDialog\";\nimport type SubSectionBlock from \"sap/fe/templates/ObjectPage/controls/SubSectionBlock\";\nimport TableScroller from \"sap/fe/templates/TableScroller\";\nimport type Button from \"sap/m/Button\";\nimport type InputBase from \"sap/m/InputBase\";\nimport InstanceManager from \"sap/m/InstanceManager\";\nimport Link from \"sap/m/Link\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport type NavContainer from \"sap/m/NavContainer\";\nimport type OverflowToolbar from \"sap/m/OverflowToolbar\";\nimport type Popover from \"sap/m/Popover\";\nimport type ToolbarSpacer from \"sap/m/ToolbarSpacer\";\nimport Device from \"sap/ui/Device\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type Control from \"sap/ui/core/Control\";\nimport UI5Element from \"sap/ui/core/Element\";\nimport type InvisibleText from \"sap/ui/core/InvisibleText\";\nimport Library from \"sap/ui/core/Lib\";\nimport type { ManifestOutboundEntry } from \"sap/ui/core/Manifest\";\nimport Messaging from \"sap/ui/core/Messaging\";\nimport Message from \"sap/ui/core/message/Message\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport OverrideExecution from \"sap/ui/core/mvc/OverrideExecution\";\nimport type DynamicSideContent from \"sap/ui/layout/DynamicSideContent\";\nimport type Form from \"sap/ui/layout/form/Form\";\nimport type Chart from \"sap/ui/mdc/Chart\";\nimport type Table from \"sap/ui/mdc/Table\";\nimport type TableTypeBase from \"sap/ui/mdc/table/TableTypeBase\";\nimport type Binding from \"sap/ui/model/Binding\";\nimport type Context from \"sap/ui/model/Context\";\nimport type ListBinding from \"sap/ui/model/ListBinding\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataV4Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataContextBinding from \"sap/ui/model/odata/v4/ODataContextBinding\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type BreadCrumbs from \"sap/uxap/BreadCrumbs\";\nimport type ObjectPageDynamicHeaderTitle from \"sap/uxap/ObjectPageDynamicHeaderTitle\";\nimport type ObjectPageLayout from \"sap/uxap/ObjectPageLayout\";\nimport type ObjectPageSection from \"sap/uxap/ObjectPageSection\";\nimport type ObjectPageSubSection from \"sap/uxap/ObjectPageSubSection\";\nimport type { MetaModelType } from \"../../../../../../../types/metamodel_types\";\nimport CollaborationManagerOverride from \"./overrides/CollaborationManager\";\nimport IntentBasedNavigationOverride from \"./overrides/IntentBasedNavigation\";\nimport InternalRoutingOverride from \"./overrides/InternalRouting\";\nimport MessageHandlerOverride from \"./overrides/MessageHandler\";\nimport PaginatorOverride from \"./overrides/Paginator\";\nimport ShareOverrides from \"./overrides/Share\";\nimport ViewStateOverrides from \"./overrides/ViewState\";\n\nexport type BindingParams = {\n\tredirectedToNonDraft?: string | undefined;\n\treason?: NavigationReason;\n\tbPersistOPScroll?: boolean;\n\tlistBinding?: ODataListBinding;\n\tshowPlaceholder?: boolean;\n};\n\nconst ProgrammingModel = FELibrary.ProgrammingModel;\n@defineUI5Class(\"sap.fe.templates.ObjectPage.ObjectPageController\")\nclass ObjectPageController extends PageController {\n\toView!: FEView;\n\n\t@usingExtension(Placeholder)\n\tplaceholder!: Placeholder;\n\n\t@usingExtension(Share.override(ShareOverrides))\n\tshare!: Share;\n\n\t@usingExtension(InternalRouting.override(InternalRoutingOverride))\n\t_routing!: InternalRouting;\n\n\t@usingExtension(Paginator.override(PaginatorOverride))\n\tpaginator!: Paginator;\n\n\t@usingExtension(MessageHandler.override(MessageHandlerOverride))\n\tmessageHandler!: MessageHandler;\n\n\t@usingExtension(IntentBasedNavigation.override(IntentBasedNavigationOverride))\n\tintentBasedNavigation!: IntentBasedNavigation;\n\n\t@usingExtension(CollaborationManager.override(CollaborationManagerOverride))\n\tcollaborationManager!: CollaborationManager;\n\n\t@usingExtension(\n\t\tInternalIntentBasedNavigation.override({\n\t\t\tgetNavigationMode: function (this: InternalIntentBasedNavigation) {\n\t\t\t\tconst bIsStickyEditMode =\n\t\t\t\t\t(this.getView().getController() as ObjectPageController).getStickyEditMode &&\n\t\t\t\t\t(this.getView().getController() as ObjectPageController).getStickyEditMode();\n\t\t\t\treturn bIsStickyEditMode ? \"explace\" : undefined;\n\t\t\t}\n\t\t})\n\t)\n\t_intentBasedNavigation!: InternalIntentBasedNavigation;\n\n\t@usingExtension(ViewState.override(ViewStateOverrides))\n\tviewState!: ViewState;\n\n\t@usingExtension(\n\t\tPageReady.override({\n\t\t\tisContextExpected: function () {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t})\n\t)\n\tpageReady!: PageReady;\n\n\tprivate mCustomSectionExtensionAPIs?: Record<string, ObjectPageExtensionAPI>;\n\n\tprotected extensionAPI?: ObjectPageExtensionAPI;\n\n\tprivate bSectionNavigated?: boolean;\n\n\tprivate clearTitleHierarchyCacheSetUp = false;\n\n\tprivate switchDraftAndActivePopOver?: Popover;\n\n\tprivate currentBinding?: Binding;\n\n\tprivate messageButton!: MessageButton;\n\n\tprivate collaborationMessage?: Message;\n\n\tprivate mergePatchDraft = false;\n\n\tprivate autoQueueLock: ReturnType<ODataModel[\"lock\"]> | undefined;\n\n\tprivate messageBinding?: Binding;\n\n\t@publicExtension()\n\t@finalExtension()\n\tgetExtensionAPI(sId?: string): ExtensionAPI {\n\t\tif (sId) {\n\t\t\t// to allow local ID usage for custom pages we'll create/return own instances for custom sections\n\t\t\tthis.mCustomSectionExtensionAPIs = this.mCustomSectionExtensionAPIs || {};\n\n\t\t\tif (!this.mCustomSectionExtensionAPIs[sId]) {\n\t\t\t\tthis.mCustomSectionExtensionAPIs[sId] = new ExtensionAPI(this, sId);\n\t\t\t}\n\t\t\treturn this.mCustomSectionExtensionAPIs[sId];\n\t\t} else {\n\t\t\tif (!this.extensionAPI) {\n\t\t\t\tthis.extensionAPI = new ExtensionAPI(this);\n\t\t\t}\n\t\t\treturn this.extensionAPI;\n\t\t}\n\t}\n\n\tonInit(): void {\n\t\tsuper.onInit();\n\t\tconst oObjectPage = this._getObjectPageLayoutControl();\n\n\t\t// Setting defaults of internal model context\n\t\tconst oInternalModelContext = this.getView().getBindingContext(\"internal\") as InternalModelContext;\n\t\toInternalModelContext?.setProperty(\"externalNavigationContext\", { page: true });\n\t\toInternalModelContext?.setProperty(\"relatedApps\", {\n\t\t\tvisibility: false,\n\t\t\titems: null\n\t\t});\n\t\toInternalModelContext?.setProperty(\"batchGroups\", this._getBatchGroupsForView());\n\t\toInternalModelContext?.setProperty(\"errorNavigationSectionFlag\", false);\n\t\tif (oObjectPage.getEnableLazyLoading()) {\n\t\t\t//Attaching the event to make the subsection context binding active when it is visible.\n\t\t\toObjectPage.attachEvent(\"subSectionEnteredViewPort\", this._handleSubSectionEnteredViewPort.bind(this));\n\t\t}\n\t\tthis.messageButton = this.getView().byId(\"fe::FooterBar::MessageButton\") as MessageButton;\n\t\tthis.messageBinding = Messaging.getMessageModel().bindList(\"/\");\n\t\tthis.messageBinding?.attachChange(this._fnShowOPMessage, this);\n\t\toInternalModelContext?.setProperty(\"rootEditEnabled\", true);\n\t\toInternalModelContext?.setProperty(\"rootEditVisible\", true);\n\t}\n\n\tonExit(): void {\n\t\tif (this.mCustomSectionExtensionAPIs) {\n\t\t\tfor (const sId of Object.keys(this.mCustomSectionExtensionAPIs)) {\n\t\t\t\tif (this.mCustomSectionExtensionAPIs[sId]) {\n\t\t\t\t\tthis.mCustomSectionExtensionAPIs[sId].destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t\tdelete this.mCustomSectionExtensionAPIs;\n\t\t}\n\t\tif (this.extensionAPI) {\n\t\t\tthis.extensionAPI.destroy();\n\t\t}\n\t\tdelete this.extensionAPI;\n\n\t\tconst oMessagePopover = this.messageButton ? this.messageButton.oMessagePopover : null;\n\t\tif (oMessagePopover && oMessagePopover.isOpen()) {\n\t\t\toMessagePopover.close();\n\t\t}\n\t\t//when exiting we set keepAlive context to false\n\t\tconst oContext = this.getView().getBindingContext();\n\t\tif (oContext && oContext.isKeepAlive()) {\n\t\t\toContext.setKeepAlive(false);\n\t\t}\n\t\tif (this.collaborativeDraft.isConnected()) {\n\t\t\tthis.collaborativeDraft.disconnect(); // Cleanup collaboration connection when leaving the app\n\t\t}\n\t\tthis.messageBinding?.detachChange(this._fnShowOPMessage, this);\n\t}\n\n\t/**\n\t * Method to show the message strip on the object page.\n\t *\n\t */\n\t_fnShowOPMessage(): void {\n\t\tconst extensionAPI = this.getExtensionAPI();\n\t\tconst view = this.getView();\n\t\tconst messages = Messaging?.getMessageModel()\n\t\t\t.getData()\n\t\t\t.filter((message: Message) => {\n\t\t\t\treturn message.getTargets()[0] === view.getBindingContext()?.getPath();\n\t\t\t});\n\n\t\tif (extensionAPI) {\n\t\t\textensionAPI._showMessages(messages, \"Backend\");\n\t\t}\n\t}\n\n\t_getTableBinding(oTable: Table): ODataListBinding {\n\t\treturn oTable && oTable.getRowBinding();\n\t}\n\n\t/**\n\t * Find the last visible subsection and add the sapUxAPObjectPageSubSectionFitContainer CSS class if it contains only a GridTable or a TreeTable.\n\t * @param subSections The sub sections to look for\n\t */\n\tprivate checkSectionsForNonResponsiveTable(subSections: ObjectPageSubSection[]): void {\n\t\tconst changeClassForTables = (event: Event, lastVisibleSubSection: ObjectPageSubSection): void => {\n\t\t\tconst blocks = [...lastVisibleSubSection.getBlocks(), ...lastVisibleSubSection.getMoreBlocks()];\n\t\t\tif (blocks.length === 1) {\n\t\t\t\tconst table = this.searchTableInBlock(blocks[0] as SubSectionBlock);\n\t\t\t\tif (!table) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst tableType = table.isA<Table>(\"sap.ui.mdc.Table\") && (table.getType() as TableTypeBase);\n\t\t\t\tconst tableAPI = table.getParent()?.isA<TableAPI>(\"sap.fe.macros.table.TableAPI\")\n\t\t\t\t\t? (table.getParent() as TableAPI)\n\t\t\t\t\t: undefined;\n\t\t\t\tif (\n\t\t\t\t\ttableType &&\n\t\t\t\t\t(tableType?.isA(\"sap.ui.mdc.table.GridTableType\") || tableType?.isA(\"sap.ui.mdc.table.TreeTableType\")) &&\n\t\t\t\t\ttableAPI?.getTableDefinition().control.rowCountMode === \"Auto\"\n\t\t\t\t) {\n\t\t\t\t\t//In case there is only a single table in a subSection we fit that to the whole page so that the scrollbar comes only on table and not on page\n\t\t\t\t\tlastVisibleSubSection.addStyleClass(\"sapUxAPObjectPageSubSectionFitContainer\");\n\t\t\t\t\tlastVisibleSubSection.detachEvent(\"modelContextChange\", changeClassForTables, this);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tfor (let subSectionIndex = subSections.length - 1; subSectionIndex >= 0; subSectionIndex--) {\n\t\t\tif (subSections[subSectionIndex].getVisible()) {\n\t\t\t\tconst lastVisibleSubSection = subSections[subSectionIndex];\n\t\t\t\t// We need to attach this event in order to manage the Object Page Lazy Loading mechanism\n\t\t\t\tlastVisibleSubSection.attachEvent(\"modelContextChange\", lastVisibleSubSection, changeClassForTables, this);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Find a table in blocks of section.\n\t * @param block One sub section block\n\t * @returns Table if exists\n\t */\n\tprivate searchTableInBlock(block: SubSectionBlock): Table | undefined {\n\t\tconst control = block.content;\n\t\tlet tableAPI: TableAPI | undefined;\n\t\tif (block.isA(\"sap.fe.templates.ObjectPage.controls.SubSectionBlock\")) {\n\t\t\t// The table may currently be shown in a full screen dialog, we can then get the reference to the TableAPI\n\t\t\t// control from the custom data of the place holder panel\n\t\t\tif (control.isA(\"sap.m.Panel\") && control.data(\"FullScreenTablePlaceHolder\")) {\n\t\t\t\ttableAPI = control.data(\"tableAPIreference\");\n\t\t\t} else if (control.isA(\"sap.fe.macros.table.TableAPI\")) {\n\t\t\t\ttableAPI = control as TableAPI;\n\t\t\t}\n\t\t\tif (tableAPI) {\n\t\t\t\treturn tableAPI.content;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tonBeforeRendering(): void {\n\t\tPageController.prototype.onBeforeRendering.apply(this);\n\t\t// In the retrieveTextFromValueList scenario we need to ensure in case of reload/refresh that the meta model in the methode retrieveTextFromValueList of the FieldRuntime is available\n\t\tif (this.oView.getViewData()?.retrieveTextFromValueList && CommonHelper.getMetaModel() === undefined) {\n\t\t\tCommonHelper.setMetaModel(this.getAppComponent().getMetaModel());\n\t\t}\n\t}\n\n\tonAfterRendering(): void {\n\t\tlet subSections: ObjectPageSubSection[];\n\t\tif (this._getObjectPageLayoutControl().getUseIconTabBar()) {\n\t\t\tconst sections = this._getObjectPageLayoutControl().getSections();\n\t\t\tfor (const section of sections) {\n\t\t\t\tsubSections = section.getSubSections();\n\t\t\t\tthis.checkSectionsForNonResponsiveTable(subSections);\n\t\t\t}\n\t\t} else {\n\t\t\tsubSections = this._getAllSubSections();\n\t\t\tthis.checkSectionsForNonResponsiveTable(subSections);\n\t\t}\n\t}\n\n\t_onBeforeBinding(oContext: ODataV4Context, mParameters: BindingParams = {}): void {\n\t\t// TODO: we should check how this comes together with the transaction helper, same to the change in the afterBinding\n\t\tconst aTables = this._findTables(),\n\t\t\toObjectPage = this._getObjectPageLayoutControl(),\n\t\t\toInternalModelContext = this.getView().getBindingContext(\"internal\") as InternalModelContext,\n\t\t\toInternalModel = this.getView().getModel(\"internal\"),\n\t\t\taBatchGroups = oInternalModelContext.getProperty(\"batchGroups\");\n\t\tlet oFastCreationRow;\n\t\taBatchGroups.push(\"$auto\");\n\t\tif (mParameters.reason !== NavigationReason.EditFlowAction) {\n\t\t\tthis._closeSideContent();\n\t\t}\n\t\tconst opContext = oObjectPage.getBindingContext() as ODataV4Context;\n\t\tif (\n\t\t\topContext &&\n\t\t\topContext.hasPendingChanges() &&\n\t\t\t!aBatchGroups.some(opContext.getModel().hasPendingChanges.bind(opContext.getModel()))\n\t\t) {\n\t\t\t/* \tIn case there are pending changes for the creation row and no others we need to reset the changes\n\t\t\t\t\t\t\t\tTODO: this is just a quick solution, this needs to be reworked\n\t\t\t\t\t\t\t\t*/\n\n\t\t\topContext.getBinding().resetChanges();\n\t\t}\n\n\t\t// For now we have to set the binding context to null for every fast creation row\n\t\t// TODO: Get rid of this coding or move it to another layer - to be discussed with MDC and model\n\t\tfor (const item of aTables) {\n\t\t\toFastCreationRow = item.getCreationRow();\n\t\t\tif (oFastCreationRow) {\n\t\t\t\toFastCreationRow.setBindingContext(null);\n\t\t\t}\n\t\t}\n\n\t\t// Scroll to present Section so that bindings are enabled during navigation through paginator buttons, as there is no view rerendering/rebind\n\t\tconst fnScrollToPresentSection = function (): void {\n\t\t\tif (!(oObjectPage as { isFirstRendering?: () => boolean }).isFirstRendering?.() && !mParameters.bPersistOPScroll) {\n\t\t\t\toObjectPage.setSelectedSection(null as unknown as string);\n\t\t\t}\n\t\t};\n\t\toObjectPage.attachEventOnce(\"modelContextChange\", fnScrollToPresentSection);\n\t\t//Set the Binding for Paginators using ListBinding ID\n\t\tthis._initializePagination(oContext, oInternalModel, mParameters?.listBinding);\n\n\t\tif (oObjectPage.getEnableLazyLoading()) {\n\t\t\tthis._disableBlocksBindings(oObjectPage);\n\t\t}\n\n\t\tif (this.placeholder.isPlaceholderEnabled() && mParameters.showPlaceholder) {\n\t\t\tconst oView = this.getView();\n\t\t\tconst oNavContainer = (oView.getParent() as unknown as { oContainer: Control }).oContainer.getParent();\n\t\t\tif (oNavContainer) {\n\t\t\t\tthis.placeholder.enableAnimation();\n\t\t\t\t(oNavContainer as unknown as { showPlaceholder: Function }).showPlaceholder({});\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getFirstEditableInput(): UI5Element | undefined {\n\t\tconst domEditableElement = this._getObjectPageLayoutControl()._getFirstEditableInput();\n\t\treturn domEditableElement ? UI5Element.closestTo(domEditableElement) : undefined;\n\t}\n\n\t_getFirstClickableElement(oObjectPage: ObjectPageLayout): UI5Element | undefined {\n\t\tlet oFirstClickableElement;\n\t\tconst aActions = oObjectPage.getHeaderTitle() && (oObjectPage.getHeaderTitle() as ObjectPageDynamicHeaderTitle).getActions();\n\t\tif (aActions && aActions.length) {\n\t\t\toFirstClickableElement = aActions.find(function (oAction: Control) {\n\t\t\t\t// Due to the left alignment of the Draft switch and the collaborative draft avatar controls\n\t\t\t\t// there is a ToolbarSpacer in the actions aggregation which we need to exclude here!\n\t\t\t\t// Due to the ACC report, we also need not to check for the InvisibleText elements\n\t\t\t\tif (\n\t\t\t\t\toAction.isA<ShareAPI>(\"sap.fe.macros.share.ShareAPI\") ||\n\t\t\t\t\toAction.isA<SummarizationButton>(\"sap.fe.macros.ai.SummarizationButton\")\n\t\t\t\t) {\n\t\t\t\t\t// since ShareAPI and summarize does not have a disable property\n\t\t\t\t\t// hence there is no need to check if it is disbaled or not\n\t\t\t\t\treturn oAction.getVisible();\n\t\t\t\t} else if (!oAction.isA<InvisibleText>(\"sap.ui.core.InvisibleText\") && !oAction.isA<ToolbarSpacer>(\"sap.m.ToolbarSpacer\")) {\n\t\t\t\t\treturn oAction.getVisible() && (oAction as Button).getEnabled();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn oFirstClickableElement;\n\t}\n\n\t/**\n\t * Disable the bindings of blocks in Object Page Layout based on the its overall content.\n\t * @param objectPage Object Page Layout control\n\t */\n\t_disableBlocksBindings(this: ObjectPageController, objectPage: ObjectPageLayout): void {\n\t\tconst aSections = objectPage.getSections();\n\t\tconst bUseIconTabBar = objectPage.getUseIconTabBar();\n\t\tlet iSkip = 3; // 3 sections/subsections are loaded initially, the others are loaded lazily\n\t\tconst bIsInEditMode = CommonUtils.getIsEditable(this.getView());\n\t\tconst bEditableHeader = this.getView().getViewData().editableHeaderContent;\n\t\tfor (let iSection = 0; iSection < aSections.length; iSection++) {\n\t\t\tconst oSection = aSections[iSection];\n\t\t\tconst aSubSections = oSection.getSubSections();\n\t\t\tfor (let iSubSection = 0; iSubSection < aSubSections.length; iSubSection++, iSkip--) {\n\t\t\t\t// In IconTabBar mode keep the second section bound if there is an editable header and we are switching to display mode\n\t\t\t\tif (iSkip < 1 || (bUseIconTabBar && (iSection > 1 || (iSection === 1 && !bEditableHeader && !bIsInEditMode)))) {\n\t\t\t\t\tconst oSubSection = aSubSections[iSubSection];\n\t\t\t\t\tif (oSubSection.data().isVisibilityDynamic !== \"true\") {\n\t\t\t\t\t\t// SubSection's binding is enabled.\n\t\t\t\t\t\toSubSection.setBindingContext(undefined);\n\t\t\t\t\t\tconst blocks = oSubSection.getBlocks() as SubSectionBlock[];\n\t\t\t\t\t\t// SubSection's contents binding is disabled.\n\t\t\t\t\t\tblocks.forEach((block) => block.setBindingContext(null));\n\t\t\t\t\t\toSubSection.getMoreBlocks().forEach((subBlock) => subBlock.setBindingContext(null));\n\t\t\t\t\t\toSubSection.getActions().forEach((actions) => actions.setBindingContext(null));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_getFirstEmptyMandatoryFieldFromSubSection(aSubSections: ObjectPageSubSection[]): InputBase | undefined {\n\t\tif (aSubSections) {\n\t\t\tfor (const subSection of aSubSections) {\n\t\t\t\tconst aBlocks = subSection.getBlocks() as (Form | FormAPI)[];\n\n\t\t\t\tif (aBlocks) {\n\t\t\t\t\tfor (const blockControl of aBlocks) {\n\t\t\t\t\t\tlet aFormContainers;\n\n\t\t\t\t\t\tif (blockControl.isA<Form>(\"sap.ui.layout.form.Form\")) {\n\t\t\t\t\t\t\taFormContainers = blockControl.getFormContainers();\n\t\t\t\t\t\t} else if (blockControl.getContent && blockControl.getContent()?.isA<Form>(\"sap.ui.layout.form.Form\")) {\n\t\t\t\t\t\t\taFormContainers = (blockControl.getContent() as Form).getFormContainers();\n\t\t\t\t\t\t} else if (blockControl?.getContent?.()?.isA<FormAPI>(\"sap.fe.macros.form.FormAPI\")) {\n\t\t\t\t\t\t\taFormContainers = ((blockControl.getContent() as FormAPI).getContent() as Form).getFormContainers();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (aFormContainers) {\n\t\t\t\t\t\t\tfor (const formContainer of aFormContainers) {\n\t\t\t\t\t\t\t\tconst aFormElements = formContainer.getFormElements();\n\t\t\t\t\t\t\t\tif (aFormElements) {\n\t\t\t\t\t\t\t\t\tfor (const formElement of aFormElements) {\n\t\t\t\t\t\t\t\t\t\tconst aFields = formElement.getFields() as InputBase[];\n\n\t\t\t\t\t\t\t\t\t\t// The first field is not necessarily an InputBase (e.g. could be a Text)\n\t\t\t\t\t\t\t\t\t\t// So we need to check whether it has a getRequired method\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tif (aFields[0].getRequired && aFields[0].getRequired() && !aFields[0].getValue()) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn aFields[0];\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\tLog.debug(`Error when searching for mandaotry empty field: ${error}`);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Set the initial focus in edit mode.\n\t * @param aSubSections Object page sub sections\n\t */\n\t_updateFocusInEditMode(aSubSections: ObjectPageSubSection[]): void {\n\t\tsetTimeout(\n\t\t\tfunction (this: ObjectPageController): void {\n\t\t\t\t// We set the focus in a timeeout, otherwise the focus sometimes goes to the TabBar\n\t\t\t\tconst oObjectPage = this._getObjectPageLayoutControl();\n\t\t\t\tconst oMandatoryField = this._getFirstEmptyMandatoryFieldFromSubSection(aSubSections);\n\t\t\t\tlet oFieldToFocus;\n\t\t\t\tif (oMandatoryField) {\n\t\t\t\t\toFieldToFocus = (oMandatoryField as unknown as { content: { getContentEdit: Function } }).content.getContentEdit()[0];\n\t\t\t\t} else {\n\t\t\t\t\toFieldToFocus = this.getFirstEditableInput() ?? this._getFirstClickableElement(oObjectPage);\n\t\t\t\t}\n\t\t\t\tif (oFieldToFocus) {\n\t\t\t\t\tconst focusInfo = oFieldToFocus.getFocusInfo() as { targetInfo: object };\n\t\t\t\t\tfocusInfo.targetInfo = { silent: true };\n\t\t\t\t\tif (oFieldToFocus.isA(\"sap.ui.mdc.field.FieldInput\")) {\n\t\t\t\t\t\toFieldToFocus = oFieldToFocus.getParent();\n\t\t\t\t\t}\n\t\t\t\t\toFieldToFocus.focus(focusInfo);\n\t\t\t\t}\n\t\t\t}.bind(this),\n\t\t\t0\n\t\t);\n\t}\n\n\t_handleSubSectionEnteredViewPort(oEvent: UI5Event<{ subSection: ObjectPageSubSection }>): void {\n\t\tconst oSubSection = oEvent.getParameter(\"subSection\");\n\t\tconst blocks = oSubSection.getBlocks() as SubSectionBlock[];\n\t\tblocks.forEach((block) => block.setBindingContext(undefined));\n\t\toSubSection.getMoreBlocks().forEach((subBlock) => subBlock.setBindingContext(undefined));\n\t\toSubSection.getActions().forEach((actions) => actions.setBindingContext(undefined));\n\t}\n\n\t_onBackNavigationInDraft(oContext: ODataV4Context): void {\n\t\tthis.messageHandler.removeTransitionMessages();\n\n\t\t// Function to navigate back, or display the launchpad if we're on the first page of the history\n\t\tconst navBack = (): void => {\n\t\t\tconst currentURL = document.URL;\n\t\t\thistory.back();\n\t\t\t// In case there is no previous page in the history, history.back does nothing.\n\t\t\t// In this case, we need to use navigateBackFromContext, that will display the home page\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (document.URL === currentURL) {\n\t\t\t\t\tthis._routing.navigateBackFromContext(oContext);\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t};\n\n\t\tif (this.getAppComponent().getRouterProxy().checkIfBackHasSameContext()) {\n\t\t\t// Back nav will keep the same context --> no need to display the dialog\n\t\t\thistory.back();\n\t\t} else if (!this.getView().getBindingContext()) {\n\t\t\t// This object page doesn't have a binding context, but still handles the shell back navigation --> pform the nav back and remove the navback handler as it makes no sense any longer\n\t\t\tthis.getAppComponent()\n\t\t\t\t.getShellServices()\n\t\t\t\t.setBackNavigation(undefined)\n\t\t\t\t.then(navBack)\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tLog.warning(\"Error while setting back navigation\", e);\n\t\t\t\t});\n\t\t} else {\n\t\t\tdraft.processDataLossOrDraftDiscardConfirmation(\n\t\t\t\tnavBack,\n\t\t\t\tFunction.prototype,\n\t\t\t\toContext,\n\t\t\t\tthis,\n\t\t\t\ttrue,\n\t\t\t\tdraft.NavigationType.BackNavigation\n\t\t\t);\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\t_onAfterBinding(inputBindingContext: Context | undefined, mParameters: BindingParams | undefined): void {\n\t\tconst view = this.getView();\n\t\tconst viewLevel = view?.getViewData()?.viewLevel;\n\t\tconst oObjectPage = this._getObjectPageLayoutControl();\n\t\tconst aTables = this._findTables();\n\n\t\tthis._sideEffects.clearFieldGroupsValidity();\n\n\t\t// TODO: this is only a temp solution as long as the model fix the cache issue and we use this additional\n\t\t// binding with ownRequest\n\t\tconst bindingContext = oObjectPage.getBindingContext() as ODataV4Context;\n\n\t\tlet aIBNActions: UI5Element[] = [];\n\t\toObjectPage.getSections().forEach(function (oSection: ObjectPageSection) {\n\t\t\toSection.getSubSections().forEach(function (oSubSection: ObjectPageSubSection) {\n\t\t\t\taIBNActions = CommonUtils.getIBNActions(oSubSection, aIBNActions);\n\t\t\t});\n\t\t});\n\n\t\t// Assign internal binding contexts to oFormContainer:\n\t\t// 1. It is not possible to assign the internal binding context to the XML fragment\n\t\t// (FormContainer.fragment.xml) yet - it is used already for the data-structure.\n\t\t// 2. Another problem is, that FormContainers assigned to a 'MoreBlock' does not have an\n\t\t// internal model context at all.\n\n\t\taTables.forEach(function (oTable: Table) {\n\t\t\tconst oInternalModelContext = oTable.getBindingContext(\"internal\");\n\t\t\tif (oInternalModelContext) {\n\t\t\t\toInternalModelContext.setProperty(\"creationRowFieldValidity\", {});\n\t\t\t\toInternalModelContext.setProperty(\"creationRowCustomValidity\", {});\n\n\t\t\t\taIBNActions = CommonUtils.getIBNActions(oTable, aIBNActions);\n\n\t\t\t\t// temporary workaround for BCP: 2080218004\n\t\t\t\t// Need to fix with BLI: FIORITECHP1-15274\n\t\t\t\t// only for edit mode, we clear the table cache\n\t\t\t\t// Workaround starts here!!\n\t\t\t\tconst oTableRowBinding = oTable.getRowBinding();\n\t\t\t\tif (oTableRowBinding) {\n\t\t\t\t\tif (ModelHelper.isStickySessionSupported(oTableRowBinding.getModel().getMetaModel())) {\n\t\t\t\t\t\t// apply for both edit and display mode in sticky\n\t\t\t\t\t\t(oTableRowBinding as unknown as { removeCachesAndMessages: Function }).removeCachesAndMessages(\"\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Workaround ends here!!\n\n\t\t\t\t// Clear the selection in the table and update action enablement accordingly\n\t\t\t\t// Will to be fixed with BLI: FIORITECHP1-24318\n\t\t\t\tconst tableAPI = oTable.getParent() as TableAPI;\n\t\t\t\tconst oActionOperationAvailableMap = tableAPI ? JSON.parse(tableAPI.tableDefinition.operationAvailableMap) : {};\n\n\t\t\t\tActionRuntime.setActionEnablement(oInternalModelContext, oActionOperationAvailableMap, [], \"table\");\n\n\t\t\t\toTable.clearSelection();\n\t\t\t}\n\t\t});\n\t\t//Retrieve Object Page header actions from Object Page title control\n\t\tconst oObjectPageTitle = oObjectPage.getHeaderTitle() as ObjectPageDynamicHeaderTitle;\n\t\tlet aIBNHeaderActions: UI5Element[] = [];\n\t\taIBNHeaderActions = CommonUtils.getIBNActions(oObjectPageTitle, aIBNHeaderActions);\n\t\taIBNActions = aIBNActions.concat(aIBNHeaderActions);\n\t\tCommonUtils.updateDataFieldForIBNButtonsVisibility(aIBNActions, this.getView());\n\n\t\tlet oModel: ODataModel,\n\t\t\toFinalUIState: Promise<unknown> = Promise.resolve();\n\n\t\t// this should not be needed at the all\n\t\t/**\n\t\t * @param oTable\n\t\t */\n\t\tconst handleTableModifications = (oTable: Table): void => {\n\t\t\tconst oBinding = this._getTableBinding(oTable),\n\t\t\t\tfnHandleTablePatchEvents = function (): void {\n\t\t\t\t\tTableHelper.enableFastCreationRow(\n\t\t\t\t\t\toTable.getCreationRow(),\n\t\t\t\t\t\toBinding.getPath(),\n\t\t\t\t\t\toBinding.getContext(),\n\t\t\t\t\t\toModel,\n\t\t\t\t\t\toFinalUIState\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\tif (!oBinding) {\n\t\t\t\tLog.error(`Expected binding missing for table: ${oTable.getId()}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (oBinding.getContext()) {\n\t\t\t\tfnHandleTablePatchEvents();\n\t\t\t} else {\n\t\t\t\tconst fnHandleChange = function (): void {\n\t\t\t\t\tif (oBinding.getContext()) {\n\t\t\t\t\t\tfnHandleTablePatchEvents();\n\t\t\t\t\t\toBinding.detachChange(fnHandleChange);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\toBinding.attachChange(fnHandleChange);\n\t\t\t}\n\t\t};\n\n\t\tif (bindingContext) {\n\t\t\toModel = bindingContext.getModel();\n\n\t\t\t// Compute Edit Mode\n\t\t\toFinalUIState = this.editFlow.computeModelsForEditMode(bindingContext);\n\n\t\t\tif (ModelHelper.isCollaborationDraftSupported(oModel.getMetaModel())) {\n\t\t\t\toFinalUIState\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tif (CommonUtils.getIsEditable(this.getView())) {\n\t\t\t\t\t\t\tthis.collaborativeDraft.connect();\n\t\t\t\t\t\t} else if (this.collaborativeDraft.isConnected()) {\n\t\t\t\t\t\t\tthis.collaborativeDraft.disconnect(); // Cleanup collaboration connection in case we switch to another element (e.g. in FCL)\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function (oError: unknown) {\n\t\t\t\t\t\tLog.error(\"Error while waiting for the final UI State\", oError as string);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\t// update related apps\n\t\t\tthis._updateRelatedApps();\n\n\t\t\t//Attach the patch sent and patch completed event to the object page binding so that we can react\n\t\t\tconst oBinding = (bindingContext.getBinding && bindingContext.getBinding()) || bindingContext;\n\n\t\t\t// Attach the event handler only once to the same binding\n\t\t\tif (this.currentBinding !== oBinding) {\n\t\t\t\toBinding.attachEvent(\"patchSent\", {}, this.editFlow.handlePatchSent, this);\n\t\t\t\tthis.currentBinding = oBinding;\n\t\t\t}\n\n\t\t\taTables.forEach(function (oTable: Table): void {\n\t\t\t\t// access binding only after table is bound\n\t\t\t\tTableUtils.whenBound(oTable)\n\t\t\t\t\t.then(handleTableModifications)\n\t\t\t\t\t.catch(function (oError: unknown) {\n\t\t\t\t\t\tLog.error(\"Error while waiting for the table to be bound\", oError as string);\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t\t// should be called only after binding is ready hence calling it in onAfterBinding\n\t\t\t(oObjectPage as unknown as { _triggerVisibleSubSectionsEvents: Function })._triggerVisibleSubSectionsEvents();\n\n\t\t\t//To Compute the Edit Binding of the subObject page using root object page, create a context for draft root and update the edit button in sub OP using the context\n\t\t\tActionRuntime.updateEditButtonVisibilityAndEnablement(this.getView());\n\t\t}\n\t\t// we are clearing any previous data from recommendations every time we come to new OP\n\t\t// so that cached recommendations are not shown to user\n\t\tif (viewLevel && viewLevel === 1) {\n\t\t\toFinalUIState?.then(() => {\n\t\t\t\tthis.recommendations.clearRecommendations();\n\n\t\t\t\treturn;\n\t\t\t});\n\t\t}\n\t\tthis._updateAvailableCards([]);\n\t\tthis.displayCollaborationMessage(mParameters?.redirectedToNonDraft);\n\t\tthis._setOPMessageStripInternalContext();\n\n\t\tconst applyAppState = this.getAppComponent().getAppStateHandler().applyAppState(view.getId(), view);\n\t\tthis.pageReady.waitFor(applyAppState);\n\t}\n\n\t/**\n\t * Update the cards when the binding is refreshed.\n\t * @param cards Array of cards to be updated\n\t */\n\tasync _updateAvailableCards(cards: WrappedCard[]): Promise<void> {\n\t\tawait this.collaborationManager.collectAvailableCards(cards);\n\t\tif (cards.length > 0) {\n\t\t\tconst cardObject = this.collaborationManager.updateCards(cards);\n\t\t\tconst parentAppId = this.getAppComponent().getId();\n\t\t\tthis.getAppComponent().getCollaborationManagerService().addCardsToCollaborationManager(cardObject, parentAppId);\n\t\t\tthis.getAppComponent().getCollaborationManagerService().shareAvailableCards();\n\t\t}\n\t}\n\n\t/**\n\t * Set the internal binding context of the Messagestrip OP.\n\t */\n\t_setOPMessageStripInternalContext(): void {\n\t\tconst view = this.getView();\n\t\tconst oObjectPage = this._getObjectPageLayoutControl();\n\t\tconst internalModelContext = view.getBindingContext(\"internal\");\n\t\tinternalModelContext?.setProperty(\"MessageStrip\", { ...internalModelContext?.getProperty(\"MessageStrip\") });\n\t\tif (internalModelContext) {\n\t\t\t(oObjectPage.getHeaderTitle() as unknown as Control)\n\t\t\t\t?.findElements(true, (elem: Control) => elem.isA(\"sap.m.MessageStrip\"))\n\t\t\t\t.forEach((messageStrip: UI5Element) => {\n\t\t\t\t\tmessageStrip.setBindingContext(\n\t\t\t\t\t\tinternalModelContext\n\t\t\t\t\t\t\t.getModel()\n\t\t\t\t\t\t\t.bindContext(this.getExtensionAPI()._getMessageStripBindingContextPath())\n\t\t\t\t\t\t\t.getBoundContext()!,\n\t\t\t\t\t\t\"internal\"\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t// If the view's binding context already had messages that were not cleared, we would need to re-evaluate to show the message strip.\n\t\t\tthis._fnShowOPMessage();\n\t\t}\n\t}\n\n\t/**\n\t * Show a message strip if a redirection to a non-draft element has been done.\n\t * Remove the message strip in case we navigate to another object page.\n\t * @param entityName Name of the Entity to be displayed in the message\n\t */\n\tdisplayCollaborationMessage(entityName: string | undefined): void {\n\t\tconst resourceBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n\n\t\tif (this.collaborationMessage) {\n\t\t\tMessaging.removeMessages([this.collaborationMessage]);\n\t\t\tdelete this.collaborationMessage;\n\t\t}\n\n\t\tif (entityName) {\n\t\t\tthis.collaborationMessage = new Message({\n\t\t\t\tmessage: resourceBundle.getText(\"REROUTED_NAVIGATION_TO_SAVED_VERSION\", [entityName]),\n\t\t\t\ttype: MessageType.Information,\n\t\t\t\ttarget: this.getView()?.getBindingContext()?.getPath()\n\t\t\t});\n\t\t\tMessaging.addMessages([this.collaborationMessage]);\n\t\t}\n\t}\n\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onPageReady(mParameters: { forceFocus: boolean } | undefined): Promise<void> {\n\t\tconst setFocus = (): void => {\n\t\t\t// Set the focus to the first action button, or to the first editable input if in editable mode\n\t\t\tconst oObjectPage = this._getObjectPageLayoutControl();\n\t\t\tconst isInDisplayMode = !CommonUtils.getIsEditable(this.getView());\n\n\t\t\tif (isInDisplayMode) {\n\t\t\t\tconst oFirstClickableElement = this._getFirstClickableElement(oObjectPage);\n\t\t\t\tif (oFirstClickableElement) {\n\t\t\t\t\toFirstClickableElement.focus();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst oSelectedSection = UI5Element.getElementById(oObjectPage.getSelectedSection()) as ObjectPageSection | undefined;\n\t\t\t\tif (oSelectedSection) {\n\t\t\t\t\tthis._updateFocusInEditMode(oSelectedSection.getSubSections());\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tconst ctxt = this.getView().getBindingContext();\n\t\t// setting this model data to be used for recommendations binding\n\t\tthis.getView().getModel(\"internal\").setProperty(\"/currentCtxt\", ctxt);\n\n\t\t// Apply app state only after the page is ready with the first section selected\n\t\tconst oView = this.getView();\n\t\tconst oInternalModelContext = oView.getBindingContext(\"internal\") as InternalModelContext;\n\t\tconst oBindingContext = oView.getBindingContext();\n\t\t//Show popup while navigating back from object page in case of draft\n\t\tif (oBindingContext) {\n\t\t\tconst bIsStickyMode = ModelHelper.isStickySessionSupported(oBindingContext.getModel().getMetaModel());\n\t\t\tif (!bIsStickyMode) {\n\t\t\t\tconst oAppComponent = CommonUtils.getAppComponent(oView);\n\t\t\t\tawait oAppComponent.getShellServices().setBackNavigation(() => this._onBackNavigationInDraft(oBindingContext));\n\t\t\t}\n\t\t}\n\t\t// do not request recommendations action if we are in Display mode\n\t\tconst isEditable = CommonUtils.getIsEditable(this.getView());\n\t\tif (isEditable && oBindingContext) {\n\t\t\tawait this.recommendations.fetchAndApplyRecommendations([{ context: oBindingContext }]);\n\t\t}\n\n\t\tif (mParameters?.forceFocus) {\n\t\t\tsetFocus();\n\t\t}\n\t\toInternalModelContext.setProperty(\"errorNavigationSectionFlag\", false);\n\t\tthis._checkDataPointTitleForExternalNavigation();\n\n\t\t//The following coding is done to merge an open PATCH and the draftprepare/draftactivate\n\t\t//request into one $batch request\n\t\t//To achieve this the $auto queue is locked at the mousedown event (before focusout) in\n\t\t//order to wait for the draft request issued in the save buttons press event handler.\n\t\t//The queue is released again during mouseup (before press).\n\t\t//This is only possible on non touch devices because on touch devices the focusout and press\n\t\t//events are both initiated at touchend by sap.m.Button.\n\t\t//mouseHandlerSet is used to ensures that the event handlers are attached only one time.\n\t\t//There can be multiple onPageReady e.g. when switching between edit/display mode\n\t\tif (!this.mergePatchDraft && !Device.support.touch) {\n\t\t\tconst saveButton = oView.byId(\"fe::FooterBar::StandardAction::Save\") as Button;\n\t\t\tconst autoQueueUnlock = (): void => {\n\t\t\t\tif (this.autoQueueLock?.isLocked()) {\n\t\t\t\t\tthis.autoQueueLock.unlock();\n\t\t\t\t}\n\t\t\t\tsaveButton.detachBrowserEvent(\"mouseup\", autoQueueUnlock);\n\t\t\t\tsaveButton.detachBrowserEvent(\"blur\", autoQueueUnlock);\n\t\t\t};\n\n\t\t\tsaveButton?.attachBrowserEvent(\"mousedown\", (): void => {\n\t\t\t\tif (!this.autoQueueLock?.isLocked()) {\n\t\t\t\t\tthis.autoQueueLock = this.getView().getModel().lock(\"$auto\");\n\t\t\t\t\t//when the mouse is dragged away from the save button while pressed then there will be no\n\t\t\t\t\t//mouseup event on the save button. Therefore, the unlocking is done on \"mouseup\" and \"blur\"\n\t\t\t\t\tsaveButton.attachBrowserEvent(\"mouseup\", autoQueueUnlock);\n\t\t\t\t\tsaveButton.attachBrowserEvent(\"blur\", autoQueueUnlock);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.mergePatchDraft = true;\n\t\t}\n\t}\n\n\t/**\n\t * Get the status of edit mode for sticky session.\n\t * @returns The status of edit mode for sticky session\n\t */\n\tgetStickyEditMode(): boolean {\n\t\tconst oBindingContext = this.getView().getBindingContext && this.getView().getBindingContext();\n\t\tlet bIsStickyEditMode = false;\n\t\tif (oBindingContext) {\n\t\t\tconst bIsStickyMode = ModelHelper.isStickySessionSupported(oBindingContext.getModel().getMetaModel());\n\t\t\tif (bIsStickyMode) {\n\t\t\t\tbIsStickyEditMode = CommonUtils.getIsEditable(this.getView());\n\t\t\t}\n\t\t}\n\t\treturn bIsStickyEditMode;\n\t}\n\n\t_getObjectPageLayoutControl(): ObjectPageLayout {\n\t\treturn this.byId(\"fe::ObjectPage\") as ObjectPageLayout;\n\t}\n\n\t_getPageTitleInformation(): { title: string; subtitle: string; intent: string; icon: string; description: string } {\n\t\tconst oObjectPage = this._getObjectPageLayoutControl();\n\t\tconst oObjectPageSubtitle = oObjectPage.getCustomData().find(function (oCustomData) {\n\t\t\treturn oCustomData.getKey() === \"ObjectPageSubtitle\";\n\t\t});\n\t\tconst objectPageDescription = oObjectPage.data(\"ObjectPageDescription\");\n\t\tconst appComponent = this.getAppComponent();\n\t\tconst rootViewController = appComponent.getRootViewController();\n\t\tconst fnClearCacheTitle = (): void => {\n\t\t\trootViewController.clearTitleHierarchyCache(oObjectPage.getBindingContext()?.getPath() as string);\n\t\t};\n\t\tif (oObjectPageSubtitle && !this.clearTitleHierarchyCacheSetUp) {\n\t\t\toObjectPageSubtitle.getBinding(\"value\")?.attachChange(fnClearCacheTitle, this);\n\t\t\tthis.clearTitleHierarchyCacheSetUp = true;\n\t\t}\n\t\treturn {\n\t\t\ttitle: oObjectPage.data(\"ObjectPageTitle\") || \"\",\n\t\t\tsubtitle: oObjectPageSubtitle && oObjectPageSubtitle.getValue(),\n\t\t\tintent: \"\",\n\t\t\ticon: \"\",\n\t\t\tdescription: objectPageDescription\n\t\t};\n\t}\n\n\t_executeHeaderShortcut(sId: string): void {\n\t\tconst sButtonId = `${this.getView().getId()}--${sId}`,\n\t\t\toButton = (this._getObjectPageLayoutControl().getHeaderTitle() as ObjectPageDynamicHeaderTitle)\n\t\t\t\t.getActions()\n\t\t\t\t.find((oElement) => oElement.getId() === sButtonId);\n\t\tif (oButton) {\n\t\t\tCommonUtils.fireButtonPress(oButton);\n\t\t}\n\t}\n\n\t_executeFooterShortcut(sId: string): void {\n\t\tconst sButtonId = `${this.getView().getId()}--${sId}`,\n\t\t\toButton = (this._getObjectPageLayoutControl().getFooter() as OverflowToolbar).getContent().find(function (\n\t\t\t\toElement: UI5Element\n\t\t\t) {\n\t\t\t\treturn oElement.getMetadata().getName() === \"sap.m.Button\" && oElement.getId() === sButtonId;\n\t\t\t});\n\t\tCommonUtils.fireButtonPress(oButton);\n\t}\n\n\t_executeTabShortCut(oExecution: UI5Event): void {\n\t\tconst oObjectPage = this._getObjectPageLayoutControl(),\n\t\t\taSections = oObjectPage.getSections(),\n\t\t\tiSectionIndexMax = aSections.length - 1,\n\t\t\tsCommand = (oExecution.getSource() as unknown as CommandExecution).getCommand();\n\t\tlet newSection,\n\t\t\tiSelectedSectionIndex = oObjectPage.indexOfSection(this.byId(oObjectPage.getSelectedSection()!) as ObjectPageSection);\n\t\tif (iSelectedSectionIndex !== -1 && iSectionIndexMax > 0) {\n\t\t\tif (sCommand === \"NextTab\") {\n\t\t\t\tif (iSelectedSectionIndex <= iSectionIndexMax - 1) {\n\t\t\t\t\tnewSection = aSections[++iSelectedSectionIndex];\n\t\t\t\t}\n\t\t\t} else if (iSelectedSectionIndex !== 0) {\n\t\t\t\t// PreviousTab\n\t\t\t\tnewSection = aSections[--iSelectedSectionIndex];\n\t\t\t}\n\n\t\t\tif (newSection) {\n\t\t\t\toObjectPage.setSelectedSection(newSection);\n\t\t\t\tnewSection.focus();\n\t\t\t}\n\t\t}\n\t}\n\n\t_getFooterVisibility(): void {\n\t\tconst oInternalModelContext = this.getView().getBindingContext(\"internal\") as InternalModelContext;\n\t\tconst sViewId = this.getView().getId();\n\t\toInternalModelContext.setProperty(\"messageFooterContainsErrors\", false);\n\t\tconst isHiddenDraftEnabled = (this.getAppComponent().getEnvironmentCapabilities().getCapabilities().HiddenDraft as HiddenDraft)\n\t\t\t?.enabled;\n\t\tMessaging.getMessageModel()\n\t\t\t.getData()\n\t\t\t.forEach(function (oMessage: Message): void {\n\t\t\t\tconst isErrorMessage = oMessage.validation && oMessage.getType() === \"Error\";\n\t\t\t\tconst messageValidation = isHiddenDraftEnabled\n\t\t\t\t\t? isErrorMessage\n\t\t\t\t\t: isErrorMessage && oMessage.getTargets().some((target) => target.includes(sViewId));\n\t\t\t\tif (messageValidation) {\n\t\t\t\t\toInternalModelContext.setProperty(\"messageFooterContainsErrors\", true);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\t_showMessagePopover(err?: string, oRet?: unknown): unknown {\n\t\tif (err) {\n\t\t\tLog.error(err);\n\t\t}\n\t\tconst isEditMode = CommonUtils.getIsEditable(this.getView());\n\t\tconst rootViewController = this.getAppComponent().getRootViewController();\n\t\tconst currentPageView = rootViewController.isFclEnabled()\n\t\t\t? rootViewController.getRightmostView()\n\t\t\t: (this.getAppComponent().getRootContainer() as NavContainer).getCurrentPage();\n\t\tif (isEditMode && !currentPageView.isA(\"sap.m.MessagePage\")) {\n\t\t\tconst oMessageButton = this.messageButton,\n\t\t\t\toMessagePopover = oMessageButton.oMessagePopover,\n\t\t\t\toItemBinding = oMessagePopover.getBinding(\"items\") as ListBinding;\n\n\t\t\tif (oItemBinding.getLength() > 0 && !oMessagePopover.isOpen()) {\n\t\t\t\toMessageButton.setVisible(true);\n\t\t\t\t// workaround to ensure that oMessageButton is rendered when openBy is called\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\toMessagePopover.openBy(oMessageButton);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\t\treturn oRet;\n\t}\n\n\tasync _editDocument(): Promise<void | Context> {\n\t\tconst oContext = this.getView().getBindingContext();\n\t\tconst oModel = this.getView().getModel(\"ui\");\n\t\tBusyLocker.lock(oModel);\n\t\treturn this.editFlow.editDocument.apply(this.editFlow, [oContext]).finally(function () {\n\t\t\tBusyLocker.unlock(oModel);\n\t\t});\n\t}\n\n\t/**\n\t * Returns the default semantic object mapping object.\n\t * @private\n\t * @param propertyPath The value of the data point property path\n\t * @param semanticObject The semantic object\n\t * @returns The array of the default semantic object mapping object\n\t */\n\t_getImplicitSemanticObjectMappingForDataPoints(\n\t\tpropertyPath: string,\n\t\tsemanticObject: string\n\t): MetaModelType<SemanticObjectMappingType>[] {\n\t\treturn [\n\t\t\t{\n\t\t\t\tLocalProperty: {\n\t\t\t\t\t$PropertyPath: propertyPath\n\t\t\t\t},\n\t\t\t\tSemanticObjectProperty: semanticObject\n\t\t\t}\n\t\t];\n\t}\n\n\t/**\n\t * Executes the validation of the document\n\t * One of the following actions is triggered on the draft version of the document:\n\t * - on a transient context:\n\t * - if the context gets data, wait for the creation of the context and execute the global validation\n\t * - if no data is found on this context, only the prepareAction is requested\n\t * - on a regular context, the global validation is requested.\n\t * @returns Promise of the global validation or undefined if not executed\n\t */\n\tasync _validateDocument(): Promise<void | unknown[] | ODataContextBinding> {\n\t\tconst control = UI5Element.getActiveElement() as Control;\n\t\tconst context = control?.getBindingContext() as ODataV4Context | undefined;\n\n\t\tif (!control || !context) {\n\t\t\treturn undefined;\n\t\t}\n\t\tlet byPassSideEffects = false;\n\t\tif (context.isTransient()) {\n\t\t\tif (context.hasPendingChanges()) {\n\t\t\t\tawait context.created();\n\t\t\t} else {\n\t\t\t\tbyPassSideEffects = true;\n\t\t\t}\n\t\t}\n\t\tthis.messageHandler.holdMessagesForControl(control);\n\t\tconst ret = await this.executeGlobalValidation(context, byPassSideEffects);\n\t\tthis.messageHandler.showMessages({ control });\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Executes the global validation of the draft\n\t * One of the following actions is triggered on the draft version of the document:\n\t * - the global side effects are executed if these side effects are defined in the context\n\t * - the draft Validation on the DraftRoot context.\n\t * @param context The Context\n\t * @param byPassSideEffects Only the draft Validation step is executed\n\t * @returns Promise of the global validation\n\t */\n\tasync executeGlobalValidation(context: ODataV4Context, byPassSideEffects = false): Promise<void | unknown[] | ODataContextBinding> {\n\t\tconst appComponent = this.getAppComponent();\n\t\t// the draft validation is treated as a user interaction, and the service must return transition messages again if still valid\n\t\tthis.messageHandler.removeTransitionMessages();\n\t\tif (!byPassSideEffects) {\n\t\t\tconst sideEffectsService = appComponent.getSideEffectsService();\n\t\t\tconst entityType = sideEffectsService.getEntityTypeFromContext(context);\n\t\t\tconst globalSideEffects = entityType ? sideEffectsService.getGlobalODataEntitySideEffects(entityType) : [];\n\t\t\t// If there is at least one global SideEffects for the related entity, execute it/them\n\t\t\tif (globalSideEffects.length) {\n\t\t\t\tawait this.editFlow.syncTask();\n\t\t\t\treturn Promise.all(\n\t\t\t\t\tglobalSideEffects.map(async (sideEffects) => this._sideEffects.requestSideEffects(sideEffects, context))\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst draftRootContext = (await CommonUtils.createRootContext(\n\t\t\tProgrammingModel.Draft,\n\t\t\tthis.getView(),\n\t\t\tappComponent\n\t\t)) as ODataV4Context;\n\t\t//Execute the draftValidation if there is no globalSideEffects (ignore ETags in collaboration draft)\n\t\tif (draftRootContext) {\n\t\t\tawait this.editFlow.syncTask();\n\t\t\treturn draft.executeDraftValidation(draftRootContext, appComponent, this.collaborativeDraft.isConnected());\n\t\t}\n\t}\n\n\t/**\n\t * Saves the draft version of the document\n\t * If data has been provided on the creation rows, the related documents are created\n\t * before saving the draft version.\n\t * @param skipBindingToView Indicates if the binding to the view should be skipped\n\t * @returns Promise\n\t */\n\tasync _saveDocument(skipBindingToView?: boolean): Promise<void> {\n\t\tconst context = this.getView().getBindingContext();\n\t\tconst model = this.getView().getModel(\"ui\"),\n\t\t\tawaitCreateDocuments: Promise<void | ODataListBinding>[] = [];\n\t\t// indicates if we are creating a new row in the OP\n\t\tlet executeSideEffectsOnError = false;\n\t\tBusyLocker.lock(model);\n\t\ttry {\n\t\t\tif (this.collaborativeDraft.isCollaborationEnabled()) {\n\t\t\t\ttry {\n\t\t\t\t\tconst dialogAction = await new CollaborationDiscard(this.getView(), true).getUserAction();\n\t\t\t\t\t// We cancel the action\n\t\t\t\t\tif (dialogAction === \"cancel\") {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// We keep the draft and leave for LR\n\t\t\t\t\tif (dialogAction === \"keepDraft\") {\n\t\t\t\t\t\tthis.collaborativeDraft.disconnect();\n\t\t\t\t\t\tawait this._routing.navigateBackFromContext(context);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tLog.error(`Something went wrong with collaboration discard: ${err}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tawait this.editFlow.syncTask();\n\t\t\tthis._findTables().forEach((table: Table) => {\n\t\t\t\tconst creationRow = table.getCreationRow();\n\t\t\t\tconst tableBinding = this._getTableBinding(table);\n\t\t\t\tconst contextKeys = Object.keys((creationRow?.getBindingContext() as ODataV4Context | undefined)?.getObject() || {});\n\t\t\t\tif (contextKeys.filter((key) => !key.startsWith(\"@$ui5.\")).length) {\n\t\t\t\t\texecuteSideEffectsOnError = true;\n\t\t\t\t\tawaitCreateDocuments.push(\n\t\t\t\t\t\tthis.editFlow\n\t\t\t\t\t\t\t.createDocument(tableBinding, {\n\t\t\t\t\t\t\t\tcreationMode: table.data(\"creationMode\"),\n\t\t\t\t\t\t\t\tcreationRow: creationRow,\n\t\t\t\t\t\t\t\tcreateAtEnd: table.data(\"createAtEnd\") === \"true\",\n\t\t\t\t\t\t\t\tskipSideEffects: true // the skipSideEffects is a parameter created when we click the save key. If we press this key, we don't execute the handleSideEffects funciton to avoid batch redundancy\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(() => tableBinding)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst bindings = await Promise.all(awaitCreateDocuments);\n\t\t\t// We need to either reject or resolve a promise here and return it since this save\n\t\t\t// function is not only called when pressing the save button in the footer, but also\n\t\t\t// when the user selects create or save in a dataloss popup.\n\t\t\t// The logic of the dataloss popup needs to detect if the save had errors or not in order\n\t\t\t// to decide if the subsequent action - like a back navigation - has to be executed or not.\n\t\t\ttry {\n\t\t\t\tawait this.editFlow.saveDocument(context, {\n\t\t\t\t\tbExecuteSideEffectsOnError: executeSideEffectsOnError,\n\t\t\t\t\tbindings: bindings as unknown as ODataListBinding[],\n\t\t\t\t\tmergePatchDraft: this.mergePatchDraft,\n\t\t\t\t\tskipBindingToView\n\t\t\t\t});\n\t\t\t} catch (error: unknown) {\n\t\t\t\t// If the saveDocument in editFlow returns errors we need\n\t\t\t\t// to show the message popover here and ensure that the\n\t\t\t\t// dataloss logic does not perform the follow up function\n\t\t\t\t// like e.g. a back navigation hence we return a promise and reject it\n\t\t\t\tif (error !== RecommendationDialogDecision.Continue) {\n\t\t\t\t\tthis._showMessagePopover(error as string);\n\t\t\t\t}\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t} finally {\n\t\t\tif (BusyLocker.isLocked(model)) {\n\t\t\t\tBusyLocker.unlock(model);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync _cancelDocument(mParameters: { cancelButton: string }): Promise<Context | void> {\n\t\tconst context = this.getView()?.getBindingContext();\n\t\tconst cancelButton = this.getView().byId(mParameters.cancelButton) as Button | undefined; //to get the reference of the cancel button from command execution\n\t\tconst lastFocusedControlId = UI5Element.getActiveElement()?.getId();\n\t\tlet shouldSkipDiscardPopover = false;\n\t\tif (this.collaborativeDraft.isCollaborationEnabled()) {\n\t\t\ttry {\n\t\t\t\tconst dialogAction = await new CollaborationDiscard(this.getView(), false).getUserAction();\n\t\t\t\t// We cancel the action\n\t\t\t\tif (dialogAction === \"cancel\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// We keep the draft and leave for LR\n\t\t\t\tif (dialogAction === \"keepDraft\") {\n\t\t\t\t\tthis.collaborativeDraft.disconnect();\n\t\t\t\t\tawait this._routing.navigateBackFromContext(context);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// We have displayed the dialog and the user confirmed the discard -> We skip the discard confirmation\n\t\t\t\tif (dialogAction === \"discardConfirmed\") {\n\t\t\t\t\tshouldSkipDiscardPopover = true;\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tLog.error(\"Cannot get collaborative users\");\n\t\t\t}\n\t\t}\n\t\tconst isDocumentModified =\n\t\t\t!!this.getView().getModel(\"ui\").getProperty(UiModelConstants.DocumentModified) || !context.getProperty(\"HasActiveEntity\");\n\t\tconst afterCancel: Function = (promiseResult: ODataV4Context) => {\n\t\t\t// focus is retained on the last focused element\n\t\t\tif (lastFocusedControlId !== undefined) {\n\t\t\t\tUI5Element.getElementById(lastFocusedControlId)?.focus();\n\t\t\t}\n\t\t\treturn promiseResult;\n\t\t};\n\t\tif (\n\t\t\t(this.getAppComponent()?.getEnvironmentCapabilities()?.getCapabilities()?.HiddenDraft as HiddenDraft)?.enabled &&\n\t\t\tisDocumentModified\n\t\t) {\n\t\t\treturn draft.processDataLossOrDraftDiscardConfirmation(\n\t\t\t\tafterCancel,\n\t\t\t\tFunction.prototype,\n\t\t\t\tcontext,\n\t\t\t\tthis,\n\t\t\t\tfalse,\n\t\t\t\tdraft.NavigationType.BackNavigation,\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t\treturn this.editFlow\n\t\t\t.cancelDocument(context, { control: cancelButton, skipDiscardPopover: shouldSkipDiscardPopover })\n\t\t\t.then((promiseResult) => {\n\t\t\t\treturn afterCancel(promiseResult);\n\t\t\t});\n\t}\n\n\tasync _applyDocument(oContext: ODataV4Context): Promise<void> {\n\t\treturn this.editFlow.applyDocument(oContext).catch(() => {\n\t\t\tthis._showMessagePopover();\n\t\t\treturn;\n\t\t});\n\t}\n\n\t_updateRelatedApps(): void {\n\t\tconst oObjectPage = this._getObjectPageLayoutControl();\n\t\tconst showRelatedApps = oObjectPage.data(\"showRelatedApps\");\n\t\tif (showRelatedApps === \"true\" || showRelatedApps === true) {\n\t\t\tconst appComponent = CommonUtils.getAppComponent(this.getView());\n\t\t\tCommonUtils.updateRelatedAppsDetails(oObjectPage, appComponent);\n\t\t}\n\t}\n\n\t_findControlInSubSection(aParentElement: Control[], aSubsection: ObjectPageSubSection, aControls: Control[], bIsChart?: boolean): void {\n\t\tfor (const item1 of aParentElement) {\n\t\t\tlet oElement = (item1 as MacroAPI).getContent instanceof Function ? (item1 as MacroAPI).getContent() : undefined;\n\t\t\tif (bIsChart) {\n\t\t\t\tif (oElement?.getAggregation(\"items\")) {\n\t\t\t\t\tconst items = oElement.getAggregation(\"items\") as Control[];\n\t\t\t\t\titems.forEach(function (item: Control) {\n\t\t\t\t\t\tif (item.isA<ChartBlock>(\"sap.fe.macros.Chart\")) {\n\t\t\t\t\t\t\tconst chartControl = item.getChartControl();\n\t\t\t\t\t\t\taControls.push(chartControl);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (oElement && oElement.isA && oElement.isA<DynamicSideContent>(\"sap.ui.layout.DynamicSideContent\")) {\n\t\t\t\t\tconst oSubElement = oElement.getMainContent instanceof Function ? oElement.getMainContent() : undefined;\n\t\t\t\t\tif (oSubElement && oSubElement.length > 0) {\n\t\t\t\t\t\toElement = oSubElement[0];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// The table may currently be shown in a full screen dialog, we can then get the reference to the TableAPI\n\t\t\t\t// control from the custom data of the place holder panel\n\t\t\t\tif (oElement && oElement.isA && oElement.isA(\"sap.m.Panel\") && oElement.data(\"FullScreenTablePlaceHolder\")) {\n\t\t\t\t\toElement = oElement.data(\"tableAPIreference\");\n\t\t\t\t}\n\t\t\t\tif (oElement && oElement.isA && oElement.isA<TableAPI>(\"sap.fe.macros.table.TableAPI\")) {\n\t\t\t\t\tconst oSubElement = oElement.getContent instanceof Function ? oElement.getContent() : undefined;\n\t\t\t\t\tif (oSubElement && oSubElement.isA && oSubElement.isA<Table>(\"sap.ui.mdc.Table\")) {\n\t\t\t\t\t\taControls.push(oSubElement);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_getAllSubSections(): ObjectPageSubSection[] {\n\t\tconst oObjectPage = this._getObjectPageLayoutControl();\n\t\tlet aSubSections: ObjectPageSubSection[] = [];\n\t\toObjectPage.getSections().forEach(function (oSection: ObjectPageSection) {\n\t\t\taSubSections = aSubSections.concat(oSection.getSubSections());\n\t\t});\n\t\treturn aSubSections;\n\t}\n\n\t_getAllBlocks(): EnhanceWithUI5<SubSectionBlock>[] {\n\t\tlet aBlocks: EnhanceWithUI5<SubSectionBlock>[] = [];\n\t\tthis._getAllSubSections().forEach(function (oSubSection: ObjectPageSubSection) {\n\t\t\taBlocks = aBlocks.concat(oSubSection.getBlocks() as EnhanceWithUI5<SubSectionBlock>[]);\n\t\t});\n\t\treturn aBlocks;\n\t}\n\n\t_findTables(): Table[] {\n\t\tconst aSubSections = this._getAllSubSections();\n\t\tconst aTables: Table[] = [];\n\t\tfor (let subSection = 0; subSection < aSubSections.length; subSection++) {\n\t\t\tthis._findControlInSubSection(aSubSections[subSection].getBlocks(), aSubSections[subSection], aTables);\n\t\t\tthis._findControlInSubSection(aSubSections[subSection].getMoreBlocks(), aSubSections[subSection], aTables);\n\t\t}\n\t\treturn aTables;\n\t}\n\n\t_findCharts(): Chart[] {\n\t\tconst aSubSections = this._getAllSubSections();\n\t\tconst aCharts: Chart[] = [];\n\t\tfor (let subSection = 0; subSection < aSubSections.length; subSection++) {\n\t\t\tthis._findControlInSubSection(aSubSections[subSection].getBlocks(), aSubSections[subSection], aCharts, true);\n\t\t\tthis._findControlInSubSection(aSubSections[subSection].getMoreBlocks(), aSubSections[subSection], aCharts, true);\n\t\t}\n\t\treturn aCharts;\n\t}\n\n\t_closeSideContent(): void {\n\t\tthis._getAllBlocks().forEach(function (oBlock: EnhanceWithUI5<SubSectionBlock>): void {\n\t\t\tconst oContent = oBlock.getContent instanceof Function && oBlock.getContent();\n\t\t\tif (oContent && oContent.isA && oContent.isA<DynamicSideContent>(\"sap.ui.layout.DynamicSideContent\")) {\n\t\t\t\tif (oContent.setShowSideContent instanceof Function) {\n\t\t\t\t\toContent.setShowSideContent(false, false);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Chart Context is resolved for 1:n microcharts.\n\t * @param oChartContext The Context of the MicroChart\n\t * @param sChartPath The collectionPath of the the chart\n\t * @returns Array of Attributes of the chart Context\n\t */\n\t_getChartContextData(oChartContext: Context, sChartPath: string): unknown[] {\n\t\tconst oContextData = oChartContext.getObject();\n\t\tlet oChartContextData = [oContextData];\n\t\tif (oChartContext && sChartPath) {\n\t\t\tif (oContextData[sChartPath]) {\n\t\t\t\toChartContextData = oContextData[sChartPath];\n\t\t\t\tdelete oContextData[sChartPath];\n\t\t\t\toChartContextData.push(oContextData);\n\t\t\t}\n\t\t}\n\t\treturn oChartContextData;\n\t}\n\n\t/**\n\t * Scroll the tables to the row with the sPath\n\t * @param {string} sRowPath 'sPath of the table row'\n\t */\n\n\t_scrollTablesToRow(sRowPath: string): void {\n\t\tif (this._findTables && this._findTables().length > 0) {\n\t\t\tconst aTables = this._findTables();\n\t\t\tfor (const item of aTables) {\n\t\t\t\tTableScroller.scrollTableToRow(item, sRowPath);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Method to merge selected contexts and filters.\n\t * @param oPageContext Page context\n\t * @param aLineContext Selected Contexts\n\t * @param sChartPath Collection name of the chart\n\t * @returns Selection Variant Object\n\t */\n\t_mergeMultipleContexts(\n\t\toPageContext: Context,\n\t\taLineContext: ODataV4Context[],\n\t\tsChartPath: string\n\t): { selectionVariant: SelectionVariant; attributes: unknown[] } {\n\t\tlet aAttributes: unknown[] = [],\n\t\t\taPageAttributes = [],\n\t\t\toContext,\n\t\t\tsMetaPathLine: string,\n\t\t\tsPathLine;\n\n\t\tconst sPagePath = oPageContext.getPath();\n\t\tconst oMetaModel = oPageContext && oPageContext.getModel() && oPageContext.getModel().getMetaModel();\n\t\tconst sMetaPathPage = oMetaModel && oMetaModel.getMetaPath(sPagePath).replace(/^\\/*/, \"\");\n\n\t\t// Get single line context if necessary\n\t\tif (aLineContext && aLineContext.length) {\n\t\t\toContext = aLineContext[0];\n\t\t\tsPathLine = oContext.getPath();\n\t\t\tsMetaPathLine = oMetaModel && oMetaModel.getMetaPath(sPathLine).replace(/^\\/*/, \"\");\n\n\t\t\taLineContext.forEach((oSingleContext: ODataV4Context): void => {\n\t\t\t\tif (sChartPath) {\n\t\t\t\t\tconst oChartContextData = this._getChartContextData(oSingleContext, sChartPath);\n\t\t\t\t\tif (oChartContextData) {\n\t\t\t\t\t\taAttributes = oChartContextData.map(function (oSubChartContextData: unknown) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tcontextData: oSubChartContextData,\n\t\t\t\t\t\t\t\tentitySet: `${sMetaPathPage}/${sChartPath}`\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\taAttributes.push({\n\t\t\t\t\t\tcontextData: oSingleContext.getObject(),\n\t\t\t\t\t\tentitySet: sMetaPathLine\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\taPageAttributes.push({\n\t\t\tcontextData: oPageContext.getObject(),\n\t\t\tentitySet: sMetaPathPage\n\t\t});\n\t\t// Adding Page Context to selection variant\n\t\taPageAttributes = this._intentBasedNavigation.removeSensitiveData(aPageAttributes, sMetaPathPage);\n\t\tconst oPageLevelSV = CommonUtils.addPageContextToSelectionVariant(new SelectionVariant(), aPageAttributes, this.getView());\n\t\taAttributes = this._intentBasedNavigation.removeSensitiveData(aAttributes, sMetaPathPage);\n\t\treturn {\n\t\t\tselectionVariant: oPageLevelSV,\n\t\t\tattributes: aAttributes\n\t\t};\n\t}\n\n\t_getBatchGroupsForView(): string[] {\n\t\tconst oViewData = this.getView().getViewData(),\n\t\t\toConfigurations = oViewData.controlConfiguration,\n\t\t\taConfigurations = oConfigurations && Object.keys(oConfigurations),\n\t\t\taBatchGroups = [\"$auto.Heroes\", \"$auto.Decoration\", \"$auto.Workers\"];\n\n\t\tif (aConfigurations && aConfigurations.length > 0) {\n\t\t\taConfigurations.forEach(function (sKey) {\n\t\t\t\tconst oConfiguration = oConfigurations[sKey] as MicroChartManifestConfiguration;\n\t\t\t\tif (oConfiguration.requestGroupId === \"LongRunners\") {\n\t\t\t\t\taBatchGroups.push(\"$auto.LongRunners\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn aBatchGroups;\n\t}\n\n\t/**\n\t * Method to initialize pagination.\n\t * @param context Context of object page\n\t * @param internalModel Internal model\n\t * @param listBinding Parent list binding to use\n\t */\n\t_initializePagination(context: ODataV4Context, internalModel: JSONModel, listBinding?: ODataListBinding): void {\n\t\tconst viewLevel = this.getView().getViewData().viewLevel;\n\t\tif (viewLevel > 1) {\n\t\t\tconst paginatorCurrentContext = internalModel.getProperty(\"/paginatorCurrentContext\");\n\t\t\tif (paginatorCurrentContext) {\n\t\t\t\tconst bindingToUse = paginatorCurrentContext.getBinding();\n\t\t\t\tthis.paginator.initialize(bindingToUse, paginatorCurrentContext);\n\t\t\t\tinternalModel.setProperty(\"/paginatorCurrentContext\", null);\n\t\t\t} else if (listBinding) {\n\t\t\t\tthis.paginator.initialize(listBinding, context);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Method to update the Breadcrumbs' links and the corresponding href when the context changes.\n\t * @param source Breadcrumbs control\n\t * @returns A Promise that is resolved when the Breadcrumbs content is filled properly\n\t * @private\n\t */\n\tasync setBreadcrumbLinks(source: BreadCrumbs): Promise<void> {\n\t\tconst context = source.getBindingContext(),\n\t\t\tappComponent = this.getAppComponent(),\n\t\t\tpromises: Promise<TitleInformation>[] = [],\n\t\t\tnewPath = context?.getPath(),\n\t\t\tpathParts = newPath?.split(\"/\") ?? [],\n\t\t\tmetaModel = appComponent && appComponent.getMetaModel();\n\t\tlet path = \"\";\n\t\ttry {\n\t\t\tpathParts.shift();\n\t\t\tpathParts.splice(-1, 1);\n\t\t\tpathParts.forEach(function (pathPart: string) {\n\t\t\t\tpath += `/${pathPart}`;\n\t\t\t\tif (!appComponent.getRouter().getRouteInfoByHash(path)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst rootViewController = appComponent.getRootViewController();\n\t\t\t\tconst parameterPath = metaModel.getMetaPath(path);\n\t\t\t\tconst resultContext = metaModel.getObject(`${parameterPath}/@com.sap.vocabularies.Common.v1.ResultContext`);\n\t\t\t\tif (resultContext) {\n\t\t\t\t\t// We dont need to create a breadcrumb for Parameter path\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tpromises.push(rootViewController.getTitleInfoFromPath(path));\n\t\t\t});\n\t\t\tconst titleHierarchyInfos: TitleInformation[] = await Promise.all(promises);\n\t\t\tlet hierarchyPosition, link;\n\t\t\tfor (const titleHierarchyInfo of titleHierarchyInfos) {\n\t\t\t\thierarchyPosition = titleHierarchyInfos.indexOf(titleHierarchyInfo);\n\t\t\t\tlink = source.getLinks()[hierarchyPosition] ? source.getLinks()[hierarchyPosition] : new Link();\n\t\t\t\t//sCurrentEntity is a fallback value in case of empty title\n\t\t\t\tlink.setText(titleHierarchyInfo.subtitle || titleHierarchyInfo.title);\n\t\t\t\t//We apply an additional encodeURI in case of special characters (ie \"/\") used in the url through the semantic keys\n\t\t\t\tlink.setHref(encodeURI(titleHierarchyInfo.intent!));\n\t\t\t\tif (!source.getLinks()[hierarchyPosition]) {\n\t\t\t\t\tsource.addLink(link);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(\"Error while setting the breadcrumb links:\" + error);\n\t\t}\n\t}\n\n\t_checkDataPointTitleForExternalNavigation(): void {\n\t\tconst oView = this.getView();\n\t\tconst oInternalModelContext = oView.getBindingContext(\"internal\") as InternalModelContext;\n\t\tconst oDataPoints = CommonUtils.getHeaderFacetItemConfigForExternalNavigation(\n\t\t\toView.getViewData() as Record<string, unknown>,\n\t\t\tthis.getAppComponent().getRoutingService().getOutbounds()\n\t\t);\n\t\tconst oShellServices = this.getAppComponent().getShellServices();\n\t\tconst oPageContext = oView && oView.getBindingContext();\n\t\toInternalModelContext.setProperty(\"isHeaderDPLinkVisible\", {});\n\t\tif (oPageContext) {\n\t\t\toPageContext\n\t\t\t\t.requestObject()\n\t\t\t\t.then(function (oData: object) {\n\t\t\t\t\treturn fnGetLinks(oDataPoints, oData);\n\t\t\t\t})\n\t\t\t\t.catch(function (oError: unknown) {\n\t\t\t\t\tLog.error(\"Cannot retrieve the links from the shell service\", oError as string);\n\t\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * @param oError\n\t\t */\n\t\tfunction fnOnError(oError: string): void {\n\t\t\tLog.error(oError);\n\t\t}\n\n\t\tfunction fnSetLinkEnablement(id: string, aSupportedLinks: { supported?: boolean }[]): void {\n\t\t\tconst sLinkId = id;\n\t\t\t// process viable links from getLinks for all datapoints having outbound\n\t\t\tif (aSupportedLinks && aSupportedLinks.length === 1 && aSupportedLinks[0].supported) {\n\t\t\t\toInternalModelContext.setProperty(`isHeaderDPLinkVisible/${sLinkId}`, true);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @param oSubDataPoints\n\t\t * @param oPageData\n\t\t */\n\t\tfunction fnGetLinks(\n\t\t\toSubDataPoints: Record<\n\t\t\t\tstring,\n\t\t\t\t{\n\t\t\t\t\tsemanticObject: string;\n\t\t\t\t\taction: string;\n\t\t\t\t\tsemanticObjectMapping: MetaModelType<SemanticObjectMappingType>[];\n\t\t\t\t}\n\t\t\t>,\n\t\t\toPageData: object\n\t\t): void {\n\t\t\tfor (const sId in oSubDataPoints) {\n\t\t\t\tconst oDataPoint = oSubDataPoints[sId];\n\t\t\t\tconst oParams: Record<string, unknown> = {};\n\t\t\t\tconst oLink = oView.byId(sId);\n\t\t\t\tif (!oLink) {\n\t\t\t\t\t// for data points configured in app descriptor but not annotated in the header\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst oLinkContext = oLink.getBindingContext();\n\t\t\t\tconst oLinkData: object = oLinkContext && oLinkContext.getObject();\n\t\t\t\tlet oMixedContext: Record<string, unknown> = merge({}, oPageData, oLinkData) as Record<string, unknown>;\n\t\t\t\t// process semantic object mappings\n\t\t\t\tif (oDataPoint.semanticObjectMapping) {\n\t\t\t\t\tconst aSemanticObjectMapping = oDataPoint.semanticObjectMapping;\n\t\t\t\t\tfor (const item in aSemanticObjectMapping) {\n\t\t\t\t\t\tconst oMapping = aSemanticObjectMapping[item];\n\t\t\t\t\t\tconst sMainProperty = oMapping[\"LocalProperty\"]![\"$PropertyPath\"];\n\t\t\t\t\t\tconst sMappedProperty = oMapping[\"SemanticObjectProperty\"]!;\n\t\t\t\t\t\tif (sMainProperty !== sMappedProperty) {\n\t\t\t\t\t\t\tif (oMixedContext.hasOwnProperty(sMainProperty)) {\n\t\t\t\t\t\t\t\tconst oNewMapping: Record<string, unknown> = {};\n\t\t\t\t\t\t\t\toNewMapping[sMappedProperty] = oMixedContext[sMainProperty];\n\t\t\t\t\t\t\t\toMixedContext = merge({}, oMixedContext, oNewMapping) as Record<string, unknown>;\n\t\t\t\t\t\t\t\tdelete oMixedContext[sMainProperty];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (oMixedContext) {\n\t\t\t\t\tfor (const sKey in oMixedContext) {\n\t\t\t\t\t\tif (!sKey.startsWith(\"_\") && !sKey.includes(\"odata.context\")) {\n\t\t\t\t\t\t\toParams[sKey] = oMixedContext[sKey];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// validate if a link must be rendered\n\t\t\t\toShellServices\n\t\t\t\t\t.isNavigationSupported([\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget: {\n\t\t\t\t\t\t\t\tsemanticObject: oDataPoint.semanticObject,\n\t\t\t\t\t\t\t\taction: oDataPoint.action\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tparams: oParams\n\t\t\t\t\t\t}\n\t\t\t\t\t])\n\t\t\t\t\t.then((aLinks) => {\n\t\t\t\t\t\treturn fnSetLinkEnablement(sId, aLinks);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(fnOnError);\n\t\t\t}\n\t\t}\n\t}\n\n\thandlers = {\n\t\tonPrimaryAction(\n\t\t\toController: ObjectPageController,\n\t\t\toView: FEView,\n\t\t\toContext: ODataV4Context,\n\t\t\tsActionName: string,\n\t\t\tmParameters: {\n\t\t\t\tparameterValues?: { name: string; value: unknown }[];\n\t\t\t\tskipParameterDialog?: boolean;\n\t\t\t\tcontexts?: ODataV4Context | ODataV4Context[];\n\t\t\t\tmodel?: ODataModel;\n\t\t\t\trequiresNavigation?: boolean;\n\t\t\t\tlabel?: string;\n\t\t\t\tisNavigable?: boolean;\n\t\t\t\tentitySetName?: string;\n\t\t\t\tinvocationGrouping?: string;\n\t\t\t\toperationAvailableMap?: string;\n\t\t\t\tcontrolId?: string;\n\t\t\t\tbStaticAction?: boolean;\n\t\t\t\tapplicableContexts?: ODataV4Context[];\n\t\t\t\tnotApplicableContexts?: ODataV4Context[];\n\t\t\t\tenableAutoScroll?: boolean;\n\t\t\t\tdefaultValuesExtensionFunction?: string;\n\t\t\t},\n\t\t\tmConditions: {\n\t\t\t\tpositiveActionVisible: boolean;\n\t\t\t\tpositiveActionEnabled: boolean;\n\t\t\t\teditActionVisible: boolean;\n\t\t\t\teditActionEnabled: boolean;\n\t\t\t}\n\t\t): void {\n\t\t\t/**\n\t\t\t * Invokes the page primary action on press of Ctrl+Enter.\n\t\t\t */\n\t\t\tconst iViewLevel = oController.getView().getViewData().viewLevel;\n\t\t\tif (mConditions.positiveActionVisible) {\n\t\t\t\tif (mConditions.positiveActionEnabled) {\n\t\t\t\t\toController.handlers.onCallAction(oView, sActionName, mParameters);\n\t\t\t\t}\n\t\t\t} else if (mConditions.editActionVisible) {\n\t\t\t\tif (mConditions.editActionEnabled) {\n\t\t\t\t\toController._editDocument();\n\t\t\t\t}\n\t\t\t} else if (iViewLevel === 1 && CommonUtils.getIsEditable(oView)) {\n\t\t\t\toController._saveDocument();\n\t\t\t} else if (CommonUtils.getIsEditable(oView)) {\n\t\t\t\toController._applyDocument(oContext);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Manages the context change event on the tables.\n\t\t * The focus is set if this change is related to an editFlow action and\n\t\t * an event is fired on the objectPage messageButton.\n\t\t * @param this The objectPage controller\n\t\t * @param event The UI5 event\n\t\t */\n\t\tasync onTableContextChange(this: ObjectPageController, event: UI5Event<{}, TableAPI>): Promise<void> {\n\t\t\tconst tableAPI = event.getSource();\n\t\t\tconst table = tableAPI.content;\n\t\t\tconst currentActionPromise = this.editFlow.getCurrentActionPromise();\n\t\t\tconst tableContexts = this._getTableBinding(table)?.getCurrentContexts();\n\n\t\t\tif (currentActionPromise && tableContexts?.length) {\n\t\t\t\ttry {\n\t\t\t\t\tconst actionResponse = await currentActionPromise;\n\t\t\t\t\tif (actionResponse?.controlId === table.getId()) {\n\t\t\t\t\t\tconst actionData = actionResponse.oData;\n\t\t\t\t\t\tconst keys = actionResponse.keys;\n\t\t\t\t\t\tconst newItem = tableContexts.findIndex((tableContext: Context) => {\n\t\t\t\t\t\t\tconst tableData = tableContext.getObject();\n\t\t\t\t\t\t\treturn keys.every((key: string) => tableData[key] === actionData[key]);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (newItem !== -1) {\n\t\t\t\t\t\t\tconst dialog = InstanceManager.getOpenDialogs().find((dialog) => dialog.data(\"FullScreenDialog\") !== true);\n\t\t\t\t\t\t\tif (dialog) {\n\t\t\t\t\t\t\t\t// by design, a sap.m.dialog set the focus to the previous focused element when closing.\n\t\t\t\t\t\t\t\t// we should wait for the dialog to be closed before set the focus to another element\n\t\t\t\t\t\t\t\tdialog.attachEventOnce(\"afterClose\", () => {\n\t\t\t\t\t\t\t\t\ttable.focusRow(newItem, true);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttable.focusRow(newItem, true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.editFlow.deleteCurrentActionPromise();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tLog.error(`An error occurs while scrolling to the newly created Item: ${e}`);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// fire ModelContextChange on the message button whenever the table context changes\n\t\t\tthis.messageButton.fireModelContextChange();\n\t\t},\n\n\t\tasync onCallAction(\n\t\t\toView: FEView,\n\t\t\tsActionName: string,\n\t\t\tmParameters: {\n\t\t\t\tparameterValues?: { name: string; value: unknown }[];\n\t\t\t\tskipParameterDialog?: boolean;\n\t\t\t\tcontexts?: ODataV4Context | ODataV4Context[];\n\t\t\t\tmodel?: ODataModel;\n\t\t\t\trequiresNavigation?: boolean;\n\t\t\t\tlabel?: string;\n\t\t\t\tisNavigable?: boolean;\n\t\t\t\tentitySetName?: string;\n\t\t\t\tinvocationGrouping?: string;\n\t\t\t\toperationAvailableMap?: string;\n\t\t\t\tcontrolId?: string;\n\t\t\t\tbStaticAction?: boolean;\n\t\t\t\tapplicableContexts?: ODataV4Context[];\n\t\t\t\tnotApplicableContexts?: ODataV4Context[];\n\t\t\t\tenableAutoScroll?: boolean;\n\t\t\t\tdefaultValuesExtensionFunction?: string;\n\t\t\t}\n\t\t): Promise<unknown> {\n\t\t\tconst oController = oView.getController() as ObjectPageController;\n\n\t\t\t// Wait for VH values to be resolved before calling the action\n\t\t\tawait oController.editFlow.syncTask();\n\n\t\t\treturn oController.editFlow\n\t\t\t\t.invokeAction(sActionName, { ...mParameters, ...{ feFrameworkCall: true } })\n\t\t\t\t.then(oController._showMessagePopover.bind(oController, undefined))\n\t\t\t\t.catch(oController._showMessagePopover.bind(oController));\n\t\t},\n\t\tonDataPointTitlePressed(\n\t\t\toController: ObjectPageController,\n\t\t\toSource: Control,\n\t\t\toManifestOutbound: Record<string, ManifestOutboundEntry>,\n\t\t\tsControlConfig: string,\n\t\t\tsCollectionPath: string\n\t\t): void {\n\t\t\toManifestOutbound = typeof oManifestOutbound === \"string\" ? JSON.parse(oManifestOutbound) : oManifestOutbound;\n\t\t\tconst oTargetInfo = oManifestOutbound[sControlConfig],\n\t\t\t\toDataPointOrChartBindingContext = oSource.getBindingContext()!,\n\t\t\t\tsMetaPath = oDataPointOrChartBindingContext\n\t\t\t\t\t.getModel()\n\t\t\t\t\t.getMetaModel()\n\t\t\t\t\t.getMetaPath(oDataPointOrChartBindingContext.getPath());\n\t\t\tlet aSemanticObjectMapping = CommonUtils.getSemanticObjectMapping(oTargetInfo),\n\t\t\t\taNavigationData = oController._getChartContextData(oDataPointOrChartBindingContext, sCollectionPath),\n\t\t\t\tadditionalNavigationParameters;\n\n\t\t\taNavigationData = aNavigationData.map(function (oNavigationData: unknown) {\n\t\t\t\treturn {\n\t\t\t\t\tdata: oNavigationData,\n\t\t\t\t\tmetaPath: sMetaPath + (sCollectionPath ? `/${sCollectionPath}` : \"\")\n\t\t\t\t};\n\t\t\t});\n\t\t\tif (oTargetInfo && oTargetInfo.parameters) {\n\t\t\t\tconst oParams = oTargetInfo.parameters && oController._intentBasedNavigation.getOutboundParams(oTargetInfo.parameters);\n\t\t\t\tif (Object.keys(oParams).length > 0) {\n\t\t\t\t\tadditionalNavigationParameters = oParams;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Check if implicit semantic object mapping is needed\n\t\t\tif (aSemanticObjectMapping.length === 0) {\n\t\t\t\tconst customData = oSource.getCustomData().find((data) => data.getKey() === \"ValuePropertyPath\");\n\t\t\t\tif (customData) {\n\t\t\t\t\taSemanticObjectMapping = oController._getImplicitSemanticObjectMappingForDataPoints(\n\t\t\t\t\t\tcustomData.getValue(),\n\t\t\t\t\t\toTargetInfo.semanticObject\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (oTargetInfo && oTargetInfo.semanticObject && oTargetInfo.action) {\n\t\t\t\toController._intentBasedNavigation.navigate(oTargetInfo.semanticObject, oTargetInfo.action, {\n\t\t\t\t\tnavigationContexts: aNavigationData,\n\t\t\t\t\tsemanticObjectMapping: aSemanticObjectMapping,\n\t\t\t\t\tadditionalNavigationParameters: additionalNavigationParameters\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Triggers an outbound navigation when a user chooses the chevron.\n\t\t * @param oController\n\t\t * @param sOutboundTarget Name of the outbound target (needs to be defined in the manifest)\n\t\t * @param oContext The context that contains the data for the target app\n\t\t * @param sCreatePath Create path when the chevron is created.\n\t\t * @returns Promise which is resolved once the navigation is triggered (??? maybe only once finished?)\n\t\t * @final\n\t\t */\n\t\tasync onChevronPressNavigateOutBound(\n\t\t\toController: ObjectPageController,\n\t\t\tsOutboundTarget: string,\n\t\t\toContext: ODataV4Context,\n\t\t\tsCreatePath: string\n\t\t): Promise<void> {\n\t\t\treturn oController._intentBasedNavigation.onChevronPressNavigateOutBound(oController, sOutboundTarget, oContext, sCreatePath);\n\t\t},\n\n\t\tonNavigateChange(this: ObjectPageController, oEvent: UI5Event<{ subSection: ObjectPageSubSection }>): void {\n\t\t\t//will be called always when we click on a section tab\n\t\t\tthis.getExtensionAPI().updateAppState();\n\t\t\tthis.bSectionNavigated = true;\n\n\t\t\tconst oInternalModelContext = this.getView().getBindingContext(\"internal\") as InternalModelContext;\n\t\t\tif (\n\t\t\t\tCommonUtils.getIsEditable(this.getView()) &&\n\t\t\t\tthis.getView().getViewData().sectionLayout === \"Tabs\" &&\n\t\t\t\toInternalModelContext.getProperty(\"errorNavigationSectionFlag\") === false\n\t\t\t) {\n\t\t\t\tconst oSubSection = oEvent.getParameter(\"subSection\");\n\t\t\t\tthis._updateFocusInEditMode([oSubSection]);\n\t\t\t}\n\t\t},\n\t\tonVariantSelected: function (this: ObjectPageController): void {\n\t\t\tthis.getExtensionAPI().updateAppState();\n\t\t},\n\t\tonVariantSaved: function (this: ObjectPageController): void {\n\t\t\t//TODO: Should remove this setTimeOut once Variant Management provides an api to fetch the current variant key on save\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.getExtensionAPI().updateAppState();\n\t\t\t}, 2000);\n\t\t},\n\t\tnavigateToSubSection: function (oController: ObjectPageController, vDetailConfig: string | object): void {\n\t\t\tconst oDetailConfig = typeof vDetailConfig === \"string\" ? JSON.parse(vDetailConfig) : vDetailConfig;\n\t\t\tconst oObjectPage = oController.getView().byId(\"fe::ObjectPage\") as ObjectPageLayout;\n\t\t\tlet oSection;\n\t\t\tlet oSubSection;\n\t\t\tif (oDetailConfig.sectionId) {\n\t\t\t\toSection = oController.getView().byId(oDetailConfig.sectionId) as ObjectPageSection;\n\t\t\t\toSubSection = (\n\t\t\t\t\toDetailConfig.subSectionId\n\t\t\t\t\t\t? oController.getView().byId(oDetailConfig.subSectionId)\n\t\t\t\t\t\t: oSection && oSection.getSubSections() && oSection.getSubSections()[0]\n\t\t\t\t) as ObjectPageSubSection;\n\t\t\t} else if (oDetailConfig.subSectionId) {\n\t\t\t\toSubSection = oController.getView().byId(oDetailConfig.subSectionId) as ObjectPageSubSection;\n\t\t\t\toSection = oSubSection && (oSubSection.getParent() as ObjectPageSection);\n\t\t\t}\n\t\t\tif (!oSection || !oSubSection || !oSection.getVisible() || !oSubSection.getVisible()) {\n\t\t\t\tconst sTitle = getResourceModel(oController).getText(\n\t\t\t\t\t\"C_ROUTING_NAVIGATION_DISABLED_TITLE\",\n\t\t\t\t\tundefined,\n\t\t\t\t\toController.getView().getViewData().entitySet\n\t\t\t\t);\n\t\t\t\tLog.error(sTitle);\n\t\t\t\tMessageBox.error(sTitle);\n\t\t\t} else {\n\t\t\t\toObjectPage.setSelectedSection(oSubSection.getId());\n\t\t\t\t// trigger iapp state change\n\t\t\t\toObjectPage.fireNavigate({\n\t\t\t\t\tsection: oSection,\n\t\t\t\t\tsubSection: oSubSection\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tcloseOPMessageStrip: function (this: ObjectPageController): void {\n\t\t\tconst view = this.getView();\n\t\t\tconst bIsInEditMode = CommonUtils.getIsEditable(view);\n\t\t\tconst internalModel = view.getModel(\"internal\");\n\t\t\tconst messagestripInternalModelContext = internalModel\n\t\t\t\t.bindContext(this.getExtensionAPI()._getMessageStripBindingContextPath())\n\t\t\t\t.getBoundContext()!;\n\t\t\t// Remove context bound messages and set the property to false for the backend transition messages in edit mode.\n\t\t\tif (!bIsInEditMode && messagestripInternalModelContext.getProperty(\"OPBackendMessageVisible\") === true) {\n\t\t\t\tconst contextBoundMessages = Messaging.getMessageModel()\n\t\t\t\t\t.getData()\n\t\t\t\t\t.filter(\n\t\t\t\t\t\t(message: Message) =>\n\t\t\t\t\t\t\tmessage.getTargets()[0] === this.getView().getBindingContext()?.getPath() && message.getPersistent() === true\n\t\t\t\t\t);\n\t\t\t\tif (contextBoundMessages.length === 1) {\n\t\t\t\t\tMessaging.removeMessages(contextBoundMessages);\n\t\t\t\t}\n\t\t\t}\n\t\t\tmessagestripInternalModelContext.setProperty(\"OPBackendMessageVisible\", false);\n\t\t\tthis.getExtensionAPI().hideMessage();\n\t\t}\n\t};\n}\n\nexport default ObjectPageController;\n"],"mappings":"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","ignoreList":[]}