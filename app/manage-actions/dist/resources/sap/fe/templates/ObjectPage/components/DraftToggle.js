/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/controls/CommandExecution","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingHelper","sap/fe/templates/ObjectPage/ObjectPageTemplating","sap/m/Button","sap/m/ResponsivePopover","sap/m/SelectList","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,i,r,n,o,a,c,s,l,p,f,u,d,_){"use strict";var g,v,h,T,b,C,w,m,O,A,I,D,E;var y={};var S=c.getSwitchToDraftVisibility;var P=c.getSwitchToActiveVisibility;var x=c.getSwitchDraftAndActiveVisibility;var R=a.UI;var B=a.Entity;var V=t.property;var M=t.implementInterface;var j=t.defineUI5Class;var z=t.defineReference;var H=e.pathInModel;var K=e.not;var F=e.ifElse;var N=e.and;function W(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function Y(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,U(e,t)}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}function k(e,t,i,r,n){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},o),n&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(n):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function G(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let J=(g=j("sap.fe.macros.DraftToggle"),v=M("sap.m.IOverflowToolbarContent"),h=V({type:"string"}),T=V({type:"string"}),b=z(),C=z(),g(w=(m=function(e){function t(t,r){var n;n=e.call(this,t,r)||this;W(n,"__implements__sap_m_IOverflowToolbarContent",O,n);n.SWITCH_TO_DRAFT_KEY="switchToDraft";n.SWITCH_TO_ACTIVE_KEY="switchToActive";W(n,"id",A,n);W(n,"contextPath",I,n);W(n,"switchToActiveRef",D,n);W(n,"switchToDraftRef",E,n);n.initialSelectedKey=n.SWITCH_TO_ACTIVE_KEY;n._hiddenDraft=false;n.handleSelectedItemChange=e=>{const t=e.getParameter("item")?.getProperty("key");if(t!==n.initialSelectedKey){n._containingView.getController().editFlow.toggleDraftActive(n._containingView.getBindingContext())}if(n.popover){n.popover.close();n.popover.destroy();delete n.popover}};n.openSwitchActivePopover=e=>{const t=e.getSource();const r=i.getTargetView(t);const o=r.getBindingContext();const a=o.getObject().IsActiveEntity;n.initialSelectedKey=a?n.SWITCH_TO_ACTIVE_KEY:n.SWITCH_TO_DRAFT_KEY;n.popover=n.createPopover();n._containingView=r;r.addDependent(n.popover);n.popover.openBy(t);n.popover.attachEventOnce("afterOpen",()=>{if(a){n.switchToDraftRef.current?.focus()}else{n.switchToActiveRef.current?.focus()}});return n.popover};return n}y=t;Y(t,e);var r=t.prototype;r.onMetadataAvailable=function e(){const t=this._getOwner()?.getRootController();this._hiddenDraft=t.getAppComponent().getEnvironmentCapabilities().getCapabilities().HiddenDraft?.enabled;if(!this.content&&!this._hiddenDraft){this.content=this.createContent()}};r.getVisible=function e(){return this.content?.getVisible()??true};r.getEnabled=function e(){return this.content?.getProperty("enabled")??true};r.getOverflowToolbarConfig=function e(){return{canOverflow:true}};r.createPopover=function e(){return d(l,{showHeader:false,contentWidth:"15.625rem",verticalScrolling:false,class:"sapUiNoContentPadding",placement:"Bottom",children:_(p,{selectedKey:this.initialSelectedKey,itemPress:this.handleSelectedItemChange,children:[d(u,{text:"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_DRAFT_MIT}",ref:this.switchToDraftRef},this.SWITCH_TO_DRAFT_KEY),d(u,{text:"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_SAVED_VERSION_MIT}",ref:this.switchToActiveRef},this.SWITCH_TO_ACTIVE_KEY)]})})};r.createContent=function e(){const t=this._getOwner()?.preprocessorContext?.fullContextPath;const i=this._getOwner()?.getMetaModel();const r=i?.createBindingContext(this.contextPath??t);const a=o.convertMetaModelContext(r);const c=F(N(K(R.IsEditable),K(R.IsCreateMode),B.HasDraft),H("C_COMMON_OBJECT_PAGE_SAVED_VERSION_BUT","sap.fe.i18n"),H("C_COMMON_OBJECT_PAGE_DRAFT_BUT","sap.fe.i18n"));const l=x(a);const p=this._getOwner()?.getRootController();const u=d(f,{text:"{sap.fe.i18n>T_HEADER_DATAPOINT_TITLE_DRAFT_SWITCHER_ARIA_BUTTON}",id:this.createId("AriaTextDraftSwitcher")});u.toStatic();const _=d(s,{id:this.createId("_dt"),"dt:designtime":"not-adaptable",text:c,visible:l,icon:"sap-icon://navigation-down-arrow",iconFirst:false,type:"Transparent",press:e=>this.openSwitchActivePopover(e),ariaDescribedBy:this.createId("AriaTextDraftSwitcher")?[this.createId("AriaTextDraftSwitcher")]:undefined});_.addDependent(u);p.getView().addDependent(d(n,{command:"SwitchToActiveObject",execute:()=>{p.editFlow.toggleDraftActive(p.getView().getBindingContext())},visible:P(a)}));p.getView().addDependent(d(n,{command:"SwitchToDraftObject",execute:()=>{p.editFlow.toggleDraftActive(p.getView().getBindingContext())},visible:S(a)}));return _};return t}(r),O=k(m.prototype,"__implements__sap_m_IOverflowToolbarContent",[v],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),A=k(m.prototype,"id",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),I=k(m.prototype,"contextPath",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),D=k(m.prototype,"switchToActiveRef",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),E=k(m.prototype,"switchToDraftRef",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),m))||w);y=J;return y},false);
//# sourceMappingURL=DraftToggle.js.map