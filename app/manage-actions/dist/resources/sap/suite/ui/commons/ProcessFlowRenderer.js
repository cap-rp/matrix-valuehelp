/*
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","./ProcessFlowLaneHeader","./AriaProperties","sap/ui/Device","sap/base/security/encodeXML","sap/ui/core/Element","sap/ui/core/Core","sap/ui/core/Lib"],function(jQuery,e,t,r,o,a,n,l,s){"use strict";var i=e.ProcessFlowZoomLevel;var d={apiVersion:2};d.render=function(e,t){var r=this._getZoomStyleClass(t),o,n,l,i=d,c,p;if(!this._oResBundle){this._oResBundle=s.getResourceBundleFor("sap.suite.ui.commons")}p=i._renderBasicStructure(e,t);if(p){return}try{o=t._getOrCreateProcessFlow();n=t._getOrCreateLaneMap();c=t._getConnectionsMap()}catch(e){t._handleException(e);return}e.openStart("table");e.attr("id",t.getId()+"-table");e.attr("aria-label",t._getAriaText());e.class("sapSuiteUiCommonsPF");e.class(a(r));e.openEnd();l=Object.keys(n).length;i._renderTableHeader(e,t,n,l);i._renderTableBody(e,t,l,o,c);e.close("table");e.close("div");e.close("div");this._writeCounter(e,t,"Right");e.renderControl(t._getScrollingArrow("right"));e.close("div")};d._renderNormalNodeHeader=function(e,r,o,a,n){e.openStart("th").attr("scope","colgroup").attr("colspan","3").attr("id",r.getId()+"-colgroup"+a).openEnd();e.renderControl(o);e.close("th");if(a<n-1){e.openStart("th").attr("scope","colgroup").attr("colspan","2").attr("id",r.getId()+"-separator"+a).openEnd();var l=t.createNewProcessSymbol(r._isHeaderMode());l.attachPress(r.ontouchend.bind(r));e.renderControl(l);e.close("th")}};d._renderMergedNodeHeader=function(e,r,o,a,n,l){var s=r._mergeLaneIdNodeStates(n);o.setState(s);a++;var i=a*3+(a-1)*2;e.openStart("th").attr("scope","colgroup").attr("colspan",i).attr("id",r.getId()+"-colgroup"+i).openEnd();e.renderControl(o);e.close("th");if(l){e.openStart("th").attr("scope","colgroup").attr("colspan","2").openEnd();var d=t.createNewProcessSymbol(r._isHeaderMode());d.attachPress(r.ontouchend.bind(r));e.renderControl(d);e.close("th")}};d._renderNode=function(e,t,o,a){if(a){var n=o.getId()+"-node";var l=o._getCurrentZoomLevelContent();e.attr("id",n);e.attr("tabindex",0);e.attr("aria-description",this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_NODE_DESC"));var s={};s.label=o._getAriaText();if(l){s.labelledBy=n+" "+l.getId()}r.writeAriaProperties(e,s,o.getAriaProperties());e.openEnd();a=false}o._setParentFlow(t);o._setZoomLevel(t.getZoomLevel());o._setFoldedCorner(t.getFoldedCorners());e.renderControl(o);return a};d._renderConnection=function(e,t,r,o){if(o){if(r.getAggregation("_labels")&&r.getAggregation("_labels").length>0){e.attr("tabindex",0)}e.openEnd();o=false}r.setZoomLevel(t.getZoomLevel());t.addAggregation("_connections",r);e.renderControl(r);return o};d._renderTableHeader=function(e,r,o,a){var n,l=null,s=null,i,d;e.openStart("thead");e.attr("id",r.getId()+"-thead");e.openEnd();e.openStart("tr");e.class("sapSuiteUiCommonsPFHeader");e.class("sapSuiteUiCommonsPFHeaderHidden");if(r.getShowLabels()){e.class("sapSuiteUiPFWithLabel")}e.openEnd();e.openStart("th").openEnd().close("th");n=0;while(n<a-1){e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");n++}e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.openStart("th").openEnd().close("th");e.close("tr");e.openStart("tr");e.class("sapSuiteUiCommonsPFHeaderRow");e.openEnd();e.openStart("th").attr("scope","col").attr("id",r.getId()+"-colstart").openEnd();i=t.createNewStartSymbol(r._isHeaderMode());e.renderControl(i);e.close("th");n=0;var c=0;var p=[];var g="#";d=false;while(n<a-1){l=o[n];s=o[n+1];if(l.getLaneId()+g===s.getLaneId()){c=c+1;p.push(l.getState())}else if(c===0){this._renderNormalNodeHeader(e,r,l,n,a)}else{p.push(l.getState());d=true;this._renderMergedNodeHeader(e,r,l,c,p,d);p=[];c=0}n++}if(c===0){if(!s){s=o[0]}this._renderNormalNodeHeader(e,r,s,n,a)}else{p.push(s.getState());d=false;this._renderMergedNodeHeader(e,r,l,c,p,d);c=0}e.openStart("th").attr("scope","col").attr("id",r.getId()+"-colend").openEnd();i=t.createNewEndSymbol(r._isHeaderMode());e.renderControl(i);e.close("th");e.close("tr");e.close("thead")};d._renderTableBody=function(e,t,r,a,n){var l,s,i,c,p;var g=d._checkIfHighlightedOrSelectedNodesExists(n);e.openStart("tbody").openEnd();i=a.length;if(i>0){e.openStart("tr").openEnd();e.openStart("td");e.attr("aria-label",this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"));e.attr("colspan",(r*5).toString());e.openEnd();e.openStart("div").attr("aria-label"," ").openEnd().close("div");e.close("td");e.close("tr")}l=0;while(l<i){e.openStart("tr").openEnd();e.openStart("td").attr("aria-label",this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC")).openEnd();e.openStart("div").attr("aria-label"," ").openEnd().close("div");e.close("td");c=a[l].length;s=0;while(s<c-1){p=a[l][s];var u=true;var _;if(s==0||s%2){e.openStart("td");_=true}else{e.openStart("td").attr("colspan","4");if(o.browser.chrome){e.class("sapSuiteUiCommonsProcessFlowZIndexForConnectors")}}if(p){if(p.getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"){u=d._renderNode(e,t,p,u)}else{p._setShowLabels(t.getShowLabels());d._setLabelsInConnection(a,n,p,{row:l,column:s},t,g);e.attr("aria-label",this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"));u=d._renderConnection(e,t,p,u)}}else if(_){e.attr("aria-label",this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC"))}if(u){e.openEnd();e.openStart("div").attr("aria-label"," ").openEnd().close("div")}e.close("td");s++}e.openStart("td").attr("aria-label",this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC")).openEnd();e.openStart("div").attr("aria-label"," ").openEnd().close("div");e.close("td");e.openStart("td").attr("aria-label",this._oResBundle.getText("PF_ARIA_PROCESS_FLOW_EMPTY_NODE_DESC")).openEnd();e.openStart("div").attr("aria-label"," ").openEnd().close("div");e.close("td");e.close("tr");l++}e.close("tbody")};d._renderBasicStructure=function(e,t){e.openStart("div",t);var o={};o.label=t._getAriaText();r.writeAriaProperties(e,o,t.getAriaProperties());e.class("sapSuiteUiPFContainer");if(t._arrowScrollable){e.class("sapPFHScrollable");if(t._bPreviousScrollForward){e.class("sapPFHScrollForward")}else{e.class("sapPFHNoScrollForward")}if(t._bPreviousScrollBack){e.class("sapPFHScrollBack")}else{e.class("sapPFHNoScrollBack")}}else{e.class("sapPFHNotScrollable")}e.openEnd();this._writeCounter(e,t,"Left");e.renderControl(t._getScrollingArrow("left"));e.openStart("div");e.attr("id",t.getId()+"-scrollContainer");e.attr("role","region");e.attr("aria-roledescription","Process Flow");e.class("sapSuiteUiScrollContainerPF");e.class("sapSuiteUiDefaultCursorPF");e.openEnd();e.openStart("div");e.attr("id",t.getId()+"-scroll-content");e.attr("tabindex",0);e.openEnd();if(!t.getLanes()||t.getLanes().length==0){e.close("div");e.close("div");e.close("div");return true}return false};d._getZoomStyleClass=function(e){switch(e.getZoomLevel()){case i.One:return"sapSuiteUiCommonsPFZoomLevel1";case i.Two:return"sapSuiteUiCommonsPFZoomLevel2";case i.Three:return"sapSuiteUiCommonsPFZoomLevel3";case i.Four:return"sapSuiteUiCommonsPFZoomLevel4";default:break}};d._setLabelsInConnection=function(e,t,r,o,a,n){for(var l=0;l<t.length;l++){var s=t[l];if(s&&s.label){for(var i=0;i<s.connectionParts.length;i++){var c=s.connectionParts[i];if(c.x===o.column&&c.y===o.row){if(e[o.row][o.column+1]&&e[o.row][o.column+1].getMetadata().getName()==="sap.suite.ui.commons.ProcessFlowNode"&&e[o.row][o.column+1].getNodeId()===s.targetNode.getNodeId()){d._setLineTypeInLabel(s,n);if(a._bHighlightedMode&&!s.label._getHighlighted()){s.label.setEnabled(false)}if(s.label.getEnabled()){if(s.label.hasListeners("press")){s.label.detachEvent("press",a._handleLabelClick,a)}s.label.attachPress(a._handleLabelClick,a)}r.addAggregation("_labels",s.label,true)}}}}}};d._setLineTypeInLabel=function(e,t){var r=false,o,a=false,l=false;if(e.sourceNode.getSelected()&&e.targetNode.getSelected()){r=true;e.label._setSelected(true)}else{e.label._setSelected(false)}o=e.targetNode;if(o.getHighlighted()){var s=o.getParents(),i;for(var d=0;d<s.length;d++){i=n.getElementById(s[d]);if(i.getHighlighted()){a=true;break}}}if(a){l=true;e.label._setHighlighted(true)}else{e.label._setHighlighted(false)}if(t&&!r&&!l){e.label._setDimmed(true)}else{e.label._setDimmed(false)}};d._checkIfHighlightedOrSelectedNodesExists=function(e){var t=false;for(var r=0;r<e.length;r++){var o=e[r];if(o.label){if(o.sourceNode.getSelected()&&o.targetNode.getSelected()||o.sourceNode.getHighlighted()&&o.targetNode.getHighlighted()){t=true}}}return t};d._writeCounter=function(e,t,r){e.openStart("span");e.attr("id",t.getId()+"-counter"+r);e.class("suiteUiPFHCounter");e.class(a("suiteUiPFHCounter"+r));e.openEnd();e.text("0");e.close("span")};return d},true);
//# sourceMappingURL=ProcessFlowRenderer.js.map